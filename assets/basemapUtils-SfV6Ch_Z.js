import{ci as s,cj as L,aD as S,aI as g,ck as u,cl as h,aZ as R,a_ as I,br as w,aP as T,aA as U}from"./index-C1aGfQcb.js";import{r as x}from"./utils-sqJe3zMg.js";const c=()=>U.getLogger("esri.support.basemapUtils");function D(){return{}}function O(e){for(const a in e){const r=e[a];S(r),delete e[a]}}function _(e,a){let r;if(typeof e=="string"){const n=e in s,t=!n&&e.includes("/");if(!n&&!t){if(g.apiKey)c().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const l=Object.entries(s).filter(([i,o])=>o.classic||o.is3d).map(([i])=>`"${i}"`).sort().join(", ");c().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`)}return null}a&&(r=a[e]),r||(r=n?u.fromId(e):new u({style:{id:e}}),a&&(a[e]=r))}else r=h(u,e);return r!=null&&r.destroyed&&(c().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function E(e,a){var r,n,t,l;return((n=(r=e.basemap)==null?void 0:r.referenceLayers)==null?void 0:n.some(i=>i.uid===a))||((l=(t=e.basemap)==null?void 0:t.baseLayers)==null?void 0:l.some(i=>i.uid===a))}function q(e){let a=null;const r=M(e),n=!(r!=null&&r.baseLayers.length);for(const t in s){const l=C(r,m(s[t]),{mustMatchReferences:n});if(l==="equal"){a=t;break}l==="base-layers-equal"&&(a=t)}return a}function F(e){return!!(e!=null&&e.baseLayers.concat(e.referenceLayers).some(k))}function k(e){if(f(e.url))return!0;if(e.type==="vector-tile")for(const a in e.sourceNameToSource){const r=e.sourceNameToSource[a];if(f(r==null?void 0:r.sourceUrl))return!0}return!1}function P(e,a){var l;if(a==null||e==null)return{spatialReference:null,updating:!1};if(a.loadStatus==="not-loaded")return a.load(),{spatialReference:null,updating:!0};if(a.spatialReference)return{spatialReference:a.spatialReference,updating:!1};if(a.baseLayers.length===0)return{spatialReference:null,updating:!1};const r=a.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const n=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?(l=r.tileInfo)==null?void 0:l.spatialReference:r.spatialReference]).filter(Boolean),t=e.spatialReference;return t?{spatialReference:n.find(i=>t.equals(i))??n[0]??null,updating:!1}:{spatialReference:n[0],updating:!1}}const A=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function f(e){if(!e)return!1;const a=new R(I(e));return!!a.authority&&A.test(a.authority)}function M(e){return e?!e.loaded&&e.resourceInfo?m(e.resourceInfo.data):{baseLayers:y(e.baseLayers),referenceLayers:y(e.referenceLayers)}:null}function y(e){return(w.isCollection(e)?e.toArray():e).map(j)}function j(e){var a,r;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:v("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null||(a=e.sublayers)==null?void 0:a.map(n=>({id:n.id,visible:n.visible})),activeLayerId:e.type==="wmts"?(r=e.activeLayer)==null?void 0:r.id:void 0}}function p(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function m(e){return e?{baseLayers:b((e.baseMapLayers??[]).filter(a=>!p(a))),referenceLayers:b((e.baseMapLayers??[]).filter(a=>p(a)))}:null}function b(e){return e.map(a=>G(a))}function G(e){let a;switch(e.layerType){case"VectorTileLayer":a="vector-tile";break;case"ArcGISTiledMapServiceLayer":a="tile";break;case"ArcGISSceneServiceLayer":a="scene";break;default:a="unknown"}return{type:a,effect:e.effect,url:v(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function C(e,a,r){return e!=null!=(a!=null)?"not-equal":!e||!a?"equal":d(e.baseLayers,a.baseLayers)?d(e.referenceLayers,a.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function d(e,a){if(e.length!==a.length)return!1;for(let r=0;r<e.length;r++)if(!K(e[r],a[r]))return!1;return!0}function K(e,a){if(e.type!==a.type||e.url!==a.url||e.minScale!==a.minScale||e.maxScale!==a.maxScale||e.visible!==a.visible||e.opacity!==a.opacity||!x(e.effect,a.effect))return!1;if(e.activeLayerId!=null||a.activeLayerId!=null)return e.activeLayerId===a.activeLayerId;if(e.sublayers!=null||a.sublayers!=null){if(e.sublayers==null||a.sublayers==null||e.sublayers.length!==a.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const n=e.sublayers.at(r),t=a.sublayers.at(r);if((n==null?void 0:n.id)!==(t==null?void 0:t.id)||(n==null?void 0:n.visible)!==(t==null?void 0:t.visible))return!1}}return!0}function v(e){return e?T(e).replace(/^\s*https?:/i,"").toLowerCase():""}function Z(e){if(!e)return null;const{thumbnailUrl:a}=e;if(a)return a;const r=q(e);return r?s[r].thumbnailUrl:L(e.baseLayers,N)}function N(e){var a;return"portalItem"in e?(a=e.portalItem)==null?void 0:a.thumbnailUrl:void 0}export{Z as O,F as T,k as U,_ as b,P as j,O as m,E as v,D as y};
