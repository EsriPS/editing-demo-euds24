const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeatureServiceSnappingSource-Cxc3WpaI.js","assets/index-C1aGfQcb.js","assets/index-qkyhuh7d.css","assets/memoize-DsJmrG76.js","assets/UpdatingHandles-DOPUoIlu.js","assets/elevationInfoUtils-DQT3uSQq.js","assets/ElevationInfo-D7CBP7sd.js","assets/lengthUtils-CFwdZ3dz.js","assets/TileKey-DZd6gJy7.js","assets/vec32-CmwgPQMd.js","assets/boundedPlane-C18Ysvcq.js","assets/sphere-DuEd_sPX.js","assets/vec42-BHDxGccW.js","assets/vec4f64-o2zAXfmz.js","assets/mat3-Dg2BrR6m.js","assets/mat3f64-q3fE-ZOt.js","assets/plane-CM4t6fNH.js","assets/mat4f64-Dk4dwAN8.js","assets/quatf64-aQ5IuZRd.js","assets/vec2f64-CCfZVA9N.js","assets/lineSegment-C6H8qMyL.js","assets/Editor-BZKF0HZM.js","assets/vec2-D9okOEat.js","assets/projectVectorToVector-Dtcb6Asj.js","assets/projectBuffer-CZ7yaGuo.js","assets/projectPointToVector-ByIVLKML.js","assets/projection-BOBOhWzm.js","assets/Spinner-CEWOvPN4.js","assets/AttachmentInfo-Cg9fIPGU.js","assets/legacyIcon-CEIp6Pa9.js","assets/FeatureLayerBase-BNIuOgAL.js","assets/commonProperties-Drl05DKJ.js","assets/HeightModelInfo-kVs8dE0B.js","assets/arcgisLayerUrl-BkZy4Mr3.js","assets/featureLayerUtils-Dy99w2fj.js","assets/Query-LPs1Zyw4.js","assets/FullTextSearch-Cza0yp3f.js","assets/TimeExtent-DGiXUfis.js","assets/timeUtils-X0MXjtQ8.js","assets/jsonUtils-CWFaUb2E.js","assets/UniqueValueRenderer-CAZbf8NT.js","assets/RendererLegendOptions-CULirduz.js","assets/diffUtils-DMLidw0V.js","assets/colorRamps-D4VCsfmX.js","assets/sizeVariableUtils-Cmcuvw-4.js","assets/visualVariableUtils-dx28E4EQ.js","assets/jsonUtils-BWWcP_yB.js","assets/defaults-Dbnhuv3C.js","assets/defaultsJSON-GKolV7NZ.js","assets/styleUtils-CEgUrR2a.js","assets/LRUCache-DbPTy7LA.js","assets/Version-DD-eRUXC.js","assets/FieldsIndex-BrdRr9E_.js","assets/UnknownTimeZone-DhxWDwo9.js","assets/OverrideHelper-D-UVQ00R.js","assets/colorUtils-BWiljOUv.js","assets/utils-D7agaEG-.js","assets/enums-CmIX1y88.js","assets/quantizationUtils-DbJV_fl5.js","assets/heatmapUtils-D0BPLm9w.js","assets/LayerFloorInfo-DzoJncEV.js","assets/Relationship-CBhq9gYu.js","assets/serviceCapabilitiesUtils-B23--4px.js","assets/arcade-DfpF5wFh.js","assets/TimeOnly-vNYE6bX9.js","assets/ImmutableArray-BPVd6ESQ.js","assets/FeatureLayer-DGRhhm0K.js","assets/MultiOriginJSONSupport-Qqzd52Lf.js","assets/Layer-CneDw8eF.js","assets/workers-CeelWDzo.js","assets/editsZScale-8GE3gysf.js","assets/queryZScale-D-ZT69l7.js","assets/FeatureSet-CeKoTEEO.js","assets/APIKeyMixin-BrvyKlIW.js","assets/ArcGISService-C1oUW8BT.js","assets/BlendLayer-CG9LFMxd.js","assets/jsonUtils-n3e_wlfQ.js","assets/parser-C4Qiz3JH.js","assets/utils-sqJe3zMg.js","assets/CustomParametersMixin-BhjpsNjD.js","assets/EditBusLayer-DCXZWvgn.js","assets/FeatureEffectLayer-gWJrS8gr.js","assets/FeatureEffect-B5YAe6Lk.js","assets/FeatureReductionLayer-DuxcLofN.js","assets/FeatureReductionSelection-tRCh97wj.js","assets/labelingInfo-BV0df7F6.js","assets/labelUtils-C_ZaLudT.js","assets/MD5-C9MwAd2G.js","assets/OperationalLayer-nNeN4Mrb.js","assets/OrderedLayer-B8Gw_A9P.js","assets/OrderByInfo-k2G4k_zV.js","assets/PortalLayer-Bqf_dhsv.js","assets/portalItemUtils-Cy9KvMYK.js","assets/RefreshableLayer-CwxQNwd3.js","assets/ScaleRangeLayer-66YiyNPI.js","assets/TemporalLayer-CR5q7V2k.js","assets/TimeInfo-CY1-cj-U.js","assets/FeatureTemplate-DJBXu3Te.js","assets/FeatureType-JHO2oVJp.js","assets/fieldProperties-CoDAhoou.js","assets/versionUtils-DBm9Te4x.js","assets/styleUtils-CFywnZa6.js","assets/popupUtils-BA1X4qoc.js","assets/AlphaCutoff-UcccL64p.js","assets/interfaces-CL2NbQte.js","assets/symbolUtils-BmmDXP-E.js","assets/utils-C2gvZghy.js","assets/mat2df32-BR-p9z6z.js","assets/webStyleSymbolUtils-kO7zmqzd.js","assets/GraphicsLayer-7fnK8PA0.js","assets/GraphicsCollection-BlUFPpxh.js","assets/screenUtils-CLE_gLy7.js","assets/signal-CRiDvIIF.js","assets/utils-CS8i_70G.js","assets/drapedUtils-BnpEPkkO.js","assets/infoFor3D-C0hFfS1m.js","assets/ViewingMode-HRfKv6NR.js","assets/utils-BQBvadb7.js","assets/widget-3rB5q3_K.js","assets/uploadAssetErrors-Cy9k5t87.js","assets/queryEngineUtils-wzzn9YcW.js","assets/VertexSnappingCandidate-CbF2FeQ4.js","assets/PointSnappingHint-DLpaNTCp.js","assets/WorkerHandle-C-9ArUR4.js","assets/TileInfo-C4AYiz3R.js","assets/debugFlags-CfZYxH5Q.js","assets/FeatureCollectionSnappingSource-KmluIKnH.js","assets/symbologySnappingCandidates-B-Ntl7JM.js","assets/GraphicsSnappingSource-Bz7SjNAi.js","assets/normalizeUtilsSync-DxE8L4Ib.js","assets/normalizeUtilsCommon-UUlRRPVA.js","assets/featureConversionUtils-C-Uqf9Q4.js","assets/OptimizedFeature-swgcyHeh.js","assets/OptimizedGeometry-C9mSZhHi.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/FeatureStore-B0gqZoOR.js","assets/BoundsStore-DO_rtT_2.js","assets/PooledRBush-D_zSRdWq.js","assets/quickselect-QQC62dOK.js","assets/timeSupport-DZeNU3Q4.js","assets/queryUtils-DfwPGxwH.js","assets/normalizeUtils-Bg1OALXh.js","assets/utils-DGPHbhMN.js","assets/utils-ByvCMLXh.js","assets/json-Wa8cmqdu.js","assets/optimizedFeatureQueryEngineAdapter-DrXZKbZy.js","assets/centroid-DdLmOD72.js","assets/QueryEngine-C9ivs0Pi.js","assets/WhereClause-dg9O4EEg.js","assets/QueryEngineCapabilities-DjYb9CEb.js","assets/utils-fVaXlGs2.js","assets/utils-D5wrSxig.js","assets/ClassBreaksDefinition-CpzZK_QT.js","assets/SnappingCandidate-O5eRSE6e.js","assets/Scheduler-DS_v5N7L.js","assets/SceneLayerSnappingSource-D7k_Y0ZC.js","assets/workerHelper-vJy25KAM.js","assets/InterleavedLayout-Bb_2wUZe.js","assets/BufferView-sBvw8vqP.js","assets/types-D0PSWh4d.js","assets/Util-BK6CBhAA.js","assets/edgeProcessing-CO1tnVAc.js","assets/deduplicate-Dq2CF0iu.js","assets/Indices-NXfq_dEG.js","assets/VertexAttribute-Cq4MnHjR.js","assets/glUtil-CFv2RXTA.js","assets/enums-Dk3osxpS.js","assets/VertexElementDescriptor-BOD-G50G.js","assets/Normals-C9jd-OeY.js"])))=>i.map(i=>d[i]);
import{F as c,G as m,K as G,L as j,gu as x,gv as Q,M as T,gw as V,cv as N,gx as I,b3 as W,aA as X,gy as q,fi as B,c5 as J,cw as Y,fl as Z,aF as C,cx as ee,bt as te,aE as $,bR as re,cr as U}from"./index-C1aGfQcb.js";import{b as O}from"./vec2-D9okOEat.js";import{v as ie,s as oe}from"./vec32-CmwgPQMd.js";import{h as ae}from"./UpdatingHandles-DOPUoIlu.js";import{j as k}from"./elevationInfoUtils-DQT3uSQq.js";import{v as A,o as H,E as ne,N as z,s as _,t as se,d as le,u as pe,w as ue,x as K,n as ce,g as de,e as me,z as he}from"./Editor-BZKF0HZM.js";import{d as L}from"./FeatureEffect-B5YAe6Lk.js";import{o as ye}from"./floorFilterUtils-DZ5C6FQv.js";import"./ElevationInfo-D7CBP7sd.js";import"./lengthUtils-CFwdZ3dz.js";import"./vec2f64-CCfZVA9N.js";import"./projectVectorToVector-Dtcb6Asj.js";import"./projectBuffer-CZ7yaGuo.js";import"./projectPointToVector-ByIVLKML.js";import"./projection-BOBOhWzm.js";import"./Spinner-CEWOvPN4.js";import"./AttachmentInfo-Cg9fIPGU.js";import"./legacyIcon-CEIp6Pa9.js";import"./FeatureLayerBase-BNIuOgAL.js";import"./commonProperties-Drl05DKJ.js";import"./HeightModelInfo-kVs8dE0B.js";import"./arcgisLayerUrl-BkZy4Mr3.js";import"./featureLayerUtils-Dy99w2fj.js";import"./Query-LPs1Zyw4.js";import"./FullTextSearch-Cza0yp3f.js";import"./TimeExtent-DGiXUfis.js";import"./timeUtils-X0MXjtQ8.js";import"./jsonUtils-CWFaUb2E.js";import"./UniqueValueRenderer-CAZbf8NT.js";import"./RendererLegendOptions-CULirduz.js";import"./diffUtils-DMLidw0V.js";import"./colorRamps-D4VCsfmX.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./visualVariableUtils-dx28E4EQ.js";import"./jsonUtils-BWWcP_yB.js";import"./defaults-Dbnhuv3C.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-CEgUrR2a.js";import"./LRUCache-DbPTy7LA.js";import"./Version-DD-eRUXC.js";import"./FieldsIndex-BrdRr9E_.js";import"./UnknownTimeZone-DhxWDwo9.js";import"./OverrideHelper-D-UVQ00R.js";import"./colorUtils-BWiljOUv.js";import"./vec42-BHDxGccW.js";import"./vec4f64-o2zAXfmz.js";import"./utils-D7agaEG-.js";import"./enums-CmIX1y88.js";import"./quantizationUtils-DbJV_fl5.js";import"./heatmapUtils-D0BPLm9w.js";import"./LayerFloorInfo-DzoJncEV.js";import"./Relationship-CBhq9gYu.js";import"./serviceCapabilitiesUtils-B23--4px.js";import"./arcade-DfpF5wFh.js";import"./TimeOnly-vNYE6bX9.js";import"./ImmutableArray-BPVd6ESQ.js";import"./FeatureLayer-DGRhhm0K.js";import"./MultiOriginJSONSupport-Qqzd52Lf.js";import"./Layer-CneDw8eF.js";import"./workers-CeelWDzo.js";import"./editsZScale-8GE3gysf.js";import"./queryZScale-D-ZT69l7.js";import"./FeatureSet-CeKoTEEO.js";import"./APIKeyMixin-BrvyKlIW.js";import"./ArcGISService-C1oUW8BT.js";import"./BlendLayer-CG9LFMxd.js";import"./jsonUtils-n3e_wlfQ.js";import"./parser-C4Qiz3JH.js";import"./utils-sqJe3zMg.js";import"./CustomParametersMixin-BhjpsNjD.js";import"./EditBusLayer-DCXZWvgn.js";import"./FeatureEffectLayer-gWJrS8gr.js";import"./FeatureReductionLayer-DuxcLofN.js";import"./FeatureReductionSelection-tRCh97wj.js";import"./labelingInfo-BV0df7F6.js";import"./labelUtils-C_ZaLudT.js";import"./MD5-C9MwAd2G.js";import"./OperationalLayer-nNeN4Mrb.js";import"./OrderedLayer-B8Gw_A9P.js";import"./OrderByInfo-k2G4k_zV.js";import"./PortalLayer-Bqf_dhsv.js";import"./portalItemUtils-Cy9KvMYK.js";import"./RefreshableLayer-CwxQNwd3.js";import"./ScaleRangeLayer-66YiyNPI.js";import"./TemporalLayer-CR5q7V2k.js";import"./TimeInfo-CY1-cj-U.js";import"./FeatureTemplate-DJBXu3Te.js";import"./FeatureType-JHO2oVJp.js";import"./fieldProperties-CoDAhoou.js";import"./versionUtils-DBm9Te4x.js";import"./styleUtils-CFywnZa6.js";import"./popupUtils-BA1X4qoc.js";import"./AlphaCutoff-UcccL64p.js";import"./interfaces-CL2NbQte.js";import"./symbolUtils-BmmDXP-E.js";import"./utils-C2gvZghy.js";import"./mat2df32-BR-p9z6z.js";import"./webStyleSymbolUtils-kO7zmqzd.js";import"./GraphicsLayer-7fnK8PA0.js";import"./GraphicsCollection-BlUFPpxh.js";import"./screenUtils-CLE_gLy7.js";import"./signal-CRiDvIIF.js";import"./utils-CS8i_70G.js";import"./plane-CM4t6fNH.js";import"./mat3f64-q3fE-ZOt.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-DuEd_sPX.js";import"./mat3-Dg2BrR6m.js";import"./drapedUtils-BnpEPkkO.js";import"./infoFor3D-C0hFfS1m.js";import"./ViewingMode-HRfKv6NR.js";import"./utils-BQBvadb7.js";import"./widget-3rB5q3_K.js";import"./uploadAssetErrors-Cy9k5t87.js";let h=class extends j{set attributeRulesEnabled(e){this._set("attributeRulesEnabled",e),e&&this.loadRules()}get layerView(){var e,t;return(t=(e=this.view)==null?void 0:e.allLayerViews)==null?void 0:t.find(r=>r.layer===this.layer)}get valid(){const{_valid:e,snappingSource:t,layer:r}=this;return!(!t||!r)&&e}get subtypeFilter(){var o,s;const{layer:e,snappingSource:t}=this;if(!x(e)||!((o=e.subtypes)!=null&&o.length)||!t)return{mode:"not-in-use",filter:null};const r=t.layerSource.sublayerSources.filter(a=>{var n;return a.enabled&&a.layer.visible&&Q((n=this.view)==null?void 0:n.scale,a.layer.effectiveScaleRange.minScale,a.layer.effectiveScaleRange.maxScale)}).map(a=>a.layer.subtypeCode);if(!r.length)return{mode:"none-visible",filter:null};if(r.length===e.subtypes.length)return{mode:"all-visible",filter:null};const i=((s=e.fieldsIndex.get(e.subtypeField))==null?void 0:s.name)??e.subtypeField;return r.length===1?{mode:"in-use",filter:`${i} = ${r.getItemAt(0)}`}:{mode:"in-use",filter:`${i} IN (${r.join(", ")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?ye({view:e,layer:t}):null}constructor(e){super(e),this.layer=null,this.snappingSource=null,this.rulesTable=null,this._valid=null}initialize(){if(!this.snappingSource||!this.layer)return void(this._valid=!1);const{layer:e,snappingSource:t}=this;if("refresh"in e){const r=e;this.addHandles(r.on("refresh",()=>t.refresh()))}this.loadRules(),this.addHandles([T(()=>t.updating,r=>t.layerSource.updating=r,V),T(()=>t.availability,r=>t.layerSource.availability=r,V)])}getFetchCandidatesParameters(e,t,r){var d,y,g,f,b;if(!this.valid)return[];const{layer:i,layerView:o,floorFilter:s,rulesTable:a,subtypeFilter:n}=this,l={distance:r,mode:((d=this.view)==null?void 0:d.type)??"2d",point:e,coordinateHelper:t.coordinateHelper,...ge(),filter:o&&"filter"in o?o.filter:null};if(s&&(l.filter=M(l.filter,s)),n.mode!=="not-in-use"&&n.mode!=="all-visible"){if(n.mode==="none-visible")return[];l.filter?l.filter.where=N(l.filter.where,n.mode):l.filter=new L({where:n.filter})}if(!this.attributeRulesEnabled)return[l];const p=t.feature,u=((y=p==null?void 0:p.sourceLayer)==null?void 0:y.type)==="subtype-sublayer"?p.sourceLayer.parent:p==null?void 0:p.sourceLayer;if(a&&p&&A((g=this.view)==null?void 0:g.map)&&(I(i)||x(i))&&i.layerId&&(I(u)||x(u))&&((f=this.view.map.utilityNetworks)!=null&&f.find(S=>S.isUtilityLayer(u)))){if(a.loadStatus!=="loaded")return[];const S=[],E=i.layerId,v=(b=a.getFeatureSQL(u,p))==null?void 0:b[E];if(!v)return[];const R=v.anyVertex;let F=v.endVertex;return F&&R&&F===R&&(F=""),F&&S.push({...l,returnEdge:!1,vertexMode:"ends",filter:M(l.filter,F)}),R&&S.push({...l,returnEdge:W("snapping-include-edges-when-applying-any-vertex-rule")??!1,vertexMode:"all",filter:M(l.filter,R)}),S}return[l]}async loadRules(){var i,o,s;this._valid=null;const{layer:e,view:t,attributeRulesEnabled:r}=this;if(r&&e&&t&&A(t==null?void 0:t.map)&&(I(e)||x(e)))try{await Promise.allSettled(((i=t.map.utilityNetworks)==null?void 0:i.map(n=>n.load()))??[]);const a=(o=t.map.utilityNetworks)==null?void 0:o.find(n=>n.isUtilityLayer(e));a&&(this.rulesTable=await a.getRulesTable(),await((s=this.rulesTable)==null?void 0:s.load()))}catch{return this._valid=!1,void X.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}this._valid=!0}remove(){this.destroy()}destroy(){var e;(e=this.snappingSource)==null||e.destroy()}};function ge(){return{returnEdge:!0,vertexMode:"all"}}function M(e,t){return e==null?new L({where:t}):e.where?new L({where:N(e.where,t)}):new L({where:t})}c([m({constructOnly:!0})],h.prototype,"layer",void 0),c([m({constructOnly:!0})],h.prototype,"snappingSource",void 0),c([m({constructOnly:!0})],h.prototype,"view",void 0),c([m({value:!1})],h.prototype,"attributeRulesEnabled",null),c([m()],h.prototype,"layerView",null),c([m()],h.prototype,"rulesTable",void 0),c([m()],h.prototype,"valid",null),c([m()],h.prototype,"subtypeFilter",null),c([m()],h.prototype,"floorFilter",null),c([m()],h.prototype,"_valid",void 0),h=c([G("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],h);let w=class extends j{get updating(){return this._snappingSources.some(e=>{var t;return(e==null?void 0:e.valid)==null||e.valid===!0&&((t=e.snappingSource)==null?void 0:t.updating)===!0})||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=H.FEATURE,this._updatingHandles=new ae,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=q(()=>{var t;return(t=this.options)==null?void 0:t._effectiveFeatureSources},(t,r)=>this._createSourceInfo(t,r));this._snappingSources=e,this.addHandles([B(e),T(()=>{var t;return{rulesEnabled:!!((t=this.options)!=null&&t.attributeRulesEnabled),sources:this._snappingSources.filter(Y)}},({rulesEnabled:t,sources:r})=>{for(const i of r)i.attributeRulesEnabled=t},J)])}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,r,i){var n,l,p;if(!(t&this._domain&&this.options!=null&&this.options.effectiveFeatureEnabled))return[];const o=[],s=this._computeScreenSizeDistanceParameters(e,r);for(const u of this._snappingSources){if(!(u!=null&&u.valid)||!((l=(n=u.snappingSource)==null?void 0:n.layerSource)!=null&&l.enabled)||(p=u.layerView)!=null&&p.suspended)continue;const d=u.getFetchCandidatesParameters(e,r,s);for(const y of d)o.push(u.snappingSource.fetchCandidates(y,i).then(g=>g.filter(f=>!this._candidateIsExcluded(u.snappingSource,f,r.excludeFeature))))}const a=(await Z(o)).flat();return this._addRightAngleCandidates(a,e,s,r),C(i),ne(e,a),a}_addRightAngleCandidates(e,t,r,i){var u,d,y,g,f,b,S,E;const o=i.vertexHandle!=null?(d=(u=i.vertexHandle.rightEdge)==null?void 0:u.rightVertex)==null?void 0:d.pos:i.editGeometryOperations!=null&&i.editGeometryOperations.data.type==="polygon"?(g=(y=i.editGeometryOperations.data.components[0])==null?void 0:y.getFirstVertex())==null?void 0:g.pos:null,s=i.vertexHandle!=null?(b=(f=i.vertexHandle.leftEdge)==null?void 0:f.leftVertex)==null?void 0:b.pos:i.editGeometryOperations!=null?(E=(S=i.editGeometryOperations.data.components[0])==null?void 0:S.getLastVertex())==null?void 0:E.pos:null,{view:a}=this,n=z(o,a,i),l=z(s,a,i),p=e.length;for(let v=0;v<p;v++)this._addRightAngleCandidate(e[v],l,t,r,e),this._addRightAngleCandidate(e[v],n,t,r,e)}_addRightAngleCandidate(e,t,r,i,o){if(t==null||!fe(e))return;const s=e.constraint.closestTo(t),a=(s[0]-r[0])/i.x,n=(s[1]-r[1])/i.y,{start:l,end:p}=e.constraint;if(a*a+n*n<=1){const u=O(_(s),_(l))>O(_(s),_(p))?l:p,d=new se({targetPoint:le(s),otherVertex:t,otherVertexType:pe.NEXT,previousVertex:u,constraint:new ue(t,s),objectId:e.objectId,isDraped:e.isDraped,domain:H.FEATURE});o.push(d)}}_computeScreenSizeDistanceParameters(e,t){let r=this.options!=null?this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return this.view==null?{x:r,y:r,z:r,distance:r}:this.view.type==="2d"?(r*=this.view.resolution,{x:r,y:r,z:r,distance:r}):this._computeScreenSizeDistanceParameters3D(e,r,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,r,i){const{spatialReference:o}=i;r.renderCoordsHelper.toRenderCoords(e,o,D);const s=r.state.camera.computeScreenPixelSizeAt(D),a=s*r.renderCoordsHelper.unitInMeters,n=a/ee(o),l=a/te(o),p=t*n,u=t*l,d=K(e,o,k,r),y=d?P(d,e,n,0,0,r,i):0,g=d?P(d,e,0,n,0,r,i):0,f=d?P(d,e,0,0,l,r,i):0;return{x:y===0?0:p/y,y:g===0?0:p/g,z:f===0?0:u/f,distance:s*t}}_candidateIsExcluded(e,t,r){if(r==null)return!1;const i=this._getCandidateObjectId(t);if(i==null)return!1;const o=e.layerSource.layer;return o.type==="graphics"?r.uid===i:r.sourceLayer===o&&!(!r.attributes||!("objectIdField"in o))&&r.attributes[o.objectIdField]===i}_getCandidateObjectId(e){return e instanceof ce?e.objectId:null}async _createSourceInfo(e,t){const r=e.layer;r.loaded||(await r.load(),C(t));const{view:i}=this,o=await this._createFeatureSnappingSourceType(e);return C(t),new h(o==null?{}:{snappingSource:o,view:i,layer:r})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return t==null||t.type!=="3d"?null:new(await this._getSourceModule("scene")).SceneLayerSnappingSource({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch((t=e.layer.source)==null?void 0:t.type){case"feature-layer":case"oriented-imagery":return new(await this._getSourceModule("featureService")).FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return e.layer.geometryType==="mesh"?null:new(await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new(await this._getSourceModule("graphics")).GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new(await this._getSourceModule("notes")).GraphicsSnappingSource({getGraphicsLayers:()=>{var t;return((t=e.layer.sublayers)==null?void 0:t.toArray())??[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(t.loader==null){const r=this._loadSourceModule(e),i={module:null,loader:r};this._sourceModules[e]=i;const o=await r,s={module:o,loader:r};return this._sourceModules[e]=s,o}return t.module==null?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise($(()=>import("./FeatureServiceSnappingSource-Cxc3WpaI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125])));case"featureCollection":return t.addPromise($(()=>import("./FeatureCollectionSnappingSource-KmluIKnH.js"),__vite__mapDeps([126,1,2,3,5,6,7,21,22,19,9,23,24,25,26,27,28,29,4,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,12,13,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,16,15,17,18,11,14,114,115,116,117,118,119,120,121,122,127])));case"graphics":case"notes":return t.addPromise($(()=>import("./GraphicsSnappingSource-Bz7SjNAi.js"),__vite__mapDeps([128,1,2,3,4,26,24,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,50,148,64,53,149,58,150,38,59,12,13,151,152,153,52,154,112,125,5,6,7,106,76,77,78,56,57,21,22,19,9,23,25,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,43,44,45,46,47,48,49,51,54,55,60,61,62,63,65,66,67,68,69,70,71,72,73,74,75,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,107,108,109,110,111,113,16,15,17,18,11,14,114,115,116,117,118,119,120,121,122,127])));case"scene":return t.addPromise($(()=>import("./SceneLayerSnappingSource-D7k_Y0ZC.js"),__vite__mapDeps([155,1,2,4,123,69,156,157,158,22,9,12,159,160,19,13,161,162,163,164,165,166,167,168,11,14,15,16,17,18,21,23,24,25,26,27,28,29,30,31,6,7,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,5,111,112,113,114,115,116,117,118,119,121,122])))}}get test(){}};function fe(e){return(e instanceof de||e instanceof me)&&!Se(e)}function Se({constraint:{start:e,end:t}}){const r=ie(e,t),i=O(_(e),_(t));return r<re()||i/r<we}function P(e,t,r,i,o,s,{spatialReference:a}){const n=oe(ve,t);n[0]+=r,n[1]+=i,n[2]+=o;const l=K(n,a,k,s);return l?he(l,e):1/0}c([m({constructOnly:!0})],w.prototype,"spatialReference",void 0),c([m({constructOnly:!0})],w.prototype,"view",void 0),c([m()],w.prototype,"options",void 0),c([m({readOnly:!0})],w.prototype,"updating",null),c([m()],w.prototype,"_snappingSources",void 0),w=c([G("esri.views.interactive.snapping.FeatureSnappingEngine")],w);const D=U(),ve=U(),we=1e-4;export{w as FeatureSnappingEngine};
