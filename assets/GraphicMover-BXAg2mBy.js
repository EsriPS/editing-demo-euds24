import{di as x,M as u,c7 as k,ba as O,bN as y,bO as E,bP as H,F as n,G as d,K as M}from"./index-C1aGfQcb.js";import{h as P}from"./GraphicsLayer-7fnK8PA0.js";import{i as w}from"./drawUtils-BqwzBuVL.js";import{A as D,B as U,C as $}from"./Editor-BZKF0HZM.js";import{_ as g,n as _}from"./screenUtils-CLE_gLy7.js";import{S as T}from"./GraphicManipulator-BMTkDhtD.js";import"./GraphicsCollection-BlUFPpxh.js";import"./Layer-CneDw8eF.js";import"./TimeExtent-DGiXUfis.js";import"./timeUtils-X0MXjtQ8.js";import"./BlendLayer-CG9LFMxd.js";import"./jsonUtils-n3e_wlfQ.js";import"./parser-C4Qiz3JH.js";import"./utils-sqJe3zMg.js";import"./ScaleRangeLayer-66YiyNPI.js";import"./ElevationInfo-D7CBP7sd.js";import"./lengthUtils-CFwdZ3dz.js";import"./vec2-D9okOEat.js";import"./vec2f64-CCfZVA9N.js";import"./vec32-CmwgPQMd.js";import"./projectVectorToVector-Dtcb6Asj.js";import"./projectBuffer-CZ7yaGuo.js";import"./projectPointToVector-ByIVLKML.js";import"./projection-BOBOhWzm.js";import"./Spinner-CEWOvPN4.js";import"./AttachmentInfo-Cg9fIPGU.js";import"./legacyIcon-CEIp6Pa9.js";import"./UpdatingHandles-DOPUoIlu.js";import"./FeatureLayerBase-BNIuOgAL.js";import"./commonProperties-Drl05DKJ.js";import"./HeightModelInfo-kVs8dE0B.js";import"./arcgisLayerUrl-BkZy4Mr3.js";import"./featureLayerUtils-Dy99w2fj.js";import"./Query-LPs1Zyw4.js";import"./FullTextSearch-Cza0yp3f.js";import"./jsonUtils-CWFaUb2E.js";import"./UniqueValueRenderer-CAZbf8NT.js";import"./RendererLegendOptions-CULirduz.js";import"./diffUtils-DMLidw0V.js";import"./colorRamps-D4VCsfmX.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./visualVariableUtils-dx28E4EQ.js";import"./jsonUtils-BWWcP_yB.js";import"./defaults-Dbnhuv3C.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-CEgUrR2a.js";import"./LRUCache-DbPTy7LA.js";import"./Version-DD-eRUXC.js";import"./FieldsIndex-BrdRr9E_.js";import"./UnknownTimeZone-DhxWDwo9.js";import"./OverrideHelper-D-UVQ00R.js";import"./colorUtils-BWiljOUv.js";import"./vec42-BHDxGccW.js";import"./vec4f64-o2zAXfmz.js";import"./utils-D7agaEG-.js";import"./enums-CmIX1y88.js";import"./quantizationUtils-DbJV_fl5.js";import"./heatmapUtils-D0BPLm9w.js";import"./LayerFloorInfo-DzoJncEV.js";import"./Relationship-CBhq9gYu.js";import"./serviceCapabilitiesUtils-B23--4px.js";import"./arcade-DfpF5wFh.js";import"./TimeOnly-vNYE6bX9.js";import"./ImmutableArray-BPVd6ESQ.js";import"./FeatureLayer-DGRhhm0K.js";import"./MultiOriginJSONSupport-Qqzd52Lf.js";import"./workers-CeelWDzo.js";import"./editsZScale-8GE3gysf.js";import"./queryZScale-D-ZT69l7.js";import"./FeatureSet-CeKoTEEO.js";import"./APIKeyMixin-BrvyKlIW.js";import"./ArcGISService-C1oUW8BT.js";import"./CustomParametersMixin-BhjpsNjD.js";import"./EditBusLayer-DCXZWvgn.js";import"./FeatureEffectLayer-gWJrS8gr.js";import"./FeatureEffect-B5YAe6Lk.js";import"./FeatureReductionLayer-DuxcLofN.js";import"./FeatureReductionSelection-tRCh97wj.js";import"./labelingInfo-BV0df7F6.js";import"./labelUtils-C_ZaLudT.js";import"./MD5-C9MwAd2G.js";import"./OperationalLayer-nNeN4Mrb.js";import"./OrderedLayer-B8Gw_A9P.js";import"./OrderByInfo-k2G4k_zV.js";import"./PortalLayer-Bqf_dhsv.js";import"./portalItemUtils-Cy9KvMYK.js";import"./RefreshableLayer-CwxQNwd3.js";import"./TemporalLayer-CR5q7V2k.js";import"./TimeInfo-CY1-cj-U.js";import"./FeatureTemplate-DJBXu3Te.js";import"./FeatureType-JHO2oVJp.js";import"./fieldProperties-CoDAhoou.js";import"./versionUtils-DBm9Te4x.js";import"./styleUtils-CFywnZa6.js";import"./popupUtils-BA1X4qoc.js";import"./AlphaCutoff-UcccL64p.js";import"./interfaces-CL2NbQte.js";import"./symbolUtils-BmmDXP-E.js";import"./utils-C2gvZghy.js";import"./mat2df32-BR-p9z6z.js";import"./webStyleSymbolUtils-kO7zmqzd.js";import"./elevationInfoUtils-DQT3uSQq.js";import"./utils-CS8i_70G.js";import"./plane-CM4t6fNH.js";import"./mat3f64-q3fE-ZOt.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-DuEd_sPX.js";import"./mat3-Dg2BrR6m.js";import"./drapedUtils-BnpEPkkO.js";import"./infoFor3D-C0hFfS1m.js";import"./ViewingMode-HRfKv6NR.js";import"./utils-BQBvadb7.js";import"./widget-3rB5q3_K.js";import"./uploadAssetErrors-Cy9k5t87.js";import"./signal-CRiDvIIF.js";class A{constructor(r,i,s,e,h){this.graphic=r,this.index=i,this.x=s,this.y=e,this.viewEvent=h,this.type="graphic-click"}}class L{constructor(r,i,s,e,h){this.graphic=r,this.index=i,this.x=s,this.y=e,this.viewEvent=h,this.type="graphic-double-click"}}class V{constructor(r,i,s,e,h,o,a,l,m,v){this.graphic=r,this.allGraphics=i,this.index=s,this.x=e,this.y=h,this.dx=o,this.dy=a,this.totalDx=l,this.totalDy=m,this.viewEvent=v,this.defaultPrevented=!1,this.type="graphic-move-start"}preventDefault(){this.defaultPrevented=!0}}class I{constructor(r,i,s,e,h,o,a,l,m,v){this.graphic=r,this.allGraphics=i,this.index=s,this.x=e,this.y=h,this.dx=o,this.dy=a,this.totalDx=l,this.totalDy=m,this.viewEvent=v,this.defaultPrevented=!1,this.type="graphic-move"}preventDefault(){this.defaultPrevented=!0}}class C{constructor(r,i,s,e,h,o,a,l,m,v){this.graphic=r,this.allGraphics=i,this.index=s,this.x=e,this.y=h,this.dx=o,this.dy=a,this.totalDx=l,this.totalDy=m,this.viewEvent=v,this.defaultPrevented=!1,this.type="graphic-move-stop"}preventDefault(){this.defaultPrevented=!0}}class S{constructor(r,i,s,e,h){this.graphic=r,this.index=i,this.x=s,this.y=e,this.viewEvent=h,this.type="graphic-pointer-over"}}class G{constructor(r,i,s,e,h){this.graphic=r,this.index=i,this.x=s,this.y=e,this.viewEvent=h,this.type="graphic-pointer-out"}}class z{constructor(r,i,s,e,h){this.graphic=r,this.index=i,this.x=s,this.y=e,this.viewEvent=h,this.type="graphic-pointer-down"}}class q{constructor(r,i,s,e,h){this.graphic=r,this.index=i,this.x=s,this.y=e,this.viewEvent=h,this.type="graphic-pointer-up"}}const b="indicator-symbols";let c=class extends x.EventedAccessor{constructor(t){super(t),this._activeGraphic=null,this._dragEvent=null,this._hoverGraphic=null,this._indicators=[],this._initialDragGeometry=null,this._manipulators=[],this._layerViews=null,this.type="graphic-mover",this.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}},this.enableMoveAllGraphics=!1,this.graphics=[],this.indicatorsEnabled=!1,this.layer=new P({listMode:"hide",internal:!0,title:"GraphicMover highlight layer"}),this.view=null}initialize(){D(this.view,this.layer),this._highlightHelper=new U({view:this.view}),this.refresh(),this.addHandles([u(()=>this.graphics.length,()=>this.refresh()),k(()=>{var t;return(t=this.view)==null?void 0:t.ready},()=>{this.addHandles([this.view.on("immediate-click",t=>this._clickHandler(t),g.TOOL),this.view.on("double-click",t=>this._doubleClickHandler(t),g.TOOL),this.view.on("pointer-down",t=>this._pointerDownHandler(t),g.TOOL),this.view.on("pointer-move",t=>this._pointerMoveHandler(t),g.TOOL),this.view.on("pointer-up",t=>this._pointerUpHandler(t),g.TOOL),this.view.on("drag",t=>this._dragHandler(t),g.TOOL),this.view.on("key-down",t=>this._keyDownHandler(t),g.TOOL)])},{once:!0,initial:!0}),u(()=>this.view,t=>{this._highlightHelper.removeAll(),this._highlightHelper.view=t})])}destroy(){var t;this._removeIndicators(),(t=this.view.map)==null||t.remove(this.layer),this.layer.destroy(),this.reset(),this._manipulators.forEach(r=>r.destroy()),this._manipulators=null}set highlightsEnabled(t){var r,i;(r=this._highlightHelper)==null||r.removeAll(),this._set("highlightsEnabled",t),t&&((i=this._highlightHelper)==null||i.add(this.graphics))}get state(){const t=this.view.ready,r=this.graphics.length>0,i=this._activeGraphic;return t&&r?i?"moving":"active":t?"ready":"disabled"}refresh(){this.reset(),this._setup()}reset(){this._activeGraphic=null,this._hoverGraphic=null,this._dragEvent=null,this._highlightHelper.removeAll()}updateGeometry(t,r){const i=this.graphics[t];i&&(i.set("geometry",r),this._setUpIndicators())}_setup(){this._setUpHighlights(),this._setUpIndicators(),this._setUpManipulators(),this._syncLayerViews()}_clickHandler(t){const r=this._findTargetGraphic(_(t));if(r){const i=new A(r,this.graphics.indexOf(r),t.x,t.y,t);this.emit("graphic-click",i),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(i)}}_doubleClickHandler(t){const r=this._findTargetGraphic(_(t));if(r){const i=new L(r,this.graphics.indexOf(r),t.x,t.y,t);this.emit("graphic-double-click",i),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(i)}}_pointerDownHandler(t){const r=this._findTargetGraphic(_(t));if(r){this._activeGraphic=r;const{x:i,y:s}=t,e=new z(r,this.graphics.indexOf(r),i,s,t);this.emit("graphic-pointer-down",e),this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(e)}else this._activeGraphic=null}_pointerUpHandler(t){if(this._activeGraphic){const{x:r,y:i}=t,s=this.graphics.indexOf(this._activeGraphic),e=new q(this._activeGraphic,s,r,i,t);this.emit("graphic-pointer-up",e),this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(e)}}_pointerMoveHandler(t){if(this._dragEvent)return;const r=this._findTargetGraphic(_(t));if(r){const{x:i,y:s}=t;if(this._hoverGraphic){if(this._hoverGraphic===r)return;const o=this.graphics.indexOf(this._hoverGraphic),a=new G(this.graphics[o],o,i,s,t);this._hoverGraphic=null,this.emit("graphic-pointer-out",a),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(a)}const e=this.graphics.indexOf(r),h=new S(r,e,i,s,t);return this._hoverGraphic=r,this.emit("graphic-pointer-over",h),void(this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(h))}if(this._hoverGraphic){const{x:i,y:s}=t,e=this.graphics.indexOf(this._hoverGraphic),h=new G(this.graphics[e],e,i,s,t);this._hoverGraphic=null,this.emit("graphic-pointer-out",h),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(h)}}_dragHandler(t){var f;if(t.action!=="start"&&!this._dragEvent||!((f=this._activeGraphic)!=null&&f.geometry))return;t.action==="start"&&this._removeIndicators(),t.stopPropagation();const{action:r,x:i,y:s}=t,e=this.graphics.indexOf(this._activeGraphic),h=this._dragEvent?i-this._dragEvent.x:0,o=this._dragEvent?s-this._dragEvent.y:0,a=i-t.origin.x,l=s-t.origin.y,m=r==="start"?this._activeGraphic.geometry:this._initialDragGeometry,v=w(m,a,l,this.view);if(this._activeGraphic.geometry=v,this.enableMoveAllGraphics&&this.graphics.forEach(p=>{p!==this._activeGraphic&&(p.geometry=w(p.geometry,h,o,this.view))}),this._dragEvent=t,r==="start"){this._initialDragGeometry=O(m);const p=new V(this._activeGraphic,this.graphics,e,i,s,h,o,a,l,t);this.emit("graphic-move-start",p),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(p),p.defaultPrevented&&this._activeGraphic.set("geometry",m)}else if(r==="update"){const p=new I(this._activeGraphic,this.graphics,e,i,s,h,o,a,l,t);this.emit("graphic-move",p),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(p),p.defaultPrevented&&(this._activeGraphic.geometry=m)}else{const p=new C(this._activeGraphic,this.graphics,e,i,s,h,o,a,l,t);this._dragEvent=null,this._activeGraphic=null,this._setUpIndicators(),this.emit("graphic-move-stop",p),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(p),p.defaultPrevented&&(this.graphics[e].set("geometry",this._initialDragGeometry),this._setUpIndicators()),this._initialDragGeometry=null}}_keyDownHandler(t){t.key!=="a"&&t.key!=="d"&&t.key!=="n"||this.state!=="moving"||t.stopPropagation()}_findTargetGraphic(t){const r=this.view.toMap(t),i=this.graphics;let s=null,e=Number.MAX_VALUE;this._syncLayerViews();const h=this._layerViews.flatMap(o=>"graphicsViews"in o?Array.from(o.graphicsViews(),a=>a.hitTest(r)).flat():o.graphicsView.hitTest(r)).filter(o=>i.includes(o)).sort((o,a)=>i.indexOf(o)-i.indexOf(a));return h.length?h[0]:(this._manipulators.forEach(o=>{const a=o.intersectionDistance(t);a!=null&&a<e&&(e=a,s=o.graphic)}),s)}_syncLayerViews(){this._layerViews=[];const t=new Set;for(const r of this.graphics){const i=$(this.view,r.layer);i&&t.add(i)}this._layerViews=[...t]}_setUpManipulators(){const{graphics:t,view:r}=this;this._manipulators.forEach(i=>i.destroy()),this._manipulators=t.length?t.map(i=>new T({graphic:i,view:r})):[]}_setUpHighlights(){this.highlightsEnabled&&this._highlightHelper.add(this.graphics)}_setUpIndicators(){if(this._removeIndicators(),this.indicatorsEnabled){for(const t of this.graphics){const r=t.clone();r.symbol=N(t),this._indicators.push(r),this.addHandles(u(()=>t.symbol,()=>this._setUpIndicators()),b)}this.layer.addMany(this._indicators)}}_removeIndicators(){this.removeHandles(b),this._indicators.length&&(this.layer.removeMany(this._indicators),this._indicators.forEach(t=>t.destroy()),this._indicators=[])}};function N(t){if(t.symbol==null)return null;switch(t.symbol.type){case"cim":return new y({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case"picture-marker":{const{xoffset:i,yoffset:s,height:e,width:h}=t.symbol,o=e===h?h:Math.max(e,h);return new y({xoffset:i,yoffset:s,size:o,style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-marker":{const{xoffset:i,yoffset:s,size:e,style:h}=t.symbol;return new y({xoffset:i,yoffset:s,style:h==="circle"?"circle":"square",size:e+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-fill":return new H({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case"simple-line":return new E({color:[255,127,0,1],style:"dash",width:1});case"text":{const{xoffset:i,yoffset:s}=t.symbol;return new y({xoffset:i,yoffset:s,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}}n([d()],c.prototype,"_activeGraphic",void 0),n([d({readOnly:!0})],c.prototype,"type",void 0),n([d()],c.prototype,"callbacks",void 0),n([d()],c.prototype,"enableMoveAllGraphics",void 0),n([d()],c.prototype,"graphics",void 0),n([d({value:!1})],c.prototype,"highlightsEnabled",null),n([d()],c.prototype,"indicatorsEnabled",void 0),n([d()],c.prototype,"layer",void 0),n([d({readOnly:!0})],c.prototype,"state",null),n([d()],c.prototype,"view",void 0),c=n([M("esri.views.draw.support.GraphicMover")],c);const Wi=c;export{Wi as default};
