import{F as t,G as i,J as m,K as h,L as d,M as f,P as u,O as g,Q as c}from"./index-C1aGfQcb.js";import{_ as B,J as _,W as R}from"./projection-BOBOhWzm.js";import{b as r,m as x,j as v,O as b}from"./basemapUtils-SfV6Ch_Z.js";import"./projectBuffer-CZ7yaGuo.js";import"./utils-sqJe3zMg.js";let a=class extends d{constructor(e){super(e),this._basemapCache={},this._loadingProjectionEngine=!1,this.nextBasemap=r("hybrid",this._basemapCache),this.view=null}initialize(){f(()=>this.nextBasemap,e=>{e&&!e.loaded&&e.load().catch(()=>{})},u)}destroy(){this.view=null,x(this._basemapCache),this._basemapCache=null}get _nextBasemapSpatialReferenceTask(){return v(this.view,this.nextBasemap)}get _viewSpatialReferenceLocked(){const{view:e}=this;return!e||!("spatialReferenceLocked"in e)||e.spatialReferenceLocked}get activeBasemap(){var e,s;return r(((s=(e=this.view)==null?void 0:e.map)==null?void 0:s.basemap)??"topo-vector",this._basemapCache)}castNextBasemap(e){return r(e,this._basemapCache)}get state(){const{view:e}=this;if(!(e!=null&&e.ready)||this._nextBasemapSpatialReferenceTask.updating)return"disabled";const{spatialReference:s}=this._nextBasemapSpatialReferenceTask;return this._viewSpatialReferenceLocked&&s!=null&&!e.spatialReference.equals(s)?"incompatible-next-basemap":this._loadingProjectionEngine?"loading":"ready"}async toggle(){const{activeBasemap:e,nextBasemap:s,state:l,view:n}=this;if(!n||l==="disabled"||l==="incompatible-next-basemap")return;const o=this._viewSpatialReferenceLocked;if(!o){if(await g(()=>!this._nextBasemapSpatialReferenceTask.updating),s!==this.nextBasemap||e!==this.activeBasemap)return;const{spatialReference:p}=this._nextBasemapSpatialReferenceTask;if(p==null||c(n.spatialReference,p)||B()||_(n.spatialReference,p)||(this._loadingProjectionEngine=!0,await R(),this._loadingProjectionEngine=!1),s!==this.nextBasemap||e!==this.activeBasemap)return}n.map.basemap=s,o||this._nextBasemapSpatialReferenceTask.spatialReference==null||c(n.spatialReference,this._nextBasemapSpatialReferenceTask.spatialReference)||(n.spatialReference=this._nextBasemapSpatialReferenceTask.spatialReference),this.nextBasemap=e}static getThumbnailUrl(e){return b(e)}};t([i()],a.prototype,"_loadingProjectionEngine",void 0),t([i({readOnly:!0})],a.prototype,"_nextBasemapSpatialReferenceTask",null),t([i({readOnly:!0})],a.prototype,"_viewSpatialReferenceLocked",null),t([i({readOnly:!0})],a.prototype,"activeBasemap",null),t([i()],a.prototype,"nextBasemap",void 0),t([m("nextBasemap")],a.prototype,"castNextBasemap",null),t([i({readOnly:!0})],a.prototype,"state",null),t([i()],a.prototype,"view",void 0),t([i()],a.prototype,"toggle",null),a=t([h("esri.widgets.BasemapToggle.BasemapToggleViewModel")],a);const L=a;export{L as default};
