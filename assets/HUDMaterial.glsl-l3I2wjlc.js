import{o as Qt}from"./VertexArrayObject-CzGu5bI8.js";import{L as Tt,dm as Z,F as p,G as g,K as Mt,cr as j,g5 as ve,g6 as Qe,cY as ie,e6 as $t,nb as Zt,nc as Kt,gA as Jt,j5 as ae,aA as ei,l_ as ti,nd as ii,c0 as ri,aE as si,bq as oi,dk as ni,da as ai,cV as li,ec as hi,bv as Ze,ke as ci,ne as ui,dq as di}from"./index-C1aGfQcb.js";import{e as N}from"./mat4f64-Dk4dwAN8.js";import{r as Dt,E as pi,o as xe,I as fi}from"./vec2-D9okOEat.js";import{r as Pt,n as Ue}from"./vec2f64-CCfZVA9N.js";import{c as _e,o as q,p as At,s as G,H as le,R as Ke,P as He,Z as Je,X as mi,g as U,r as Q,_ as et,A as be,K as gi,E as we,u as Te,N as vi}from"./vec32-CmwgPQMd.js";import{m as tt,L as it,E as Me,a as he,x as rt,z as ce}from"./vec42-BHDxGccW.js";import{r as Ne,n as K,s as _i,u as wi,e as st}from"./vec4f64-o2zAXfmz.js";import{H as yi,N as xi,L as bi}from"./Octree-_-EHFyX0.js";import{b as Oi}from"./sphere-DuEd_sPX.js";import{f as Ci}from"./plane-CM4t6fNH.js";import{l as Si}from"./ViewingMode-HRfKv6NR.js";import{n as Et}from"./mat3-Dg2BrR6m.js";import{e as Rt}from"./mat3f64-q3fE-ZOt.js";import{x as Ti}from"./BufferView-sBvw8vqP.js";import{aa as Mi,Q as $i,R as Di,P as Pi,s as Ai,F as Ei,I as Ri,a5 as Ii,e as ue,N as ot,o as $e,w as Fi,aI as zi,h as ji,j as nt,G as Li,ag as re,U as Bi,V as Vi,aJ as Hi,ak as Ni,ap as A,ar as Gi,K as Ui,aq as qi,as as Wi,A as k,m as ki,aK as Yi,aL as Xi,aM as at,au as Qi,aN as Zi,ax as Ki,aO as Ji,af as er,ay as tr,aP as ir,aQ as rr,aR as sr,aS as or,aT as lt,aU as ht,aV as nr,ad as ar,C as lr}from"./Texture-D7jaxJ9P.js";import{H as hr}from"./InterleavedLayout-Bb_2wUZe.js";import{n as F,c as De}from"./NormalAttribute.glsl-DGUKFRgB.js";import{b as It,d as cr,e as ur,f as dr,p as pr}from"./utils-OIoyRVPd.js";import{o as W}from"./AlphaCutoff-UcccL64p.js";import{s as ye}from"./Util-BK6CBhAA.js";import{e as x}from"./VertexAttribute-Cq4MnHjR.js";import{E as ct,O as fr,D as ut}from"./enums-Dk3osxpS.js";import{p as mr,B as gr,o as vr,g as _r}from"./renderState-QDOxIGNB.js";import{t as wr}from"./NestedMap-GuqgquCN.js";import{t as yr}from"./glUtil-CFv2RXTA.js";import{O as xr}from"./basicInterfaces-CZwQPxTp.js";import{o as br}from"./floatRGBA-BxT4aGRY.js";import{a as Or}from"./BindType-BmZEZMMh.js";import{o as _,r as E}from"./interfaces-DDtDqZYj.js";let Ys=class extends Qt{};const Cr={required:[]};F.Depth;let Ft=class extends Tt{precompile(e){const i=this.acquireTechniques(e);return Tr(i),i!=null}consumes(){return Cr}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}},Sr=class extends Ft{},Ks=class extends Ft{};function Tr(t){Array.isArray(t)?t.forEach(e=>e==null?void 0:e.release()):t==null||t.release()}function Mr(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function $r(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Dr(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function Pr(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let eo=class{constructor(){this.adds=new Z,this.removes=new Z,this.updates=new Z({allocator:e=>e||new Ar,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Ar=class{},Er=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var dt,b;function so(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new Er,e.set(r,s)),s};return t.removes.forAll(r=>{Pe(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{Pe(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{Pe(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function Pe(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(dt||(dt={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(b||(b={}));var Ge;let m=Ge=class extends Tt{constructor(t){super(t),this._ray=Oi(),this._viewport=Ne(0,0,1,1),this._padding=Ne(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Pt(1,1e3),this._viewDirty=!0,this._viewMatrix=N(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=N(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=N(),this._frustumDirty=!0,this._frustum=yi(),this._fullViewport=K(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=j(),this._up=j(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return _e(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){ve(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),q(j(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),q(j(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),q(j(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=tt(K(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&it(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=tt(K(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&it(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[b.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[b.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[b.RIGHT]+this._padding[b.LEFT]}set fullWidth(t){this.width=t-(this._padding[b.RIGHT]+this._padding[b.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[b.TOP]+this._padding[b.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[b.TOP]+this._padding[b.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[b.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[b.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){Me(this._padding,t)||(this._viewport[0]+=t[b.LEFT]-this._padding[b.LEFT],this._viewport[1]+=t[b.BOTTOM]-this._padding[b.BOTTOM],this._viewport[2]-=t[b.RIGHT]+t[b.LEFT]-(this._padding[b.RIGHT]+this._padding[b.LEFT]),this._viewport[3]-=t[b.TOP]+t[b.BOTTOM]-(this._padding[b.TOP]+this._padding[b.BOTTOM]),he(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Qe(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return ie(N(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||N()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Dr(this._fov,this.width,this.height)}set fovX(t){this._fov=Mr(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Pr(this._fov,this.width,this.height)}set fovY(t){this._fov=$r(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return At(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(ie(this._viewInverseTransposeMatrix,this.viewMatrix),$t(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,o=r/this.columns,n=-r/2+this.column*o,l=n+o,a=-i/2+this.row*s,c=a+s,h=Zt(N(),n*(1+2*this._padding[b.LEFT]/t),l*(1+2*this._padding[b.RIGHT]/t),a*(1+2*this._padding[b.BOTTOM]/e),c*(1+2*this._padding[b.TOP]/e),this.near,this.far),u=this._get("projectionMatrix");return u&&Kt(u,h)?u:h}copyFrom(t){G(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,he(this._viewport,t.viewport),this.notifyChange("_viewport"),he(this._padding,t.padding),this.notifyChange("_padding"),Dt(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(ve(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(xi(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(ve(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),he(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return new Ge().copyFrom(this)}equals(t){return le(this.eye,t.eye)&&le(this.center,t.center)&&le(this.up,t.up)&&Me(this._viewport,t.viewport)&&Me(this._padding,t.padding)&&pi(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||rt(t.screenPadding,this.screenPadding)>=e||rt(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Ke(R,t.eye,t.center),Ke(Ae,this.eye,this.center);const i=He(R,Ae),r=Je(R),s=Je(Ae),o=5e-4;return i*i>=(1-1e-10)*r*s&&mi(t.eye,this.eye)<Math.max(r,s)*o*o}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(Ci(this.viewForward,_e(R,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Jt()){return t[0]=(this.padding[b.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[b.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[b.LEFT]+this.width*e,t[1]=this.padding[b.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==v&&G(v,t),v[3]=1,ce(v,v,this.projectionMatrix);const i=Math.abs(v[3]);U(v,v,1/i);const r=this.fullViewport;e[0]=ae(0,r[0]+r[2],.5+.5*v[0]),e[1]=ae(0,r[1]+r[3],.5+.5*v[1]),e[2]=.5*(v[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;v[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],v[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],v[2]=(2*t[2]-1)*t[3],v[3]=t[3],this.inverseProjectionMatrix!=null&&(ce(v,v,this.inverseProjectionMatrix),e[0]=v[0],e[1]=v[1],e[2]=v[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,Ee),this.renderToScreen(Ee,e),e}projectToRenderScreen(t,e){if(v[0]=t[0],v[1]=t[1],v[2]=t[2],v[3]=1,ce(v,v,this.viewProjectionMatrix),v[3]===0)return null;const i=v;U(i,i,1/Math.abs(v[3]));const r=this.fullViewport,s=ae(0,r[0]+r[2],.5+.5*i[0]),o=ae(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=o):(e[0]=s,e[1]=o,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,Ee),e)}unprojectFromRenderScreen(t,e){if(Qe(de,this.projectionMatrix,this.viewMatrix),!ie(de,de))return null;const i=this.fullViewport;return v[0]=2*(t[0]-i[0])/i[2]-1,v[1]=2*(t[1]-i[1])/i[3]-1,v[2]=2*t[2]-1,v[3]=1,ce(v,v,de),v[3]===0?null:(e[0]=v[0]/v[3],e[1]=v[1]/v[3],e[2]=v[2]/v[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,o=e*this.pixelRatio,n=Math.max(s-i/2,0),l=Math.max(this.fullHeight-o-r/2,0),a=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-o-r/2,0),h=i-a- -Math.min(this.fullWidth-s-i/2,0),u=r-c- -Math.min(o-r/2,0);return[Math.round(n),Math.round(l),Math.round(h),Math.round(u)]}computeUp(t){t===Si.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){_e(R,this.center,this.eye);const t=Q(this.center);t<1?(q(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(He(R,this.center))>.9999*Q(R)*t||(et(this._up,R,this.center),et(this._up,this._up,R),be(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){gi(R,this.eye,this.center),Math.abs(R[2])<=.9999&&(U(R,R,R[2]),q(this._up,-R[0],-R[1],1-R[2]),be(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?le(t,e)||(G(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):ei.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(bi(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(ti(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};p([g()],m.prototype,"_viewport",void 0),p([g()],m.prototype,"_padding",void 0),p([g()],m.prototype,"_fov",void 0),p([g()],m.prototype,"_nearFar",void 0),p([g()],m.prototype,"_viewDirty",void 0),p([g()],m.prototype,"_viewMatrix",void 0),p([g()],m.prototype,"_pixelRatio",void 0),p([g()],m.prototype,"pixelRatio",null),p([g()],m.prototype,"row",void 0),p([g()],m.prototype,"column",void 0),p([g()],m.prototype,"_rows",void 0),p([g()],m.prototype,"rows",null),p([g()],m.prototype,"_columns",void 0),p([g()],m.prototype,"columns",null),p([g()],m.prototype,"eye",null),p([g()],m.prototype,"center",null),p([g()],m.prototype,"_center",void 0),p([g()],m.prototype,"up",null),p([g()],m.prototype,"_up",void 0),p([g()],m.prototype,"viewMatrix",null),p([g({readOnly:!0})],m.prototype,"viewForward",null),p([g({readOnly:!0})],m.prototype,"viewUp",null),p([g({readOnly:!0})],m.prototype,"viewRight",null),p([g({readOnly:!0})],m.prototype,"nearFar",null),p([g()],m.prototype,"near",null),p([g()],m.prototype,"far",null),p([g()],m.prototype,"viewport",null),p([g({readOnly:!0})],m.prototype,"screenViewport",null),p([g({readOnly:!0})],m.prototype,"screenPadding",null),p([g()],m.prototype,"x",null),p([g()],m.prototype,"y",null),p([g()],m.prototype,"width",null),p([g()],m.prototype,"height",null),p([g()],m.prototype,"fullWidth",null),p([g()],m.prototype,"fullHeight",null),p([g({readOnly:!0})],m.prototype,"_aspect",null),p([g()],m.prototype,"padding",null),p([g({readOnly:!0})],m.prototype,"projectionMatrix",null),p([g({readOnly:!0})],m.prototype,"inverseProjectionMatrix",null),p([g()],m.prototype,"fov",null),p([g()],m.prototype,"fovX",null),p([g()],m.prototype,"fovY",null),p([g()],m.prototype,"viewInverseTransposeMatrix",null),p([g({readOnly:!0})],m.prototype,"_projectionMatrixInternal",null),p([g()],m.prototype,"relativeElevation",void 0),m=Ge=p([Mt("esri.views.3d.webgl.RenderCamera")],m);const oo=m,v=K(),de=N(),R=j(),Ae=j(),Ee=ii();function Rr(t){return t instanceof Float32Array&&t.length>=16}function Ir(t){return Array.isArray(t)&&t.length>=16}function Fr(t){return Rr(t)||Ir(t)}let zr=class{constructor(){this.factor=new pt,this.factorAlignment=new pt}},pt=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function jr(t,e){const{vertex:i,fragment:r}=t;t.include(Mi,e),i.include(It),e.terrainDepthTest&&t.varyings.add("depth","float"),i.main.add(_`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.terrainDepthTest?_`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),r.main.add(_`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)}let Lr=class extends $i{constructor(e,i){super(e,"vec4",Or.Draw,(r,s,o)=>r.setUniform4fv(e,i(s,o)))}};const qe={occludedFadeFactor:.6};function zt(t){const e=new Di,i=t.signedDistanceFieldEnabled;if(e.include(cr,t),e.include(Pi,t),t.occlusionPass)return e.include(jr,t),e;const{vertex:r,fragment:s}=e;e.include(Ai),e.include(Ei,t),e.include(Ri,t),e.include(ur),s.include(dr),s.include(Ii),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new ue("viewport",(h,u)=>u.camera.fullViewport),new ot("screenOffset",(h,u)=>xe(jt,2*h.screenOffset[0]*u.camera.pixelRatio,2*h.screenOffset[1]*u.camera.pixelRatio)),new ot("anchorPosition",h=>se(h)),new ue("materialColor",h=>h.color),new $e("materialRotation",h=>h.rotation)),Fi(r),i&&(r.uniforms.add(new ue("outlineColor",h=>h.outlineColor)),s.uniforms.add(new ue("outlineColor",h=>ft(h)?h.outlineColor:_i),new $e("outlineSize",h=>ft(h)?h.outlineSize:0))),t.horizonCullingEnabled&&r.uniforms.add(new Lr("pointDistanceSphere",(h,u)=>{const f=u.camera.eye,d=h.origin;return Ne(d[0]-f[0],d[1]-f[1],d[2]-f[2],ri.radius)})),t.pixelSnappingEnabled&&r.include(It),t.hasScreenSizePerspective&&(zi(r),ji(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(x.UV0,"vec2"),e.attributes.add(x.COLOR,"vec4"),e.attributes.add(x.SIZE,"vec2"),e.attributes.add(x.ROTATION,"float"),e.attributes.add(x.FEATUREATTRIBUTE,"vec4"),r.code.add(t.horizonCullingEnabled?_`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:_`bool behindHorizon(vec3 posModel) { return false; }`),r.main.add(_`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${E(t.hasScreenSizePerspective,_`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,_`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${E(t.vvSize,_`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const o=_`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${E(t.hasRotation,_`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,n=t.pixelSnappingEnabled?i?_`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:_`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:_`posProj += quadOffset;`;r.main.add(_`
    ${E(t.occlusionTestEnabled,_`if (visible) {`)}
    ${o}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${E(t.output===F.ObjectAndLayerIdColor,_`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${_.float(W)};
    ${E(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${_.float(W)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${n}
      gl_Position = posProj;
    }

    vtc = uv;

    ${E(t.debugDrawLabelBorder,_`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
    ${E(t.occlusionTestEnabled,_`} else {
        vtc = vec2(0.0);
        ${E(t.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
      }`)}`),s.uniforms.add(new nt("tex",h=>h.texture)),t.occludedFragmentFade&&(s.uniforms.add(new nt("depthMap",(h,u)=>u.mainDepth)),s.uniforms.add(new $e("fadeFactor",()=>qe.occludedFadeFactor)));const l=t.debugDrawLabelBorder?_`(isBorder > 0.0 ? 0.0 : ${_.float(W)})`:_.float(W),a=t.output===F.Highlight,c=_`
    ${E(t.debugDrawLabelBorder,_`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${E(t.sampleSignedDistanceFieldTexelCenter,_`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,_`vec2 samplePos = vtc;`)}

    ${i?_`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${l} ||
          fillPixelColor.a + outlinePixelColor.a < ${_.float(W)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${E(!a,_`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${l}) {
          discard;
        }

        ${E(!a,_`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:_`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${l}) {
            discard;
          }
          ${E(!a,_`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${E(t.occludedFragmentFade&&!a,_`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${E(!a&&t.debugDrawLabelBorder,_`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(t.output){case F.Color:t.oitPass===re.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.main.add(_`
        ${c}
        ${E(t.oitPass===re.FrontFace,_`fragColor.rgb /= fragColor.a;`)}
        ${E(t.oitPass===re.ColorAlpha,_`fragAlpha = fragColor.a;`)}`);break;case F.ObjectAndLayerIdColor:s.main.add(_`
        ${c}
        outputObjectAndLayerIdColor();`);break;case F.Highlight:e.include(Li,t),s.main.add(_`
        ${c}
        outputHighlight(voccluded == 1.0);`)}return e}function ft(t){return t.outlineColor[3]>0&&t.outlineSize>0}function se(t,e=jt){return t.textureIsSignedDistanceField?Br(t.anchorPosition,t.distanceFieldBoundingBox,e):Dt(e,t.anchorPosition),e}function Br(t,e,i){e!=null?xe(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):xe(i,0,0)}const jt=Ue(),Vr=Object.freeze(Object.defineProperty({__proto__:null,build:zt,calculateAnchorPosForRendering:se,shaderSettings:qe},Symbol.toStringTag,{value:"Module"}));let Hr=class extends Bi{constructor(e,i,r){super(e,i,new Vi(Vr,()=>si(()=>Promise.resolve().then(()=>vs),void 0)),r),this.primitiveType=i.occlusionPass?ct.POINTS:ct.TRIANGLES}initializePipeline(e){const{oitPass:i,hasPolygonOffset:r,draped:s,output:o,depthEnabled:n,occlusionPass:l}=e,a=i===re.NONE,c=i===re.FrontFace,h=r?Nr:null,u=s?null:(a||c)&&o!==F.Highlight&&(n||l)?mr:null;return gr({blending:o===F.Color?a?vr:Hi(i):null,depthTest:s?null:{func:fr.LEQUAL},depthWrite:u,drawBuffers:Ni(i,o),colorWrite:_r,polygonOffset:h})}};const Nr={factor:0,units:-4};let P=class extends Gi{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.textureCoordinateType=Ui.None,this.emissionSource=qi.None,this.discardInvisibleFragments=!0,this.hasSliceInVertexProgram=!0,this.hasVvInstancing=!1}};p([A()],P.prototype,"screenCenterOffsetUnitsEnabled",void 0),p([A()],P.prototype,"occlusionTestEnabled",void 0),p([A()],P.prototype,"signedDistanceFieldEnabled",void 0),p([A()],P.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),p([A()],P.prototype,"vvSize",void 0),p([A()],P.prototype,"vvColor",void 0),p([A()],P.prototype,"hasVerticalOffset",void 0),p([A()],P.prototype,"hasScreenSizePerspective",void 0),p([A()],P.prototype,"hasRotation",void 0),p([A()],P.prototype,"debugDrawLabelBorder",void 0),p([A()],P.prototype,"hasSlicePlane",void 0),p([A()],P.prototype,"hasPolygonOffset",void 0),p([A()],P.prototype,"depthEnabled",void 0),p([A()],P.prototype,"pixelSnappingEnabled",void 0),p([A()],P.prototype,"draped",void 0),p([A()],P.prototype,"terrainDepthTest",void 0),p([A()],P.prototype,"cullAboveTerrain",void 0),p([A()],P.prototype,"occlusionPass",void 0),p([A()],P.prototype,"occludedFragmentFade",void 0),p([A()],P.prototype,"objectAndLayerIdColorInstanced",void 0),p([A()],P.prototype,"horizonCullingEnabled",void 0);class uo extends Wi{constructor(e,i){super(e,Kr),this.produces=new Map([[k.HUD_MATERIAL,r=>De(r)&&!this.parameters.drawInSecondSlot],[k.LABEL_MATERIAL,r=>De(r)&&this.parameters.drawInSecondSlot],[k.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[k.DRAPED_MATERIAL,r=>this.parameters.draped&&De(r)]]),this._visible=!0,this._configuration=new P(i)}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===k.OCCLUSION_PIXELS&&this.parameters.occlusionTest,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,e===F.Color&&(this._configuration.debugDrawLabelBorder=!!ki.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,r,s,o,n){const{options:{selectionMode:l,hud:a,excludeLabels:c},point:h,camera:u}=r,{parameters:f}=this;if(!l||!a||c&&f.isLabel||!e.visible||!h)return;const{scaleX:d,scaleY:w}=this._getScreenScale(e,u.pixelRatio);Et(Ie,i),e.attributes.has(x.FEATUREATTRIBUTE)&&qr(Ie);const y=e.attributes.get(x.POSITION),O=e.attributes.get(x.SIZE),S=e.attributes.get(x.NORMAL),M=e.attributes.get(x.ROTATION),T=e.attributes.get(x.CENTEROFFSETANDDISTANCE);ye(y.size>=3);const C=se(f),D=this.parameters.centerOffsetUnits==="screen";for(let $=0;$<y.data.length/y.size;$++){const V=$*y.size;q(I,y.data[V],y.data[V+1],y.data[V+2]),we(I,I,i),we(I,I,u.viewMatrix);const Ce=$*T.size;if(q(B,T.data[Ce],T.data[Ce+1],T.data[Ce+2]),!D&&(I[0]+=B[0],I[1]+=B[1],B[2]!==0)){const ne=B[2];be(B,I),_e(I,I,U(B,B,ne))}const Se=$*S.size;if(q(ee,S.data[Se],S.data[Se+1],S.data[Se+2]),mt(ee,Ie,u,ze),this._applyVerticalOffsetTransformationView(I,ze,u,Re),u.applyProjection(I,z),z[0]>-1){D&&(B[0]||B[1])&&(z[0]+=B[0]*u.pixelRatio,B[1]!==0&&(z[1]+=Yi(B[1],Re.factorAlignment)*u.pixelRatio),u.unapplyProjection(z,I)),z[0]+=this.parameters.screenOffset[0]*u.pixelRatio,z[1]+=this.parameters.screenOffset[1]*u.pixelRatio,z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]);const ne=$*O.size;L[0]=O.data[ne],L[1]=O.data[ne+1],Xi(L,Re.factor,L);const kt=Xr*u.pixelRatio;let ke=0;f.textureIsSignedDistanceField&&(ke=Math.min(f.outlineSize,.5*L[0])*u.pixelRatio/2),L[0]*=d,L[1]*=w;const Yt=$*M.size,Xt=f.rotation+M.data[Yt];if(gt(h,z[0],z[1],L,kt,ke,Xt,f,C)){const Ye=r.ray;if(we(vt,I,ie(kr,u.viewMatrix)),z[0]=h[0],z[1]=h[1],u.unprojectFromRenderScreen(z,I)){const J=j();G(J,Ye.direction);const Xe=1/Q(J);U(J,J,Xe),n(At(Ye.origin,I)*Xe,J,-1,!0,1,vt)}}}}}intersectDraped(e,i,r,s,o,n){const l=e.attributes.get(x.POSITION),a=e.attributes.get(x.SIZE),c=e.attributes.get(x.ROTATION),h=this.parameters,u=se(h),{scaleX:f,scaleY:d}=this._getScreenScale(e,e.screenToWorldRatio),w=Qr*e.screenToWorldRatio;for(let y=0;y<l.data.length/l.size;y++){const O=y*l.size,S=l.data[O],M=l.data[O+1],T=y*a.size;L[0]=a.data[T],L[1]=a.data[T+1];let C=0;h.textureIsSignedDistanceField&&(C=Math.min(h.outlineSize,.5*L[0])*e.screenToWorldRatio/2),L[0]*=f,L[1]*=d;const D=y*c.size,$=h.rotation+c.data[D];gt(s,S,M,L,w,C,$,h,u)&&o(n.dist,n.normal,-1,!1)}}createBufferWriter(){return new es}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?at(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?at(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,o,n,l){const a=mt(i,r,o,ze);return this._applyVerticalGroundOffsetView(e,a,o,l),this._applyVerticalOffsetTransformationView(l,a,o,n),this._applyPolygonOffsetView(l,a,s[3],o,l),this._applyCenterOffsetView(l,s,l),l}applyShaderOffsetsNDC(e,i,r,s,o){return this._applyCenterOffsetNDC(e,i,r,s),o!=null&&G(o,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,o){const n=s.aboveGround?1:-1;let l=Math.sign(r);l===0&&(l=n);const a=n*l;if(this.parameters.shaderPolygonOffset<=0)return G(o,e);const c=oi(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return U(o,e,a>0?h:1/h),o}_applyVerticalGroundOffsetView(e,i,r,s){const o=Q(e),n=r.aboveGround?1:-1,l=r.computeRenderPixelSizeAtDist(o)*pr,a=U(I,i.normal,n*l);return Te(s,e,a),s}_applyVerticalOffsetTransformationView(e,i,r,s){var c;const o=this.parameters;if(!((c=o.verticalOffset)!=null&&c.screenLength)){if(o.screenSizePerspective||o.screenSizePerspectiveAlignment){const h=Q(e);this._updateScaleInfo(s,h,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const n=Q(e),l=o.screenSizePerspectiveAlignment??o.screenSizePerspective,a=Qi(r,n,o.verticalOffset,i.cosAngle,l);return this._updateScaleInfo(s,n,i.cosAngle),U(i.normal,i.normal,a),Te(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&G(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(be(ee,r),Te(r,r,U(ee,ee,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const o=this.parameters.centerOffsetUnits!=="screen";return s!==e&&G(s,e),o||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const o=this.parameters.shaderPolygonOffset;if(e!==s&&G(s,e),o){const n=r.aboveGround?1:-1,l=n*Math.sign(i[3]);s[2]-=(l||n)*o}return s}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:i,outlineColor:r}=this.parameters,s=e[3]>=W||i>=W&&r[3]>=W;return this._visible&&s}createGLMaterial(e){return new Gr(e)}calculateRelativeScreenBounds(e,i,r=ni()){return Ur(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,i){const r=e.attributes.get(x.FEATUREATTRIBUTE);if(r==null)return{scaleX:i,scaleY:i};const s=wi(r.data,Yr);return Zi(Fe,this.parameters,s),{scaleX:Fe[0]*i,scaleY:Fe[1]*i}}}class Gr extends Ki{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(Hr,e)}}function Ur(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function mt(t,e,i,r){return Fr(e)&&(e=Et(Wr,e)),vi(r.normal,t,e),we(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=He(Lt,Zr),r}function qr(t){const e=t[0],i=t[1],r=t[2],s=t[3],o=t[4],n=t[5],l=t[6],a=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),u=1/Math.sqrt(s*s+o*o+n*n),f=1/Math.sqrt(l*l+a*a+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=s*u,t[4]=o*u,t[5]=n*u,t[6]=l*f,t[7]=a*f,t[8]=c*f,t}function gt(t,e,i,r,s,o,n,l,a){let c=e-s-r[0]*a[0],h=c+r[0]+2*s,u=i-s-r[1]*a[1],f=u+r[1]+2*s;const d=l.distanceFieldBoundingBox;return l.textureIsSignedDistanceField&&d!=null&&(c+=r[0]*d[0],u+=r[1]*d[1],h-=r[0]*(1-d[2]),f-=r[1]*(1-d[3]),c-=o,h+=o,u-=o,f+=o),xe(_t,e,i),fi(te,t,_t,ai(n)),te[0]>c&&te[0]<h&&te[1]>u&&te[1]<f}const Re=new zr,I=j(),ee=j(),z=K(),Lt=j(),vt=j(),te=Ue(),_t=Ue(),Ie=Rt(),Wr=Rt(),kr=N(),B=j(),Fe=j(),Yr=K(),ze={normal:Lt,cosAngle:0},Xr=1,Qr=2,L=[0,0],Zr=li(0,0,1);class Kr extends Ji{constructor(){super(...arguments),this.renderOccluded=er.Occlude,this.isDecoration=!1,this.color=st(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=Pt(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=st(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const Bt=hr().vec3f(x.POSITION).vec3f(x.NORMAL).vec2f(x.UV0).vec4u8(x.COLOR).vec2f(x.SIZE).f32(x.ROTATION).vec4f(x.CENTEROFFSETANDDISTANCE).vec4f(x.FEATUREATTRIBUTE),Jr=Bt.clone().vec4u8(x.OBJECTANDLAYERIDCOLOR);class es{constructor(){this.vertexBufferLayout=tr()?Jr:Bt}elementCount(e){return 6*e.get(x.POSITION).indices.length}write(e,i,r,s,o,n){var M,T;ir(r.get(x.POSITION),e,o.position,n,6),rr(r.get(x.NORMAL),i,o.normal,n,6);const l=(M=r.get(x.UV0))==null?void 0:M.data;let a=0,c=0,h=1,u=1;l&&l.length>=4&&(a=l[0],c=l[1],h=l[2],u=l[3]),h=Math.min(1.99999,h+1),u=Math.min(1.99999,u+1);let f=r.get(x.POSITION).indices.length,d=n;const w=o.uv0;for(let C=0;C<f;++C)w.set(d,0,a),w.set(d,1,c),d++,w.set(d,0,h),w.set(d,1,c),d++,w.set(d,0,h),w.set(d,1,u),d++,w.set(d,0,h),w.set(d,1,u),d++,w.set(d,0,a),w.set(d,1,u),d++,w.set(d,0,a),w.set(d,1,c),d++;sr(r.get(x.COLOR),4,o.color,n,6);const{data:y,indices:O}=r.get(x.SIZE);f=O.length;const S=o.size;d=n;for(let C=0;C<f;++C){const D=y[2*O[C]],$=y[2*O[C]+1];for(let V=0;V<6;++V)S.set(d,0,D),S.set(d,1,$),d++}if(or(r.get(x.ROTATION),o.rotation,n,6),r.get(x.CENTEROFFSETANDDISTANCE)?lt(r.get(x.CENTEROFFSETANDDISTANCE),o.centerOffsetAndDistance,n,6):ht(o.centerOffsetAndDistance,n,6*f),r.get(x.FEATUREATTRIBUTE)?lt(r.get(x.FEATUREATTRIBUTE),o.featureAttribute,n,6):ht(o.featureAttribute,n,6*f),s!=null){const C=(T=r.get(x.POSITION))==null?void 0:T.indices;if(C){const D=C.length,$=o.getField(x.OBJECTANDLAYERIDCOLOR,Ti);nr(s,$,D,n,6)}}}}let ts=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){const s=this._material.produces.get(i);if(!(s!=null&&s(r)))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const o=this._map.get(r);if(o!=null){if(o.ensureResources(e)===xr.LOADED)return o;this._repository.requestRender()}return null}},is=class extends ar{constructor(e=j()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}};var wt,Y;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(wt||(wt={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Y||(Y={}));let We=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function yt(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],o=e.get(s.to);if(!o)return;s.to=o.to,e.delete(o.from),t.removeUnordered(o),i=!0}}}let xt=class extends We{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(e){this.isVisible&&this.geometry.foreachHighlightGroup(e)}get hasOccludees(){return this.geometry.occludees!=null}};class rs{constructor(){this.first=0,this.count=0}}class ss{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Z({allocator:e=>e||new We,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightGroups=new Set,this.drawCommandsDefault=pe(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=pe(),this.drawCommandsShadowHighlightRest=pe()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightGroups.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightGroups.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const i of this.instances.values())this.updateDrawState(i);this.updateDrawCommands(e)}}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.foreachHighlightGroup(i=>this.highlightGroups.add(i)),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const s=this.drawCommandsDefault.pushNew(),o=this.holes.front();return this.vao!=null&&this.holes.length===1&&o.to===Math.floor(this.vao.byteSize/e)?(s.first=0,void(s.count=o.from)):(s.first=1/0,s.count=0,this._instances.forEach(n=>{s.first=Math.min(s.first,n.from),s.count=Math.max(s.count,n.to)}),void(s.count-=s.first))}const i=Array.from(this._instances.values()).sort((s,o)=>s.from===o.from?s.to-o.to:s.from-o.from),{drawCommandsHighlights:r}=this;for(const s of i)s.isVisible&&(je(s.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,s),s.hasHighlights?s.foreachHighlightGroup(o=>{let n=r.get(o);n||(n=pe(),r.set(o,n)),je(n,s)}):je(this.drawCommandsShadowHighlightRest,s))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function os(t){return t.vao!=null}function pe(){return new Z({allocator:t=>t||new rs,deallocator:t=>t})}function je(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(ns(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function ns(t,e){return t.first+t.count>=e.from}let as=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}},Le=class extends Sr{get _hasAnyHighlight(){return this._highlightGroups.size>0}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new is,this._highlightGroups=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=hi(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==F.Highlight&&r!==F.ShadowHighlight||this._hasAnyHighlight))&&e(r))})}initializeRenderContext(e,i){this._glMaterials=new ts(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,yr(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(({geometry:s})=>e(s))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i==null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const o=s.renderGeometry,n=this._dataByOrigin.get(o.localOrigin.id),l=n==null?void 0:n.findBuffer(o.id);if(l==null)return;const a=l.instances.get(o.id);if(s.updateType&(Y.GEOMETRY|Y.TRANSFORMATION)){const c=ge(i.elementCount(a.geometry.geometry.attributes)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),l.vao.vertexBuffers.get("geometry").setSubData(c,a.from*r,0,a.numElements*r)}s.updateType&(Y.HIGHLIGHT|Y.OCCLUDEE|Y.VISIBILITY)&&(l.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new wr;for(const s of e){const o=s.localOrigin;if(o==null)continue;let n=r.get(o.id,null);n==null&&(n=new bt(o.vec3),r.set(o.id,null,n)),n.changes.push(s)}for(const s of i){const o=s.localOrigin;if(o==null)continue;const n=this._dataByOrigin.get(o.id),l=n==null?void 0:n.findBuffer(s.id);if(l==null)continue;let a=r.get(o.id,l);a==null&&(a=new bt(o.vec3),r.set(o.id,l,a)),a.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter==null||this._vaoCache==null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,o=r.vertexBufferLayout.stride/4,n=this._computeDeltas(e,i);n.forEach((l,a)=>{const c=l.get(null),h=(c==null?void 0:c.changes)??[];n.delete(a,null);let u=s.get(a);if(l.forEach((f,d)=>{if(n.delete(a,d),d==null)return void ye(!1,"No VAO for removed geometries");if(d.instances.size===f.changes.length)return this._vaoCache.deleteVao(d.vao),Ze(u.buffers,d),void(u.buffers.length===0&&h.length===0&&s.delete(a));const w=d.numElements,y=d.vao.byteSize/4,O=h.reduce((C,D)=>C+r.elementCount(D.geometry.attributes),0),S=f.changes.reduce((C,D)=>C+r.elementCount(D.geometry.attributes),0),M=Math.min((w+O-S)*o,me),T=M>y;M>Oe&&M<y/2?(f.changes.forEach(({id:C})=>d.deleteInstance(C)),d.instances.forEach(({geometry:C})=>h.push(C)),this._vaoCache.deleteVao(d.vao),Ze(u.buffers,d)):T?this._applyAndRebuild(d,h,f):this._applyRemoves(d,f)}),h.length>0)for(u==null&&(u=new as(c.origin),s.set(a,u)),u.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)u.buffers.push(this._applyAndRebuild(new ss,h,null))})}_updateDrawCommands(){this._highlightGroups.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride),i.hasHighlights&&ci(this._highlightGroups,i.highlightGroups),this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r)for(const w of r.changes)e.deleteInstance(w.id);const s=this._bufferWriter,o=s.vertexBufferLayout.stride,n=o/4,l=Math.floor(me/n);let a=e.numElements;for(;i.length>0;){const w=i.pop(),y=s.elementCount(w.geometry.attributes);if(a+y>l&&a>0){i.push(w);break}a+=y;const O=new xt(w,0,0);ye(e.instances.get(w.id)==null),e.addInstance(w.id,O)}const c=a*n,h=ge(c),u=s.vertexBufferLayout.createView(h.buffer);let f=0;e.resetInstanceSummary(),e.instances.forEach((w,y)=>{this._writeGeometry(w.geometry,u,f);const O=f;f+=s.elementCount(w.geometry.geometry.attributes),e.updateInstance(y,O,f),e.updateDrawState(w)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Ct(c)),e.vao.vertexBuffers.get("geometry").setSubData(h,0,0,f*n),e.holes.clear();const d=e.holes.pushNew();return d.from=f,d.to=Math.floor(e.vao.byteSize/o),e.updateDrawCommands(o),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter==null)return;for(const l of i.changes){const a=l.id,c=e.instances.get(a);if(!c)continue;e.deleteInstance(a);const h=H.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const u=H.pushNew();u.from=c.from,u.to=c.to}yt(H);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=H.reduce((l,a)=>Math.max(l,a.numElements),0)*r,o=ge(s);o.fill(0,0,s);const n=e.vao.vertexBuffers.get("geometry");H.forAll(l=>n.setSubData(o,l.from*r,0,l.numElements*r)),e.holes.pushArray(H.data,H.length),H.forAll((l,a)=>H.data[a]=null),H.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter==null)return;if(!os(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,o=e.numElements,n=i.reduce((S,M)=>S+r.elementCount(M.geometry.attributes),0),l=Math.min((o+n)*s,me),a=4*l;if(e.vao.byteSize<Ct(me-Oe)&&a>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);yt(e.holes);const c=new Array;for(const S of i){const M=r.elementCount(S.geometry.attributes),T=ls(e.holes,M);c.push(T)}const h=e.vao.vertexBuffers.get("geometry");let u=0,f=0,d=0;const w=ge(l),y=r.vertexBufferLayout.createView(w.buffer);i.forEach((S,M)=>{const T=c[M];if(T==null)return;if(d!==T){const $=d-f;$>0&&h.setSubData(w,f*s,0,$*s),f=T,u=0}const C=r.elementCount(S.geometry.attributes);this._writeGeometry(S,y,u),u+=C,d=T+C;const D=new xt(S,T,T+C);ye(e.instances.get(S.id)==null),e.addInstance(S.id,D),e.drawCommandsDirty=!0});const O=d-f;O>0&&h.setSubData(w,f*s,0,O*s),ui(i,(S,M)=>c[M]==null)}_writeGeometry(e,i,r){this._bufferWriter!=null&&(ve(X,e.transformation),X[12]-=e.localOrigin.vec3[0],X[13]-=e.localOrigin.vec3[1],X[14]-=e.localOrigin.vec3[2],ie(fe,X),$t(fe,fe),this._bufferWriter.write(X,fe,e.geometry.attributes,e.geometry.objectAndLayerIdColor,i,r))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){var d;if(!this.material.shouldRender(e))return null;const{output:i,bind:r}=e,s=this.material.produces.get(r.slot);if(!(s!=null&&s(i)))return null;const{highlightGroupName:o,slot:n}=r,l=i===F.ShadowHighlight,a=i===F.Highlight,c=a||l,h=w=>c&&(this._highlightGroups.size===0||a&&!!o&&!w.has(o));if(h(this._highlightGroups))return null;const u=i===F.ShadowExcludeHighlight,f=!(c||u);for(const{buffers:w}of this._dataByOrigin.values())for(const y of w){if(h(y.highlightGroups))continue;const O=l?y.drawCommandsHighlights.size>0:c?o?y.drawCommandsHighlights.get(o):y.drawCommandsHighlights.size>0:((d=(u&&y.needsMultipleCommands()?y.drawCommandsShadowHighlightRest:y.drawCommandsDefault)||null)==null?void 0:d.length)??!1,S=f&&y.drawCommandsOccludees||null;if(O||S!=null&&S.length){const M=this._glMaterials.load(e.rctx,n,i),T=M==null?void 0:M.beginSlot(r);if(T)return T}}return null}render(e,i){const{output:r,bind:s}=e,{slot:o,highlightGroupName:n}=s,l=r===F.Highlight;if(l&&!n)return;const a=r===F.ShadowHighlight,c=l||a,h=r===F.ShadowExcludeHighlight,u=!(c||h),f=o===k.OCCLUDER_MATERIAL||o===k.TRANSPARENT_OCCLUDER_MATERIAL?o:null,{rctx:d}=e;d.runAppleAmdDriverHelper();const w=d.bindTechnique(i,s,this.material.parameters);for(const y of this._dataByOrigin.values())for(const O of y.buffers){if(l&&(!O.hasHighlights||!O.drawCommandsHighlights.has(n))||a&&!O.hasHighlights)continue;const S=()=>{const $=[];for(const V of O.drawCommandsHighlights.values())$.push(V);return $},M=c&&!a?O.drawCommandsHighlights.get(n)??null:null,T=a?S():c?M?[M]:St:(h&&O.needsMultipleCommands()?[O.drawCommandsShadowHighlightRest]:[O.drawCommandsDefault])||St,C=T.some($=>$.length>0),D=u&&O.drawCommandsOccludees||null;if(C||D!=null&&D.length){if(this._drawParameters.origin=y.origin,w.bindDraw(s,this.material.parameters,this._drawParameters),i.ensureAttributeLocations(O.vao),d.bindVAO(O.vao),C)for(const $ of T)d.setPipelineState(i.getPipeline(!1,f)),$.forAll(V=>d.drawArrays(i.primitiveType,V.first,V.count));D!=null&&D.length&&(d.setPipelineState(i.getPipeline(!0,f)),D.forAll($=>d.drawArrays(i.primitiveType,$.first,$.count)))}}}get test(){}};p([g({constructOnly:!0})],Le.prototype,"material",void 0),Le=p([Mt("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],Le);class bt{constructor(e){this.origin=e,this.changes=new Array}}function ls(t,e){const i=t.find(s=>s.numElements>=e);if(i==null)return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const X=N(),fe=N(),H=new Z({allocator:t=>t||new We,deallocator:null}),Oe=65536,Be=4*Oe,Ot=1024,Vt=16777216,me=Vt/4;let Ve=new Float32Array(Oe);function ge(t){return Ve.length<t&&(Ve=new Float32Array(t)),Ve}function Ct(t){const e=4*t;return e<=Ot?Ot:e<Be?di(e):Math.max(Math.min(Math.ceil(1.5*e/Be)*Be,Vt),e)}const St=[],Ht=128,Nt=.5;function wo(t){return t==="cross"||t==="x"}function yo(t,e=Ht,i=e*Nt,r=0){const s=hs(t,e,i,r);return new lr(s,{mipmap:!1,wrap:{s:ut.CLAMP_TO_EDGE,t:ut.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function hs(t,e=Ht,i=e*Nt,r=0){switch(t){case"circle":default:return cs(e,i);case"square":return us(e,i);case"cross":return ps(e,i,r);case"x":return fs(e,i,r);case"kite":return ds(e,i);case"triangle":return ms(e,i);case"arrow":return gs(e,i)}}function cs(t,e){const i=t/2-.5;return oe(t,qt(i,i,e/2))}function us(t,e){return Gt(t,e,!1)}function ds(t,e){return Gt(t,e,!0)}function ps(t,e,i=0){return Ut(t,e,!1,i)}function fs(t,e,i=0){return Ut(t,e,!0,i)}function ms(t,e){return oe(t,Wt(t/2,e,e/2))}function gs(t,e){const i=e,r=e/2,s=t/2,o=.8*i,n=qt(s,(t-e)/2-o,Math.sqrt(o*o+r*r)),l=Wt(s,i,r);return oe(t,(a,c)=>Math.max(l(a,c),-n(a,c)))}function Gt(t,e,i){return i&&(e/=Math.SQRT2),oe(t,(r,s)=>{let o=r-.5*t+.25,n=.5*t-s-.75;if(i){const l=(o+n)/Math.SQRT2;n=(n-o)/Math.SQRT2,o=l}return Math.max(Math.abs(o),Math.abs(n))-.5*e})}function Ut(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return oe(t,(o,n)=>{let l,a=o-.5*t,c=.5*t-n-1;if(i){const h=(a+c)/Math.SQRT2;c=(c-a)/Math.SQRT2,a=h}return a=Math.abs(a),c=Math.abs(c),l=a>c?a>s?Math.sqrt((a-s)*(a-s)+c*c):c:c>s?Math.sqrt(a*a+(c-s)*(c-s)):a,l-=r/2,l})}function qt(t,e,i){return(r,s)=>{const o=r-t,n=s-e;return Math.sqrt(o*o+n*n)-i}}function Wt(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,o)=>{const n=Math.abs(s-t)-i,l=o-t+e/2+.75,a=(e*n+i*l)/r,c=-l;return Math.max(a,c)}}function oe(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const o=s+t*r;let n=e(s,r);n=n/t+.5,br(n,i,4*o)}return i}const vs=Object.freeze(Object.defineProperty({__proto__:null,build:zt,calculateAnchorPosForRendering:se,shaderSettings:qe},Symbol.toStringTag,{value:"Module"}));export{wt as E,Y as I,Ct as V,is as a,yo as b,uo as c,wo as d,Nt as e,Tr as f,Ht as g,oo as i,so as n,Ks as o,Ys as r,eo as s,ts as t,Sr as u,Le as x};
