const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-action-Bu7tqzqE.js","assets/action-DoqCRstk.js","assets/index-C1aGfQcb.js","assets/index-qkyhuh7d.css","assets/calcite-action-bar-1uw53S87.js","assets/conditionalSlot-DyGemPLG.js","assets/action-group-B6LEEqB9.js","assets/action-menu-BleOBRYN.js","assets/array-D9rxjK_-.js","assets/popover-DdH8HGky.js","assets/floating-ui-R-4Kk1Xn.js","assets/debounce-DUf35w49.js","assets/focusTrapComponent-ftxFIElQ.js","assets/openCloseComponent-BuFuLtHA.js","assets/Heading-l4oDCerj.js","assets/FloatingArrow-BWnzcOPl.js","assets/calcite-label-CXLoAlD_.js","assets/calcite-icon-B5wvyzgm.js","assets/calcite-popover-BfZsosHM.js","assets/calcite-tooltip-CQlqWX4W.js","assets/calcite-color-picker-Dr3ACja3.js","assets/math-CkFPD3oi.js","assets/input-message-DUj9fRxn.js","assets/input-number-CJ4XkYYB.js","assets/Validation-GlGaxVIF.js","assets/input-De-TCHNF.js","assets/progress-BuA_2UWg.js","assets/input-text-CPWGU601.js","assets/core-CoDzbbcw.js","assets/throttle-B9yWORl3.js","assets/calcite-input-number-CqPBhxk_.js"])))=>i.map(i=>d[i]);
import{cS as T,b8 as E,F as n,G as o,K as M,L as D,aO as R,Q as st,dS as at,T as lt,ay as pt,bU as _,fu as l,jg as J,bO as X,bN as ct,c7 as dt,M as I,aD as G,b_ as U,aA as ht,cx as mt,d6 as ut,fr as N,fs as gt,P as vt,ft as _t,aE as w,fv as B,im as yt,jh as ft,ji as bt}from"./index-C1aGfQcb.js";import{m as F,U as Y,V as wt,W as x}from"./Editor-BZKF0HZM.js";import{u as St}from"./scaleUtils-D2VbidBA.js";import{e as z}from"./projectVectorToVector-Dtcb6Asj.js";import{e as Ct,P as Mt,a as $t,T as xt,E as Pt,v as It,M as Tt,p as Et,b as Ot}from"./SketchTooltipInfo-DuJVRn9_.js";import{t as Lt,o as kt}from"./gridUtils-DnVGRhB5.js";import{DrawGraphicTool2D as Rt}from"./editingTools-CU2cZK96.js";import{x as Gt}from"./TextOverlayItem-DKvrqEks.js";import{r as At}from"./number-ByPuf2wa.js";import{_ as Dt,K as Vt}from"./projection-BOBOhWzm.js";import"./vec2-D9okOEat.js";import"./vec2f64-CCfZVA9N.js";import"./vec32-CmwgPQMd.js";import"./projectBuffer-CZ7yaGuo.js";import"./Spinner-CEWOvPN4.js";import"./AttachmentInfo-Cg9fIPGU.js";import"./legacyIcon-CEIp6Pa9.js";import"./UpdatingHandles-DOPUoIlu.js";import"./FeatureLayerBase-BNIuOgAL.js";import"./commonProperties-Drl05DKJ.js";import"./ElevationInfo-D7CBP7sd.js";import"./lengthUtils-CFwdZ3dz.js";import"./HeightModelInfo-kVs8dE0B.js";import"./arcgisLayerUrl-BkZy4Mr3.js";import"./featureLayerUtils-Dy99w2fj.js";import"./Query-LPs1Zyw4.js";import"./FullTextSearch-Cza0yp3f.js";import"./TimeExtent-DGiXUfis.js";import"./timeUtils-X0MXjtQ8.js";import"./jsonUtils-CWFaUb2E.js";import"./UniqueValueRenderer-CAZbf8NT.js";import"./RendererLegendOptions-CULirduz.js";import"./diffUtils-DMLidw0V.js";import"./colorRamps-D4VCsfmX.js";import"./sizeVariableUtils-Cmcuvw-4.js";import"./visualVariableUtils-dx28E4EQ.js";import"./jsonUtils-BWWcP_yB.js";import"./defaults-Dbnhuv3C.js";import"./defaultsJSON-GKolV7NZ.js";import"./styleUtils-CEgUrR2a.js";import"./LRUCache-DbPTy7LA.js";import"./Version-DD-eRUXC.js";import"./FieldsIndex-BrdRr9E_.js";import"./UnknownTimeZone-DhxWDwo9.js";import"./OverrideHelper-D-UVQ00R.js";import"./colorUtils-BWiljOUv.js";import"./vec42-BHDxGccW.js";import"./vec4f64-o2zAXfmz.js";import"./utils-D7agaEG-.js";import"./enums-CmIX1y88.js";import"./quantizationUtils-DbJV_fl5.js";import"./heatmapUtils-D0BPLm9w.js";import"./LayerFloorInfo-DzoJncEV.js";import"./Relationship-CBhq9gYu.js";import"./serviceCapabilitiesUtils-B23--4px.js";import"./arcade-DfpF5wFh.js";import"./TimeOnly-vNYE6bX9.js";import"./ImmutableArray-BPVd6ESQ.js";import"./FeatureLayer-DGRhhm0K.js";import"./MultiOriginJSONSupport-Qqzd52Lf.js";import"./Layer-CneDw8eF.js";import"./workers-CeelWDzo.js";import"./editsZScale-8GE3gysf.js";import"./queryZScale-D-ZT69l7.js";import"./FeatureSet-CeKoTEEO.js";import"./APIKeyMixin-BrvyKlIW.js";import"./ArcGISService-C1oUW8BT.js";import"./BlendLayer-CG9LFMxd.js";import"./jsonUtils-n3e_wlfQ.js";import"./parser-C4Qiz3JH.js";import"./utils-sqJe3zMg.js";import"./CustomParametersMixin-BhjpsNjD.js";import"./EditBusLayer-DCXZWvgn.js";import"./FeatureEffectLayer-gWJrS8gr.js";import"./FeatureEffect-B5YAe6Lk.js";import"./FeatureReductionLayer-DuxcLofN.js";import"./FeatureReductionSelection-tRCh97wj.js";import"./labelingInfo-BV0df7F6.js";import"./labelUtils-C_ZaLudT.js";import"./MD5-C9MwAd2G.js";import"./OperationalLayer-nNeN4Mrb.js";import"./OrderedLayer-B8Gw_A9P.js";import"./OrderByInfo-k2G4k_zV.js";import"./PortalLayer-Bqf_dhsv.js";import"./portalItemUtils-Cy9KvMYK.js";import"./RefreshableLayer-CwxQNwd3.js";import"./ScaleRangeLayer-66YiyNPI.js";import"./TemporalLayer-CR5q7V2k.js";import"./TimeInfo-CY1-cj-U.js";import"./FeatureTemplate-DJBXu3Te.js";import"./FeatureType-JHO2oVJp.js";import"./fieldProperties-CoDAhoou.js";import"./versionUtils-DBm9Te4x.js";import"./styleUtils-CFywnZa6.js";import"./popupUtils-BA1X4qoc.js";import"./AlphaCutoff-UcccL64p.js";import"./interfaces-CL2NbQte.js";import"./symbolUtils-BmmDXP-E.js";import"./utils-C2gvZghy.js";import"./mat2df32-BR-p9z6z.js";import"./webStyleSymbolUtils-kO7zmqzd.js";import"./GraphicsLayer-7fnK8PA0.js";import"./GraphicsCollection-BlUFPpxh.js";import"./elevationInfoUtils-DQT3uSQq.js";import"./screenUtils-CLE_gLy7.js";import"./signal-CRiDvIIF.js";import"./utils-CS8i_70G.js";import"./plane-CM4t6fNH.js";import"./mat3f64-q3fE-ZOt.js";import"./mat4f64-Dk4dwAN8.js";import"./quatf64-aQ5IuZRd.js";import"./sphere-DuEd_sPX.js";import"./mat3-Dg2BrR6m.js";import"./drapedUtils-BnpEPkkO.js";import"./infoFor3D-C0hFfS1m.js";import"./ViewingMode-HRfKv6NR.js";import"./utils-BQBvadb7.js";import"./widget-3rB5q3_K.js";import"./uploadAssetErrors-Cy9k5t87.js";import"./projectPointToVector-ByIVLKML.js";import"./spatialReferenceEllipsoidUtils-BEJMNM9o.js";import"./geodesicLengthMeasurementUtils-DHp52l__.js";import"./MeshTransform-CQofocAh.js";import"./quat-D8-cBF-l.js";import"./axisAngleDegrees-C6bqw-Uy.js";import"./meshVertexSpaceUtils-D5F-abOR.js";import"./MeshLocalVertexSpace-sgg6_SW2.js";import"./themeUtils-C3zvZbsE.js";import"./a11yUtils-Tsw26pQ5.js";import"./memoize-DsJmrG76.js";import"./SnappingVisualizer2D-Bz9mNgwk.js";import"./automaticAreaMeasurementUtils-B8M9AKp8.js";import"./PointSnappingHint-DLpaNTCp.js";import"./earcut-Lltz9D9k.js";import"./triangle-CPy2PSEx.js";import"./lineSegment-C6H8qMyL.js";import"./editPlaneUtils-C8xyLzT4.js";import"./hydratedFeatures-ByIq7uy-.js";import"./Scheduler-DS_v5N7L.js";import"./debugFlags-CfZYxH5Q.js";import"./mat2df64-B7VPBnkO.js";import"./helpMessageUtils3d-BZzQ2OvH.js";import"./boundedPlane-C18Ysvcq.js";import"./GraphicManipulator-BMTkDhtD.js";import"./drawUtils-BqwzBuVL.js";const jt={readOnly:!0,get(){return Ct(this.view)}};function Wt(t,e){const i=tt(e);return[t[0].toFixed(i),t[1].toFixed(i)]}function tt(t){return t>=500?6:t<500&&t>=50?7:t<50&&t>=5?8:9}function Ut(t,e){const i=t.includes(",")?",":" ",[r,s,a]=t.split(i).map(d=>{const h=d.trim();return h?Number(h):null});if(!O(r)||!O(s))return null;const p=new T({x:r,y:s,spatialReference:e||E.WGS84});return a&&(p.z=a,p.hasZ=!0),p}function O(t){return typeof t=="number"&&isFinite(t)}function H(t){return!!t&&O(t.x)&&O(t.y)}function q(t,e){if(t.spatialReference.isGeographic&&e){const[i,r]=Wt([t.x,t.y],e);return`${i}, ${r}`}return`${t.x.toFixed(3)}, ${t.y.toFixed(3)}`}let m=class extends D{constructor(t){super(t),this.conversionInfo=null,this.coordinateSegments=null,this._currentPattern=void 0,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return(this._currentPattern||this.defaultPattern)??""}set currentPattern(t){this._currentPattern=t}get label(){return this.name??""}set label(t){this._overrideIfSome("label",t)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){var t;return this.name==="basemap"?this._viewSpatialReference:((t=this.conversionInfo)==null?void 0:t.spatialReference)??E.WGS84}set spatialReference(t){this._overrideIfSome("spatialReference",t)}get _viewSpatialReference(){var t,e;return((e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.spatialReference)??E.WGS84}get _additionalCharactersPattern(){const t=this.coordinateSegments;if(!t)return null;const e=t.map(r=>r.alias),i=this.currentPattern.replaceAll(new RegExp(`["nsew${e.join()}]`,"gi"),"").replaceAll(" ","");return new RegExp(`[${i}]`,"g")}get test(){}async convert(t){var r;if(!H(t))throw new R("format:invalid-point","Could not convert invalid point.",{point:t});const e=(r=this.conversionInfo)==null?void 0:r.convert;if(e)return Promise.resolve().then(()=>e(t));const i=await this._project(t,this.spatialReference);return{location:i,coordinate:await this._getCoordinate(i)}}getConversionStrategy(){var e,i;const t=this._viewSpatialReference;return(e=this.conversionInfo)!=null&&e.convert||(i=this.viewModel)!=null&&i.formatterAvailable||this.name==="xy"&&(t.isWebMercator||t.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(t){if(!t)return null;if(!this.coordinateSegments||!this.currentPattern)return t;let e=this.currentPattern;const i=this._getSegmentMatches(t,!1);for(let r=this.coordinateSegments.length-1;r>=0;r--){const s=this.coordinateSegments[r];e=e.replace(s.alias,i[r])}return e}_parseUserInput(t){const{defaultPattern:e,_additionalCharactersPattern:i,coordinateSegments:r}=this;if(!e||!i)return"";let s=e.replace(i,"");t=t.replace(i,"");const a=this._getSegmentMatches(t,!0);if(r)for(let p=r.length-1;p>=0;p--){const d=r[p];s=s.replace(d.alias,a[p])}return s}_getSegmentMatches(t,e){const i=new Array,{coordinateSegments:r}=this;if(!r)return i;for(let s=0;s<r.length;s++){const a=r[s],p=t.match(a.searchPattern);if(!p){i.push("");continue}let d=p[0];if(t=t.replace(d,"").trim(),a.substitution){const h=e?a.substitution.input(d):a.substitution.output(d);h&&(d=`${h}`)}i.push(d)}return i}async reverseConvert(t){var s,a;const e=this._parseUserInput(t),i=(s=this.conversionInfo)==null?void 0:s.reverseConvert;let r;if(i)r=i(e);else if(this.name==="xy"||this.name==="basemap")r=Ut(e,this.spatialReference);else if((a=this.viewModel)!=null&&a.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":r=Pt(e,this.spatialReference);break;case"mgrs":{r=xt(e,this.spatialReference,"automatic");break}case"utm":{r=$t(e,this.spatialReference,"latitude-band-indicators");break}case"usng":r=Mt(e,this.spatialReference);break;default:r=null}if(!r)throw new R("format:invalid-input","Could not parse input into point.",{userInput:t});return this._project(r,this._viewSpatialReference)}async _getCoordinate(t){var i,r,s;const e=((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.scale)??0;if(!H(t))throw new R("format:invalid-point","Could not transform invalid point into coordinate.",{point:t});if((s=this.viewModel)!=null&&s.formatterAvailable||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{const a=tt(e);return Ot(t,this.name,a)}case"mgrs":return Et(t,"automatic",5,!1);case"usng":return Tt(t,5,!1);case"utm":return It(t,"latitude-band-indicators",!0);default:return q(t,e)}return q(t,e)}async _project(t,e){var i,r;if(st(t.spatialReference,e)||!e)return t;if((i=this.viewModel)!=null&&i.formatterAvailable&&Dt())return Vt(t,e);if(!((r=this.viewModel)!=null&&r.formatterAvailable)){const s=at(t,e);if(s!=null)return s}return null}};n([o()],m.prototype,"conversionInfo",void 0),n([o()],m.prototype,"coordinateSegments",void 0),n([o()],m.prototype,"currentPattern",null),n([o()],m.prototype,"_currentPattern",void 0),n([o()],m.prototype,"label",null),n([o()],m.prototype,"defaultPattern",void 0),n([o({readOnly:!0})],m.prototype,"hasDisplayProperties",null),n([o()],m.prototype,"name",void 0),n([o({type:E})],m.prototype,"spatialReference",null),n([o()],m.prototype,"viewModel",void 0),n([o({readOnly:!0})],m.prototype,"_viewSpatialReference",null),n([o({readOnly:!0})],m.prototype,"_additionalCharactersPattern",null),m=n([M("esri.widgets.CoordinateConversion.support.Format")],m);At().decimal;const Nt="°‎";let g=class extends pt{constructor(t){super(t),this.center=new T,this.dynamicScaling=!0,this.majorLineColor=_.fromArray([115,115,115,1]),this.majorLineInterval=10,this.minorLineColor=_.fromArray([165,165,165,1]),this.rotateWithMap=!1,this.rotation=0,this.spacing=1,this.type="measured",this.units="miles"}};n([o()],g.prototype,"center",void 0),n([o()],g.prototype,"dynamicScaling",void 0),n([o()],g.prototype,"majorLineColor",void 0),n([o()],g.prototype,"majorLineInterval",void 0),n([o()],g.prototype,"minorLineColor",void 0),n([o()],g.prototype,"rotateWithMap",void 0),n([o()],g.prototype,"rotation",void 0),n([o()],g.prototype,"spacing",void 0),n([lt({measured:"measured"})],g.prototype,"type",void 0),n([o()],g.prototype,"units",void 0),g=n([M("esri.grids.MeasuredGrid")],g);let v=class extends D{constructor(t){super(t),this.color=new _([255,127,0,1]),this.isDecoration=!0,this.length=34,this.rotation=0,this.thickness=2,this.visible=!0}get _strokeStyle(){return this.color.toCss(!0)}render(){const{x:t,y:e,length:i,thickness:r,rotation:s}=this,a=i/2,p=`0 0 ${i} ${i}`,d=`M${a} 0 V${i} M0 ${a} H${i}`;return l("div",{classes:{"esri-box-overlay-item":!0},styles:{left:`${(t??0)-a}px`,top:`${(e??0)-a}px`,width:`${i}px`,height:`${i}px`,transform:`rotate(${s}deg)`,visibility:this.visible?"visible":"hidden"}},l("svg",{styles:{overflow:"visible"},viewbox:p},l("path",{d,stroke:this._strokeStyle,"stroke-width":r})))}renderCanvas(){}};n([o()],v.prototype,"color",void 0),n([o()],v.prototype,"isDecoration",void 0),n([o()],v.prototype,"length",void 0),n([o()],v.prototype,"rotation",void 0),n([o()],v.prototype,"thickness",void 0),n([o()],v.prototype,"visible",void 0),n([o()],v.prototype,"x",void 0),n([o()],v.prototype,"y",void 0),n([o({readOnly:!0})],v.prototype,"_strokeStyle",null),v=n([M("esri.views.overlay.CrosshairOverlayItem")],v);const Bt=v,et=t=>{if(t==null||isNaN(t))return 0;const e=t+180;return Math.trunc(J(e,360))},Ft=t=>{let e=t;return e==null?0:(typeof e=="string"&&(e=parseInt(e,10)),isNaN(e)?0:J(Math.trunc(e),360)-180)},K=(t,e)=>{if(!t||e.length<3)return;const[i,r,s,a]=e,[p,d]=a===void 0?[1,.25]:[a,.25*a];t.majorLineColor=_.fromArray([i,r,s,p]),t.minorLineColor=_.fromArray([i,r,s,d])},Q=Symbol("grid-interactivity");let c=class extends D{constructor(t){super(t),this._drawGraphicTool=null,this._crosshairLabel=null,this._crosshairItem=null,this.snappingManager=null,this.snappingOptions=null,this.view=null,this._mostRecentlyShownGrid=null,this._sketchedVertexCount=0}initialize(){this.addHandles([dt(()=>!this.displayEnabled,()=>{this.interactivePlacementState=null}),I(()=>{var t;return(t=this.view)==null?void 0:t.viewpoint},()=>{this._renderOverlays()}),I(()=>{var t;return((t=this.snappingOptions)==null?void 0:t.gridEnabled)&&this.snappingOptions.enabled},t=>{var e;t!=null&&(this.trySetDisplayEnabled(t),((e=this.snappingOptions)==null?void 0:e.enabled)===!0&&(this.snappingEnabled=t))}),I(()=>{var t;return(t=this.view)==null?void 0:t.grid},(t,e)=>{this._mostRecentlyShownGrid=!t&&e?e:null})])}destroy(){var t,e,i,r;this._resetGridPlacementState(),this._crosshairItem&&((e=(t=this.view)==null?void 0:t.overlay)==null||e.removeItem(this._crosshairItem),this._crosshairItem=G(this._crosshairItem)),this._crosshairLabel&&((r=(i=this.view)==null?void 0:i.overlay)==null||r.removeItem(this._crosshairLabel),this._crosshairLabel=G(this._crosshairLabel))}get displayEnabled(){var t;return!!((t=this.view)!=null&&t.grid)}get dynamicScaling(){var t;return((t=this.grid)==null?void 0:t.dynamicScaling)??!1}set dynamicScaling(t){this.grid&&(this.grid.dynamicScaling=t)}get grid(){var t;return((t=this.view)==null?void 0:t.grid)??this._mostRecentlyShownGrid}set gridColor(t){this._set("gridColor",t);const[e,i,r,s]=t.toArray();K(this.grid,[e,i,r,s/255])}get gridControlsEnabled(){return this.displayEnabled&&!this.interactivePlacementState}set interactivePlacementState(t){this._set("interactivePlacementState",t),this._resetGridPlacementState(),t&&this._startGridManipulation(t)}get majorLineInterval(){var t;return((t=this.grid)==null?void 0:t.majorLineInterval)??10}set majorLineInterval(t){this.grid&&(t<1||(this.grid.majorLineInterval=t))}get rotateWithMap(){var t;return((t=this.grid)==null?void 0:t.rotateWithMap)??!1}set rotateWithMap(t){this.grid&&(this.grid.rotateWithMap=t)}get rotation(){var t;return((t=this.grid)==null?void 0:t.rotation)??-180}set rotation(t){this.grid&&(this.grid.rotation=t)}get snappingEnabled(){var t;return(this.grid&&((t=this.snappingOptions)==null?void 0:t.gridEnabled))??!1}set snappingEnabled(t){const{snappingOptions:e}=this;e&&(e.gridEnabled=t)}get spacing(){var t;return((t=this.grid)==null?void 0:t.spacing)??1}set spacing(t){this.grid&&(this.grid.spacing=t)}get unit(){var t;return(t=this.grid)==null?void 0:t.units}set unit(t){this.grid&&(this.grid.units=t)}get gridOutOfScale(){return!this.dynamicScaling&&this._pixelsPerStride!=null&&this._pixelsPerStride<Lt}get effectiveSpacingAfterDynamicScaling(){var t;return this.majorLineInterval<1||!this.dynamicScaling||!this.view||this._pixelsPerStride==null||!((t=this.grid)!=null&&t.spacing)?null:this.grid.spacing*kt(this.majorLineInterval,this._pixelsPerStride,this.dynamicScaling)}get _pixelsPerStride(){var e;if(!((e=this.view)!=null&&e.scale)||!this.displayEnabled||!this.grid)return null;const t=this.grid;return U(t.spacing,t.units,"meters")/St(this.view.scale)}get _isPlacing(){if(!this._drawGraphicTool)return!1;const t=this.interactivePlacementState;return t==="place"||t==="interactive"&&this._sketchedVertexCount===0}get _isRotating(){if(!this._drawGraphicTool)return!1;const t=this.interactivePlacementState;return t==="rotate"||t==="interactive"&&this._sketchedVertexCount===1}get _isScaling(){return this._drawGraphicTool?this.interactivePlacementState==="interactive"&&this._sketchedVertexCount===1:!1}togglePlacementState(t){this.interactivePlacementState=this.interactivePlacementState===t?null:t}trySetDisplayEnabled(t){const{view:e}=this;if(e!=null&&e.ready)if(!e.grid&&t)if(this._mostRecentlyShownGrid)e.grid=this._mostRecentlyShownGrid;else{const i=this.defaultUnit==="imperial"?"feet":"meters";e.grid=new g({units:i,center:e.center??new T,rotateWithMap:!0}),K(this.grid,[115,115,115])}else t||(e.grid=null);else ht.getLogger(this).warn("Attempting to enable grid display while view is not ready")}_startGridManipulation(t){const{view:e,snappingManager:i}=this;if(!e)return void(this.interactivePlacementState=null);this._sketchedVertexCount=0;const r=new Rt({view:e,graphicProperties:{attributes:{[F]:F}},sketchOptions:{tooltips:{enabled:!0,visibleElements:{direction:!1,rotation:!1,totalLength:!1,elevation:!1,distance:!1,area:!1}}},geometryType:"polyline",mode:"click",snapToScene:!1,snappingManager:i,forceUniformSize:!0,centered:!1,cursor:this.interactivePlacementState==="interactive"||this.interactivePlacementState==="place"?"none":null,regularVerticesSymbol:void 0,activeVertexSymbol:zt,activeLineSymbol:Z,graphicSymbol:Z});this._drawGraphicTool=r,e.addAndActivateTool(r),this._renderOverlays(),this.addHandles([r.on("cursor-update",s=>this._onCursorUpdate(s)),r.on("complete",()=>this._onDrawComplete()),r.on("vertex-add",s=>this._onVertexAdd(s,t))],Q)}_onCursorUpdate(t){var e;try{if(this._isPlacing){const i=t.vertices[0].coordinates;return void this._handlePlace(i)}if(this._drawGraphicTool.cursor=null,this._isRotating&&this._handleRotate(t.vertices[0].coordinates),this._isScaling){const i=(e=this._drawGraphicTool)==null?void 0:e.drawOperation.cursorVertex;this._handleScale(i)}}finally{this._renderOverlays()}}_onDrawComplete(){this._drawGraphicTool.cursor=null,this.interactivePlacementState=null}_onVertexAdd(t,e){const i=t.vertices[0].coordinates;this._isPlacing&&this._handlePlace(i),this._isRotating&&this._sketchedVertexCount>0&&this._handleRotate(i),this._isScaling&&this._sketchedVertexCount>0&&this._handleScale(z(i[0],i[1],void 0,this.view.spatialReference)),this._sketchedVertexCount++,this._drawGraphicTool.cursor=null,this._sketchedVertexCount!==2&&e==="interactive"||(this.interactivePlacementState=null),this._renderOverlays()}_handlePlace(t){const{grid:e,view:i}=this;e&&i&&(e.center=new T({x:t[0],y:t[1],spatialReference:i.spatialReference}))}_handleRotate(t){var W;const{grid:e,view:i}=this;if(!e||!i)return;(W=this._drawGraphicTool)==null||W.sketchOptions.tooltips.set("enabled",!1);const{x:r,y:s}=e.center,[a,p]=t,d=i.toScreen(e.center,{pickClosestTarget:!0}),h=d&&i.toMap(d),b=i.toScreen(z(a,p,void 0,i.spatialReference),{pickClosestTarget:!0}),S=b&&i.toMap(b),L=h?h.x:r,k=h?h.y:s,$=L-(S?S.x:a),V=k-(S?S.y:p);if($===0&&V===0)return;const it=Math.atan2(V,$),j=ut(it),rt=e.rotateWithMap,nt=i.viewpoint.rotation??0,ot=rt?j:j-nt;e.rotation=Math.fround(ot)%360}_handleScale(t){const{view:e,grid:i,_drawGraphicTool:r,interactivePlacementState:s}=this;if(!(t&&e&&i&&r))return;r.sketchOptions.tooltips.enabled=!1;const a=s==="interactive"?i.center:r.drawOperation.firstVertex;if(!a||!t)return;const p=e==null?void 0:e.toScreen(a),d=p&&e.toMap(p),h=e==null?void 0:e.toScreen(t),b=d??a,S=(h&&e.toMap(h))??t,L=Math.sqrt((b.x-S.x)**2+(b.y-S.y)**2),k=mt(e.spatialReference),$=U(L*k,"meters",i.units);i.spacing=$}_renderOverlays(){this._renderCrosshairOverlay(),this._renderTextOverlay()}_renderTextOverlay(){const{grid:t,view:e,_drawGraphicTool:i}=this,r=this._getCrosshairLabel();if(!(t&&(e!=null&&e.overlay)&&i&&r))return;const s=e.toScreen(t.center,{pickClosestTarget:!0});s&&(r.position=[s.x+12,s.y+12]),this._isRotating?(r.text=`${et(t.rotation)}${Nt}`,r.visible=!0):r.visible=!1}_renderCrosshairOverlay(){const{grid:t,view:e,_drawGraphicTool:i}=this;if(!t||!(e!=null&&e.overlay)||!i)return;const r=this._getCrosshair();if(!r)return;const s=e.toScreen(t.center);s&&(r.x=s.x,r.y=s.y,r.rotation=t.rotateWithMap?e.viewpoint.rotation-t.rotation:-t.rotation,r.visible=!!i)}_getCrosshairLabel(){if(this._crosshairLabel)return this._crosshairLabel;const{grid:t,view:e,_drawGraphicTool:i}=this;if(!t||!(e!=null&&e.overlay)||!i)return null;const r=new Gt({anchor:"top-left",fontSize:10,textColor:new _([21,21,21]),backgroundColor:new _([248,248,248]),padding:8,borderRadius:20});return e.overlay.addItem(r),this._crosshairLabel=r,r}_getCrosshair(){var i;const{_crosshairItem:t,view:e}=this;return e!=null&&e.overlay?t&&e.overlay.items.includes(t)?t:(this._crosshairItem=new Bt({color:e.effectiveTheme.accentColor,thickness:4,length:36,visible:!0}),(i=e.overlay)==null||i.addItem(this._crosshairItem),this._crosshairItem):null}_resetGridPlacementState(){var t,e;this.removeHandles(Q),this._crosshairItem&&(this._crosshairItem.visible=!1),this._crosshairLabel&&(this._crosshairLabel.visible=!1),this._drawGraphicTool&&(((t=this.view)==null?void 0:t.activeTool)===this._drawGraphicTool&&(this.view.activeTool=null),(e=this.view)==null||e.tools.remove(this._drawGraphicTool)),this._drawGraphicTool=G(this._drawGraphicTool)}};n([o(jt)],c.prototype,"defaultUnit",void 0),n([o({readOnly:!0})],c.prototype,"displayEnabled",null),n([o()],c.prototype,"dynamicScaling",null),n([o()],c.prototype,"grid",null),n([o()],c.prototype,"gridColor",null),n([o()],c.prototype,"gridControlsEnabled",null),n([o()],c.prototype,"interactivePlacementState",null),n([o()],c.prototype,"majorLineInterval",null),n([o()],c.prototype,"rotateWithMap",null),n([o()],c.prototype,"rotation",null),n([o()],c.prototype,"snappingEnabled",null),n([o()],c.prototype,"snappingManager",void 0),n([o()],c.prototype,"snappingOptions",void 0),n([o()],c.prototype,"spacing",null),n([o()],c.prototype,"unit",null),n([o()],c.prototype,"view",void 0),n([o()],c.prototype,"gridOutOfScale",null),n([o()],c.prototype,"effectiveSpacingAfterDynamicScaling",null),n([o()],c.prototype,"_pixelsPerStride",null),n([o()],c.prototype,"_isPlacing",null),n([o()],c.prototype,"_isRotating",null),n([o()],c.prototype,"_isScaling",null),n([o()],c.prototype,"_mostRecentlyShownGrid",void 0),n([o()],c.prototype,"_sketchedVertexCount",void 0),c=n([M("esri.widgets.support.GridControls.GridControlsViewModel")],c);const Z=new X({width:0}),zt=new ct({color:_.fromArray([0,0,0,0]),outline:new X({color:_.fromArray([0,0,0,0])})}),y="esri-grid-controls",f={base:y,borderedSwitch:`${y}__switch--bordered`,container:`${y}__container`,numericInputsContainer:`${y}__numeric-inputs__container`,tilegroup:`${y}__tilegroup`,tile:`${y}__tile`,tileDisabled:`${y}__tile--disabled`,tileContent:`${y}__tile__content`,suffixedInputContainer:`${y}__input-with-suffix__container`,inputSuffix:`${y}__input-with-suffix__suffix-part`,inlineIcon:`${y}__inline-icon`},C={widgetIcon:"grid-unit",gridTheme:{light:"circle",dark:"circle-area",custom:"palette"},placementState:{interactive:"maximum-territory-distance",place:"move",rotate:"rotate"},info:"information",warning:"exclamation-mark-triangle"},P=_.fromArray([115,115,115]),A=_.fromArray([200,200,200]),Ht=["interactive","place","rotate"];let u=class extends gt{constructor(t,e){super(t,e),this.customColor=null,this.messages=null,this.messagesUnits=null,this.viewModel=new c,this.visibleElements=new Y}initialize(){this.addHandles([I(()=>{var t,e;return(e=(t=this.view)==null?void 0:t.grid)==null?void 0:e.majorLineColor},t=>{!t||P.equals(t)||A.equals(t)||(this.customColor=t)},vt)])}loadDependencies(){return Promise.all([_t({action:()=>w(()=>import("./calcite-action-Bu7tqzqE.js"),__vite__mapDeps([0,1,2,3])),"action-bar":()=>w(()=>import("./calcite-action-bar-1uw53S87.js"),__vite__mapDeps([4,2,3,5,6,7,8,1,9,10,11,12,13,14,15])),label:()=>w(()=>import("./calcite-label-CXLoAlD_.js"),__vite__mapDeps([16,2,3])),icon:()=>w(()=>import("./calcite-icon-B5wvyzgm.js"),__vite__mapDeps([17,2,3])),popover:()=>w(()=>import("./calcite-popover-BfZsosHM.js"),__vite__mapDeps([18,9,2,3,10,11,12,13,14,15,1])),tooltip:()=>w(()=>import("./calcite-tooltip-CQlqWX4W.js"),__vite__mapDeps([19,2,3,10,11,13,15])),"color-picker":()=>w(()=>import("./calcite-color-picker-Dr3ACja3.js"),__vite__mapDeps([20,2,3,21,22,23,24,25,26,27,28,29,11])),"input-number":()=>w(()=>import("./calcite-input-number-CqPBhxk_.js"),__vite__mapDeps([30,23,2,3,24,25,22,26]))}),wt()])}get icon(){return C.widgetIcon}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages.widgetLabel}set label(t){this._overrideIfSome("label",t)}get snappingManager(){return this.viewModel.snappingManager}set snappingManager(t){this.viewModel.snappingManager=t}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get theme(){var e;const t=(e=this.viewModel.grid)==null?void 0:e.majorLineColor;return t?P.equals(t)?"dark":A.equals(t)?"light":"custom":null}set theme(t){const{viewModel:e,customColor:i}=this;switch(t){case"light":e.gridColor=A;break;case"dark":e.gridColor=P;break;case"custom":e.gridColor=i??P}}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){return l("div",{"aria-label":this.label,class:this.classes(f.base,B.widget,B.panel)},l("div",{class:f.container},this._renderContent()))}_renderContent(){const{visibleElements:t}=this;return[t.gridEnabledToggle?this._renderEnabledToggle():null,t.placementButtons?this._renderGridPlacementButtons():null,t.numericInputs?this._renderNumericInputs():null,t.lineIntervalInput?this._renderIntervalInput():null,t.gridSnapEnabledToggle&&this.viewModel.snappingOptions?this._renderSnappingToggle():null,t.dynamicScaleToggle?this._renderDynamicScaleToggle():null,t.rotateWithMapToggle?this._renderRotateToggle():null,t.colorSelection?this._renderColorSelection():null]}_renderGridPlacementButtons(){return l("calcite-label",{key:"grid-placement-buttons",scale:"s"},this.messages.placementOptions,l("calcite-action-bar",{expandDisabled:!0,layout:"horizontal"},Ht.map(t=>this._renderPlacementModeButton(t))))}_renderPlacementModeButton(t){const{interactivePlacementState:e,gridControlsEnabled:i}=this.viewModel,r=this.messages.placementState[t],s=`__placement-action-${t}`;return l("div",null,l("calcite-action",{active:e===t,alignment:"center",disabled:!i,icon:C.placementState[t],id:s,onclick:()=>this.viewModel.togglePlacementState(t),text:r}),l("calcite-tooltip",{disabled:!i,placement:"top",referenceElement:s},r))}_renderNumericInputs(){const{rotation:t,spacing:e,effectiveSpacingAfterDynamicScaling:i,unit:r="meters"}=this.viewModel,s=this.messagesUnits.units[r].abbr,a=this.viewModel.gridControlsEnabled,p=i!=null&&i!==this.viewModel.spacing,d=`__spacing_input_scaled-${this.id}`;return l("div",{class:this.classes(f.numericInputsContainer)},l("calcite-label",{scale:"s"},l("span",null,this.messages.inputLabel.spacing,p?l("calcite-icon",{class:this.classes(f.inlineIcon),icon:C.info,id:d,scale:"s",tabIndex:0}):void 0),l("div",{class:f.suffixedInputContainer},l("calcite-input-number",{disabled:!a,numberButtonType:"none",suffixText:s,value:`${e==null?void 0:e.toFixed(2)}`,onCalciteInputNumberChange:({target:h})=>this.viewModel.spacing=parseInt(h.value,10)}),p?l("calcite-tooltip",{overlayPositioning:"fixed",placement:"leading",referenceElement:d},yt(this.messages.warnings.dynamicSpacing,{actualSpacingIncludingUnit:ft(this.messagesUnits,i,r,2,"plural")})):void 0)),l("calcite-label",{scale:"s"},this.messages.inputLabel.angle,l("calcite-input-number",{disabled:!a,integer:!0,numberButtonType:"none",suffixText:this.messagesUnits.units.degrees.abbr,value:`${et(t)}`,onCalciteInputNumberChange:({target:h})=>this.viewModel.rotation=Ft(h.value)})))}_renderIntervalInput(){const{majorLineInterval:t,gridControlsEnabled:e}=this.viewModel;return l("div",{class:this.classes(f.numericInputsContainer)},l("calcite-label",{scale:"s"},this.messages.inputLabel.interval,l("calcite-input-number",{disabled:!e,integer:!0,max:15,min:1,numberButtonType:"vertical",value:`${t}`,onCalciteInputNumberChange:({target:i})=>this.viewModel.majorLineInterval=parseInt(i.value,10)})))}_renderSnappingToggle(){const{snappingOptions:t,gridControlsEnabled:e}=this.viewModel;return l(x,{checked:!!((t==null?void 0:t.gridEnabled)??!1),disabled:!(e&&t),key:"grid-snap-enabled-toggle",label:this.messages.switchLabel.snap,onChange:i=>{var r;return(r=this.viewModel.snappingOptions)==null?void 0:r.set("gridEnabled",i)}})}_renderDynamicScaleToggle(){const{viewModel:t,messages:e}=this,i=this.visibleElements.outOfScaleWarning&&t.gridOutOfScale;return l(x,{checked:t.dynamicScaling,disabled:!t.gridControlsEnabled,hint:i?e.warnings.outOfScale:void 0,hintIcon:C.warning,hintKind:"warning",key:`grid-dynamic-scale-toggle-${this.id}`,label:e.switchLabel.scaling,onChange:r=>t.dynamicScaling=r})}_renderRotateToggle(){const{gridControlsEnabled:t,rotateWithMap:e}=this.viewModel;return l(x,{checked:e,disabled:!t,key:"grid-rotate-map-toggle",label:this.messages.switchLabel.rotateWithMap,onChange:i=>this.viewModel.rotateWithMap=i})}_renderEnabledToggle(){return l("div",{class:f.borderedSwitch},l(x,{checked:this.viewModel.displayEnabled,disabled:!!this.viewModel.interactivePlacementState,key:"grid-enabled-toggle",label:this.messages.switchLabel.display,onChange:t=>this.viewModel.trySetDisplayEnabled(t)}))}_renderColorSelection(){const{customColor:t}=this,e=`${this.id}--custom-grid-color-button`;return l("calcite-label",{scale:"s"},this.messages.inputLabel.theme,l("div",{class:f.tilegroup},[this._renderThemeTile({value:"dark"}),this._renderThemeTile({value:"light"}),this._renderThemeTile({value:"custom",id:e}),l("calcite-popover",{autoClose:!0,label:this.messages.gridLineColorPopoverLabel,overlayPositioning:"fixed",referenceElement:e},l("calcite-color-picker",{alphaChannel:!0,savedDisabled:!0,value:(t==null?void 0:t.toHex({digits:8}))??"#000000ff",onCalciteColorPickerChange:i=>{const r=_.fromHex(i.target.value);r&&(this.customColor=r,this.theme="custom")}}))]))}_renderThemeTile(t){const{theme:e}=this,{value:i}=t,r=this.messages.gridTheme[i],s=`${this.id}--theme_tile_${i}`,a=`${s}__label`,p=C.gridTheme[i],d=this.viewModel.gridControlsEnabled;return l("div",{class:bt({[f.tile]:!0,[f.tileDisabled]:!d}),id:t.id,role:"button"},l("input",{"aria-labelledby":a,checked:e===i,disabled:!d,id:s,name:`${this.id}--theme`,onchange:h=>{var b;this.theme=i,(b=h.target)==null||b.focus()},tabIndex:0,type:"radio"}),l("div",{class:f.tileContent},l("calcite-icon",{icon:p,scale:"l"}),l("calcite-label",{for:s,id:a},r)))}};n([o()],u.prototype,"customColor",void 0),n([o()],u.prototype,"icon",null),n([o()],u.prototype,"label",null),n([o(),N("esri/widgets/support/GridControls/t9n/GridControls")],u.prototype,"messages",void 0),n([o(),N("esri/core/t9n/Units")],u.prototype,"messagesUnits",void 0),n([o()],u.prototype,"snappingManager",null),n([o()],u.prototype,"snappingOptions",null),n([o()],u.prototype,"theme",null),n([o()],u.prototype,"view",null),n([o({type:c})],u.prototype,"viewModel",void 0),n([o({type:Y,nonNullable:!0})],u.prototype,"visibleElements",void 0),u=n([M("esri.widgets.support.GridControls")],u);const Er=u;export{Er as default};
