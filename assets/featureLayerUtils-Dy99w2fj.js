const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingSupport-DtOMNCjA.js","assets/index-C1aGfQcb.js","assets/index-qkyhuh7d.css","assets/normalizeUtils-Bg1OALXh.js","assets/normalizeUtilsCommon-UUlRRPVA.js","assets/utils-DGPHbhMN.js","assets/utils-ByvCMLXh.js","assets/EditBusLayer-DCXZWvgn.js","assets/infoFor3D-C0hFfS1m.js"])))=>i.map(i=>d[i]);
import{a$ as v,aO as i,aE as q,fD as P,fE as A,fF as E,fG as F,fH as x,fI as L,fJ as j,fK as R,aL as m,aJ as S}from"./index-C1aGfQcb.js";import{b as y}from"./Query-LPs1Zyw4.js";import{p as C}from"./jsonUtils-CWFaUb2E.js";import{A as M}from"./UniqueValueRenderer-CAZbf8NT.js";async function T(t,e,r){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=O(t));const n=_(t),a=t.capabilities.query.supportsPagination;e.start=0,e.num=n;let o=null;for(;;){const s=await t.source.queryFeaturesJSON(e,r);if(o==null?o=s:o.features=o.features.concat(s.features),o.exceededTransferLimit=s.exceededTransferLimit,!a||!s.exceededTransferLimit)break;e.start+=n}return o}function _(t){return O(t)*$(t)}function $(t){return t.capabilities.query.maxRecordCount||2e3}function O(t){return t.capabilities.query.supportsMaxRecordCountFactor?y.MAX_MAX_RECORD_COUNT_FACTOR:1}const H=new v({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Z(t,e,r,n){const a=await f(t);if(await w(t,e,n),!a.addAttachment)throw new i(n,"Layer source does not support addAttachment capability");return a.addAttachment(e,r)}function w(t,e,r){var o,s;const{attributes:n}=e,{objectIdField:a}=t;return(s=(o=t.capabilities)==null?void 0:o.data)!=null&&s.supportsAttachment?e?n?a&&n[a]?Promise.resolve():Promise.reject(new i(r,`feature is missing the identifying attribute ${a}`)):Promise.reject(new i(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new i(r,"A feature is required to add/delete/update attachments")):Promise.reject(new i(r,"this layer doesn't support attachments"))}async function B(t,e,r,n,a){const o=await f(t);if(await w(t,e,a),!o.updateAttachment)throw new i(a,"Layer source does not support updateAttachment capability");return o.updateAttachment(e,r,n)}async function z(t,e,r){const{applyEdits:n}=await q(()=>import("./editingSupport-DtOMNCjA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await t.load();let o=r;return a.type==="feature"&&a.infoFor3D&&e.deleteFeatures!=null&&a.globalIdField!=null&&(o={...o,globalIdToObjectId:await G(a,e.deleteFeatures,a.globalIdField)}),n(a,a.source,e,r)}async function X(t,e,r){const{uploadAssets:n}=await q(()=>import("./editingSupport-DtOMNCjA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),a=await t.load();return n(a,a.source,e,r)}async function K(t,e,r,n){const a=await f(t);if(await w(t,e,n),!a.deleteAttachments)throw new i(n,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(e,r)}async function W(t,e,r){const n=(await t.load({signal:e==null?void 0:e.signal})).source;if(!n.fetchRecomputedExtents)throw new i(r,"Layer source does not support fetchUpdates capability");return n.fetchRecomputedExtents(e)}async function Y(t,e,r,n){var g,I;e=P.from(e),await t.load();const a=t.source,o=t.capabilities;if(!((g=o==null?void 0:o.data)!=null&&g.supportsAttachment))throw new i(n,"this layer doesn't support attachments");const{attachmentTypes:s,objectIds:d,globalIds:p,num:c,size:u,start:l,where:b}=e;if(!((I=o==null?void 0:o.operations)!=null&&I.supportsQueryAttachments)&&((s==null?void 0:s.length)>0||(p==null?void 0:p.length)>0||(u==null?void 0:u.length)>0||c||l||b))throw new i(n,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(d!=null&&d.length||p!=null&&p.length||b))throw new i(n,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!a.queryAttachments)throw new i(n,"Layer source does not support queryAttachments capability",e);return a.queryAttachments(e)}async function tt(t,e,r,n){const a=await f(t);if(!a.queryObjectIds)throw new i(n,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(y.from(e)??t.createQuery(),r)}async function et(t,e,r,n){const a=await f(t);if(!a.queryFeatureCount)throw new i(n,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(y.from(e)??t.createQuery(),r)}async function nt(t,e,r,n){const a=await f(t);if(!a.queryExtent)throw new i(n,"Layer source does not support queryExtent capability");return a.queryExtent(y.from(e)??t.createQuery(),r)}async function rt(t,e,r,n){const a=await f(t);if(!a.queryRelatedFeatures)throw new i(n,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(A.from(e),r)}async function at(t,e,r,n){const a=await f(t);if(!a.queryRelatedFeaturesCount)throw new i(n,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(A.from(e),r)}async function ot(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:n}=await e.refresh();if(n!=null&&(t.sourceJSON={...t.sourceJSON,...n},t.read(n,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await E(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function st(t){var s,d;const e=new y,r=(s=t.capabilities)==null?void 0:s.data,n=(d=t.capabilities)==null?void 0:d.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,n&&(e.compactGeometryEnabled=n.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=n.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:a,timeExtent:o}=t;return e.timeExtent=a!=null&&o!=null?o.offset(-a.value,a.unit):o||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function it(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeGlobalID")return n.name}}function ut(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const n of r)if(n.type==="esriFieldTypeOID")return n.name}}function ct(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function lt(t,e){const{subtypes:r,subtypeField:n}=t;if(!(e!=null&&e.attributes)||!(r!=null&&r.length)||!n)return null;const a=e.attributes[n];return a==null?null:r.find(o=>o.code===a)}function dt(t,e){var o,s,d,p,c;const{fieldsIndex:r,subtypeField:n}=t,a=(o=r.get(e))==null?void 0:o.name;if(!a)return null;if((n&&((s=r.get(n))==null?void 0:s.name))===a&&((d=t.subtypes)!=null&&d.length)){const u=t.subtypes.map(l=>new F({code:l.code,name:l.name}));if(u!=null&&u.length)return new x({codedValues:u})}if(("typeIdField"in t?(p=r.get(t.typeIdField))==null?void 0:p.name:null)===a&&"types"in t&&((c=t.types)!=null&&c.length)){const u=t.types.map(l=>new F({code:l.id,name:l.name}));return new x({codedValues:u})}return null}async function f(t){return(await t.load()).source}async function D(t,e){if(!m||m.findCredential(t))return;let r;try{const n=await S(t,e);n&&(r=await m.checkSignInStatus(`${n}/sharing`))}catch{}if(r)try{const n=e!=null?e.signal:null;await m.getCredential(t,{signal:n})}catch{}}async function pt(t,e,r){var a;const n=(a=t.parsedUrl)==null?void 0:a.path;n&&t.authenticationTriggerEvent===e&&await D(n,r)}function ft(t){return!V(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const h=L({types:j});function yt(t,e){var r;if(t.defaultSymbol)return(r=t.types)!=null&&r.length?new M({defaultSymbol:h(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:h(n.symbol,n,e)}))}):new C({symbol:h(t.defaultSymbol,t,e)})}function mt(t){var n,a,o;let e=(n=t.sourceJSON)==null?void 0:n.cacheMaxAge;if(!e)return!1;const r=(o=(a=t.editingInfo)==null?void 0:a.lastEditDate)==null?void 0:o.getTime();return r==null||(e*=1e3,Date.now()-r<e)}async function G(t,e,r){if(e==null)return null;const n=[],{objectIdField:a}=t;if(e.forEach(c=>{let u=null;if("attributes"in c){const{attributes:l}=c;u={globalId:l[r],objectId:l[a]!=null&&l[a]!==-1?l[a]:null}}else u={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};u.globalId!=null&&(u.objectId!=null&&u.objectId!==-1||n.push(u.globalId))}),n.length===0)return null;const o=t.createQuery();o.where=n.map(c=>`${r}='${c}'`).join(" OR "),o.returnGeometry=!1,o.outFields=[a,r],o.cacheHint=!1;const s=await R(T(t,o));if(!s.ok)return null;const d=new Map,p=s.value.features;for(const c of p){const u=c.attributes[r],l=c.attributes[a];u!=null&&l!=null&&l!==-1&&d.set(u,l)}return d}function ht(t,e,r){if(!e||!r||!t)return null;const n=r.getAttribute(e);return n==null?null:t.find(a=>{const{id:o}=a;return o!=null&&o.toString()===n.toString()})??null}function V(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||J(t)}function J(t){var e,r;return!!((r=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&r.toLowerCase().split(",").map(n=>n.trim()).includes("map"))}function wt(t,e,r){const n=e==null?void 0:e.queryBins;if(!n)throw new i(r,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!n.supportsAutoInterval)throw new i(r,"Layer source does not support auto-interval binning");break;case"date":if(!n.supportsDate)throw new i(r,"Layer source does not support date binning");break;case"fixed-boundaries":if(!n.supportsFixedBoundaries)throw new i(r,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!n.supportsFixedInterval)throw new i(r,"Layer source does not support fixed-interval binning")}const a=n==null?void 0:n.supportedStatistics;if(t.outStatistics&&a){const o=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:s}of t.outStatistics){const d=o.get(s);if(d&&!a[d])throw new i(r,`Layer source does not support ${s} statistic type`)}}}export{G as $,tt as A,wt as B,it as C,dt as D,ot as E,K as F,V as H,z as I,yt as J,st as L,ct as M,mt as N,rt as O,at as P,ut as R,nt as S,pt as T,ft as U,lt as V,ht as Z,B as g,H as h,X as j,W as q,T as r,et as v,Z as w,Y as x};
