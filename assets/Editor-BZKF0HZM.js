const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-CLlhYFEF.js","assets/index-C1aGfQcb.js","assets/index-qkyhuh7d.css","assets/elevationInfoUtils-DQT3uSQq.js","assets/ElevationInfo-D7CBP7sd.js","assets/lengthUtils-CFwdZ3dz.js","assets/vec2-D9okOEat.js","assets/geodesicLengthMeasurementUtils-DHp52l__.js","assets/vec2f64-CCfZVA9N.js","assets/vec32-CmwgPQMd.js","assets/projectVectorToVector-Dtcb6Asj.js","assets/projectBuffer-CZ7yaGuo.js","assets/projectPointToVector-ByIVLKML.js","assets/projection-BOBOhWzm.js","assets/Spinner-CEWOvPN4.js","assets/AttachmentInfo-Cg9fIPGU.js","assets/legacyIcon-CEIp6Pa9.js","assets/UpdatingHandles-DOPUoIlu.js","assets/FeatureLayerBase-BNIuOgAL.js","assets/commonProperties-Drl05DKJ.js","assets/HeightModelInfo-kVs8dE0B.js","assets/arcgisLayerUrl-BkZy4Mr3.js","assets/featureLayerUtils-Dy99w2fj.js","assets/Query-LPs1Zyw4.js","assets/FullTextSearch-Cza0yp3f.js","assets/TimeExtent-DGiXUfis.js","assets/timeUtils-X0MXjtQ8.js","assets/jsonUtils-CWFaUb2E.js","assets/UniqueValueRenderer-CAZbf8NT.js","assets/RendererLegendOptions-CULirduz.js","assets/diffUtils-DMLidw0V.js","assets/colorRamps-D4VCsfmX.js","assets/sizeVariableUtils-Cmcuvw-4.js","assets/visualVariableUtils-dx28E4EQ.js","assets/jsonUtils-BWWcP_yB.js","assets/defaults-Dbnhuv3C.js","assets/defaultsJSON-GKolV7NZ.js","assets/styleUtils-CEgUrR2a.js","assets/LRUCache-DbPTy7LA.js","assets/Version-DD-eRUXC.js","assets/FieldsIndex-BrdRr9E_.js","assets/UnknownTimeZone-DhxWDwo9.js","assets/OverrideHelper-D-UVQ00R.js","assets/colorUtils-BWiljOUv.js","assets/vec42-BHDxGccW.js","assets/vec4f64-o2zAXfmz.js","assets/utils-D7agaEG-.js","assets/enums-CmIX1y88.js","assets/quantizationUtils-DbJV_fl5.js","assets/heatmapUtils-D0BPLm9w.js","assets/LayerFloorInfo-DzoJncEV.js","assets/Relationship-CBhq9gYu.js","assets/serviceCapabilitiesUtils-B23--4px.js","assets/arcade-DfpF5wFh.js","assets/TimeOnly-vNYE6bX9.js","assets/ImmutableArray-BPVd6ESQ.js","assets/FeatureLayer-DGRhhm0K.js","assets/MultiOriginJSONSupport-Qqzd52Lf.js","assets/Layer-CneDw8eF.js","assets/workers-CeelWDzo.js","assets/editsZScale-8GE3gysf.js","assets/queryZScale-D-ZT69l7.js","assets/FeatureSet-CeKoTEEO.js","assets/APIKeyMixin-BrvyKlIW.js","assets/ArcGISService-C1oUW8BT.js","assets/BlendLayer-CG9LFMxd.js","assets/jsonUtils-n3e_wlfQ.js","assets/parser-C4Qiz3JH.js","assets/utils-sqJe3zMg.js","assets/CustomParametersMixin-BhjpsNjD.js","assets/EditBusLayer-DCXZWvgn.js","assets/FeatureEffectLayer-gWJrS8gr.js","assets/FeatureEffect-B5YAe6Lk.js","assets/FeatureReductionLayer-DuxcLofN.js","assets/FeatureReductionSelection-tRCh97wj.js","assets/labelingInfo-BV0df7F6.js","assets/labelUtils-C_ZaLudT.js","assets/MD5-C9MwAd2G.js","assets/OperationalLayer-nNeN4Mrb.js","assets/OrderedLayer-B8Gw_A9P.js","assets/OrderByInfo-k2G4k_zV.js","assets/PortalLayer-Bqf_dhsv.js","assets/portalItemUtils-Cy9KvMYK.js","assets/RefreshableLayer-CwxQNwd3.js","assets/ScaleRangeLayer-66YiyNPI.js","assets/TemporalLayer-CR5q7V2k.js","assets/TimeInfo-CY1-cj-U.js","assets/FeatureTemplate-DJBXu3Te.js","assets/FeatureType-JHO2oVJp.js","assets/fieldProperties-CoDAhoou.js","assets/versionUtils-DBm9Te4x.js","assets/styleUtils-CFywnZa6.js","assets/popupUtils-BA1X4qoc.js","assets/AlphaCutoff-UcccL64p.js","assets/interfaces-CL2NbQte.js","assets/symbolUtils-BmmDXP-E.js","assets/utils-C2gvZghy.js","assets/mat2df32-BR-p9z6z.js","assets/webStyleSymbolUtils-kO7zmqzd.js","assets/GraphicsLayer-7fnK8PA0.js","assets/GraphicsCollection-BlUFPpxh.js","assets/screenUtils-CLE_gLy7.js","assets/signal-CRiDvIIF.js","assets/utils-CS8i_70G.js","assets/plane-CM4t6fNH.js","assets/mat3f64-q3fE-ZOt.js","assets/mat4f64-Dk4dwAN8.js","assets/quatf64-aQ5IuZRd.js","assets/sphere-DuEd_sPX.js","assets/mat3-Dg2BrR6m.js","assets/drapedUtils-BnpEPkkO.js","assets/infoFor3D-C0hFfS1m.js","assets/ViewingMode-HRfKv6NR.js","assets/utils-BQBvadb7.js","assets/widget-3rB5q3_K.js","assets/uploadAssetErrors-Cy9k5t87.js","assets/GridSnappingEngine-_a4rjWMQ.js","assets/normalizeUtils-Bg1OALXh.js","assets/normalizeUtilsCommon-UUlRRPVA.js","assets/utils-DGPHbhMN.js","assets/utils-ByvCMLXh.js","assets/scaleUtils-D2VbidBA.js","assets/gridUtils-DnVGRhB5.js","assets/FeatureSnappingEngine-Cp3hja5K.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/Legend-Dm-5dECe.js","assets/featureReductionUtils-Caulfaw_.js","assets/EffectView-Di3KCO94.js","assets/ExportImageParameters-BqqZG4Ti.js","assets/sublayerUtils-C2scBnIk.js","assets/pixelRangeUtils-DR2RxTkt.js","assets/rendererConversion-DHDLdqpP.js","assets/utils--V_Ce2mw.js","assets/themeUtils-C3zvZbsE.js","assets/accessibleHandler-CubitGf2.js","assets/calcite-block-CV5TdCEP.js","assets/conditionalSlot-DyGemPLG.js","assets/Heading-l4oDCerj.js","assets/openCloseComponent-BuFuLtHA.js","assets/floating-ui-R-4Kk1Xn.js","assets/debounce-DUf35w49.js","assets/action-DoqCRstk.js","assets/action-menu-BleOBRYN.js","assets/array-D9rxjK_-.js","assets/popover-DdH8HGky.js","assets/focusTrapComponent-ftxFIElQ.js","assets/FloatingArrow-BWnzcOPl.js","assets/handle-C1swX_HU.js","assets/calcite-button-OwHWnVyW.js","assets/calcite-combobox-DdJJS4cJ.js","assets/combobox-Dfassm8V.js","assets/core-CoDzbbcw.js","assets/filter-Ig933xs6.js","assets/Validation-GlGaxVIF.js","assets/utils2-CMX6KhTm.js","assets/chip-C9cjUhni.js","assets/combobox-item-DuAZwYfM.js","assets/input-message-DUj9fRxn.js","assets/calcite-combobox-item-Crmu17Dx.js","assets/calcite-combobox-item-group-DKcqCP6X.js","assets/combobox-item-group-OG6RouMp.js","assets/calcite-icon-B5wvyzgm.js","assets/calcite-input-C30oMPBL.js","assets/input2-C_Sx2o43.js","assets/input-De-TCHNF.js","assets/progress-BuA_2UWg.js","assets/calcite-input-date-picker-6-XYFwB7.js","assets/input-text-CPWGU601.js","assets/calcite-input-message-C_2xmbqm.js","assets/calcite-input-number-CqPBhxk_.js","assets/input-number-CJ4XkYYB.js","assets/calcite-input-time-picker-B8wBVmEV.js","assets/math-CkFPD3oi.js","assets/calcite-input-time-zone-BMVnFr1B.js","assets/calcite-label-CXLoAlD_.js","assets/calcite-list-DEz7lVXs.js","assets/resources4-BWCcs03d.js","assets/utils3-BtBiup1s.js","assets/calcite-list-item-BLSA8Adn.js","assets/calcite-loader-Ce47wHPj.js","assets/calcite-notice-BhTM-Xuv.js","assets/resources2-CPksjOim.js","assets/calcite-radio-button-SzL8DcRw.js","assets/calcite-radio-button-group-DokW4NJz.js","assets/calcite-switch-DiS6Xp-u.js","assets/calcite-text-area-CqLGaXFq.js","assets/throttle-B9yWORl3.js","assets/symbolLayerUtils-BnaK6dY7.js","assets/Upload-B3aMxJOg.js","assets/progressUtils-wtUH52Ad.js","assets/editingTools-CU2cZK96.js","assets/SnappingVisualizer2D-Bz9mNgwk.js","assets/automaticAreaMeasurementUtils-B8M9AKp8.js","assets/PointSnappingHint-DLpaNTCp.js","assets/SketchTooltipInfo-DuJVRn9_.js","assets/spatialReferenceEllipsoidUtils-BEJMNM9o.js","assets/MeshTransform-CQofocAh.js","assets/quat-D8-cBF-l.js","assets/axisAngleDegrees-C6bqw-Uy.js","assets/meshVertexSpaceUtils-D5F-abOR.js","assets/MeshLocalVertexSpace-sgg6_SW2.js","assets/a11yUtils-Tsw26pQ5.js","assets/memoize-DsJmrG76.js","assets/earcut-Lltz9D9k.js","assets/triangle-CPy2PSEx.js","assets/lineSegment-C6H8qMyL.js","assets/editPlaneUtils-C8xyLzT4.js","assets/hydratedFeatures-ByIq7uy-.js","assets/Scheduler-DS_v5N7L.js","assets/debugFlags-CfZYxH5Q.js","assets/mat2df64-B7VPBnkO.js","assets/helpMessageUtils3d-BZzQ2OvH.js","assets/boundedPlane-C18Ysvcq.js","assets/GraphicManipulator-BMTkDhtD.js","assets/drawUtils-BqwzBuVL.js","assets/ImageMaterial.glsl-BgV2IVLt.js","assets/BindType-BmZEZMMh.js","assets/interfaces-DDtDqZYj.js","assets/Texture-D7jaxJ9P.js","assets/orientedBoundingBox-DCXdMZSx.js","assets/computeTranslationToOriginAndRotation-C2_ZYUki.js","assets/VertexAttribute-Cq4MnHjR.js","assets/Util-BK6CBhAA.js","assets/Texture-CLoEFKJJ.js","assets/enums-Dk3osxpS.js","assets/renderState-QDOxIGNB.js","assets/basicInterfaces-CZwQPxTp.js","assets/NormalAttribute.glsl-DGUKFRgB.js","assets/Indices-NXfq_dEG.js","assets/BufferView-sBvw8vqP.js","assets/requestImageUtils-C-ZsPy5-.js","assets/interfaces-CeZic7cp.js","assets/InterleavedLayout-Bb_2wUZe.js","assets/types-D0PSWh4d.js","assets/triangulationUtils-ss0xSAA3.js","assets/deduplicate-Dq2CF0iu.js","assets/RibbonLine.glsl-CJtVy81W.js","assets/utils-OIoyRVPd.js","assets/IntersectorInterfaces-BgX4KEwK.js","assets/vec3f32-nZdmKIgz.js","assets/doublePrecisionUtils-B0owpBza.js","assets/Octree-_-EHFyX0.js","assets/floatRGBA-BxT4aGRY.js","assets/HUDMaterial.glsl-l3I2wjlc.js","assets/VertexArrayObject-CzGu5bI8.js","assets/NestedMap-GuqgquCN.js","assets/glUtil-CFv2RXTA.js","assets/VertexElementDescriptor-BOD-G50G.js","assets/HighlightDefaults-D7TbvM-a.js","assets/BufferObject-C4qiEJeh.js","assets/TextOverlayItem-DKvrqEks.js","assets/SelectedVertexTooltipInfo-ePpFunqV.js","assets/TranslateTooltipInfo-CA9YaD4t.js","assets/IViewEvents-Bci6PjlS.js","assets/persistable-yoZGtoc7.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-D0H_LB-z.js","assets/ExtentScaleTooltipInfo-CzwmCuLw.js","assets/LineCallout.glsl-BwvEWs7Q.js","assets/heightModelInfoUtils-BhzRw8-2.js","assets/dehydratedFeatures-ZAXIPmEt.js","assets/basemapUtils-SfV6Ch_Z.js","assets/RealisticTree.glsl-ewHJogxm.js","assets/DefaultMaterial-DLGx92FQ.js","assets/symbolColorUtils-BlCDN8di.js","assets/edgeUtils-COULqf4e.js","assets/OptimizedFeature-swgcyHeh.js","assets/OptimizedGeometry-C9mSZhHi.js","assets/optimizedFeatureQueryEngineAdapter-DrXZKbZy.js","assets/centroid-DdLmOD72.js","assets/vec2f32-BbH2jxlN.js","assets/featureConversionUtils-C-Uqf9Q4.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/PooledRBush-D_zSRdWq.js","assets/quickselect-QQC62dOK.js","assets/popupUtils-3iX6uIxV.js","assets/highlightUtils-Ch3EC-YF.js","assets/languageUtils-DfhLIq1n.js","assets/shared-Czb1Shm3.js","assets/number-ByPuf2wa.js","assets/geometryServiceUtils-Bhz4sZCe.js","assets/project-BFnjSY2q.js","assets/LayerView-ClcY0vUI.js","assets/GraphicMover-BXAg2mBy.js","assets/Box-DjZBm2t7.js","assets/settings-CUbKJ-2d.js","assets/Reshape-DJof3RzQ.js","assets/calcite-scrim-j94-IGph.js","assets/calcite-tooltip-CQlqWX4W.js","assets/calcite-checkbox-Cn1O7aj9.js","assets/GridControls-_XlWP9J0.js","assets/calcite-accordion-DrLEyXdV.js","assets/calcite-accordion-item-BlbU6_We.js","assets/calcite-flow-item-DP0tjgKQ.js","assets/panel-BfKqYCK-.js","assets/calcite-flow-DPwGtHi7.js"])))=>i.map(i=>d[i]);
import{d4 as tr,b8 as ir,d2 as nr,aO as U,b_ as dn,dd as Gl,c1 as Nl,dT as Hl,cV as Kn,F as r,G as l,K as C,bU as Yn,ay as sr,bH as xn,c9 as j,cN as zs,gh as Ft,cr as S,cz as Ul,bR as tn,cW as zt,cw as Fe,cP as Wl,hb as jl,d9 as Bl,Q as Yi,iz as nn,mn as Ea,hB as zl,l9 as ql,L as O,cv as Zl,i6 as Kl,M as k,gw as it,br as Q,aA as le,cQ as Yl,go as Jl,gA as Ql,di as At,dC as pn,c5 as sn,aE as E,aF as at,hn as ar,lJ as or,ei as ka,fs as Fi,P as K,aD as Se,fu as f,lK as Xl,lL as ed,gQ as _n,J as td,f0 as id,fx as nd,aR as Oi,mo as qs,dF as sd,bz as ad,fh as cn,b4 as Ca,aG as Qa,cf as un,mp as rr,gc as Ia,mq as Ji,mr as od,c8 as Ne,ms as rd,mt as Zs,c$ as Jn,lC as lr,cb as dr,mu as ld,mv as Xa,mw as eo,kg as dd,mx as pd,my as cd,mz as ud,b6 as Ai,ej as hd,iX as Qn,mA as yd,mB as ki,mC as md,bE as to,bF as gd,az as fd,O as ue,mD as Ks,kd as io,mE as no,kf as vd,mF as _d,kc as wd,bT as pr,mG as cr,mH as so,mI as bd,fr as Ue,k4 as Ma,ft as ze,mJ as Ed,fv as di,mK as ur,jY as an,jZ as Qi,mL as kd,mM as $s,im as Wt,mN as Cd,mO as Id,mP as Md,mQ as ao,mR as wn,mS as bn,mT as En,mU as oo,mV as Td,mW as $d,mX as Sd,io as hr,mY as ro,mZ as Fd,m_ as Od,m$ as Ad,gj as ni,c7 as si,ji as on,n0 as ai,ke as Ld,ba as xd,fk as rn,kQ as Vd,n1 as Rd,bj as yr,bo as Ss,fC as Pd,gg as Dd,bN as lo,bP as Gd,bO as Nd,g_ as Hd,g$ as Ud,cg as Ys,n2 as Wd,hp as jd,n3 as rt,eI as po,hE as kn,cc as Vn,d0 as co,k3 as mr,n4 as uo,fj as Bd,n5 as ho,gu as zd,n6 as qd,cd as Zd,c_ as Kd,d3 as Yd,n7 as Jd,gp as Js,gx as Qd,aJ as Xd,jm as ep,n8 as tp,la as us,n9 as ip,cj as np}from"./index-C1aGfQcb.js";import{e as be,u as sp,q as gr,d as vt,j as Li,p as pi,l as ap,B as op,_ as rp,o as fr,b as vr,E as yo,L as lp,m as dp}from"./vec2-D9okOEat.js";import{n as We,r as Rn,a as pp,_ as cp}from"./vec2f64-CCfZVA9N.js";import{H as B,p as _r,R as $e,P as Ie,q as he,o as _t,s as hs,c as ys,_ as Xn,Z as Qs,v as Xs,j as up,A as hp,J as yp,u as mp,I as gp}from"./vec32-CmwgPQMd.js";import{e as hn,a as wr,n as es}from"./projectVectorToVector-Dtcb6Asj.js";import{i as we,d as fp,t as vp}from"./projectBuffer-CZ7yaGuo.js";import{F as _p,s as mo,y as wp,p as bp,I as Ep,h as kp}from"./Spinner-CEWOvPN4.js";import{h as xi}from"./UpdatingHandles-DOPUoIlu.js";import{n as go,V as Cp}from"./FeatureLayerBase-BNIuOgAL.js";import{d as Fs}from"./arcgisLayerUrl-BkZy4Mr3.js";import{createArcadeProfile as Ip,createArcadeExecutor as Mp}from"./arcade-DfpF5wFh.js";import{V as Tp,f as ea}from"./symbolUtils-BmmDXP-E.js";import{h as ms}from"./GraphicsLayer-7fnK8PA0.js";import{K as ta,N as $p,J as Sp,_ as Fp,W as Op}from"./projection-BOBOhWzm.js";import{m as Ap,j as Mi,x as br,E as Lp,v as Ta,l as xp,f as Vp}from"./elevationInfoUtils-DQT3uSQq.js";import{g as Rp}from"./timeUtils-X0MXjtQ8.js";import{b as Pp}from"./Query-LPs1Zyw4.js";import{a as Dp,_ as q,n as fo}from"./screenUtils-CLE_gLy7.js";import{r as Gp}from"./utils-CS8i_70G.js";import{s as Np,j as Hp}from"./vec42-BHDxGccW.js";import{n as Up}from"./vec4f64-o2zAXfmz.js";import{M as je,z as Wp,l as gs,Q as ia,d as Er,k as kr,V as jp,H as Cr,O as Ir,p as Bp}from"./plane-CM4t6fNH.js";import{I as zp,O as qp,_ as Zp,$ as Kp,U as Yp}from"./sphere-DuEd_sPX.js";import{d as Jp}from"./diffUtils-DMLidw0V.js";import{o as Qp,r as Xp}from"./drapedUtils-BnpEPkkO.js";import{m as ec}from"./lengthUtils-CFwdZ3dz.js";import{a as tc,i as ic}from"./sizeVariableUtils-Cmcuvw-4.js";import{getRotationAngle as nc,getSize as sc}from"./visualVariableUtils-dx28E4EQ.js";import{u as ac}from"./jsonUtils-BWWcP_yB.js";import{s as vo}from"./workers-CeelWDzo.js";import{a as oc}from"./infoFor3D-C0hFfS1m.js";import{l as rc}from"./ViewingMode-HRfKv6NR.js";import{e as _o}from"./utils-BQBvadb7.js";import{e as wo}from"./widget-3rB5q3_K.js";import{l as lc,m as dc,i as pc}from"./uploadAssetErrors-Cy9k5t87.js";async function cc(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const n=i.results[0],s=(n.distance??0)*(1+uc),a=i.results.findIndex(o=>(o.distance??0)>s);return a!==-1&&(i.results=i.results.slice(0,a)),n&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const uc=.05;function Mr(t){return(t==null?void 0:t.type)==="graphic"}function hc(t){return t.find(Mr)??null}function Tr(t){return t.filter(Mr)}function $r(t){if(!t)return null;const e=t.wkid;if(e)return fp[e];const i=t.wkt2??t.wkt;return i?yc(i):null}function yc(t){const e=vp.exec(t);if(!e||e.length!==2)return null;const i=e[1].split(",");if(!i||i.length<3)return null;const n=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(n)||isNaN(s)?null:{a:n,f:s===0?0:1/s}}function fs(t){const e=$r(t);if(mc(e))return e;const i=e.a*(1-e.f);return Object.assign(e,{b:i,eSq:1-(i/e.a)**2,radius:(2*e.a+i)/3,densificationRatio:1e4/((2*e.a+i)/3)})}function mc(t){return t!=null&&"b"in t&&"eSq"in t&&"radius"in t}function Cn(t,e,i){const{a:n,eSq:s}=fs(i),a=Math.sqrt(s),o=Math.sin(e[1]*we),d=n*e[0]*we;let p;return s>0?p=n*((1-s)*(o/(1-s*(o*o))-1/(2*a)*Math.log((1-a*o)/(1+a*o))))*.5:p=n*o,t[0]=d,t[1]=p,t}function vs(t){return nr(t)&&!!$r(t)}function Bm(t,e="square-meters"){if(t.some(o=>!vs(o.spatialReference)))throw new U("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let o=0;o<t.length;o++){const d=t[o],p=d.spatialReference,{radius:c,densificationRatio:h}=fs(p),u=c*h;i.push(gc(d,u))}const n=[],s=[0,0],a=[0,0];for(let o=0;o<i.length;o++){const{rings:d,spatialReference:p}=i[o];let c=0;for(let h=0;h<d.length;h++){const u=d[h];Cn(s,u[0],p),Cn(a,u[u.length-1],p);let y=a[0]*s[1]-s[0]*a[1];for(let g=0;g<u.length-1;g++)Cn(s,u[g+1],p),Cn(a,u[g],p),y+=a[0]*s[1]-s[0]*a[1];c+=y}c=dn(c,"square-meters",e),n.push(c/-2)}return n}function zm(t,e="meters"){if(!t)throw new U("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some(n=>!vs(n.spatialReference)))throw new U("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let n=0;n<t.length;n++){const s=t[n],{spatialReference:a}=s,o=s.type==="polyline"?s.paths:s.rings;let d=0;for(let p=0;p<o.length;p++){const c=o[p];let h=0;for(let u=1;u<c.length;u++){const y=c[u-1][0],g=c[u][0],m=c[u-1][1],v=c[u][1];if(m!==v||y!==g){const _=new yn;mn(_,[y,m],[g,v],a),h+=_.distance}}d+=h}d=dn(d,"meters",e),i.push(d)}return i}function gc(t,e){if(t.type!=="polyline"&&t.type!=="polygon")throw new U("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=t;if(!vs(i))throw new U("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const n=t.type==="polyline"?t.paths:t.rings,s=[],a=[0,0],o=new yn;for(const p of n){const c=[];s.push(c),c.push([p[0][0],p[0][1]]);let h,u,y=p[0][0],g=p[0][1];for(let m=0;m<p.length-1;m++){if(h=p[m+1][0],u=p[m+1][1],y===h&&g===u)continue;const v=[y,g];mn(o,[y,g],[h,u],i);const{azimuth:_,distance:w}=o,b=w/e;if(b>1){for(let M=1;M<=b-1;M++)oi(a,v,_,M*e,i),c.push(a.slice());oi(a,v,_,(w+Math.floor(b-1)*e)/2,i),c.push(a.slice())}oi(a,v,_,w,i),c.push(a.slice()),y=a[0],g=a[1]}}const d=Gl(ir,i);return t.type==="polyline"?new Nl({paths:s,spatialReference:d}):new Hl({rings:s,spatialReference:d})}let yn=class{constructor(e=0,i=void 0,n=void 0){this.distance=e,this.azimuth=i,this.reverseAzimuth=n}};function oi(t,e,i,n,s){const a=e[0],o=e[1],d=a*we,p=o*we,c=(i??0)*we,{a:h,b:u,f:y}=fs(s),g=Math.sin(c),m=Math.cos(c),v=(1-y)*Math.tan(p),_=1/Math.sqrt(1+v*v),w=v*_,b=Math.atan2(v,m),M=_*g,I=M*M,F=1-I,R=F*(h*h-u*u)/(u*u),Y=1+R/16384*(4096+R*(R*(320-175*R)-768)),me=R/1024*(256+R*(R*(74-47*R)-128));let te,Ze,ge,Kt,ot=n/(u*Y),Le=2*Math.PI;for(;Math.abs(ot-Le)>1e-12;)ge=Math.cos(2*b+ot),te=Math.sin(ot),Ze=Math.cos(ot),Kt=me*te*(ge+me/4*(Ze*(2*ge*ge-1)-me/6*ge*(4*te*te-3)*(4*ge*ge-3))),Le=ot,ot=n/(u*Y)+Kt;const Ke=w*te-_*Ze*m,Pi=Math.atan2(w*Ze+_*te*m,(1-y)*Math.sqrt(I+Ke*Ke)),Is=Math.atan2(te*g,_*Ze-w*te*m),Di=y/16*F*(4+y*(4-3*F)),Ms=Pi/we,Ts=(d+(Is-(1-Di)*y*M*(ot+Di*te*(ge+Di*Ze*(2*ge*ge-1)))))/we;return t[0]=Ts,t[1]=Ms,t}function mn(t,e,i,n){const s=e[0]*we,a=e[1]*we,o=i[0]*we,d=i[1]*we,{a:p,b:c,f:h,radius:u}=fs(n),y=o-s,g=Math.atan((1-h)*Math.tan(a)),m=Math.atan((1-h)*Math.tan(d)),v=Math.sin(g),_=Math.cos(g),w=Math.sin(m),b=Math.cos(m);let M,I,F,R,Y,me,te,Ze,ge,Kt,ot=1e3,Le=y;do{if(te=Math.sin(Le),Ze=Math.cos(Le),F=Math.sqrt(b*te*(b*te)+(_*w-v*b*Ze)*(_*w-v*b*Ze)),F===0)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;Y=v*w+_*b*Ze,me=Math.atan2(F,Y),ge=_*b*te/F,I=1-ge*ge,R=Y-2*v*w/I,isNaN(R)&&(R=0),Kt=h/16*I*(4+h*(4-3*I)),M=Le,Le=y+(1-Kt)*h*ge*(me+Kt*F*(R+Kt*Y*(2*R*R-1)))}while(Math.abs(Le-M)>1e-12&&--ot>0);if(ot===0){const Ts=u,Vl=Math.acos(Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos(o-s))*Ts,Ja=o-s,Rl=Math.sin(Ja)*Math.cos(d),Pl=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(Ja),Dl=Math.atan2(Rl,Pl);return t.azimuth=Dl/we,t.distance=Vl,t.reverseAzimuth=void 0,t}const Ke=I*(p*p-c*c)/(c*c),Pi=Ke/1024*(256+Ke*(Ke*(74-47*Ke)-128)),Is=c*(1+Ke/16384*(4096+Ke*(Ke*(320-175*Ke)-768)))*(me-Pi*F*(R+Pi/4*(Y*(2*R*R-1)-Pi/6*R*(4*F*F-3)*(4*R*R-3)))),Di=Math.atan2(b*Math.sin(Le),_*w-v*b*Math.cos(Le)),Ms=Math.atan2(_*Math.sin(Le),_*w*Math.cos(Le)-v*b);return t.azimuth=Di/we,t.distance=Is,t.reverseAzimuth=Ms/we,t}function na(t){return vs(t)?t:tr(t)?ir.WGS84:null}var ci;function Sr(t,e,i){return Ae(t,e,i)}function Ae(t=0,e=0,i=0){return Kn(t,e,i)}function Zm(t){return t}function Km(t){return t}function qt(t,e,i){return Kn(t,e,i)}function Ti(t){const[e,i,n]=t;return t.length>3?[e,i,n,t[3]]:[e,i,n]}function Os(t){return t[3]=((t.length>3?t[3]:void 0)??ci.NONE)|ci.TARGET,t}function Ym(t){return!!(((t.length>3?t[3]:void 0)??ci.NONE)&ci.TARGET)}function bo(t,e,{coordinateHelper:i,elevationInfo:n},s){return t?zi(i.vectorToDehydratedPoint(t,fc),e,n,s):null}function zi(t,e,i,n=Ae()){return n[0]=t.x,n[1]=t.y,n[2]=t.z??0,e==null||(e.type==="2d"?n[2]=0:n[2]=Ap(e,t,i,Mi)??0),n}function Jm(t,e,i){return i?(wr(i,t[0],t[1],t[2],e),i):hn(t[0],t[1],t[2],e)}function Eo(t,e,{z:i,m:n},s,a){const{spatialReference:o,elevationInfo:d}=s;let p;i==null&&n==null?p=void 0:e==null||e.type==="2d"?p=i??void 0:p=br(e,t,o,Mi,d)??0;const[c,h]=t;return a?wr(a,c,h,p,o):a=hn(c,h,p,o),n!=null&&(a.m=n,a.hasM=!0),a}function Qm(t,e,i,n,s=Ae()){const[a,o]=t;return s[0]=a,s[1]=o,t.length>3&&(s[3]=t[3]??ci.NONE),(i==null?void 0:i.type)!=="3d"?(s[2]=e.value,s):(s[2]=Lp(i,a,o,e.value,n,e.elevationInfo,Mi)??0,s)}(function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"})(ci||(ci={}));const fc=hn(0,0,0,null);let nt=class extends sr{constructor(){super(...arguments),this.enabled=!0}};r([l({type:Boolean})],nt.prototype,"enabled",void 0),nt=r([C("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],nt);let N=class extends sr{constructor(e){super(e),this.lineSnapper=new nt,this.parallelLineSnapper=new nt,this.rightAngleSnapper=new nt,this.rightAngleTriangleSnapper=new nt,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Yn([255,127,0]),this.orangeTransparent=new Yn([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};r([l({type:nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],N.prototype,"lineSnapper",void 0),r([l({type:nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],N.prototype,"parallelLineSnapper",void 0),r([l({type:nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],N.prototype,"rightAngleSnapper",void 0),r([l({type:nt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],N.prototype,"rightAngleTriangleSnapper",void 0),r([l({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],N.prototype,"shortLineThreshold",void 0),r([l({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],N.prototype,"distance",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],N.prototype,"pointThreshold",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],N.prototype,"intersectionParallelLineThreshold",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],N.prototype,"parallelLineThreshold",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],N.prototype,"verticalLineThresholdMeters",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],N.prototype,"touchSensitivityMultiplier",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],N.prototype,"pointOnLineThreshold",void 0),r([l({type:Yn,nonNullable:!0})],N.prototype,"orange",void 0),r([l({type:Yn,nonNullable:!0})],N.prototype,"orangeTransparent",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],N.prototype,"lineHintWidthReference",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],N.prototype,"lineHintWidthTarget",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],N.prototype,"lineHintFadedExtensions",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],N.prototype,"parallelLineHintWidth",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],N.prototype,"parallelLineHintLength",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],N.prototype,"parallelLineHintOffset",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],N.prototype,"rightAngleHintSize",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],N.prototype,"rightAngleHintOutlineSize",void 0),r([l({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],N.prototype,"satisfiesConstraintScreenThreshold",void 0),N=r([C("esri.views.interactive.snapping.Settings.Defaults")],N);const ts=new N;var ye;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(ye||(ye={}));let _s=class{constructor(e,i){this.isDraped=e,this.domain=i}},vc=class Fr extends _s{constructor(e,i,n=ye.ALL){super(i,n),this.intersectionPoint=e}equals(e){return e instanceof Fr&&B(this.intersectionPoint,e.intersectionPoint)}},wt=class Or extends _s{constructor(e,i,n,s,a=ye.ALL,o=!0,d=!0){super(s,a),this.type=e,this.lineStart=i,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=d}equals(e){return e instanceof Or&&this.type===e.type&&B(this.lineStart,e.lineStart)&&B(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return _r(this.lineStart,this.lineEnd)}},_c=class Ar extends _s{constructor(e,i,n,s=ye.ALL){super(n,s),this.lineStart=e,this.lineEnd=i}equals(e){return e instanceof Ar&&B(this.lineStart,e.lineStart)&&B(this.lineEnd,e.lineEnd)}},Lr=class xr extends _s{constructor(e,i,n,s,a=ye.ALL){super(s,a),this.previousVertex=e,this.centerVertex=i,this.nextVertex=n}equals(e){return e instanceof xr&&B(this.previousVertex,e.previousVertex)&&B(this.centerVertex,e.centerVertex)&&B(this.nextVertex,e.nextVertex)}};function As(t,e){return t[0]*e[1]-t[1]*e[0]}function wc(t,e,i){const n=Li(i,e)/pi(i);return ap(t,i,n)}function ig(t,e,i,n,s=i){return be(ri,n,i),be(is,e,s),wc($i,is,ri),sp(t,s,$i)}function ng(t,e,i,n){be(ri,e,i);const s=n/gr(ri);return vt(t,i,ri,s)}function sg(t,e){const i=t.start,n=t.end,s=e.start,a=e.end,o=be(ri,n,i),d=be(Vr,a,s),p=As(o,d);if(Math.abs(p)<=Ec)return[];const c=be(is,i,s),h=As(d,c)/p,u=As(o,c)/p;if(h>=0){if(u>=0||e.type===z.LINE)return[vt($i,i,o,h)]}else if(t.type===z.LINE&&(u>=0||e.type===z.LINE))return[vt($i,i,o,h)];return[]}function bc(t,e,i){const n=[],s=be(ri,t.end,t.start),a=be(Vr,t.start,e),o=pi(s),d=2*Li(s,a),p=d*d-4*o*(pi(a)-i*i);if(p===0){const c=-d/(2*o);(t.type===z.LINE||c>=0)&&n.push(vt($i,t.start,s,c))}else if(p>0){const c=Math.sqrt(p),h=(-d+c)/(2*o);(t.type===z.LINE||h>=0)&&n.push(vt($i,t.start,s,h));const u=(-d-c)/(2*o);(t.type===z.LINE||u>=0)&&n.push(vt(is,t.start,s,u))}return n}var z;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(z||(z={}));const Ec=1e-6,ri=We(),Vr=We(),is=We(),$i=We(),Rr="z",Pr="r",Z={redo:Pr,undo:Rr,center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},ko={toggle:"Control"},ag={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},og={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:Dp,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:Rr,redo:Pr};let rg=class{constructor(){this._bindings=new Map}add(e,i){return this.addToggle(e,n=>{n.type==="key-down"&&i(n)})}addToggle(e,i){const n=kc.fromDefinition(e,i),s=xn(this._bindings,n.key,()=>[]);return s.push(n),j(()=>zs(s,n))}register(e,i=q.WIDGET){return Ft([e.on("key-down",n=>this.dispatch(e.inputManager,n),i),e.on("key-up",n=>this.dispatch(e.inputManager,n),i)])}dispatch(e,i){const n=i.key,s=this._bindings.get(n);if(s)for(const a of s)a.process(e,i)}},kc=class sa{constructor(e,i,n,s,a){this.key=e,this.modifiers=i,this.repeats=n,this.continuePropagation=s,this.callback=a}process(e,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const n of this.modifiers)if(!e.isModifierKeyDown(n))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(e,i){if(typeof e=="string")return new sa(e,[],!1,!1,i);const{key:n,modifier:s,repeats:a,continuePropagation:o}=e;return new sa(n,s?Array.isArray(s)?s:[s]:[],!!a,!!o,i)}};function $a({start:t,end:e,type:i},n,s){const a=[],o=be(gn,e,t),d=be(ws,t,n),p=pi(o),c=2*Li(o,d),h=c*c-4*p*(pi(d)-s*s);if(h===0){const u=-c/(2*p);(i===Oe.PLANE||u>=0)&&a.push(vt(We(),t,o,u))}else if(h>0){const u=Math.sqrt(h),y=(-c+u)/(2*p);(i===Oe.PLANE||y>=0)&&a.push(vt(We(),t,o,y));const g=(-c-u)/(2*p);(i===Oe.PLANE||g>=0)&&a.push(vt(We(),t,o,g))}return a}function Dr(t,e){const i=t.start,n=t.end,s=be(gn,n,i),a=_t(Es,-s[1],s[0],0),o=e.start,d=e.end,p=$e(Fa,d,o),c=Ie(p,a),h=_t(zr,i[0],i[1],0),u=$e(qr,h,o),y=Ie(u,a),g=tn();if(Math.abs(c)<g)return[];const m=he(Zr,o,p,y/c);if(e.type===z.RAY){const v=$e(aa,m,o);if(Ie(v,p)<-g)return[]}if(t.type===Oe.HALF_PLANE){const v=op(ws,m,i);if(Li(v,s)<-g)return[]}return[zt(m)]}function Cc(t,e){return Mc(ns(Oa,e[2],t),e)}function Gr(t,e){return jr(ns(Oa,0,t),ns(Fc,0,e)).map(([n,s])=>Rn(n,s))}function Nr(t,e,i){return Ur(t,ns(Oa,t[2],e),i)}function Hr(t,e,i,n=S()){const s=be(gn,t,e),a=gr(s);return vt(n,e,s,a===0?1:i/a),n[2]=t[2],n}function Ur(t,{start:e,end:i,type:n},s=S()){const a=$e(bs,t,e),o=$e(Es,i,e),d=Ie(a,o)/Ie(o,o);return he(s,e,o,n===z.RAY?Math.max(d,0):d)}const Ic=(()=>{const t=S(),e=S(),i=S();return({start:n,end:s},{center:a,radius:o,normal:d,slicePlane:p})=>{const c=gs(a,d,Sc);if(G(ia(c,n),0)&&G(ia(c,s),0)){Er(d,t,e);const u=(m,v)=>(ys(i,v,a),fr(m,Ie(i,t),Ie(i,e)),m),y=bc({start:u(gn,n),end:u(ws,s),type:z.LINE},pp,o),g=[];for(const[m,v]of y){const _=hs(S(),a);he(_,_,t,m),he(_,_,e,v),p&&!Bt(p,_)||g.push(_)}return g}const h=S();return kr(c,n,s,h)?!G(_r(h,a),o)||p&&!Bt(p,h)?[]:[h]:[]}})();function Wr({start:t,end:e,type:i},n,s){const a=[],o=ys(bs,e,t),d=be(ws,t,n),p=pi(o),c=2*Li(o,d),h=c*c-4*p*(pi(d)-s*s);if(h===0){const u=-c/(2*p);(i===z.LINE||u>=0)&&a.push(he(S(),t,o,u))}else if(h>0){const u=Math.sqrt(h),y=(-c+u)/(2*p);(i===z.LINE||y>=0)&&a.push(he(S(),t,o,y));const g=(-c-u)/(2*p);(i===z.LINE||g>=0)&&a.push(he(S(),t,o,g))}return a}function jr(t,e){const i=t.start,n=t.end,s=e.start,a=e.end,o=$e(bs,n,i),d=$e(Es,a,s),p=$e(Fa,s,i),c=Xn(zr,o,d);if(!G(Ie(p,c),0))return[];const h=Qs(c);if(G(h,0))return[];const u=Xn(qr,p,d),y=Ie(u,c)/h,g=he(Zr,i,o,y);if(t.type===z.RAY){const m=$e(aa,g,i);if(Ie(o,m)<-tn())return[]}if(e.type===z.RAY){const m=$e(aa,g,s);if(Ie(d,m)<-tn())return[]}return[zt(g)]}function Mc({start:t,end:e,type:i},n){const s=$e(bs,n,t),a=$e(Es,e,t),o=Xn(Fa,a,s),d=Qs(o)/Qs(a),p=tn();if(d<p)switch(i){case z.LINE:return[zt(n)];case z.RAY:return Ie(a,s)<-p?[]:[zt(n)]}return[]}function Sa(t,e,i,n){const[s,a]=t,[o,d]=i,p=o-s,c=d-a,h=p*p+c*c,u=Math.sqrt(h);if(u>e+n)return[];if(u<Math.abs(e-n))return[];if(G(u,0)&&G(e,n))return[];const y=(e*e-n*n+h)/(2*u),g=Math.sqrt(e*e-y*y),m=g*c/u,v=g*p/u,[_,w]=rp(gn,t,i,y/u);return G(m,v)?[Rn(_,w)]:[Rn(_+m,w-v),Rn(_-m,w+v)]}function ns(t,e,{start:i,end:n,type:s}){return _t(t.start,i[0],i[1],e),_t(t.end,n[0],n[1],e),t.type=$c[s],t}function Br(t,e){return G(t[2],e[2])}function G(t,e){return Ul(Math.abs(t-e),0,tn())}function Tc(t,e){return e.filter(i=>Bt(t,i))}function Bt(t,e){return Wp(t,e)}var Oe;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(Oe||(Oe={}));const $c={[Oe.PLANE]:z.LINE,[Oe.HALF_PLANE]:z.RAY},gn=We(),ws=We(),bs=S(),Es=S(),Fa=S(),zr=S(),qr=S(),Zr=S(),aa=S(),Sc=je(),Oa={start:S(),end:S(),type:z.LINE},Fc={start:S(),end:S(),type:z.LINE};class qe{intersect(e){return bt(this,e)}closestPoints(e){return[this.closestTo(e)]}}class Vi extends qe{constructor(e){super(),this.point=e}equals(e){return this===e||tt(e)&&B(this.point,e.point)}closestTo(){return Ti(this.point)}}class Aa extends qe{constructor(e,i,n){super(),this.start=e,this.end=i,this.lineLike={start:e,end:i,type:n}}equals(e){return this===e||ht(e)&&this.lineLike.type===e.lineLike.type&&B(this.start,e.start)&&B(this.end,e.end)}closestTo(e){const i=Ae();return Ur(e,this.lineLike,i),i}}class La extends Aa{constructor(e,i){super(e,i,z.LINE)}}class Oc extends Aa{constructor(e,i){super(e,i,z.RAY)}}class Kr extends qe{constructor(e){super(),this.constraints=e}equals(e){return this===e||oa(e)&&Wl(this.constraints,e.constraints,(i,n)=>i.equals(n))}closestTo(e){let i,n=1/0;for(const s of this.constraints){const a=s.closestTo(e),o=Xs(e,a);o<n&&(n=o,i=a)}return Ti(i??e)}closestPoints(e){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(e))}}class Yr extends qe{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||mt(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const i=Ae();return Hr(e,this.center,this.radius,i),i}}class xa extends qe{constructor(e,i){super(),this.center=e,this.radius=i}equals(e){return this===e||kt(e)&&B(this.center,e.center)&&this.radius===e.radius}closestTo(e){const i=Ae();return Hr(e,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new Va(Ti(this.center),this.radius,qt(0,0,1))}}class Va extends qe{constructor(e,i,n,s=void 0){super(),this.center=e,this.radius=i,this.normal=n,this.slicePlane=s}equals(e){return this===e||Vt(e)&&B(this.center,e.center)&&B(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:i,radius:n}=this;Cr(this.getPlane(Ac),e,Ls);const s=$e(Ls,Ls,i),a=up(s);if(G(a,0))return Ti(e);const o=n/Math.sqrt(a),d=Ae();he(d,i,s,o);const{slicePlane:p}=this;if(p&&!Bt(p,d)){const c=Pa(p,this);return(c==null?void 0:c.closestTo(e))??Ti(e)}return d}getPlane(e=je()){return gs(this.center,this.normal,e)}}const Ls=S(),Ac=je();class Lc extends qe{constructor(e){super(),this.z=e}equals(e){return this===e||Et(e)&&this.z===e.z}closestTo(e){return qt(e[0],e[1],this.z)}getPlane(e=je()){return _t(Co,0,0,this.z),gs(Co,Bl,e)}}const Co=S();class Ra extends qe{constructor(e,i,n){super(),this.start=e,this.end=i,this.planeLike={start:e,end:i,type:n}}equals(e){return this===e||yt(e)&&this.planeLike.type===e.planeLike.type&&B(this.start,e.start)&&B(this.end,e.end)}closestTo(e){const i=Ae();return Nr(e,this.planeLike,i),i}closestEndTo(e){const{start:i,end:n}=this.planeLike;return Math.sign(Li(be(xc,n,i),be(Vc,e,i)))>0?this.end:this.start}getPlane(e=je()){const i=hs(Io,this.end);return i[2]+=1,Bp(this.start,this.end,i,e)}getSlicePlane(e=je()){const{start:i,end:n,type:s}=this.planeLike;if(s===Oe.PLANE)return;const a=_t(Io,i[0],i[1],0),o=_t(Mo,n[0],n[1],0),d=ys(Mo,o,a);return gs(a,d,e),e}}const xc=We(),Vc=We(),Io=S(),Mo=S();class dg extends Ra{constructor(e,i){super(e,i,Oe.HALF_PLANE)}}class Jr extends Ra{constructor(e,i){super(e,i,Oe.PLANE)}}class Rc extends qe{constructor(e,i){super(),this.sphere=qp(e,i)}equals(e){return this===e||Ct(e)&&Zp(this.sphere,e.sphere)}closestTo(e){const i=Ae();return Kp(this.sphere,e,i),i}get center(){return Yp(this.sphere)}get radius(){return this.sphere[3]}}class Qr extends qe{constructor(e,i,n){super(),this.start=e,this.end=i,this.getZ=n,this.planeLike={start:e,end:i,type:Oe.PLANE}}equals(e){return this===e||ss(e)&&B(this.start,e.start)&&B(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return Uc(this,e)}addIfOnTheGround(e,i){for(const n of i){const s=this.getZ(n[0],n[1])??0;G(n[2],s)&&(n[2]=s,e.push(n))}}}class Pc extends qe{constructor(e,i,n){super(),this._x=e,this._y=i,this._z=n}equals(e){return this===e||su(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,i,n]){return Sr(this._x??e,this._y??i,this._z??n)}}class Dc extends qe{constructor(e,i,n,s,a){super(),this._origin=e,this._spatialReference=i,this._distanceMeters=n,this._z=s,this._directionDegrees=a}equals(e){return this===e||nu(e)&&yo(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,i,n]){return fr(Gi,e,i),yo(Gi,this._origin)||this._applyDirectionAndDistance(Gi),Sr(Gi[0],Gi[1],this._z??n)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)oi(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Nc(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=mn(Gc,this._origin,e,this._spatialReference);oi(e,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Gi=[0,0],Gc=new yn;function Nc(t,e,i,n,s){let{azimuth:a,distance:o}=mn(Hc,e,n,s);a??(a=0);let d=o*Math.cos((a-i)*we);d=Math.max(0,d),oi(t,e,i,d,s)}const Hc=new yn;function Uc(t,e){const i=Ae();return Nr(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??el,i}function bt(t,e){if(oa(t)){const i=[];for(const n of t.constraints){const s=n.intersect(e);s&&i.push(s)}return Da(i)}if(oa(e))return bt(e,t);if(ss(t))return To(t,e);if(ss(e))return To(e,t);if(tt(t)){const{point:i}=t;if(tt(e))return B(i,e.point)?t:void 0;const n=e.closestTo(i);return yp(n,i)?t:void 0}if(ht(t)){if(tt(e))return bt(e,t);if(ht(e))return st(jr(t.lineLike,e.lineLike));if(Et(e))return Wc(t,e);if(yt(e))return st(Dr(e.planeLike,t.lineLike));if(mt(e))return st(Wr(t.lineLike,e.center,e.radius));if(Vt(e))return st(Ic(t.lineLike,e));if(kt(e))return jc(t,e);if(Ct(e))return Bc(t,e)}else if(Et(t)){if(tt(e)||ht(e))return bt(e,t);if(Et(e))return zc(t,e);if(yt(e))return qc(t,e);if(mt(e))return Zc(t,e);if(Vt(e))return Yc(t,e);if(kt(e))return Kc(t,e);if(Ct(e))return Jc(t,e)}else if(yt(t)){if(tt(e)||ht(e)||Et(e))return bt(e,t);if(yt(e))return xs(Gr(t.planeLike,e.planeLike));if(mt(e))return xs($a(t.planeLike,e.center,e.radius));if(Vt(e))return Xc(t,e);if(kt(e))return Qc(t,e);if(Ct(e))return eu(t,e)}else if(mt(t)){if(tt(e)||ht(e)||Et(e)||yt(e))return bt(e,t);if(mt(e))return xs(Sa(t.center,t.radius,e.center,e.radius));if(Vt(e))return void 0;if(kt(e))return tu(t,e);if(Ct(e))return void 0}else if(Vt(t)){if(tt(e)||ht(e)||Et(e)||yt(e)||mt(e))return bt(e,t);if(Vt(e))return void 0;if(kt(e))return e.asCircle(),void 0;if(Ct(e))return void 0}else if(kt(t)){if(tt(e)||ht(e)||Et(e)||yt(e)||mt(e)||Vt(e))return bt(e,t);if(kt(e))return iu(e,t);if(Ct(e))return void 0}else if(Ct(t)){if(tt(e)||ht(e)||Et(e)||yt(e)||mt(e)||kt(e))return bt(e,t);if(Ct(e))return void 0}}const Wc=(()=>{const t=je();return(e,i)=>{const{start:n,end:s}=e;if(Br(n,s)&&G(n[2],i.z))return e;const a=Ae();return kr(i.getPlane(t),n,s,a)?new Vi(a):void 0}})();function jc({lineLike:t},{center:e,radius:i}){const n=e[2];return st(Wr(t,e,i).filter(s=>G(s[2],n)))}function Bc({lineLike:t},{sphere:e}){return st(zp(e,t.start,t.end))}const Pa=(()=>{const t=Up(),e=S(),i=S();return(n,s,a)=>{const{normal:o,center:d,radius:p}=s;Er(o,e,i);const c=Ir(n),h=p*Ie(c,e),u=p*Ie(c,i);Np(t,d[0],d[1],d[2],1);const y=Hp(n,t),g=Math.hypot(h,u),m=G(g,0);if(G(ia(n,d),0)){if(m)return s;if(G(p,0))return!a||Bt(a,d)?new Vi(Ti(d)):void 0;Xn(e,c,o),hp(e,e);const R=new Array,Y=zt(d);he(Y,Y,e,p),a&&!Bt(a,Y)||R.push(Y);const me=zt(d);return he(me,me,e,-p),a&&!Bt(a,me)||R.push(me),st(R)}if(m)return;const v=-y/g;if(Math.abs(v)>1||G(v,1))return;const _=Math.atan(h/u),w=jl(v)-_,b=Math.PI-w,M=new Array,I=S();he(I,d,e,p*Math.cos(w)),he(I,I,i,p*Math.sin(w)),M.push(I);const F=S();return he(F,d,e,p*Math.cos(b)),he(F,F,i,p*Math.sin(b)),M.push(F),st(a?Tc(a,M):M)}})();function zc(t,e){return G(t.z,e.z)?t:void 0}function qc({z:t},{planeLike:e}){const[i,n]=e.start,[s,a]=e.end,o=qt(i,n,t),d=qt(s,a,t);return e.type===Oe.PLANE?new La(o,d):new Oc(o,d)}function Zc(t,e){const[i,n]=e.center;return new xa(qt(i,n,t.z),e.radius)}function Kc(t,e){return G(e.center[2],t.z)?e:void 0}const Yc=(()=>{const t=je();return(e,i)=>Pa(e.getPlane(t),i,i.slicePlane)})();function Jc(t,{center:e,radius:i}){const n=Math.abs(e[2]-t.z);if(n>i&&!G(n,i))return;const s=qt(e[0],e[1],t.z),a=Math.sqrt(i**2-n**2);return G(a,0)?void 0:new xa(s,a)}const Qc=(()=>{const t=je();return(e,{center:i,radius:n})=>{const s=$a(e.planeLike,i,n),a=i[2];e.getSlicePlane(t);const o=new Array;for(const[d,p]of s){const c=[d,p,a];Bt(t,c)&&o.push(c)}return st(o)}})(),Xc=(()=>{const t=je(),e=je();return(i,n)=>Pa(i.getPlane(t),n,i.getSlicePlane(e))})(),eu=(()=>{const t=je();return(e,{center:i,radius:n})=>{const s=e.getPlane(t),a=jp(s,i),o=Math.abs(a);if(o>n&&!G(o,n))return;const d=Math.sqrt(n**2-a**2);if(G(d,0)){const h=Ae();return Cr(s,i,h),new Vi(h)}const p=Ae(),c=zt(Ir(s));return he(p,i,c,a),new Va(p,d,c,e.getSlicePlane())}})();function tu(t,e){const i=vr(t.center,e.center);return G(i,0)&&G(t.radius,e.radius)?e:Xr(Sa(t.center,t.radius,e.center,e.radius),e.center[2])}function iu(t,e){if(!Br(t.center,e.center))return;const i=vr(t.center,e.center);return G(i,0)&&G(t.radius,e.radius)?t:Xr(Sa(t.center,t.radius,e.center,e.radius),t.center[2])}function To(t,e){const{planeLike:i,getZ:n}=t,s=new Array;if(tt(e))t.addIfOnTheGround(s,Cc(i,e.point));else if(ht(e))t.addIfOnTheGround(s,Dr(i,e.lineLike));else if(mt(e))for(const[a,o]of $a(i,e.center,e.radius)){const d=n(a,o);d!=null&&s.push(Kn(a,o,d))}else if(yt(e)||ss(e))for(const[a,o]of Gr(i,e.planeLike)){const d=n(a,o)??el;s.push(Kn(a,o,d))}return st(s)}function xs(t){return Da(t.map(([e,i])=>{const n=qt(e,i,0),s=qt(e,i,1);return new La(n,s)}))}function st(t){return Da(t.map(e=>e?new Vi(e):void 0))}function Xr(t,e){return st(t.map(([i,n])=>[i,n,e]))}function Da(t){if(t.length!==0)return t.length===1?t[0]??void 0:new Kr(t.filter(Fe))}function oa(t){return t instanceof Kr}function tt(t){return t instanceof Vi}function ht(t){return t instanceof Aa}function Et(t){return t instanceof Lc}function yt(t){return t instanceof Ra}function mt(t){return t instanceof Yr}function kt(t){return t instanceof xa}function Vt(t){return t instanceof Va}function Ct(t){return t instanceof Rc}function ss(t){return t instanceof Qr}function nu(t){return t instanceof Dc}function su(t){return t instanceof Pc}const el=0;var Ce;function au(t,e){if(t==null||e==null)return;const i=ra(t,e);return i!=null?nn(i,"radians","geographic"):void 0}(function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"})(Ce||(Ce={}));const ra=(()=>{const t=S(),e=S();return(i,n)=>(_t(t,i.x,i.y,i.z??0),_t(e,n.x,n.y,n.z??0),ou(t,e,i.spatialReference,n.spatialReference))})(),ou=(()=>{const t=We(),e=S(),i=S();return(n,s,a,o)=>{if(B(n,s))return;const d=na(a),p=na(o);if(d&&p&&Yi(d,p)&&es(n,a,e,d)&&es(s,o,i,p)){const{azimuth:h}=mn(lu,e,i,d);return h!=null?dn(h,"degrees","radians"):void 0}t[0]=s[0]-n[0],t[1]=s[1]-n[1];let c=lp(cp,t);return t[0]<0&&(c=du-c),c}})();function pg(t,e,i,n=Ce.Absolute){if(e&&i)switch(n){case Ce.Absolute:return au(e,i);case Ce.Relative:return So($o(t,e,i),Ce.Relative);case Ce.RelativeBilateral:return So($o(t,e,i),Ce.RelativeBilateral)}}function $o(t,e,i){if(!t||!e||!i)return;const n=ra(t,e),s=ra(e,i);return n!=null&&s!=null?nn(s-n,"radians","geographic"):void 0}function So(t,e){if(t!=null)switch(e){case Ce.Absolute:return ru(t);case Ce.Relative:{const i=as(t);let n=Fo.normalize(i,0,!0);return n===-180&&(n=180),nn(n,"degrees","geographic")}case Ce.RelativeBilateral:{const i=as(t),n=Math.abs(Fo.normalize(i,0,!0));return nn(n,"degrees","geographic")}}}function ru(t){const e=as(t),i=pu.normalize(e,0,!0);return nn(i,"degrees","geographic")}const cg=(()=>{const t=S();return(e,i,n,s,a,o="geodesic")=>{hs(t,i);const d=as(a);if(o==="geodesic"){const g=na(n);if(g&&es(t,n,t,g))return oi(e,t,d,s,g),e[2]=i[2],!!es(e,g,e,n)}const p=Ea(d,"geographic","arithmetic"),c=dn(p,"degrees","radians"),h=i[0]+s*Math.cos(c),u=i[1]+s*Math.sin(c),y=i[2];return _t(e,h,u,y),!0}})();function as(t){if(t!=null)return Ea(tl(t),t.rotationType,"geographic")}function ug(t){if(t!=null)return Ea(tl(t),t.rotationType,"arithmetic")}function tl(t){return dn(t.value,t.unit,"degrees")}const lu=new yn,du=2*Math.PI,pu=zl,Fo=new ql(-180,180);let Pn=class extends O{constructor(e){super(e),this.enabled=!1}};r([l({type:Boolean,nonNullable:!0})],Pn.prototype,"enabled",void 0),Pn=r([C("esri.views.interactive.sketch.SketchLabelOptions")],Pn);const Ga=Pn,yg=Symbol("grid-placement-graphic");function il(t,e){const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}function mg(t,e){return Math.sqrt(il(t,e))}function cu(t,e){e.sort((i,n)=>Xs(i.targetPoint,t)-Xs(n.targetPoint,t))}var Be;function gg({point:t,distance:e,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:s},filter:a},o,d){return d=d!=null?d.clone():new Pp({where:"1=1"}),a&&(d.geometry=a.geometry,d.distance=a.distance,d.spatialRelationship=a.spatialRelationship,d.where=Zl(d.where,a.where),d.timeExtent=Rp(d.timeExtent,a.timeExtent),d.objectIds=uu(d.objectIds,a.objectIds)),{point:hn(t[0],t[1],t[2],s.toJSON()),mode:o,distance:e,returnEdge:i,vertexMode:n,query:d.toJSON()}}function uu(t,e){return t||e?e?t?Array.from(Kl(new Set(t),new Set(e))):e:t:null}function fg(t,e,i){return{left:bo(t.leftVertex.pos,e,i),right:bo(t.rightVertex.pos,e,i)}}function vg(t){return t.createQuery()}(function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(Be||(Be={}));const Oo=Symbol("snapping-toggle");function hu(t,e=()=>{}){const i=k(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:n,snappingOptions:s})=>{if(t.removeHandles(Oo),!n||!s)return;const a=q.TOOL,o=[n.on("key-down",d=>{d.key!==ko.toggle||d.repeat||(s.enabledToggled=!0,e())},a),n.on("key-up",d=>{d.key===ko.toggle&&(s.enabledToggled=!1,e())},a),n.on("pointer-move",d=>{const p=d.native.ctrlKey;s.enabledToggled!==p&&(s.enabledToggled=p,e())},a)];t.addHandles(o,Oo)},it);t.addHandles(i)}function _g(t){var e;return Gp(t)&&"utilityNetworks"in t&&!!((e=t.utilityNetworks)!=null&&e.length)}let Rt=class extends O{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Q}};r([l({constructOnly:!0})],Rt.prototype,"layer",void 0),r([l()],Rt.prototype,"enabled",void 0),r([l()],Rt.prototype,"updating",void 0),r([l()],Rt.prototype,"availability",void 0),r([l()],Rt.prototype,"sublayerSources",void 0),Rt=r([C("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Rt);const ks=Rt;let ie=class extends O{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Q,this.distance=ts.distance,this.touchSensitivityMultiplier=ts.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var p;const e=this.featureSources;e.some(Ao)&&le.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=e.filter(mu),n=((p=this._get("_effectiveFeatureSources"))==null?void 0:p.filter(Ao))??new Q;for(const c of i){const h=n.find(u=>u.layer===c.layer.parent);if(h)h.sublayerSources.includes(c)||h.sublayerSources.add(c);else if(c.layer.parent){const u=new ks({layer:c.layer.parent});u.sublayerSources.add(c),n.add(u)}}for(const c of n){const h=c.sublayerSources.filter(u=>!i.includes(u));c.sublayerSources.removeMany(h)}n.removeMany(n.filter(c=>c.sublayerSources.length===0));const s=e.filter(yu),a=this._get("_effectiveFeatureSources")??new Q,{added:o,removed:d}=Yl(a.toArray(),[...s,...n]);return a.removeMany(d),a.addMany(o),a}};r([l()],ie.prototype,"enabled",void 0),r([l()],ie.prototype,"enabledToggled",void 0),r([l()],ie.prototype,"forceDisabled",void 0),r([l()],ie.prototype,"selfEnabled",void 0),r([l()],ie.prototype,"featureEnabled",void 0),r([l()],ie.prototype,"gridEnabled",void 0),r([l()],ie.prototype,"attributeRulesEnabled",void 0),r([l({type:Q.ofType(ks)})],ie.prototype,"featureSources",void 0),r([l()],ie.prototype,"distance",void 0),r([l()],ie.prototype,"touchSensitivityMultiplier",void 0),r([l({readOnly:!0})],ie.prototype,"effectiveEnabled",null),r([l({readOnly:!0})],ie.prototype,"effectiveGridEnabled",null),r([l({readOnly:!0})],ie.prototype,"effectiveSelfEnabled",null),r([l({readOnly:!0})],ie.prototype,"effectiveFeatureEnabled",null),r([l({readOnly:!0})],ie.prototype,"_effectiveFeatureSources",null),ie=r([C("esri.views.interactive.snapping.SnappingOptions")],ie);const ui=ie;function Ao(t){return t.layer.type==="subtype-group"}function yu(t){return t.layer.type!=="subtype-group"}function mu(t){return t.layer.type==="subtype-sublayer"}let Ri=class{constructor(e,i,n,s){this.targetPoint=e,this.constraint=i,this.isDraped=n,this.domain=s}},nl=class extends Ri{constructor({targetPoint:e,objectId:i,constraint:n,isDraped:s}){super(e,n,s,ye.FEATURE),this.objectId=i}},gu=class extends nl{constructor(e){super({...e,isDraped:!0,constraint:new Qr(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new wt(Be.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},fu=class extends nl{constructor(e){super({...e,constraint:new La(e.edgeStart,e.edgeEnd)})}get hints(){return[new wt(Be.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Dn=class extends Ri{constructor(e,i,n,s){super(e,new Vi(e),s,ye.ALL),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new vc(this.targetPoint,this.isDraped,this.domain)]}},vu=class extends Ri{constructor({lineStart:e,lineEnd:i,targetPoint:n,isDraped:s}){super(n,new Jr(e,i),s,ye.SELF),this._referenceLineHint=new wt(Be.REFERENCE_EXTENSION,e,i,s,this.domain)}get hints(){return[this._referenceLineHint,new wt(Be.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},_u=class extends Ri{constructor({referenceLine:e,lineStart:i,targetPoint:n,isDraped:s}){const a=zt(i),{left:o,right:d}=e;ys(a,mp(a,a,d),o),super(n,new Jr(i,a),s,ye.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new wt(Be.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new _c(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new wt(Be.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const i={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(n=>{B(e.right,n.edge.left)&&(n.fadeLeft=!1,i.fadeRight=!1),B(e.right,n.edge.right)&&(n.fadeRight=!1,i.fadeRight=!1),B(e.left,n.edge.right)&&(n.fadeRight=!1,i.fadeLeft=!1),B(e.left,n.edge.left)&&(n.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}},wu=class extends Ri{constructor({targetPoint:e,constraint:i,previousVertex:n,otherVertex:s,otherVertexType:a,isDraped:o,selfSnappingType:d,objectId:p,domain:c}){super(e,i,o,c??ye.SELF),this.previousVertex=n,this.otherVertex=s,this.otherVertexType=a,this.selfSnappingType=d??rs.None,this.objectId=p??null}get hints(){const e=this.previousVertex,i=this.otherVertexType===os.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===os.CENTER?this.targetPoint:this.otherVertex;return[new wt(Be.TARGET,i,n,this.isDraped,this.domain),new wt(Be.REFERENCE,e,i,this.isDraped,this.domain),new Lr(this.previousVertex,i,n,this.isDraped,this.domain)]}};var os,rs;(function(t){t[t.NEXT=0]="NEXT",t[t.CENTER=1]="CENTER"})(os||(os={})),function(t){t[t.None=0]="None",t[t.LastVertex=1]="LastVertex",t[t.FirstVertex=2]="FirstVertex",t[t.ExistingEdge=3]="ExistingEdge"}(rs||(rs={}));let bu=class extends Ri{constructor({targetPoint:e,point1:i,point2:n,isDraped:s}){super(e,new Yr(gp(S(),i,n,.5),.5*dp(i,n)),s,ye.SELF),this._p1=i,this._p2=n}get hints(){return[new wt(Be.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new wt(Be.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Lr(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function Eu(t,e,i,n,s=S()){const a=hs(ku,t);return a[2]=br(n,a,e,i)||0,n.renderCoordsHelper.toRenderCoords(a,e,s),s}const ku=S();function Cu(t,e,i,n){return n.type==="2d"?(In.x=t[0],In.y=t[1],In.spatialReference=e,n.toScreen(In)):(Eu(t,e,i,n,Lo),n.state.camera.projectToScreen(Lo,Vs),Jl(Vs[0],Vs[1]))}const In=hn(0,0,0,null),Lo=S(),Vs=Ql();let Ge=class extends At.EventedMixin(O){constructor(e){super(e),this.options=new ui,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Tt.MAIN}initialize(){this.addHandles([k(()=>{const{distance:e,touchSensitivityMultiplier:i,effectiveSelfEnabled:n,effectiveFeatureEnabled:s,effectiveGridEnabled:a}=this.options;return{selfEnabled:n,featureEnabled:s,gridEnabled:this.view.type==="2d"&&a,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:i}},(e,i)=>{var n;i&&(this.doneSnapping(),this.emit("changed")),(n=this._loadTask)==null||n.abort(),this._loadTask=pn(s=>this._updateEngines(e,i,s))},it),k(()=>this.options,e=>{for(const i of this._engines)i.options=e},sn)])}destroy(){this._destroyEngines()}get updating(){var e;return this._engines.some(i=>i.updating)||!((e=this._loadTask)!=null&&e.finished)}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,i,n){if(!e.viewReady)return void this._destroyEngines();(i==null?void 0:i.viewSpatialReference)!==e.viewSpatialReference&&this._destroyEngines();const{_engineCache:s}=this,a=[];e.featureEnabled&&!s.has("feature")&&a.push(this._setupFeatureSnappingEngine(n)),e.selfEnabled&&!s.has("self")&&a.push(this._setupSelfSnappingEngine(n)),e.gridEnabled&&!s.has("grid")&&this.view.type==="2d"&&a.push(this._setupGridSnappingEngine(n)),await Promise.allSettled(a),n.aborted||(this._engines=Array.from(s.values()))}async _setupSelfSnappingEngine(e){const{SelfSnappingEngine:i}=await E(()=>import("./SelfSnappingEngine-CLlhYFEF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115]));at(e);const n=new i({view:this.view,options:this.options});this._engineCache.set("self",n)}async _setupGridSnappingEngine(e){const{view:i}=this,{GridSnappingEngine:n}=await E(async()=>{const{GridSnappingEngine:s}=await import("./GridSnappingEngine-_a4rjWMQ.js");return{GridSnappingEngine:s}},__vite__mapDeps([116,1,2,9,13,11,117,118,119,120,121,122,6,8,10,12,14,15,16,17,18,19,4,5,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,3,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115]));if(at(e),i.type==="2d"){const s=new n({view:i,options:this.options});this._engineCache.set("grid",s)}}async _setupFeatureSnappingEngine(e){const{FeatureSnappingEngine:i}=await E(()=>import("./FeatureSnappingEngine-Cp3hja5K.js"),__vite__mapDeps([123,1,2,6,9,17,3,4,5,72,66,67,68,23,24,25,26,124,8,10,11,12,13,14,15,16,18,19,20,21,22,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,69,70,71,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115]));at(e);const{view:n,options:s,_engineCache:a}=this,o=new i({view:n,options:s,spatialReference:n.spatialReference});a.set("feature",o)}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:i}=this.options,n=e*i;return n*n}snap(e){return Tu(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:i,context:n}=e;this._removeVisualization();const s=this._currentMainCandidate;if(s==null)return i;const a=this._selectUpdateInput(e);if(a==null)return i;const{spatialReference:o}=n,d=ta(a,o);if(d==null)return i;const{view:p}=this,{elevationInfo:c,visualizer:h}=n,u=[],y=zi(d,p,c),g=s.constraint.closestTo(y);if(!this._arePointsWithinScreenThreshold(y,g,n)||!Ps(s,n.drawConstraints))return this._resetSnappingState(),i;s.targetPoint=Os(g),u.push(...s.hints);for(const m of this._currentOtherActiveCandidates)Ps(m,n.drawConstraints)&&(m.targetPoint=Os(g),u.push(...m.hints));return h!=null&&this.addHandles(h.draw(u,{spatialReference:o,elevationInfo:$u(n),view:p,selfSnappingZ:n.selfSnappingZ}),Rs),Eo(g,p,i,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:i}){switch(this._currentSnappedType){case Tt.MAIN:return e;case Tt.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Tt.MAIN}_removeVisualization(){this.removeHandles(Rs)}async _snapSinglePoint({point:e,context:i,signal:n}){const{view:s}=this,{elevationInfo:a}=i,o=zi(e,s,a),d=await this._fetchCandidates(o,ye.ALL,i,n);return this._createSnapResult(o,Tt.MAIN,d,s,e,i,n)}async _snapMultiPoint({point:e,scenePoint:i,context:n,signal:s}){const{view:a}=this,{coordinateHelper:o,elevationInfo:d,spatialReference:p}=n;await $p(i.spatialReference,p);const c=ta(i,p),h=zi(c,a,d),u=await this._fetchCandidates(h,ye.FEATURE,n,s);if(u.length>0){const m=await this._fetchCandidates(h,ye.SELF,n,s);return this._createSnapResult(h,Tt.SCENE,[...u,...m],a,c,n,s)}const y=zi(e,a,d),g=await this._fetchCandidates(y,ye.SELF,n,s);return this._createSnapResult(y,Tt.MAIN,g,a,{z:o.hasZ()&&e.hasZ?e.z??0:void 0,m:o.hasM()&&e.hasM?e.m??0:void 0},n,s)}async _fetchCandidates(e,i,n,s){return(await Promise.all(this._engines.map(a=>a.fetchCandidates(e,i,n,s)))).flat()}_createSnapResult(e,i,n,s,a,o,d){return{get valid(){return!ar(d)},apply:()=>{const{spatialReference:p}=o,{snappedPoint:c,hints:h}=this._processCandidates(e,i,n,o);return this._removeVisualization(),o.visualizer!=null&&this.addHandles(o.visualizer.draw(h,{spatialReference:p,elevationInfo:Mi,view:s,selfSnappingZ:o.selfSnappingZ}),Rs),Eo(c,s,a,o)}}}_processCandidates(e,i,n,s){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==i&&this._resetSnappingState(),cu(e,n);const a=this._currentMainCandidate;if(a!=null){const o=Mu(a,n);if(o>=0){if(!(n[o]instanceof Dn))return this._intersectWithOtherCandidates(o,n,e,i,s);if(this._arePointsWithinScreenThreshold(e,a.targetPoint,s))return this._updateSnappingCandidate(a,i,n,s)}}return this._intersectWithOtherCandidates(0,n,e,i,s)}_intersectWithOtherCandidates(e,i,n,s,a){const{coordinateHelper:o}=a,d=i[e],p=[];for(let c=0;c<i.length;++c){if(c===e)continue;const h=i[c],u=d.constraint.intersect(h.constraint);if(u)for(const y of u.closestPoints(d.targetPoint))p.push([new Dn(Os(y),d,h,h.isDraped),this._squaredScreenDistance(n,y,o)])}return p.length>0&&(p.sort((c,h)=>c[1]-h[1]),p[0][1]<this._squaredPointProximityThreshold(a.pointer))?this._updateSnappingCandidate(p[0][0],s,i,a):Ps(d,a.drawConstraints)?this._updateSnappingCandidate(d,s,i,a):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,i,n,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=i;const a=this._currentMainCandidate.targetPoint,o=[];o.push(...e.hints);for(const d of n){if(e instanceof Dn){if(d.constraint.equals(e.first.constraint)||d.constraint.equals(e.second.constraint))continue}else if(d.constraint.equals(e.constraint))continue;const p=d.constraint.closestTo(a);this._squaredScreenDistance(p,a,s.coordinateHelper)<Iu()&&(d.targetPoint=a,this._currentOtherActiveCandidates.push(d),o.push(...d.hints))}return{snappedPoint:a,hints:o}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,i,n){return this._squaredScreenDistance(e,i,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,i,n){return il(this._toScreen(e,n),this._toScreen(i,n))}_toScreen(e,i){return Cu(e,i.spatialReference,Mi,this.view)}get test(){}};var Tt;r([l({constructOnly:!0})],Ge.prototype,"view",void 0),r([l()],Ge.prototype,"options",void 0),r([l({readOnly:!0})],Ge.prototype,"updating",null),r([l()],Ge.prototype,"_loadTask",void 0),r([l()],Ge.prototype,"_engines",void 0),r([l()],Ge.prototype,"_squaredMouseProximityThreshold",null),r([l()],Ge.prototype,"_squaredTouchProximityThreshold",null),Ge=r([C("esri.views.interactive.snapping.SnappingManager")],Ge),function(t){t[t.MAIN=0]="MAIN",t[t.SCENE=1]="SCENE"}(Tt||(Tt={}));const Rs="visualization-handle";function Iu(){return ts.satisfiesConstraintScreenThreshold*ts.satisfiesConstraintScreenThreshold}function Ps(t,e){return!e||e.direction==null&&e.distance==null||!(t instanceof gu||t instanceof fu||t instanceof vu||t instanceof _u||t instanceof bu)&&(!(t instanceof wu)||e.direction==null&&t.selfSnappingType===rs.LastVertex)}function Mu(t,e){return t instanceof Dn?Ds(e,t.first)>=0&&Ds(e,t.second)>=0?0:-1:Ds(e,t)}function Ds(t,e){let i=-1;for(let n=0;n<t.length;++n)if(e.constraint.equals(t[n].constraint)){i=n;break}return i}function Tu(t){return t.scenePoint!=null}function $u({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?Mi:e}var la;let Pt=la=class extends or{constructor(t){super(t),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new la({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};r([l()],Pt.prototype,"displayValueEnabled",void 0),r([l()],Pt.prototype,"max",void 0),r([l()],Pt.prototype,"min",void 0),r([l()],Pt.prototype,"step",void 0),r([l()],Pt.prototype,"value",void 0),Pt=la=r([C("esri.support.actions.ActionSlider")],Pt);const Su=Pt,Fu={hide:"hide",hideChildren:"hide-children"};function ls(t){return(t==null?void 0:t.listMode)??void 0}function Ou(t){return t!=null&&"minScale"in t&&t.minScale!=null?t.minScale:void 0}function Au(t){return t!=null&&"maxScale"in t&&t.maxScale!=null?t.maxScale:void 0}function Lu(t){if(!t)return"inherited";const e=Vu(al(t)?t.layer:t);return e!=null?e?"independent":"inherited":"visibilityMode"in t&&t.visibilityMode!=null?t.visibilityMode:"independent"}function sl(t){if(t&&(!("type"in t)||t.type!=="wmts"))return"sublayers"in t?"sublayers":"layers"in t?"layers":void 0}function Na(t){return ls(t)!==Fu.hide}function xu(t,e){if(!t||e==null||isNaN(e))return!1;const i=Ou(t),n=Au(t),s=i!=null&&!isNaN(i)&&i>0&&e>i,a=n!=null&&!isNaN(n)&&n>0&&e<n;return s||a}function xo(t){const e=t==null?void 0:t.layer;return e&&"layers"in e?e.layers:null}function al(t){return t!=null&&"layer"in t&&t.layer!=null}function Vu(t){const e=Ru(t);return e!=null&&"supportsSublayerVisibility"in e?e.supportsSublayerVisibility:void 0}function Ru(t){return t&&"capabilities"in t&&t.capabilities!=null&&"exportMap"in t.capabilities?t.capabilities.exportMap:void 0}let oe=class extends ka(Fi){constructor(e,i){super(e,i),this._legend=null,this.className=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([k(()=>this._canCreateLegend,()=>this._createLegend(),K),k(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),K)])}destroy(){this._legend=Se(this._legend)}get _canCreateLegend(){const{content:e,listItem:i}=this;if(!i)return!1;const n="legend";return e===n||e!=null&&!!Array.isArray(e)&&e.includes(n)}get _legendOptions(){const{listItem:e,_legendLayerInfo:i}=this,n=e==null?void 0:e.view;return i&&n?{view:n,layerInfos:[i]}:{}}get _legendLayerInfo(){var o;const e=(o=this.listItem)==null?void 0:o.layer;if(!e||e.type==="subtype-sublayer")return null;const i=al(e)?e:null,n=e==null?void 0:e.parent,s=n!=null&&"type"in n&&n.type==="map-image"?i==null?void 0:i.source:null,a="";return s&&n?{layer:n,title:a,sublayerIds:[s.mapLayerId]}:{layer:e,title:a}}get disabled(){var s;const{listItem:e,_legend:i,content:n}=this;return!e||!(Array.isArray(n)&&n.length>1)&&!!i&&(!((s=i.activeLayerInfos)!=null&&s.length)||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,i=this._getFirstWidget();return this._get("icon")??(!e&&i?i.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){var e;return this._get("title")||(((e=this._getFirstWidget())==null?void 0:e.label)??"")}set title(e){this._override("title",e)}render(){return f("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:i,disabled:n,open:s}=this;return e&&!n&&s?e==="legend"&&i?f("div",{key:"legend-widget"},i.render()):typeof e=="string"?f("div",{innerHTML:e,key:e}):wo(e)?f("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?f("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:i}=this;return i?Array.isArray(e)?e.map(n=>this._renderContent(n)):this._renderContent(e):null}async _createLegend(){if(Se(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await E(()=>import("./Legend-Dm-5dECe.js"),__vite__mapDeps([125,1,2,126,127,67,68,66,128,121,124,129,130,27,28,29,30,31,32,33,5,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,131,96,95,97,98,132,26,133,134])),i=new e(this._legendOptions);this._legend=i}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:wo(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(i=>this._getWidget(i)).find(i=>i):this._getWidget(e)}};r([l()],oe.prototype,"_legend",void 0),r([l()],oe.prototype,"_canCreateLegend",null),r([l()],oe.prototype,"_legendOptions",null),r([l()],oe.prototype,"_legendLayerInfo",null),r([l()],oe.prototype,"className",void 0),r([l()],oe.prototype,"content",void 0),r([l()],oe.prototype,"disabled",null),r([l()],oe.prototype,"flowEnabled",void 0),r([l()],oe.prototype,"icon",null),r([l()],oe.prototype,"image",void 0),r([l()],oe.prototype,"listItem",void 0),r([l()],oe.prototype,"open",void 0),r([l()],oe.prototype,"title",null),r([l()],oe.prototype,"visible",void 0),oe=r([C("esri.widgets.LayerList.ListItemPanel")],oe);const ol=oe;var qi;const Pu=Q.ofType({key:"type",defaultKeyValue:"button",base:or,typeMap:{button:Xl,toggle:ed,slider:Su}}),rl=Q.ofType(Pu),Gs="layer",Mn="child-list-mode",Du="hide";let x=qi=class extends ka(O){constructor(t){super(t),this.actionsSections=new rl,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(Q.ofType(qi)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.panel=null,this.parent=null,this.view=null}initialize(){if(this.addHandles([k(()=>{var t;return[this.layer,(t=this.layer)==null?void 0:t.listMode,this.listModeDisabled]},()=>this._watchLayerProperties(this.layer),K),k(()=>this.checkPublishStatusEnabled,t=>this._updateChildrenPublishing(t),K),k(()=>this.view,t=>this._updateChildrenView(t),K),k(()=>this.panel,t=>this._setListItemOnPanel(t),K)]),typeof this.listItemCreatedFunction=="function"){const t={item:this};this.listItemCreatedFunction.call(null,t)}}destroy(){var t;(t=this.panel)==null||t.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:t,publishing:e}=this;if(!e&&t&&"connectionStatus"in t)return t.connectionStatus}get error(){var t;return(t=this.layer)==null?void 0:t.loadError}get incompatible(){const{layerView:t}=this;return!(!t||!("spatialReferenceSupported"in t))&&!t.spatialReferenceSupported}get layerView(){const{layer:t,view:e}=this;if(!t||!e||t.type==="sublayer")return null;const i=t.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(n=>n.layer===i)??null}castPanel(t){var e;return(e=this.panel)!=null&&e.open&&!t.hasOwnProperty("open")&&(t.open=!0),t?new ol(t):null}get sortable(){var t;return((t=this.layer)==null?void 0:t.type)!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(t){this._set("sortable",t)}get title(){const t=_n(this,"layer.layer");return(!t||t&&_n(this,"layer.layer.loaded"))&&_n(this,"layer.title")||_n(this,"layer.attributes.title")||""}set title(t){this._override("title",t)}get publishing(){var i;const{layer:t,checkPublishStatusEnabled:e}=this;return e&&t&&"publishingInfo"in t&&((i=t.publishingInfo)==null?void 0:i.status)==="publishing"}get updating(){const{layerView:t,connectionStatus:e,layer:i,publishing:n}=this;return!n&&!e&&(t?t.updating:(i==null?void 0:i.loadStatus)==="loading"||!1)}get visible(){var t;return(t=this.layer)==null?void 0:t.visible}set visible(t){const e=this.layer;e&&(e.visible=t)}get visibleAtCurrentScale(){var t,e;return((t=this.layerView)==null?void 0:t.visibleAtCurrentScale)??!xu(this.layer,(e=this.view)==null?void 0:e.scale)}get visibleAtCurrentTimeExtent(){var t;return((t=this.layerView)==null?void 0:t.visibleAtCurrentTimeExtent)??!0}get visibilityMode(){return Lu(this.layer)}clone(){return new qi({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(t){t&&(t.listItem=this)}_updateChildrenPublishing(t){const e=this.children;e&&e.forEach(i=>i.checkPublishStatusEnabled=t)}_updateChildrenView(t){const e=this.children;e&&e.forEach(i=>i.view=t)}_createChildren(t){const{listModeDisabled:e,children:i}=this,n=t.filter(s=>!i.some(a=>a.layer===s));i.addMany(this._createChildItems(n,e))}_destroyChildren(t){const{children:e}=this,i=e.filter(n=>!t.includes(n.layer));e.destroyMany(i)}_sortChildren(t){this.children.sort((e,i)=>t.indexOf(i.layer)-t.indexOf(e.layer))}_destroyAllChildren(){this.removeHandles(Mn),this.children.destroyAll()}_watchChildLayerListMode(t){this.removeHandles(Mn),this.listModeDisabled||this.addHandles(t.toArray().map(e=>k(()=>e.listMode,()=>this._compileChildren(t))),Mn)}_compileChildren(t){const e=this.listModeDisabled?t:t==null?void 0:t.filter(i=>ls(i)!==Du);e!=null&&e.length?(this._createChildren(e),this._destroyChildren(e),this._sortChildren(e),this._watchChildLayerListMode(t)):this._destroyAllChildren()}_watchSublayerChanges(t){t&&this.addHandles(t.on("change",()=>this._compileChildren(t)),Gs)}_initializeChildLayers(t){this._compileChildren(t),this._watchSublayerChanges(t)}_createChildItems(t,e){return t.map(i=>e||Na(i)?new qi({layer:i,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(Fe).reverse()}_watchLayerProperties(t){if(this.removeHandles(Gs),this.removeHandles(Mn),!t)return;if((!this.listModeDisabled&&ls(t))==="hide-children")return void this.children.destroyAll();const e=sl(t);e&&this.addHandles(k(()=>t[e],i=>{t.hasOwnProperty(e)&&this._initializeChildLayers(i)},K),Gs)}};r([l({type:rl})],x.prototype,"actionsSections",void 0),r([l()],x.prototype,"actionsOpen",void 0),r([l()],x.prototype,"checkPublishStatusEnabled",void 0),r([l({type:Q})],x.prototype,"children",void 0),r([l()],x.prototype,"childrenSortable",void 0),r([l({readOnly:!0})],x.prototype,"connectionStatus",null),r([l({readOnly:!0})],x.prototype,"error",null),r([l()],x.prototype,"hidden",void 0),r([l({readOnly:!0})],x.prototype,"incompatible",null),r([l()],x.prototype,"layer",void 0),r([l({readOnly:!0})],x.prototype,"layerView",null),r([l()],x.prototype,"listItemCreatedFunction",void 0),r([l({nonNullable:!0})],x.prototype,"listModeDisabled",void 0),r([l()],x.prototype,"open",void 0),r([l({type:ol})],x.prototype,"panel",void 0),r([td("panel")],x.prototype,"castPanel",null),r([l()],x.prototype,"parent",void 0),r([l({value:!0})],x.prototype,"sortable",null),r([l()],x.prototype,"title",null),r([l({readOnly:!0})],x.prototype,"publishing",null),r([l({readOnly:!0})],x.prototype,"updating",null),r([l()],x.prototype,"view",void 0),r([l()],x.prototype,"visible",null),r([l({readOnly:!0})],x.prototype,"visibleAtCurrentScale",null),r([l({readOnly:!0})],x.prototype,"visibleAtCurrentTimeExtent",null),r([l({readOnly:!0})],x.prototype,"visibilityMode",null),x=qi=r([C("esri.widgets.LayerList.ListItem")],x);const Ha=x;let _i=class extends O{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};r([l()],_i.prototype,"length",void 0),r([l()],_i.prototype,"verticalLength",void 0),r([l()],_i.prototype,"area",void 0),_i=r([C("esri.views.interactive.sketch.Units")],_i);const ds=_i;let Dt=class extends O{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?Ce.RelativeBilateral:Ce.Relative;case"absolute":return Ce.Absolute}}get displayUnits(){return this._get("displayUnits")??new ds}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new ds}set inputUnits(e){this._set("inputUnits",e)}};r([l({type:String,nonNullable:!0})],Dt.prototype,"directionMode",void 0),r([l({type:Boolean,nonNullable:!0})],Dt.prototype,"relativeDirectionIsBilateral",void 0),r([l()],Dt.prototype,"effectiveDirectionMode",null),r([l({type:ds,nonNullable:!0})],Dt.prototype,"displayUnits",null),r([l({type:ds,nonNullable:!0})],Dt.prototype,"inputUnits",null),Dt=r([C("esri.views.interactive.sketch.SketchValueOptions")],Dt);const Cs=Dt,Te="esri-feature-form",Ns=`${Te}__group`,hi=`${Te}__input`,Hs=`${Te}__related-records`,P={base:Te,form:`${Te}__form`,formHeader:`${Te}__form-header`,label:`${Te}__label`,labelTextContent:`${Te}__label-text-content`,fieldInput:`${hi}`,inputRadio:`${hi}--radio`,inputRadioGroup:`${hi}--radio-group`,inputRadioLabel:`${hi}--radio-label`,inputDisabled:`${hi}--disabled`,inputSwitch:`${hi}--switch`,centeredButton:`${Te}__centered-button`,description:`${Te}__description-text`,listObserver:`${Te}__list-observer`,relatedRecordsHeader:`${Hs}_header`,relatedRecordsLabel:`${Hs}_label`,relatedRecordsList:`${Hs}_list`,dateInputContainer:`${`${Te}__date`}-input-container`,textElement:`${Te}__text-element`,group:Ns,groupSequential:`${Ns}--sequential`,groupActive:`${Ns}--active`};let Qt=class extends O{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};r([l()],Qt.prototype,"objectType",void 0),r([l()],Qt.prototype,"maxValue",void 0),r([l()],Qt.prototype,"minValue",void 0),r([l()],Qt.prototype,"codedValue",void 0),Qt=r([C("esri.layers.support.ContingentValue")],Qt);const ae=Qt;let Xt=class extends O{constructor(e){super(e),this.isRetired=!1}};r([l()],Xt.prototype,"id",void 0),r([l()],Xt.prototype,"isRetired",void 0),r([l()],Xt.prototype,"subtype",void 0),r([l()],Xt.prototype,"values",void 0),Xt=r([C("esri.layers.support.Contingency")],Xt);const Vo=Xt;let Zi=class extends O{constructor(e){super(e)}};r([l()],Zi.prototype,"fieldGroup",void 0),r([l()],Zi.prototype,"type",void 0),Zi=r([C("esri.layers.support.ContingencyConstraintViolation")],Zi);const Ro=Zi;let Ki=class extends O{constructor(e){super(e)}};r([l()],Ki.prototype,"contingentValuesAllGroups",void 0),r([l()],Ki.prototype,"contingentValuesByFieldGroup",void 0),Ki=r([C("esri.layers.support.ContingentValuesResult")],Ki);const Gu=Ki;let ei=class extends O{constructor(e){super(e),this.fields=null,this.isEditingRestrictive=!1}};r([l()],ei.prototype,"name",void 0),r([l()],ei.prototype,"fields",void 0),r([l()],ei.prototype,"isEditingRestrictive",void 0),r([l()],ei.prototype,"contingencies",void 0),ei=r([C("esri.layers.support.FieldGroup")],ei);const da=ei;var Gn;let Gt=Gn=class extends id(nd){constructor(t){super(t),this.request=Oi,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){return qs(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(t){await t.load();const e=t.sourceJSON;if(t.layerId===void 0)return null;const i=e.hasContingentValuesDefinition;if(i)return new Gn({layer:t}).load();if(i===void 0){const n=Fs(t.url);if(n==null)return null;const s=n.url.path;if((await Do(s)).supportsQueryDataElements){const a=t.layerId.toString(),o=await Po(s,a);if(o){const d=o.map(p=>({name:p.name,isEditingRestrictive:p.isEditingRestrictive,fields:p.fieldNames.names.map(c=>t.fieldsIndex.normalizeFieldName(c))}));return new Gn({layer:t,fieldGroupDefinitions:d}).load()}}}return null}async load(t){const e=this.layer.load(t).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,t));return this.addResolvingPromise(e),this}validateContingencyConstraints(t,e){const i=Object.keys(t),n=[],s=[];for(const a of this.fieldGroups){const o=a.isEditingRestrictive?"error":"warning";if(e&&!a.fields.some(h=>e.includes(h)))continue;if(!a.fields.every(h=>i.includes(h))){s.push(new Ro({fieldGroup:a,type:o}));continue}let d=!1;const p=t[this.subtypeFieldName],c=a.contingencies.filter(h=>!(!h.isRetired&&h.subtype)||h.subtype.code===p);if(c.length!==0){for(const h of c){let u=!0;for(const y in h.values){const g=h.values[y];if(g.objectType!=="any"){if(g.objectType==="null"){if(t[y]!=null){u=!1;break}}else if(g.objectType==="code"){if(t[y]!==g.codedValue.code){u=!1;break}}else if(g.objectType==="range"){const m=t[y];if(m<g.minValue||m>g.maxValue){u=!1;break}}}}if(u){d=!0;break}}d||n.push(new Ro({fieldGroup:a,type:o}))}}return{invalid:n,incomplete:s}}getContingentValues(t,e,i=!1){const n=t[this.subtypeFieldName],s=n!=null,a={};let o=[];const d=this.fieldGroups.filter(p=>p.fields.includes(e));o.push(new ae({objectType:"any"}));for(const p of d){let c=[];const h=p.contingencies.filter(g=>!(g.isRetired||g.subtype&&s&&g.subtype.code!==n));let u=!1;const y={};for(const g of h){let m,v=!0;for(const _ in g.values){const w=g.values[_];if(e!==_){if(t[_]!==void 0&&w.objectType!=="any"){if(w.objectType==="null")t[_]!==null&&(v=!1);else if(w.objectType==="code")t[_]!==w.codedValue.code&&(v=!1);else if(w.objectType==="range"){const b=t[_];(b<w.minValue||b>w.maxValue)&&(v=!1)}}}else m=w,u=u||w.objectType==="range"}if(m&&v){if(m.objectType==="any"){c.length=0,c.push(m);break}const _=Nu(m);y[_]||c.push(m),y[_]=!0}}u&&(c=Hu(c)),a[p.name]=c,o=i?ju(o,c):[]}return d.length===1&&i&&(o=[]),new Gu({contingentValuesAllGroups:o,contingentValuesByFieldGroup:a})}async _initializeContingentValues(t,e){const i=t??await this._fetchFieldGroupDefs(e);if(i.length===0)return void(this.fieldGroups=[]);const n=await this._fetchContingentValues(i,e);this.fieldGroups=n}async _fetchFieldGroupDefs(t){if(this.layer.layerId===void 0)return[];const e=this.layer.sourceJSON,i=this.layer.layerId.toString(),n=Fs(this.layer.url).url.path;return e.hasContingentValuesDefinition?(await Bu(n,i,t)).map(s=>({name:s.name,isEditingRestrictive:s.restrictive,fields:s.fields.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):e.hasContingentValuesDefinition!==void 0?[]:Do(n,t).then(async s=>s.supportsQueryDataElements?(await Po(n,i,t)).map(a=>({name:a.name,isEditingRestrictive:a.isEditingRestrictive,fields:a.fieldNames.names.map(o=>this.layer.fieldsIndex.normalizeFieldName(o))})):[])}async _fetchContingentValues(t,e){if(this.layer.layerId===void 0)return[];const i=this.layer.sourceJSON,n=this.layer.layerId.toString(),s=Fs(this.layer.url).url.path;if(i.hasContingentValuesDefinition){const o=await qu(s,n,e);return this._constructFieldGroupsAGOL(t,o)}const a=await zu(s,n,e);return this._constructFieldGroupsEnterprise(t,a)}_constructFieldGroupsAGOL(t,e){return t.map(i=>{const n=e.contingentValuesDefinition.fieldGroups.find(s=>s.name===i.name);if(n){let s=[];return s=e.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(i,e,n.subTypes):this._parseAGOLFieldGroup(i,e,n.contingentValues),new da({name:i.name,isEditingRestrictive:i.isEditingRestrictive,fields:i.fields,contingencies:s})}return null}).filter(Fe)}_parseAGOLFieldGroupSubtype(t,e,i){let n=[];return i==null||i.forEach(s=>{const a=this._getSubtypeAGOL(s.name);n=n.concat(this._parseAGOLFieldGroup(t,e,s.contingentValues,a))}),n}_parseAGOLFieldGroup(t,e,i,n=null){const s=[];for(const a of i??[]){const o=this._parseAGOLContingency(a,t,e,n);s.push(o)}return s}_parseAGOLContingency(t,e,i,n){const s=t.id,a=!!t.retired&&t.retired===1,o={};for(let d=0,p=0;d<e.fields.length;d++){const c=e.fields[d],h=i.typeCodes[t.types[d]];if(h==="Code"){let u=t.values[p];p++;const y=this._getDomain(n,c),g=this.layer.getField(c);if((g==null?void 0:g.type)==="string"){const _=i.stringDicts.find(w=>w.domain===(y==null?void 0:y.name));_&&(u=_.entries[u])}const m=y==null?void 0:y.codedValues.find(_=>_.code===u),v=new ae({codedValue:m,objectType:"code"});o[c]=v}else if(h==="Range"){const u=t.values[p];p++;const y=u.range[0],g=u.range[1],m=new ae({minValue:y,maxValue:g,objectType:"range"});o[c]=m}else if(h==="Any"){const u=new ae({objectType:"any"});o[c]=u}else{const u=new ae({objectType:"null"});o[c]=u}}return new Vo({id:s,isRetired:a,subtype:n,values:o})}_constructFieldGroupsEnterprise(t,e){const i=e.fieldGroups;return t.map(n=>{const s=i.find(a=>a.name===n.name);if(s){const a=s.contingencies.map(o=>{const d=o.id,p=o.isRetired||!1,c=this._getSubtypeEnterprise(o.subtypeCode),h={};for(let u=0;u<n.fields.length;u++){const y=n.fields[u];let g=o.values[u];if(typeof g=="number"||typeof g=="string"){const m=this._getDomain(c,y),v=this.layer.getField(y);sd(v)?g=e.stringDictionary[g]:ad(v)&&(g=new Date(`${g}+00:00`).getTime());const _=m==null?void 0:m.codedValues.find(b=>b.code===g),w=new ae({codedValue:_,objectType:"code"});h[y]=w}else if(typeof g=="object"){const m=g.minValue,v=g.maxValue,_=new ae({minValue:m,maxValue:v,objectType:"range"});h[y]=_}else if(g){const m=new ae({objectType:"any"});h[y]=m}else{const m=new ae({objectType:"null"});h[y]=m}}return new Vo({id:d,isRetired:p,subtype:c,values:h})});return new da({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fields,contingencies:a})}return null}).filter(Fe)}_getSubtypeEnterprise(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const n=e.subtypes.find(s=>s.code===t);i=go.fromJSON(n)}return i||null}_getSubtypeAGOL(t){const e=this.layer.sourceJSON;let i;if(e.subtypes){const n=e.subtypes.find(s=>s.name===t);i=go.fromJSON(n)}return i||null}_getDomain(t,e){const i=t?Zu(t,e):this.layer.getFieldDomain(e);return(i==null?void 0:i.type)==="inherited"?this.layer.getFieldDomain(e):i}};function Nu(t){switch(t.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return t.codedValue.name+t.codedValue.code.toString();case"range":return t.minValue.toString()+"-"+t.maxValue.toString()}}function Hu(t){let e,i;t.sort((s,a)=>s.objectType==="null"?-1:a.objectType==="null"?1:s.minValue-a.minValue);const n=[];for(const s of t)s.objectType!=="null"?e!=null&&i!=null?i<s.minValue?(n.push(new ae({objectType:"range",minValue:e,maxValue:i})),e=s.minValue,i=s.maxValue):i<s.maxValue&&(i=s.maxValue):(e=s.minValue,i=s.maxValue):n.push(s);return n.push(new ae({objectType:"range",minValue:e,maxValue:i})),n}function Uu(t,e){const i=[];let n,s=0;for(const a of t)for(;s<e.length;s++){const o=e[s];if(a.objectType==="null"&&o.objectType==="null")i.push(new ae({objectType:"null"}));else{if(a.objectType==="null")break;if(o.objectType==="null")continue}if(a.maxValue<o.minValue)break;if(a.maxValue===o.minValue){i.push(new ae({objectType:"range",minValue:a.maxValue,maxValue:o.minValue}));break}if(!(a.minValue>o.maxValue))if(a.minValue!==o.maxValue){if(n=a.minValue>o.minValue?a.minValue:o.minValue,a.maxValue<o.maxValue){i.push(new ae({objectType:"range",minValue:n,maxValue:a.maxValue}));break}i.push(new ae({objectType:"range",minValue:n,maxValue:o.maxValue}))}else i.push(new ae({objectType:"range",minValue:a.minValue,maxValue:o.maxValue}))}return i}function Wu(t,e){const i=[];for(const n of t)e.some(s=>{if(n.objectType===s.objectType)switch(n.objectType){case"any":case"null":return!0;case"code":return n.codedValue.code===s.codedValue.code&&n.codedValue.name===s.codedValue.name}return!1})&&i.push(n);return i}function ju(t,e){var s,a;if(t.length===0||e.length===0)return[];if(t[0].objectType==="any")return e;if(e[0].objectType==="any")return t;const i=t[0].objectType==="range"||((s=t[1])==null?void 0:s.objectType)==="range",n=e[0].objectType==="range"||((a=e[1])==null?void 0:a.objectType)==="range";return i||n?Uu(t,e):Wu(t,e)}async function Bu(t,e,i){return Oi(`${t}/${e}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data.fieldGroups??[])}async function Po(t,e,i){return Oi(`${t}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(n=>{var s;return((s=n.data.layerDataElements)==null?void 0:s[0].dataElement.fieldGroups)??[]})}async function Do(t,e){return Oi(t,{responseType:"json",query:{f:"json"},...e}).then(i=>i.data)}async function zu(t,e,i){return Oi(`${t}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([e]),f:"json"},...i}).then(n=>{var s;return(s=n.data.contingentValueSets)==null?void 0:s[0]})}async function qu(t,e,i){return Oi(`${t}/${e}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(n=>n.data)}function Zu(t,e){const i=t.domains;if(i){const[n,s]=Object.entries(i).find(([a])=>a.trim().toLowerCase()===e.trim().toLowerCase())||[];return s||null}return null}r([l({constructOnly:!0})],Gt.prototype,"layer",void 0),r([l({constructOnly:!0})],Gt.prototype,"request",void 0),r([l({type:[da]})],Gt.prototype,"fieldGroups",void 0),r([l({constructOnly:!0})],Gt.prototype,"fieldGroupDefinitions",void 0),r([l()],Gt.prototype,"subtypeFieldName",null),Gt=Gn=r([C("esri.layers.support.LayerContingentValuesCache")],Gt);const Ku=Gt;var ll;const Yu=Symbol("FormExpressionArcadeExecutor");let fe=class extends O{constructor(e){super(e),this[ll]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new xi,this._executeAsyncDebounced=cn(async(i,n,s)=>{const a=await this.executor.executeAsync(i,{...n,abortSignal:s});return s.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=a,this._stale=!1,a)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,i){this._abortController=new AbortController;const n=this.executor.execute(e,{...i,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=n,n}async executeAsync(e,i){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,i??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};ll=Yu,r([l()],fe.prototype,"_lastEvaluatedValue",void 0),r([l()],fe.prototype,"_stale",void 0),r([l()],fe.prototype,"_updatingTracking",void 0),r([l({constructOnly:!0})],fe.prototype,"executor",void 0),r([l()],fe.prototype,"isAsync",null),r([l()],fe.prototype,"fieldsUsed",null),r([l()],fe.prototype,"syntaxTree",null),r([l()],fe.prototype,"updating",null),r([l()],fe.prototype,"stale",null),r([l()],fe.prototype,"geometryUsed",null),r([l()],fe.prototype,"variablesUsed",null),r([l()],fe.prototype,"lastEvaluatedValue",null),fe=r([C("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],fe);const Ju=async(t,e)=>{const i=Ip("form-calculation"),n=await Mp(t,i,{});return e!=null&&e.fieldsIndex&&(n.fieldsUsed=Ca(e.fieldsIndex,n.fieldsUsed)),new fe({executor:n})},Us="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let lt=class extends O{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(e=>e.isAsync)}get _baseContext(){const{editType:e,layer:i,map:n,originalFeature:s,spatialReference:a,timeZone:o}=this.arcadeContextInfo,d=(i==null?void 0:i.type)==="scene"&&i.associatedLayer!=null?i.associatedLayer:i;return[{$originalfeature:s,$editcontext:{editType:e},$layer:d,$featureset:d,$datastore:i==null?void 0:i.url,$map:n},{rawOutput:!0,spatialReference:a??void 0,timeZone:o}]}set feature(e){this._latestFieldValues={...e==null?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:i,_latestFieldValues:n,feature:s}=this,a=new Set;for(const o of e)if(n[o]=s.getAttribute(o),i.has(o))for(const d of i.get(o))a.add(d);return this._evaluate([...a])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(Us))return this._evaluate([...this._fieldReferencesLookup.get(Us)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){var p;const{_fieldReferencesLookup:e,_fieldsAffectedLookup:i,executors:n,preserveFieldValuesWhenHidden:s}=this,a=new Map(this.fieldInputs.map(c=>[c.name,c])),o=s===!1,d=new Map(n.map(c=>[c,new Array]));for(const c of n){for(const h of c.fieldsUsed){xn(e,h,()=>new Set).add(c);const u=a.get(h);[u==null?void 0:u.valueExpressionExecutor,u==null?void 0:u.editableExpressionExecutor,o?(p=u==null?void 0:u.group)==null?void 0:p.visibilityExpressionExecutor:null,o?u==null?void 0:u.visibilityExpressionExecutor:null].filter(y=>y!=null&&y!==c).forEach(y=>{d.get(y).push(c),xn(i,y,()=>new Set).add(u)})}c.geometryUsed&&xn(e,Us,()=>new Set).add(c)}return d}async _evaluate(e){const i=new Map,{_dependencyGraph:n,_fieldsAffectedLookup:s,_latestFieldValues:a}=this;for(const d of e)dl(d,i,n);for(const[d,{resolver:p,dependencyPromises:c}]of i)Promise.all(c).then(async()=>{const[h,u]=this._makeContext(a);return d.executeAsync(h,u)}).then(()=>{if(s.has(d))for(const h of s.get(d))this._latestFieldValues[h.name]=h.value;p.resolve()},h=>{!h||Qa(h)||Go(h)||d.markStale(),p.reject(h)});const o=(await Promise.allSettled(Array.from(i.values(),({resolver:d})=>d.promise))).filter(d=>d.status==="rejected"&&!(Qa(d.reason)||Go(d.reason)));if(o.length>0){const d=new AggregateError(o,`One or more expression executions failed. First error message: ${o[0].reason}`);throw le.getLogger(this).error(d),d}}_makeContext(e){const[i,n]=this._baseContext,s=this.feature.clone();return s.attributes=e,[{...i,$feature:s},n]}get test(){}};r([l()],lt.prototype,"_asyncExecutors",null),r([l()],lt.prototype,"_baseContext",null),r([l()],lt.prototype,"feature",null),r([l({constructOnly:!0})],lt.prototype,"preserveFieldValuesWhenHidden",void 0),r([l()],lt.prototype,"executors",void 0),r([l()],lt.prototype,"fieldInputs",void 0),r([l()],lt.prototype,"arcadeContextInfo",void 0),lt=r([C("esri.widgets.FeatureForm.FormExpressionsManager")],lt);const dl=(t,e,i)=>{if(e.has(t))return;const n=un();e.set(t,{resolver:n,dependencyPromises:[]}),t.abort();const s=i.get(t);for(const a of s)dl(a,e,i),e.get(a).dependencyPromises.push(n.promise)},Go=t=>t&&typeof t=="object"&&"message"in t&&t.message==="Cancelled";let It=class extends rr{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.id=Ia().toString(),this.type="group"}initialize(){this.addHandles([k(()=>[this.visible,this.inputs],([e])=>{const{inputs:i}=this,n=!!e&&void 0;for(const s of i)Ji(s)&&(s.required=n)},{initial:!0,equals:(e,i)=>i[0]===e[0]&&i[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map(i=>k(()=>i.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",e)}get open(){return this.initialState==="expanded"}set open(e){this._override("open",e)}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(e=>e.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};r([l()],It.prototype,"id",void 0),r([l()],It.prototype,"initialState",null),r([l()],It.prototype,"inputs",null),r([l()],It.prototype,"open",null),r([l()],It.prototype,"type",void 0),r([l()],It.prototype,"visible",null),It=r([C("esri.widgets.FeatureForm.GroupInput")],It);const Qu=It,Xu=3;let H=class extends od{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([k(()=>({feature:this.feature,element:this.element,layer:this.layer}),i=>this._createRelationshipVM(i),K),Ne(()=>this.relatedLayer,"edits",()=>{var i;return(i=this._relationshipVM)==null?void 0:i.refresh()})])}destroy(){var e;(e=this._relationshipVM)==null||e.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:i,relationship:n}=this;if(!n||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:s,role:a}=n;return!(s==="one-to-one"&&i>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&a==="destination"&&i>0)&&e}get displayCount(){return this.element.displayCount??Xu}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){var e;return((e=this._relationshipVM)==null?void 0:e.featureCount)??0}get loaded(){var e;return((e=this._relationshipVM)==null?void 0:e.state)!=="loading"}get map(){return this._get("map")}set map(e){var i;e&&((i=this._relationshipVM)==null||i.set("map",e)),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var e;return(e=this._relationshipVM)==null?void 0:e.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var d;const{_relationshipVM:e,timeZone:i}=this;if(!((d=e==null?void 0:e.relatedFeatures)!=null&&d.length)||!(e!=null&&e.relatedLayer))return[];const{itemDescriptionFieldName:n,relatedFeatures:s,relatedLayer:a}=e,o=a&&"formTemplate"in a&&a.formTemplate?a.formTemplate.title:void 0;return s.map(p=>{let c;if(n){const h=p.getAttribute(n),u=a.fieldsIndex.get(n);if(u){const y=rd({values:[h],fields:[u],timeZone:i??void 0})[n];y!=null&&(c=y.toString())}}return{feature:p,description:c,title:o?Zs({label:o,attributes:p.attributes,fieldsIndex:a.fieldsIndex,timeZone:i}):void 0}}).toArray()}get relatedLayer(){var e;return(e=this._relationshipVM)==null?void 0:e.relatedLayer}get relatedLayerIsTable(){var e;return!!((e=this.relatedLayer)!=null&&e.isTable)}get relatedLayerAllowsAdds(){var n;const{relatedLayer:e}=this;if(!e||!this.relatedLayerAllowsEdits)return!1;const i=Jn(e);return!!((n=i==null?void 0:i.operations)!=null&&n.supportsAdd)}get relatedLayerAllowsEdits(){var n;const{relatedLayer:e}=this;if(!e)return!1;const i=Jn(e);return!!((n=i==null?void 0:i.operations)!=null&&n.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){var i;(i=this._relationshipVM)==null||i.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:i}=e;return i!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var e,i;return((e=this._relationshipVM)==null?void 0:e.state)==="loading"||((i=this._relationshipVM)==null?void 0:i.state)==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){var i;return(i=this._relationshipVM)==null?void 0:i.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){var h;const{feature:i,element:n,layer:s}=e;if((h=this._relationshipVM)==null||h.destroy(),!i||!n||!s)return;const{displayCount:a,map:o,orderByFields:d,relationshipId:p,showAllEnabled:c}=this;lr(s)&&(this._relationshipVM=new _p({graphic:i,displayCount:a,layer:s,map:o,orderByFields:d,relationshipId:p,showAllEnabled:c}))}};r([l()],H.prototype,"_relationshipVM",void 0),r([l()],H.prototype,"canAddRelatedFeature",null),r([l()],H.prototype,"displayCount",null),r([l()],H.prototype,"displayType",null),r([l()],H.prototype,"editable",null),r([l()],H.prototype,"featureCount",null),r([l()],H.prototype,"group",void 0),r([l()],H.prototype,"loaded",null),r([l()],H.prototype,"map",null),r([l()],H.prototype,"orderByFields",null),r([l()],H.prototype,"originHasValidKey",null),r([l()],H.prototype,"relationship",null),r([l()],H.prototype,"relationshipId",null),r([l()],H.prototype,"relatedFeatureInfos",null),r([l()],H.prototype,"relatedLayer",null),r([l()],H.prototype,"relatedLayerIsTable",null),r([l()],H.prototype,"relatedLayerAllowsAdds",null),r([l()],H.prototype,"relatedLayerAllowsEdits",null),r([l()],H.prototype,"showAllEnabled",null),r([l()],H.prototype,"showAllActionVisible",null),r([l({readOnly:!0})],H.prototype,"type",void 0),r([l()],H.prototype,"visible",null),r([l()],H.prototype,"updating",null),H=r([C("esri.widgets.FeatureForm.RelationshipInput")],H);const eh=H;let pa;const th=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function ih(t){return pa||await nh(),pa.parse(t)}async function nh(){const{Marked:t}=await E(()=>import("./marked.esm-DrK359eT.js"),[]),e=function({text:a}){return`<span style="text-decoration:line-through;">${a}</span>`},i=function({href:a,text:o,title:d}){return`<a${a!=null?` href="${a}"`:""}${d!=null?` title="${d}"`:""} target="_blank">${o??""}</a>`},n=()=>"",s={};for(const a of th)s[a]=n;pa=new t({renderer:{del:e,link:i,...s}})}let Me=class extends rr{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${Ia()}`,this.type="text",this._expressionReferences=new dr,this._expressionsUsed=new mo,this._fieldsUsed=new mo,this._literalParts=new Q,this._templateParts=new Q,this._updatingHandles=new xi}initialize(){const{rawText:e}=this;e?this.textFormat==="markdown"?this._updatingHandles.addPromise(ih(e).then(i=>this._initializeTextParts(i))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map(i=>{var n;return`${((n=this._expressionReferences.get(i))==null?void 0:n.lastEvaluatedValue)??""}`});return ld.sanitize(ah(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e==null?void 0:e.updating)}setExpressionExecutor(e,i){this._expressionReferences.set(Xa(e),i)}setFieldExecutor(e,i){this._expressionReferences.set(eo(e),i)}_initializeTextParts(e){const{fieldsIndex:i}=this,{literals:n,templates:s}=sh(e),a=[],o=[];for(let d=0;d<s.length;d++){const p=n[d],c=dd(s[d])[0];if(pd(c))this._expressionsUsed.add(cd(c)),this._expressionReferences.set(c,null),a.push(p),o.push(c);else if(ud(c)){this._expressionsUsed.add(c);const h=Xa(c);this._expressionReferences.set(h,null),a.push(p),o.push(h)}else if(i!=null&&i.has(c)){const h=i.normalizeFieldName(c);this._fieldsUsed.add(h);const u=eo(h);this._expressionReferences.set(u,null),a.push(p),o.push(u)}else n[d+1]=p.concat(c,n[d+1])}a.push(n.at(-1)),this._literalParts.addMany(a),this._templateParts.addMany(o)}};function sh(t){const e=/{[^{]+?}/g,i=[...t.matchAll(e)];let n=0;const s=[],a=[];for(const o of i){const d=o[0];s.push(t.slice(n,o.index)),a.push(d),n=o.index+d.length}return s.push(t.slice(n)),{literals:s,templates:a}}function ah(t,e){return e.reduce((i,n,s)=>i.concat(t.at(s),n),"").concat(t.at(-1))}r([l()],Me.prototype,"expressionsUsed",null),r([l()],Me.prototype,"fieldsIndex",null),r([l()],Me.prototype,"fieldsUsed",null),r([l()],Me.prototype,"group",void 0),r([l()],Me.prototype,"id",void 0),r([l()],Me.prototype,"rawText",null),r([l()],Me.prototype,"text",null),r([l()],Me.prototype,"textFormat",null),r([l()],Me.prototype,"type",void 0),r([l()],Me.prototype,"updating",null),Me=r([C("esri.widgets.FeatureForm.TextElementInput")],Me);const Ws=new Ai({attributes:{}}),oh={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"]},rh="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",yi="#JSAPI_CONTINGENT_VALUE_ANY_HASH",lh="#JSAPI_CONTINGENT_VALUE_NULL_HASH",pl="esri.widgets.FeatureForm.FeatureFormViewModel",cl=()=>le.getLogger(pl);let T=class extends hd(At.EventedAccessor){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=Ws.clone(),this._initialFeature=Ws.clone(),this._timeZone=null,this._updatingHandles=new xi,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1,this.hasPendingSubtypeChoice=!1}initialize(){const e=k(()=>{var s;return[this.layer,!!((s=this.layer)!=null&&s.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]},async([s,a])=>{s!=null&&(a?this._updatingHandles.addPromise(this._updateInputs()):s.load().catch(()=>{}))},{equals:([s,a,o,d,p,c],[h,u,y,g,m,v])=>s===h&&a===u&&o===y&&d===g&&p===m&&c===v,initial:!0}),i=k(()=>this._arcadeContextInfo,s=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=s,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())))}),n=k(()=>this.layer,s=>{const a=(s==null?void 0:s.type)==="subtype-sublayer"?s.parent:(s==null?void 0:s.type)==="feature"?s:null;a&&this.addResolvingPromise(Ku.createLoadedLayerContingentValuesCache(a).then(o=>{this._contingentValuesCache=o,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,i,n])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=Se(this._contingentValuesCache),(e=this.highlightHelper)==null||e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e,i;return new Map((i=(e=this.formTemplate)==null?void 0:e.expressionInfos)==null?void 0:i.map(n=>[n.name,n]))}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId)}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:i,layer:n,map:s,spatialReference:a,timeZone:o}=this;return{layer:Qn(n)?n:null,originalFeature:e,editType:i,map:s,spatialReference:a,timeZone:o}}get allFieldInputs(){return yd(this.inputs)}get allGroupInputs(){return this.inputs.filter(ki)}get allRelationshipInputs(){return md(this.inputs)}get _layerFieldsByName(){var e;return new Map((e=this.layer)==null?void 0:e.fields.map(i=>[i.name,i]))}get feature(){return this._get("feature")}set feature(e){const i=this._get("feature");this._featureClone=e?e.clone():Ws.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(n=>n.feature=e)):(this.inputs.forEach(n=>n.destroy()),this.inputs.length=0),i!==e&&(this.hasPendingSubtypeChoice=!1),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(i=>i.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){e===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:i}=this;return e!=null&&e.description&&i?Zs({label:e.description,attributes:this.getValues(),fieldsIndex:i.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:i}=this;return e!=null&&e.title&&i?Zs({label:e.title,attributes:this.getValues(),fieldsIndex:i.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,formDescription:i,formTitle:n}=this;return!(e||!i&&!n)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return(e=this.feature)!=null&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const i=this.allRelationshipInputs;if(e!=null&&e===this.relationshipId||i.forEach(n=>n.showAllEnabled=!1),e!=null){const n=i.find(s=>s.relationshipId===e);n&&(n.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e;return((e=this.layer)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return(e=this.layer)!=null&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return to;const i=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===gd?i||to:this._timeZone||fd}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:i})=>i)}findField(e){return this.allFieldInputs.find(i=>i.name===e)}getFieldValueOptionsForField(e,i){var d;const n=this.findField(e);if(!n)return[[],[],[]];const s=((d=n.domain)==null?void 0:d.type)==="coded-value"?n.domain.codedValues.map(({name:p,code:c})=>({name:p,value:c})):[],a=n.value==null||s.some(p=>p.value===n.value)?[]:[{name:`${n.value}`,value:n.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,i):[];if(o.length>0){const p=new Set(o.map(c=>c.value));return[o,s.filter(c=>!p.has(c.value)),a]}return[s,[],a]}getValue(e){var n;const i=(n=this.layer)==null?void 0:n.getField(e);if(i!=null)return this._featureClone.getAttribute(i.name)??null}setValue(e,i){const{_featureClone:n,strict:s}=this,a=this.findField(e);i=i===""?null:i,a&&n.getAttribute(e)!==i&&(a.value=i,s&&!a.valid||(this._afterValueChange(a),this._expressionsManager!=null&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([a.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,i=new Set(e.filter(a=>a.valid).map(({name:a})=>a)),n=e.filter(a=>!a.valid).map(({name:a})=>a),s=this.getValues();if(this.validateContingencyConstraints(s,{includeIncompleteViolations:!0}).length>0)for(const[a,o]of this.contingencyConstraintViolations.entries())o.type==="error"&&(i.delete(a),n.push(a));this.emit("submit",{valid:[...i],invalid:n,values:s})}validateContingencyConstraints(e,i){const{_contingentValuesCache:n}=this,s=new Map;if(this.contingencyConstraintViolations=s,n==null)return[];const{invalid:a,incomplete:o}=n.validateContingencyConstraints(e),d=[...a,...i!=null&&i.includeIncompleteViolations?o:[]];for(const p of d)for(const c of p.fieldGroup.fields)s.set(c,p);return d}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:i,_featureClone:n}=this;i&&(n.geometry=i.geometry,e!=null&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated())))}applySubtypeDefaults(e){const{defaultValues:i}=e,{allFieldInputs:n}=this;for(const{name:s}of n){const a=i[s];a!=null&&this.setValue(s,a)}}_emitChangeEvent({name:e,valid:i,value:n}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:n,valid:i})}async _updateInputs(){this._stopExpressions();const{_featureClone:e,_initialFeature:i,arcadeEditType:n,formTemplate:s,inputs:a,layer:o,timeZone:d}=this;if(!o)return;const p={arcadeEditType:n,feature:e,initialFeature:i,layer:o,timeZone:d},c=a.slice(),h=s!=null&&s.elements&&s.elements.length>0?await this._updateInputsUsingFormElements(c,s.elements,p):this._updateInputsUsingLayerFields(c,o==null?void 0:o.fields,p);this.inputs=h,await this._startExpressions()}async _updateInputsUsingFormElements(e,i,n){const s=new Map;for(const d of e)if(ki(d)){s.set(d.element,d);for(const p of d.inputs)p.element&&s.set(p.element,p)}else d.element&&s.set(d.element,d);const a=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:s,updatedElements:i.filter(No),sharedInitializationProperties:n,group:null,newExpressionExecutorPromises:a});for(const[d,p]of s.entries())s.delete(d),p.destroy();return await Promise.all(Array.from(a.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:i,updatedElements:n,sharedInitializationProperties:s,group:a,newExpressionExecutorPromises:o}=e,d=[];for(const p of n){const c=i.has(p),h=c?i.get(p):this._makeInputFromElement(p,s,a);if(h){if(d.push(h),await ue(()=>!h.updating),this._assignExpressionExecutors(h,p,o),c)if(i.delete(p),ki(h)){const{feature:u,timeZone:y}=s;h.set({feature:u,timeZone:y})}else if(Ks(h)){const u=this.relationshipId===p.relationshipId;h.set(s),h.set({map:this.map,showAllEnabled:u})}else h.set(s);if(io(p)){const u=p.elements.filter(y=>No(y));h.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:u,sharedInitializationProperties:s,group:h,newExpressionExecutorPromises:o})}}}return d}_updateInputsUsingLayerFields(e,i,n){var o,d;if(!Array.isArray(i))return cl().warn(this.declaredClass,"No attribute fields found."),[];const s=new Map;for(const p of e)if(ki(p)){for(const c of p.inputs)c.destroy();p.inputs.length=0,p.destroy()}else Ks(p)?p.destroy():Ji(p)&&(p.element!==null?p.destroy():s.set(p.field,p));const a=[];for(const p of i){const c=((o=n.feature)==null?void 0:o.getAttribute(p.name))??null,h=s.get(p)??new no({field:p,preservesValueWhenHidden:(d=this.formTemplate)==null?void 0:d.preserveFieldValuesWhenHidden});a.push(h.set({...n,value:c})),s.delete(p)}for(const[p,c]of s.entries())s.delete(p),c.destroy();return a}_resetFieldInputValues(e){for(const i of this.allFieldInputs)i.value=e.getAttribute(i.name)}_makeInputFromElement(e,i,n){return io(e)?dh(e,i):vd(e)?this._makeFieldInputFromElement(e,i,n):_d(e)?this._makeRelationshipInputFromElement(e,i,n):wd(e)?ph(e,i):pr()}_makeFieldInputFromElement(e,i,n){var u;const{arcadeEditType:s,feature:a,initialFeature:o,layer:d,timeZone:p}=i,{fieldName:c}=e,h=c&&this._layerFieldsByName.get(c);return h?new no({arcadeEditType:s,element:e,field:h,value:(a==null?void 0:a.getAttribute(e.fieldName))??null,feature:a,initialFeature:o,layer:d,group:n,preservesValueWhenHidden:(u=this.formTemplate)==null?void 0:u.preserveFieldValuesWhenHidden,timeZone:p}):null}_makeRelationshipInputFromElement(e,i,n=null){const{map:s}=this,{feature:a,layer:o,timeZone:d}=i,p=new eh({element:e,feature:a,group:n,layer:o,map:s,timeZone:d});return p.addHandles(Ne(()=>p.relatedLayer,"edits",()=>{var c;return(c=this._expressionsManager)==null?void 0:c.evaluateAsyncExpressions()})),p}_assignExpressionExecutors(e,i,n){var o;const s=oh[i.type],a=[];for(const d of s){const p=`${d}Executor`;if(e[p]){this._useExecutor(e[p]);continue}const c=i[d];if(c!=null&&c!==""){const h=((o=this._expressionInfosLookup.get(c))==null?void 0:o.expression)??c;a.push(this._getOrCreateExecutorForExpression(h,n).then(u=>{e[p]=this._useExecutor(u)}))}}return cr(e)&&a.push(...this._assignTextElementExpressionExecutors(e,n)),a}_assignTextElementExpressionExecutors(e,i){const{_expressionInfosLookup:n}=this,s=[];for(const a of e.expressionsUsed){const o=n.get(a);o!=null?s.push(this._getOrCreateExecutorForExpression(o.expression,i).then(d=>e.setExpressionExecutor(a,this._useExecutor(d)))):le.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${a}'`)}for(const a of e.fieldsUsed){const o=`return $feature['${a}'];`;s.push(this._getOrCreateExecutorForExpression(o,i).then(d=>e.setFieldExecutor(a,this._useExecutor(d))))}return s}async _getOrCreateExecutorForExpression(e,i){const{_expressionExecutorLookup:n}=this;if(n.has(e))return n.get(e);if(i.has(e))return i.get(e);const s=Ju(e,this.layer);i.set(e,s);const a=await s;return n.set(e,a),a}_createExpressionsManager(e){const{_arcadeContextInfo:i,_featureClone:n,allFieldInputs:s,formTemplate:a}=this;this._expressionsManager=new lt({executors:e,feature:n,arcadeContextInfo:i,fieldInputs:s,preserveFieldValuesWhenHidden:(a==null?void 0:a.preserveFieldValuesWhenHidden)===!0})}async _startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())}_stopExpressions(){this._expressionsManager=Se(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){var h;const{name:i,value:n}=e,{_featureClone:s,formTemplate:a,layer:o}=this;if(!o)return;const d=s.getAttribute(i);s.setAttribute(i,n);const{typeFieldName:p,types:c}=qs(o);if((e.isSubtypeField||i===p)&&n!==d){if(o.type==="subtype-sublayer"){const y=(h=o.parent)==null?void 0:h.findSublayerForFeature(s);this.feature&&(this.feature.sourceLayer=y),s.sourceLayer=y}const u=new Set;for(const y of c)if(y.domains&&typeof y.domains=="object")for(const g of Object.keys(y.domains))u.add(g);for(const y of u){const g=this.findField(y);g&&g.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(a!=null){const{description:u,title:y}=a;y&&so(y,i)&&this.notifyChange("formTitle"),u&&so(u,i)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const i of this.allFieldInputs)i.value!==e.getAttribute(i.name)&&this._afterValueChange(i)}_joinContingentValues(){const e=this._contingentValuesCache;if(e==null)return[];const{typeFieldName:i}=qs(this.layer),n=i?this.getValue(i):null,s=[];for(const d of e.fieldGroups){const{contingencies:p,fields:c,name:h}=d,u=[];for(const y of p)y.isRetired||y.subtype!=null&&y.subtype.code!==n||u.push({values:y.values});u.length>0&&s.push({name:h,fields:c,contingencies:u})}const[a,o]=this._generateJoinPlan(s);return[...a.flatMap(d=>this._joinFieldGroupContingencies(d)),...o.flatMap(d=>d.contingencies)]}_generateJoinPlan(e){const i=new Map,n=[],s=new Set;for(const c of e)for(const h of c.fields)if(i.has(h)){const u=i.get(h),y=c,g=[u.name,y.name].sort().join("|");if(s.has(g))continue;n.push([u,y]),s.add(g),i.set(h,y)}else i.set(h,c);const a=new Set(n.flat()),o=new Set(e);for(const c of a)o.delete(c);const d=new Map,p=new Map;for(const c of new Set(n.flat())){const h=Symbol(c.name);d.set(h,new Set([c])),p.set(c,h)}for(const[c,h]of n){const u=p.get(c),y=p.get(h);if(u===y)continue;const g=d.get(u),m=d.get(y);for(const v of m)g.add(v),p.set(v,u);d.delete(y)}return[[...d.values()].map(c=>[...c]),[...o]]}_joinFieldGroupContingencies(e){var c,h;const i=e.slice(),n=i.shift();let s=i.shift(),a=this._generateJoinKey(n.fields,s.fields),o=new Set([...n.fields,...s.fields]),d=new Map;for(const u of n.contingencies){const[y]=this._hashContingency(u,a.codedValueFields,!0);d.has(y)?(c=d.get(y))==null||c.push(u):d.set(y,[u])}for(;i.length>0;){const u=new Map,y=i.shift(),g=this._generateJoinKey(o,y.fields);for(const m of s.contingencies){const[v,_]=this._hashContingency(m,a.codedValueFields),w=_?this._findMatchingContingenciesWithAnyHashMask(d,v):d.get(v);if(d.has(yi)&&(w==null||w.push(...this._findMatchingContingenciesContainingAny(m,d.get(yi),a.codedValueFields))),w!=null)for(const b of w){const M=a.rangeFields.length>0?this._joinContingenciesWithRangeDomains(b,m,a.rangeFields):this._joinContingencies(b,m);if(M==null)break;const[I]=this._hashContingency(M,g.codedValueFields,!0);u.has(I)?(h=u.get(I))==null||h.push(M):u.set(I,[M])}}d=u,s=y,a=g,o=new Set([...o,...s.fields])}const p=[];for(const u of s.contingencies){const[y,g]=this._hashContingency(u,a.codedValueFields),m=g?this._findMatchingContingenciesWithAnyHashMask(d,y):d.get(y);if(d.has(yi)&&m.push(...this._findMatchingContingenciesContainingAny(u,d.get(yi),a.codedValueFields)),m!=null)for(const v of m){const _=a.rangeFields.length>0?this._joinContingenciesWithRangeDomains(v,u,a.rangeFields):this._joinContingencies(v,u);_!=null&&p.push(_)}}return p}_joinContingencies(e,i){const n={values:{...e.values,...i.values}};for(const[s,a]of Object.entries(n.values))a.objectType==="any"&&e.values[s]!=null&&(n.values[s]=e.values[s]);return n}_joinContingenciesWithRangeDomains(e,i,n){const s=this._joinContingencies(e,i);for(const a of n){const o=e.values[a],d=i.values[a],{leftIsNull:p,rightIsNull:c,bothAreNull:h,leftIsAny:u,rightIsAny:y,bothAreAny:g,leftIsRange:m,rightIsRange:v}=this._compareObjectTypes(o.objectType,d.objectType);if(h||g)continue;if(p&&y||c&&u){s.values[a]=new ae({objectType:"null"});continue}if(p&&v||c&&m)return null;u?(o.minValue=-1/0,o.maxValue=1/0):y&&(d.minValue=-1/0,d.maxValue=1/0);const _=Math.max(o.minValue,d.minValue),w=Math.min(o.maxValue,d.maxValue);if(_>w)return null;s.values[a]=new ae({objectType:"range",minValue:_,maxValue:w})}return s}_findMatchingContingenciesContainingAny(e,i,n){return i.filter(s=>n.every(a=>{var p,c;const o=s.values[a],d=e.values[a];return o.objectType==="any"||d.objectType==="any"||((p=o.codedValue)==null?void 0:p.code)===((c=d.codedValue)==null?void 0:c.code)}))}_findMatchingContingenciesWithAnyHashMask(e,i){const n=RegExp(`${i}$`),s=[];for(const[a,o]of e){if(a===yi)break;n.test(a)&&s.push(...o)}return s}_generateJoinKey(e,i){var h;const n=Array.isArray(e)?new Set(e):e,s=Array.isArray(i)?new Set(i):i,a=n.size<s.size?n:s,o=a===n?s:n,{feature:d}=this,p=new Set,c=new Set;for(const u of a)if(o.has(u)){const y=(h=this.layer)==null?void 0:h.getFieldDomain(u,d?{feature:d}:void 0);if(y==null)continue;switch(y.type){case"coded-value":p.add(u);break;case"range":c.add(u)}}return{codedValueFields:[...p],rangeFields:[...c]}}_contingencyIsValid(e,i){const n={};for(const{name:s,value:a}of this.allFieldInputs)this.fieldsWithContingentValues.has(s)&&a!=null&&s!==e&&(n[s]=a);return Object.entries(n).every(([s,a])=>!i.values.hasOwnProperty(s)||bd(a,i.values[s]))}_getContingentValueOptionsForField(e,i){const n=this.joinedContingentValues.slice(),s=new Map,a={code:"",name:i??"No value"};for(const o of n){const d=o.values[e];if((d==null?void 0:d.objectType)==="code"||(d==null?void 0:d.objectType)==="null"){const{code:p,name:c}=d.codedValue&&d.objectType!=="null"?d.codedValue:a;!s.has(p)&&this._contingencyIsValid(e,o)&&s.set(p,{name:c,value:p})}}return[...s.values()]}_hashContingency(e,i,n=!1){var o;if(i.length<1)return[rh,!1];const s=[];let a=!1;for(const d of i){const p=e.values[d];if(p.objectType==="any"){if(n)return[yi,!0];a=!0,s.push(`${d}:.*`)}else p.objectType==="null"?s.push(`${d}:${lh}`):s.push(`${d}:${(o=p.codedValue)==null?void 0:o.code}`)}return[s.sort().join("&"),a]}_compareObjectTypes(e,i){return{leftIsNull:e==="null",rightIsNull:i==="null",bothAreNull:e==="null"&&i==="null",leftIsAny:e==="any",rightIsAny:i==="any",bothAreAny:e==="any"&&i==="any",leftIsRange:e==="range",rightIsRange:i==="range"}}get test(){return{featureClone:this._featureClone}}};function No(t){return t.type==="field"||t.type==="group"||t.type==="relationship"||t.type==="text"||(cl().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${t.label} has unsupported type '${t.type}'`),!1)}function dh(t,e){const{feature:i,layer:n}=e;return new Qu({element:t,inputs:[],feature:i,layer:n})}function ph(t,e,i=null){const{feature:n,layer:s,timeZone:a}=e;return new Me({element:t,feature:n,group:i,layer:s,timeZone:a})}r([l()],T.prototype,"_expressionInfosLookup",null),r([l()],T.prototype,"_featureClone",void 0),r([l()],T.prototype,"_timeZone",void 0),r([l()],T.prototype,"activeRelationshipInput",null),r([l()],T.prototype,"_arcadeContextInfo",null),r([l()],T.prototype,"allFieldInputs",null),r([l()],T.prototype,"allGroupInputs",null),r([l()],T.prototype,"allRelationshipInputs",null),r([l()],T.prototype,"_layerFieldsByName",null),r([l()],T.prototype,"arcadeEditType",void 0),r([l()],T.prototype,"contingencyConstraintViolations",void 0),r([l()],T.prototype,"disabled",void 0),r([l()],T.prototype,"feature",null),r([l()],T.prototype,"fieldsWithContingentValues",null),r([l({type:Cp})],T.prototype,"formTemplate",null),r([l()],T.prototype,"formDescription",null),r([l()],T.prototype,"formTitle",null),r([l()],T.prototype,"formHeaderVisible",null),r([l()],T.prototype,"highlightHelper",void 0),r([l()],T.prototype,"inputs",void 0),r([l()],T.prototype,"joinedContingentValues",null),r([l()],T.prototype,"layer",null),r([l()],T.prototype,"map",void 0),r([l()],T.prototype,"relatedRecordCallbacks",void 0),r([l()],T.prototype,"relationshipId",null),r([l()],T.prototype,"spatialReference",null),r([l()],T.prototype,"state",null),r([l()],T.prototype,"strict",void 0),r([l()],T.prototype,"submittable",null),r([l()],T.prototype,"timeZone",null),r([l()],T.prototype,"updating",null),r([l()],T.prototype,"valid",null),r([l()],T.prototype,"hasPendingSubtypeChoice",void 0),r([l()],T.prototype,"getValues",null),r([l()],T.prototype,"submit",null),r([l()],T.prototype,"test",null),T=r([C(pl)],T);const Ua=T,Yt="data-field-name";let V=class extends Fi{constructor(e,i){super(e,i),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(n=>{n.length&&n[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new Ua,this._onShowAllRelatedRecordsClick=n=>{const{feature:s,relatedRecordCallbacks:a}=this;s&&(a!=null&&a.showAllRelatedRecords)&&a.showAllRelatedRecords({parentFeature:s,relationshipId:n})},this._onAddRelatedRecordsClick=(n,s)=>{const{feature:a,relatedRecordCallbacks:o}=this;a&&(o!=null&&o.addRelatedRecord)&&o.addRelatedRecord({parentFeature:a,relatedLayer:s,relationshipId:n})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([k(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),ue(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(e==null?void 0:e.name)||null,this._attemptFocusOnNextRender=!0})}),k(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[i]=e.invalid;e.invalid.forEach(n=>this._inputsWithChanges.add(n)),this._focusedFieldName=i,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),k(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])}loadDependencies(){return ze({block:()=>E(()=>import("./calcite-block-CV5TdCEP.js"),__vite__mapDeps([135,1,2,136,137,138,139,140,141,142,143,144,145,146,147])),button:()=>E(()=>import("./calcite-button-OwHWnVyW.js"),__vite__mapDeps([148,1,2])),combobox:()=>E(()=>import("./calcite-combobox-DdJJS4cJ.js"),__vite__mapDeps([149,150,1,2,151,152,140,139,138,153,154,155,156,136,157])),"combobox-item":()=>E(()=>import("./calcite-combobox-item-Crmu17Dx.js"),__vite__mapDeps([158,156,1,2,136,154])),"combobox-item-group":()=>E(()=>import("./calcite-combobox-item-group-DKcqCP6X.js"),__vite__mapDeps([159,160,1,2,154])),icon:()=>E(()=>import("./calcite-icon-B5wvyzgm.js"),__vite__mapDeps([161,1,2])),input:()=>E(()=>import("./calcite-input-C30oMPBL.js"),__vite__mapDeps([162,163,1,2,153,164,157,165])),"input-date-picker":()=>E(()=>import("./calcite-input-date-picker-6-XYFwB7.js"),__vite__mapDeps([166,1,2,139,140,138,137,145,153,164,157,167,165])),"input-message":()=>E(()=>import("./calcite-input-message-C_2xmbqm.js"),__vite__mapDeps([168,157,1,2])),"input-number":()=>E(()=>import("./calcite-input-number-CqPBhxk_.js"),__vite__mapDeps([169,170,1,2,153,164,157,165])),"input-time-picker":()=>E(()=>import("./calcite-input-time-picker-B8wBVmEV.js"),__vite__mapDeps([171,1,2,145,172,153,164,141,157,167,165,144,139,140,138,137,146])),"input-time-zone":()=>E(()=>import("./calcite-input-time-zone-BMVnFr1B.js"),__vite__mapDeps([173,1,2,155,150,151,152,140,139,138,153,154,156,136,157,160])),label:()=>E(()=>import("./calcite-label-CXLoAlD_.js"),__vite__mapDeps([174,1,2])),list:()=>E(()=>import("./calcite-list-DEz7lVXs.js"),__vite__mapDeps([175,1,2,176,177,152,140,163,153,164,157,165])),"list-item":()=>E(()=>import("./calcite-list-item-BLSA8Adn.js"),__vite__mapDeps([178,1,2,177,176,141,147])),loader:()=>E(()=>import("./calcite-loader-Ce47wHPj.js"),__vite__mapDeps([179,1,2])),notice:()=>E(()=>import("./calcite-notice-BhTM-Xuv.js"),__vite__mapDeps([180,1,2,136,181,138])),"radio-button":()=>E(()=>import("./calcite-radio-button-SzL8DcRw.js"),__vite__mapDeps([182,1,2,143])),"radio-button-group":()=>E(()=>import("./calcite-radio-button-group-DokW4NJz.js"),__vite__mapDeps([183,1,2,153,157])),switch:()=>E(()=>import("./calcite-switch-DiS6Xp-u.js"),__vite__mapDeps([184,1,2])),"text-area":()=>E(()=>import("./calcite-text-area-CqLGaXFq.js"),__vite__mapDeps([185,1,2,153,164,157,186,140]))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _subtypes(){return Ed(this.layer)}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{var i,n;(n=(i=this._prompt)==null?void 0:i.cancel)==null||n.call(i),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return f("div",{class:this.classes(P.base,di.widget,di.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return f("div",null,f("form",{class:P.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?f(ur,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const i=e.formTitle!=null&&f(an,{key:"title",level:this.headingLevel},e.formTitle),n=e.formDescription!=null&&f("p",{class:P.description,key:"description"},e.formDescription);return f("div",{class:P.formHeader},i,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.inputs.filter(Fe).filter(i=>i.visible).map(i=>this._renderInput(i))}_renderInput(e){return ki(e)?this._renderGroup(e):Ji(e)?this._renderLabeledField(e):Ks(e)?this._renderRelationshipInput(e):cr(e)?this._renderTextElementInput(e):void 0}_renderDescriptionOrEmpty(e,i){return e==null?null:f("div",{class:this.classes(P.description),id:i},e)}_renderGroup(e){const{disabled:i,formTemplate:n,headingLevel:s}=this,{description:a,id:o,inputs:d,label:p,open:c}=e,h=d.filter(m=>m.visible),u=this.viewModel.findField(this._focusedFieldName),y=(u==null?void 0:u.group)===e,g=this.groupDisplay==="sequential";return f("calcite-block",{class:this.classes(P.group,g?P.groupSequential:null,y?P.groupActive:null,i?P.inputDisabled:null),collapsible:!0,"data-group":e,description:a||void 0,disabled:i,heading:`${p}`,headingLevel:n!=null&&n.title?Qi(s):s,id:o,key:o,open:c,onCalciteBlockToggle:({target:m})=>this._onGroupToggle(m,e)},h.map(m=>this._renderInput(m)))}_getFocusableInput(e,i){const n=kd(this.viewModel.inputs);let s;if(e==="backward"&&n.reverse(),i)if(ki(i)){const a=i.inputs.find(o=>o.visible);s=a?n.indexOf(a):0}else{let a;if($s(i)&&!i.group.open){const o=i.group.inputs.filter(Ji);a=e==="forward"?o[o.length-1]:o[0]}else a=i;s=n.indexOf(a)+1}else s=0;for(let a=s;a<n.length;a++){const o=n[a];if(o.visible&&Ji(o))return o}return null}_renderLabeledField(e){var c;const{dataType:i,feature:n,label:s,layer:a,required:o}=e,d={"aria-label":o?Wt(this.messages.requiredFieldLabel,{name:s}):s,class:P.label,key:`${a.id}-${n.uid}-${e.name}`},p=[f("div",{class:P.labelTextContent,key:"labelTextContainer"},s,o?f("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),i!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return i==="date"&&((c=e.domain)==null?void 0:c.type)!=="coded-value"?f("label",{...d},p):f("calcite-label",{...d},p)}_renderFieldInput(e){const{dataType:i,domain:n,inputType:s,name:a}=e,o=this.getCommonInputProps(e);if((n==null?void 0:n.type)==="coded-value"){const d=this.viewModel.getFieldValueOptionsForField(a,this.messages.empty);return s!=="switch"||e.hasInvalidSwitchValue?s==="radio-buttons"?this._renderRadioButtonComponents(e,d.flat(),o):this._renderComboBoxComponent(e,d,o):this._renderSwitchComponent(e,o)}return s==="datetime-picker"||i==="date"?this._renderDateComponents(e,o):i==="number"?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,i){return e.inputType==="text-area"?i.readOnly?f("calcite-input",{...i,loading:e.updating,type:"textarea",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)}):f("calcite-text-area",{...i,resize:"vertical",onCalciteTextAreaInput:n=>this._saveValueFromComponent(n.target)}):f("calcite-input",{...i,loading:e.updating,type:"text",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)})}_renderNumberComponent(e,i){return f("calcite-input-number",{...i,integer:Cd(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:n=>this._saveValueFromComponent(n.target)})}_renderDateComponents(e,i){const{field:n}=e;switch(n.type){case"date":return this._renderDateFieldComponents(e,i);case"date-only":return this._renderDateOnlyFieldComponent(e,i);case"time-only":return this._renderTimeOnlyFieldComponent(e,i);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,i);default:return this._renderReadOnlyComponent(e,Id(n,i.value,{timeZone:this.timeZone,...Md(n)}))}}_renderDateOnlyFieldComponent(e,i){const{range:n,valid:s,value:a}=e,{class:o,key:d,readOnly:p}=i,{rawMax:c,rawMin:h}=n;return f("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,class:o,"data-date-part":"date","data-field-name":i[Yt],key:`${d}-date-input`,max:ao(c)?c:void 0,min:ao(h)?h:void 0,numberingSystem:wn,onblur:u=>{this._focusedFieldName=null,this._saveValueFromDateComponent(u.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:p,value:a!=null?`${a}`:void 0,onCalciteInputDatePickerChange:u=>this._saveValueFromDateComponent(u.target)})}_renderTimeOnlyFieldComponent(e,i){const{valid:n,value:s}=e,{class:a,key:o,readOnly:d}=i;return f("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:a,"data-date-part":"time","data-field-name":i[Yt],key:`${o}-time-input`,numberingSystem:wn,onblur:p=>{this._focusedFieldName=null,this._saveValueFromDateComponent(p.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:d,step:e.timeStep,value:s!=null?`${s}`:void 0,onCalciteInputTimePickerChange:p=>this._saveValueFromDateComponent(p.target)})}_renderTimestampOffsetFieldComponents(e,i){const{name:n,range:s,timeZone:a,valid:o,value:d}=e,{class:p,key:c,readOnly:h}=i,{rawMax:u,rawMin:y}=s,g={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:wn,overlayPositioning:"fixed",readOnly:h,[Yt]:n,onfocus:this._onComponentFocus},m=bn(u,a),v=bn(y,a),_=bn(d,a);return f("div",{class:P.dateInputContainer,key:`${c}-date-time-container`},f("calcite-input-date-picker",{...g,class:p,"data-date-part":"date",key:`${c}-date-input`,max:(m==null?void 0:m.date)??void 0,min:(v==null?void 0:v.date)??void 0,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},value:_.date??void 0,onCalciteInputDatePickerChange:w=>this._saveValueFromDateComponent(w.target)}),f("calcite-input-time-picker",{...g,class:p,"data-date-part":"time",key:`${c}-time-input`,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},step:e.timeStep,value:_.time??void 0,onCalciteInputTimePickerChange:w=>this._saveValueFromDateComponent(w.target)}),e.includeTimeOffset?f("calcite-input-time-zone",{...g,class:p,"data-date-part":"timeZone",disabled:h,key:`${c}-timezone-input`,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},value:_.timeZoneOffset??"0",onCalciteInputTimeZoneChange:w=>this._saveValueFromDateComponent(w.target)}):null)}_renderDateFieldComponents(e,i){const{includeTime:n,name:s,valid:a,value:o}=e,{class:d,key:p,max:c,min:h,readOnly:u}=i,{timeZone:y}=this,g={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!a,numberingSystem:wn,overlayPositioning:"fixed",readOnly:u,[Yt]:s,onfocus:this._onComponentFocus},m=En(o,y),v=En(c,y),_=En(h,y);return f("div",{class:P.dateInputContainer,key:`${p}-date-time-container`},f("calcite-input-date-picker",{...g,class:d,"data-date-part":"date",key:`${p}-date-input`,max:(v==null?void 0:v.date)??void 0,min:(_==null?void 0:_.date)??void 0,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},value:m.date??void 0,onCalciteInputDatePickerChange:w=>this._saveValueFromDateComponent(w.target)}),n?f("calcite-input-time-picker",{...g,class:d,"data-date-part":"time",key:`${p}-time-input`,onblur:w=>{this._focusedFieldName=null,this._saveValueFromDateComponent(w.target)},step:1,value:m.time??void 0,onCalciteInputTimePickerChange:w=>this._saveValueFromDateComponent(w.target)}):null)}_renderReadOnlyComponent(e,i){const n=this.getCommonInputProps(e);return f("calcite-input",{...n,class:this.classes(P.fieldInput,P.inputDisabled),readOnly:!0,type:"text",value:i!=null?`${i}`:n.value})}_renderComboBoxComponent(e,i,n){const{value:s,name:a}=e,{viewModel:o,_inputsWithChanges:d}=this,p=o.arcadeEditType==="INSERT",c=d.has(a),h=s==null&&(!p||c),u=p&&e.showNoValueOptionEnabled&&!c?()=>{}:n.onblur;return f("calcite-combobox",{...n,allowCustomValues:!1,clearDisabled:!0,disabled:n.readOnly,onblur:u,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:y})=>{h&&y.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(y):e.isSubtypeField&&y.selectedItems.length===0?y.value=`${e.value}`:this._saveValueFromComponent(y)}},this.renderComboboxOptionsList(e,i))}renderComboboxOptionsList(e,i){const{value:n,name:s}=e,{messages:a,messagesTemplates:o,viewModel:d,_inputsWithChanges:p}=this,[c,h,u]=i.map(_=>_.map(({name:w,value:b})=>f("calcite-combobox-item",{key:`#${b}`,selected:n===b,textLabel:w,value:`${b}`}))),y=[];h.length>0&&y.push(f("calcite-combobox-item-group",{key:"other",label:o.other},h)),u.length>0&&y.push(f("calcite-combobox-item-group",{key:"unsupported",label:a.subtypes.unsupportedDomainGroupTitle},u)),y.length>0?y.unshift(f("calcite-combobox-item-group",{key:"recommended",label:a.recommended},c)):y.push(...c);const g=d.arcadeEditType==="INSERT",m=p.has(s),v=n==null&&(!g||m);return e.showNoValueOptionEnabled&&y.unshift(f("calcite-combobox-item",{key:"empty-option",selected:v,textLabel:e.showNoValueLabel||a.empty,value:""})),y}_renderRadioButtonComponents(e,i,n){const{name:s,value:a}=e,o=i.map(({name:d,value:p})=>this._renderRadioButtonComponent({key:d,label:d,name:s,value:p,selected:p===a,props:n}));if(e.showNoValueOptionEnabled){const d="",p=e.showNoValueLabel||this.messages.empty,c=a===d||a===null;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:p,name:s,value:d,selected:c,props:n}))}return f("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:P.inputRadioGroup,"data-field-name":n[Yt],key:`${n.key}-radio-group`,layout:"vertical",name:n.key,required:n.required},o)}_renderSwitchComponent(e,i){const{value:n}=e,s=!!oo(e.element,"switch")&&n===e.element.input.onValue;return f("calcite-switch",{...i,checked:s,class:P.inputSwitch,disabled:i.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:a=>this._saveValueFromComponent(a.target)})}_renderRadioButtonComponent({key:e,name:i,value:n,selected:s,label:a,props:o}){return f("calcite-label",{class:P.inputRadioLabel,key:e,layout:"inline"},f("calcite-radio-button",{...o,afterCreate:void 0,afterUpdate:void 0,checked:s,class:P.inputRadio,disabled:o.readOnly,name:i,onblur:()=>{this._focusedFieldName=null},value:n,onCalciteRadioButtonChange:({target:d})=>{d.checked&&this._saveValueFromComponent(d)}}),a)}_renderAuxiliaryText(e){const i=e.name,n=this._inputsWithChanges.has(i)&&!e.valid?Td(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(i)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return n!=null?f("calcite-input-message",{icon:!0,status:"invalid"},n):this._inputsWithChanges.has(i)&&e.valueIsOutOfDomain?f("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:i,relationshipId:n,showAllActionVisible:s}=e,{relatedRecordCallbacks:a}=this;if(!s||!(a!=null&&a.showAllRelatedRecords))return;const o=this.messages;return f("calcite-list-item",{description:Wt(o.totalCount,{count:i}),label:o.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(n)},f("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:i,relationshipId:n,relatedLayer:s}=e,{messages:a,relatedRecordCallbacks:o}=this;if(i&&(o!=null&&o.addRelatedRecord)&&s)return f("calcite-button",{alignment:"center",appearance:"outline-fill",class:P.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${n}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(n,s)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?a.addRecord:a.addFeature)}_renderRelatedRecordListItem(e,i){const{feature:n,description:s,title:a}=e,{feature:o,relatedRecordCallbacks:d}=this,{highlightHelper:p}=this.viewModel,c=()=>{p==null||p.removeAll(),d!=null&&d.editRelatedRecord&&o&&d.editRelatedRecord({parentFeature:o,relationshipId:i,relatedFeature:n})},h=p?()=>p.add(n):void 0,u=p?()=>p.remove(n):void 0;return f("calcite-list-item",{bind:this,description:s,key:`${i}-${n.uid}`,label:a,onclick:c,onmouseenter:h,onmouseleave:u,value:a},f("calcite-icon",{icon:$d(n),slot:"content-start"}),f("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:i,relationshipId:n,showAllEnabled:s}=e,a=s?null:this._renderDescriptionOrEmpty(e.description),o=i>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return f("calcite-label",{class:this.classes(P.label,P.relatedRecordsLabel),key:`relationship-${n}-container`},f("div",null,this._renderRelatedRecordsHeaderContainer(e),a,o),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var n;const i=e.updating||!e.loaded;return f("div",{class:P.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},f("span",null,e.label),i?f("calcite-loader",{inline:!0,key:"loader",label:(n=this.messagesCommon)==null?void 0:n.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:i}=e;return f("calcite-list",{class:P.relatedRecordsList},e.relatedFeatureInfos.map(n=>this._renderRelatedRecordListItem(n,i)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var c,h,u;const{messages:i}=this,n=e.relatedLayerIsTable?i.noOriginKeyRecord:i.noOriginKeyFeature,s=(c=e.relationship)==null?void 0:c.keyField,a=this.viewModel.findField(s),o=(h=e.layer)==null?void 0:h.fieldsIndex.get(s),d=(a==null?void 0:a.label)||(o==null?void 0:o.alias)||s,p=Wt(n,{relatedLayerName:(u=e.relatedLayer)==null?void 0:u.title,originKeyField:d});return f("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},f("div",{slot:"message"},p))}_renderNoRelatedRecordsNotice(){return f("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},f("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if((e=this.viewModel.activeRelationshipInput)!=null&&e.showAllEnabled)return f("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:P.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return f("div",{class:P.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:i}=this,{editable:n,hint:s,label:a,maxLength:o,minLength:d,name:p,range:{max:c,min:h},required:u,valid:y,value:g}=e,m=this._inputsWithChanges.has(p),v=!n||i;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":y?"false":"true",class:this.classes(P.fieldInput,v?P.inputDisabled:null),status:m&&!y?"invalid":"idle",key:p,label:a,max:c??void 0,min:h??void 0,maxLength:o>-1?o:void 0,minLength:d>-1?d:void 0,placeholder:s??void 0,readOnly:v,required:u,value:g==null?"":`${g}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[Yt]:p}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(Yt))}_afterDateComponentCreate(e){const i=this._getFieldInputFromHTMLElement(e),n=e.dataset.datePart,s=this._dateComponentMap.get(i.name);if("valueAsDate"in e&&e.value!=null){const a=new ResizeObserver(()=>{switch(e.value=void 0,i.field.type){case"date":e.value=En(i.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=bn(i.value,this.timeZone).date??"";break;default:e.value=`${i.value}`}a.unobserve(e)});a.observe(e)}if(s!=null)switch(n){case"date":s.date=e;break;case"time":s.time=e;break;case"timeZone":s.timeZone=e}else this._dateComponentMap.set(i.name,{[n]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const i=this._getFieldInputFromHTMLElement(e);Sd(i)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const i=e.selectedItem,n=e.querySelector("calcite-radio-button"),s=i||n;s&&this._afterComponentCreateOrUpdate(s)}_afterComponentCreateOrUpdate(e){const{viewModel:i}=this,n=this._getFieldInputFromHTMLElement(e),s=i.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&s===n&&(this._attemptFocusOnNextRender=!1,$s(n)&&(n.group.open=!0),hr(e))}_onComponentFocus(e){const i=e.target,n=this._getFieldInputFromHTMLElement(i);this._focusedFieldName=n.name}_onComponentBlur(e){const i=e.target;this._focusedFieldName=null,this._saveValueFromComponent(i)}_saveValueFromDateComponent(e){const{timeZone:i}=this,n=this._getFieldInputFromHTMLElement(e),s=n.field.type,{name:a,range:o}=n,d=this._dateComponentMap.get(a);if(!d)return;let p=this.viewModel.getValue(a),c=null;s==="date-only"?c=Array.isArray(e.value)?e.value[0]:e.value:s==="time-only"?(p=ro(p),c=ro(e.value)):c=s==="timestamp-offset"?e.value!=null?Fd({dateComponent:d.date,timeComponent:d.time,timeZoneComponent:d.timeZone,oldValue:p,defaultTimeZone:i}):null:e.value!=null?Od({oldValue:p,dateComponent:d.date,timeComponent:d.time,timeZone:i,max:o.max,min:o.min}):null,c!==null&&e.value?p!==c&&this._updateFieldValue(a,c):this._updateFieldValue(a,null)}_saveValueFromComponent(e){const i=this._getFieldInputFromHTMLElement(e),n=this._parseValue(e),s=i.value;i.isSubtypeField&&Ad(this.layer,s,n)?this._pendingSubtypeChoice||n===s||(this._pendingSubtypeChoice=this._handleSubtypeChoice(i,n)):this._updateFieldValue(i.name,n)}async _handleSubtypeChoice(e,i){var v;const{value:n,name:s}=e,{messages:a,viewModel:o,messagesCommon:d,_subtypes:p}=this;if(this._updateFieldValue(s,i),!(p!=null&&p.length))return;const c=p.find(_=>_.code===i),h=((v=p.find(_=>_.code===n))==null?void 0:v.name)??`${n}`;if(!c)return;o.hasPendingSubtypeChoice=!0;const u=un();let y="update-fields";const g=[{label:a.subtypes.useDefaultValuesOption,value:"update-fields"},{label:a.subtypes.keepCurrentValuesOption,value:"keep-existing"}],m={context:"info",title:a.subtypes.changeWarningTitle,message:Wt(a.subtypes.changeWarning,{originalType:h,newType:c.name}),radios:g,defaultRadioSelection:"update-fields",onRadioSelection:_=>y=_,actions:{primary:{label:d.apply,action:()=>u.resolve(y),type:"positive"},secondary:{label:d.cancel,type:"neutral",action:()=>u.resolve("undo")}},cancel:()=>u.reject()};try{switch(this.showPrompt(m),await u.promise){case"update-fields":o.applySubtypeDefaults(c),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,n)}}finally{o.hasPendingSubtypeChoice=!1,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:i}){const n=this._getFieldInputFromHTMLElement(i);e==="Enter"&&$s(n)&&!n.group.open&&(n.group.open=!0)}_updateFieldValue(e,i){const n=this.viewModel.getValue(e);this.viewModel.setValue(e,i),this._inputsWithChanges.add(e),n!==i&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([i,n])=>n!=null));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const i=this._getFieldInputFromHTMLElement(e),n=e.value;return oo(i.element,"switch")?e.checked?i.element.input.onValue:i.element.input.offValue:n==null||n===""?null:i.dataType==="number"?n==="-0"||n==="-0."||n==="-0,"?n:parseFloat(n):i.field.type==="date"?parseFloat(n):n}_ignoreDeselectionOfNoValueOption(e){const{firstChild:i,selectedItems:n}=e;n.length===0&&i&&"selected"in i?i.selected=!0:le.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,i){var n;e.open?(i.open=!0,this._focusedFieldName=((n=this._getFocusableInput("forward",i))==null?void 0:n.name)||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(s=>{s!==i&&(s.open=!1)})):i.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e==null||e.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const i=e.filter(n=>n.open);i.length===0?e[0].open=!0:i.length>1&&i.slice(1).forEach(n=>n.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};r([l()],V.prototype,"_listObserverNode",void 0),r([l()],V.prototype,"_relatedRecordsEnabled",null),r([l()],V.prototype,"_prompt",void 0),r([l()],V.prototype,"_subtypes",null),r([l()],V.prototype,"disabled",null),r([l()],V.prototype,"feature",null),r([l()],V.prototype,"formTemplate",null),r([l()],V.prototype,"groupDisplay",void 0),r([l()],V.prototype,"headingLevel",void 0),r([l()],V.prototype,"icon",null),r([l()],V.prototype,"label",null),r([l()],V.prototype,"layer",null),r([l()],V.prototype,"map",null),r([l(),Ue("esri/widgets/FeatureForm/t9n/FeatureForm")],V.prototype,"messages",void 0),r([l(),Ue("esri/t9n/common")],V.prototype,"messagesCommon",void 0),r([l(),Ue("esri/widgets/Feature/t9n/Feature")],V.prototype,"messagesFeature",void 0),r([l(),Ue("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],V.prototype,"messagesTemplates",void 0),r([l()],V.prototype,"relatedRecordCallbacks",null),r([l()],V.prototype,"relationshipId",null),r([l()],V.prototype,"spatialReference",null),r([l()],V.prototype,"strict",null),r([l()],V.prototype,"timeZone",null),r([l()],V.prototype,"showPrompt",null),r([l()],V.prototype,"clearPrompt",null),r([l(),Ma(["value-change","submit"])],V.prototype,"viewModel",void 0),r([l()],V.prototype,"test",null),V=r([C("esri.widgets.FeatureForm")],V);const ch=V;async function uh(t,e){var i;return t.type==="subtype-sublayer"?await((i=t.parent)==null?void 0:i.load(e)):await t.load(e),t}function hh(t){const e=new Map,i=[];for(const n of t)if(li(n)){i.push(n);for(const s of n.items)e.set(s.template,s)}else e.set(n.template,n);return[e,i]}const li=t=>"items"in t;var ca;let xe=ca=class extends O{constructor(t){super(t),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(k(()=>{const{layer:t}=this;return[t&&"renderer"in t?t.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},K))}get description(){var t;return(t=this.template)==null?void 0:t.description}set description(t){this.template&&(this.template.description=t)}get disabled(){var t;return((t=this.disabledFunction)==null?void 0:t.call(this,this))??!1}get label(){var t;return(t=this.template)==null?void 0:t.name}set label(t){this.template&&(this.template.name=t)}get id(){var t;return`${this.label??""}–${(t=this.layer)==null?void 0:t.id}`}get supportsUpload(){var t;return((t=this.layer)==null?void 0:t.type)==="scene"}clone(){const t=this.thumbnail!=null?this.thumbnail.cloneNode(!0):null,e=new ca({layer:this.layer,template:this.template});return e._set("thumbnail",t),e}static async fetchThumbnail(t,e){var s;const i=await yh(t,e);if(i==null)return null;const n={maxSize:36};return((s=t.renderer)==null?void 0:s.type)==="dictionary"&&(n.fieldMap=t.renderer.fieldMap??void 0,n.feature={attributes:e.prototype.attributes??{}}),await Tp(i,n)}};r([l()],xe.prototype,"description",null),r([l()],xe.prototype,"disabled",null),r([l()],xe.prototype,"disabledFunction",void 0),r([l()],xe.prototype,"label",null),r([l()],xe.prototype,"layer",void 0),r([l()],xe.prototype,"template",void 0),r([l()],xe.prototype,"thumbnail",void 0),r([l()],xe.prototype,"id",null),r([l()],xe.prototype,"supportsUpload",null),xe=ca=r([C("esri.widgets.FeatureTemplates.TemplateItem")],xe);const ul=xe;async function yh(t,e){const{renderer:i}=t;if(i){const n=new Ai({attributes:e.prototype.attributes}),s=await i.getSymbolAsync(n);if(s)return s}return mh(t)}async function mh(t){const{geometryType:e}=t,i=e==="point"||e==="multipoint"?await E(()=>import("./index-C1aGfQcb.js").then(n=>n.nM),__vite__mapDeps([1,2])):e==="polyline"?await E(()=>import("./index-C1aGfQcb.js").then(n=>n.nK),__vite__mapDeps([1,2])):e==="polygon"||e==="mesh"||e==="multipatch"?await E(()=>import("./index-C1aGfQcb.js").then(n=>n.nL),__vite__mapDeps([1,2])):null;return i?new i.default:null}let Nt=class extends ka(O){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return e==null||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find(i=>i.template===e)}};r([l()],Nt.prototype,"allItems",void 0),r([l()],Nt.prototype,"filterFunction",void 0),r([l()],Nt.prototype,"items",null),r([l()],Nt.prototype,"label",void 0),r([l()],Nt.prototype,"id",null),Nt=r([C("esri.widgets.FeatureTemplates.TemplateItemGroup")],Nt);const gh=Nt,ps=t=>t==null||typeof t!="object"?[]:[..."templates"in t&&Array.isArray(t.templates)?t.templates:[],..."types"in t&&Array.isArray(t.types)?t.types.flatMap(e=>e.templates):[]];var Nn;const fh=({layer:t})=>({key:t,label:t.title??""}),vh=({layer:t})=>({key:t.geometryType,label:t.geometryType??""});let ne=Nn=class extends At.EventedAccessor{constructor(t){super(t),this._allItems=[],this._updatingHandles=new xi,this._updateAllItemsTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([k(()=>[this._featureTemplatesByLayer,this._groupByFunction],()=>{this._updateAllItemsTask=ni(this._updateAllItemsTask);const t=pn(e=>this._updateAllItems(e));this._updateAllItemsTask=t,this._updatingHandles.addPromise(t.promise)},it),k(()=>this.filterFunction,t=>{for(const e of this._allItems)li(e)&&(e.filterFunction=t)},sn)])}get _featureTemplatesByLayer(){const t=new Map;if(!this.layers)return t;for(const e of this.layers)if(e.type==="subtype-group")for(const i of e.sublayers)t.set(i,ps(i));else t.set(e,ps(e));return t}set groupBy(t){if(this._set("groupBy",t),typeof t!="function")switch(t){case"layer":this._groupByFunction=fh;break;case"geometry":this._groupByFunction=vh;break;default:this._groupByFunction=null}else this._groupByFunction=e=>this._ensureGroupByObject(t(e))}get layers(){return this._get("layers")}set layers(t){const e="layers";if(this.removeHandles(e),t){const i=()=>this.notifyChange("state");this.addHandles(t.map(n=>si(()=>n.loadStatus,i)),e)}this._set("layers",t)}get state(){return this.updating?"loading":this.layers.length===0?"disabled":"ready"}get numberOfFeatureTemplates(){return Array.from(this._featureTemplatesByLayer.values()).reduce((t,e)=>t+e.length,0)}get items(){const{filterFunction:t}=this;return t==null?this._allItems:this._allItems.filter(e=>li(e)?e.items.length>0:t(e))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const t of this._allItems)li(t)&&t.reapplyFilter()}select(t,{emit:e=!0}={}){const i=this.selectedItem,n=(t==null?void 0:t.clone())||null;this._set("selectedItem",n),e&&this.emit("select",{item:n,oldItem:i,template:(n==null?void 0:n.template)??null})}_createItem(t,e){return new ul({disabledFunction:this.disabledItemFunction,layer:e,template:t})}_ensureGroupByObject(t){return typeof t=="string"?{key:t,label:t}:t}async _updateAllItems(t){var h,u;const e=this._allItems;if(this.numberOfFeatureTemplates===0)return _h(e),void(this._allItems=[]);const[i,n]=hh(e),s={signal:t},a=this._featureTemplatesByLayer,o=[];for(const[y,g]of a){await uh(y,s),at(t);const m=(h=Jn(y))==null?void 0:h.operations;if(m!=null&&m.supportsEditing&&(m!=null&&m.supportsAdd))for(const v of g)i.has(v)?(o.push(i.get(v)),i.delete(v)):o.push(this._createItem(v,y))}for(const y of[...i.values(),...n])y.destroy();if(this._groupByFunction==null)return at(t),void(this._allItems=o);const d=new Map;for(const y of o){const g=this._groupByFunction(y),{key:m,label:v}=g.key!=null?g:Nn.nullGroupBy;d.has(m)||d.set(m,{label:v,items:[]}),(u=d.get(m))==null||u.items.push(y)}const{filterFunction:p}=this,c=Array.from(d.values()).map(({label:y,items:g})=>new gh({allItems:g,filterFunction:p,label:y}));at(t),c.length===1&&c[0].label===Nn.nullGroupBy.label?this._allItems=c[0].allItems:this._allItems=c}};function _h(t){for(const e of t){if(li(e))for(const i of e.items)i.destroy();e.destroy()}}ne.nullGroupBy={key:Symbol(),label:"Other​"},r([l()],ne.prototype,"_allItems",void 0),r([l()],ne.prototype,"_featureTemplatesByLayer",null),r([l()],ne.prototype,"_groupByFunction",void 0),r([l()],ne.prototype,"_updatingHandles",void 0),r([l()],ne.prototype,"disabled",void 0),r([l()],ne.prototype,"disabledItemFunction",void 0),r([l({value:null})],ne.prototype,"filterFunction",void 0),r([l()],ne.prototype,"groupBy",null),r([l({value:[]})],ne.prototype,"layers",null),r([l()],ne.prototype,"state",null),r([l({readOnly:!0})],ne.prototype,"numberOfFeatureTemplates",null),r([l({readOnly:!0})],ne.prototype,"items",null),r([l({readOnly:!0})],ne.prototype,"selectedItem",void 0),r([l()],ne.prototype,"updating",null),ne=Nn=r([C("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],ne);const ua=ne,Ht="esri-item-list",Tn=`${Ht}__list-item`,ft={base:Ht,filterContainerSticky:`${Ht}__filter-container--sticky`,group:`${Ht}__group`,groupHeader:`${Ht}__group__header`,item:Tn,itemDisabled:`${Tn}--disabled`,itemIcon:`${Tn}-icon`,itemContentEnd:`${Tn}-content-end`,noMatchesMessage:`${Ht}__no-matches-message`,scroller:`${Ht}__scroller`,scrollerEnabled:`${Ht}__scroller--enabled`},wh=4;function hl(t){const{disabled:e,filterText:i="",id:n,messages:s,onFilterChange:a,...o}=t;return f("div",{key:n},t.filterEnabled??1?kh({disabled:e,filterText:i,id:n,messages:s,onFilterChange:a}):null,Eh({...o,disabled:e,enableListScroll:t.enableListScroll??!0,filterText:i,messages:s}))}function bh(t){return!!t.items}function Eh(t){const{headingLevel:e,items:i,...n}=t;return i.length===0?f("div",{class:ft.noMatchesMessage,key:"no-matches"},t.messages.noMatches):f("div",{class:on({[ft.scroller]:!0,[ft.scrollerEnabled]:!!t.enableListScroll}),key:"item-container"},i.map(s=>bh(s)?Ch({...n,group:s,headingLevel:e}):Wa({...n,grouped:!0,item:s})))}function kh(t){const{disabled:e,messages:i,filterText:n,enableListScroll:s}=t;return f("div",{class:s?void 0:ft.filterContainerSticky,key:"filter"},f("calcite-input",{disabled:e,placeholder:i.filterPlaceholder,type:"search",value:n,onCalciteInputInput:a=>{const o=a.currentTarget;t.onFilterChange&&t.onFilterChange(o.value)}}))}function Wa(t){const{disabled:e,grouped:i,identify:n,item:s,onItemMouseEnter:a,onItemMouseLeave:o,onItemSelect:d,renderIcon:p,renderCustomItem:c,renderItemContent:h,renderItemContentEnd:u,renderItemLabel:y,renderItemDescription:g,selectedItem:m}=t,v=Ho(s,n),_=v===Ho(m,n),w=c==null?void 0:c(t);if(w)return w;const b=h==null?void 0:h(s),M=u==null?void 0:u(s),I=!(!s.disabled&&!e);return f("calcite-list-item",{afterUpdate:F=>{F.selected=_},"aria-level":i?"2":"",class:on({[ft.item]:!0,[ft.itemDisabled]:I}),"data-item":s,description:b?void 0:(g==null?void 0:g(s))??void 0,disabled:I,key:v,label:b?void 0:(y==null?void 0:y(s))??s.label??void 0,onmouseenter:F=>a==null?void 0:a(js(F)),onmouseleave:F=>o==null?void 0:o(js(F)),selected:_,tabIndex:I?-1:0,onCalciteListItemSelect:F=>{F.preventDefault(),d==null||d(js(F))}},f("div",{class:ft.itemIcon,key:"content-start",slot:"content-start"},p==null?void 0:p(s)),b?f("div",{key:"content",slot:"content"},b):null,M?f("div",{class:ft.itemContentEnd,key:"content-end",slot:"content-end"},M):null)}function Ho(t,e){return t?`${(e==null?void 0:e(t))||t.id}__${t.label}`:""}function js(t){return t.currentTarget["data-item"]}function Ch(t){const{disabled:e,group:i,headingLevel:n=wh,selectionMode:s="none",renderCustomGroupContent:a,...o}=t,d=a==null?void 0:a(t);return f("div",{class:ft.group,key:i.label??void 0},f(an,{class:ft.groupHeader,level:n},i.label),d||f("calcite-list",{disabled:e,selectionAppearance:"border",selectionMode:s},i.items.map(p=>Wa({...o,disabled:e,item:p,grouped:!0}))))}let Hn=class extends O{constructor(e){super(e),this.filter=!0}};r([l({type:Boolean,nonNullable:!0})],Hn.prototype,"filter",void 0),Hn=r([C("esri.widgets.FeatureTemplates.VisibleElements")],Hn);const yl=Hn,Ih={base:"esri-feature-templates"};function Mh(t){return t.length>0&&li(t[0])}function Th(t){return t.id}let W=class extends Fi{constructor(e,i){super(e,i),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.selectionMode="none",this.viewModel=new ua,this.visibleElements=new yl,this.renderCustomItem=n=>null,this.renderCustomGroupContent=n=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=n=>null,this.renderItemContentEnd=n=>null,this._iconIntersectionObserver=new IntersectionObserver((n,s)=>{n.forEach(async a=>{if(a.isIntersecting){const o=a.target;if(Sh(o))return void s.unobserve(o);const d=$h(o),{layer:p,template:c}=d;Uo(o,!0);const h=await ul.fetchThumbnail(p,c).catch(()=>(Uo(o,!1),null));if(h==null)return;o.appendChild(h)}})}),this._renderItemIcon=n=>ai(n.layer)?f("span",{"data-has-icon":!0,"data-item":n,key:"icon"},f("calcite-icon",{icon:"table"})):f("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":n,key:"icon"}),this._afterItemCreateOrUpdate=n=>{var s;(s=this._iconIntersectionObserver)==null||s.observe(n)},this._afterItemRemoved=n=>{var s;(s=this._iconIntersectionObserver)==null||s.unobserve(n)}}initialize(){const e=({label:i})=>!this.filterText||!!(i!=null&&i.toLowerCase().includes(this.filterText.toLowerCase()));this.addHandles(k(()=>this.viewModel,(i,n)=>{i&&!i.filterFunction&&(this.filterFunction=e),n&&n!==i&&n.filterFunction===e&&(n.filterFunction=null)},K))}destroy(){var e;(e=this._iconIntersectionObserver)==null||e.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return ze({icon:()=>E(()=>import("./calcite-icon-B5wvyzgm.js"),__vite__mapDeps([161,1,2])),loader:()=>E(()=>import("./calcite-loader-Ce47wHPj.js"),__vite__mapDeps([179,1,2])),input:()=>E(()=>import("./calcite-input-C30oMPBL.js"),__vite__mapDeps([162,163,1,2,153,164,157,165])),list:()=>E(()=>import("./calcite-list-DEz7lVXs.js"),__vite__mapDeps([175,1,2,176,177,152,140,163,153,164,157,165])),"list-item":()=>E(()=>import("./calcite-list-item-BLSA8Adn.js"),__vite__mapDeps([178,1,2,177,176,141,147])),notice:()=>E(()=>import("./calcite-notice-BhTM-Xuv.js"),__vite__mapDeps([180,1,2,136,181,138]))})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,i){return this.viewModel.select(e,i)}render(){const{disabled:e,enableListScroll:i,filterText:n,headingLevel:s,messages:a,viewModel:{items:o,numberOfFeatureTemplates:d,selectedItem:p,state:c}}=this,h=this.visibleElements.filter&&d>1;if(Mh(o)){const u=o.find(y=>y.label===ua.nullGroupBy.label);u&&(u.label=a.other)}return f("div",{"aria-label":a.widgetLabel,class:this.classes(Ih.base,di.widget)},c==="loading"?f("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):c==="ready"?f(hl,{disabled:e,enableListScroll:i,filterEnabled:h,filterText:n,headingLevel:s,id:this.id,identify:Th,items:o,messages:{filterPlaceholder:a.filterPlaceholder,noItems:a.noItems,noMatches:a.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:p??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:u=>{this.filterText=u},onItemSelect:u=>!li(u)&&this.viewModel.select(u)}):null)}};function $h(t){return t==null?void 0:t["data-item"]}function Sh(t){return!!(t!=null&&t["data-has-icon"])}function Uo(t,e){t&&(t["data-has-icon"]=e)}r([l()],W.prototype,"disabled",null),r([l()],W.prototype,"enableListScroll",void 0),r([l()],W.prototype,"filterFunction",null),r([l()],W.prototype,"filterText",void 0),r([l()],W.prototype,"groupBy",null),r([l()],W.prototype,"headingLevel",void 0),r([l()],W.prototype,"icon",null),r([l()],W.prototype,"label",null),r([l()],W.prototype,"layers",null),r([l(),Ue("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],W.prototype,"messages",void 0),r([l(),Ue("esri/t9n/common")],W.prototype,"messagesCommon",void 0),r([l({readOnly:!0})],W.prototype,"selectedItem",null),r([l()],W.prototype,"selectionMode",void 0),r([l(),Ma("select")],W.prototype,"viewModel",void 0),r([l({type:yl,nonNullable:!0})],W.prototype,"visibleElements",void 0),r([l()],W.prototype,"renderCustomItem",void 0),r([l()],W.prototype,"renderCustomGroupContent",void 0),r([l()],W.prototype,"renderItemLabel",void 0),r([l()],W.prototype,"renderItemDescription",void 0),r([l()],W.prototype,"renderItemContent",void 0),r([l()],W.prototype,"renderItemContentEnd",void 0),W=r([C("esri.widgets.FeatureTemplates")],W);const Fh=W,mi="esri-editor",gi={base:mi,helpMessage:`${mi}__help-message`,updateActions:`${mi}__update-actions`,updateActionsList:`${mi}__update-actions-list`,featureTemplatesContainer:`${mi}__feature-templates-container`,templateItemContentEnd:`${mi}__template-item-content-end`};let Xi=class extends O{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};r([l({type:String,nonNullable:!0})],Xi.prototype,"mode",void 0),Xi=r([C("esri.views.interactive.sketch.SketchTooltipElevationOptions")],Xi);let de=class extends O{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};r([l({type:Boolean,nonNullable:!0})],de.prototype,"area",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"coordinates",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"direction",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"distance",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"elevation",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"header",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"helpMessage",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"orientation",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"radius",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"rotation",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"scale",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"size",void 0),r([l({type:Boolean,nonNullable:!0})],de.prototype,"totalLength",void 0),de=r([C("esri.views.interactive.sketch.SketchTooltipVisibleElements")],de);const ml=de;let ve=class extends O{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new Xi,this.placement="auto",this.offset=null,this.visibleElements=new ml,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};r([l({type:Boolean,nonNullable:!0})],ve.prototype,"enabled",void 0),r([l()],ve.prototype,"forceEnabled",void 0),r([l()],ve.prototype,"effectiveEnabled",null),r([l()],ve.prototype,"helpMessage",void 0),r([l()],ve.prototype,"helpMessageIcon",void 0),r([l({type:Boolean,nonNullable:!0})],ve.prototype,"inputEnabled",void 0),r([l({type:Xi,nonNullable:!0})],ve.prototype,"elevation",void 0),r([l()],ve.prototype,"placement",void 0),r([l()],ve.prototype,"offset",void 0),r([l({type:ml,nonNullable:!0})],ve.prototype,"visibleElements",void 0),r([l()],ve.prototype,"visualVariables",void 0),r([l()],ve.prototype,"xyMode",void 0),ve=r([C("esri.views.interactive.sketch.SketchTooltipOptions")],ve);const ja=ve;let wi=class extends O{constructor(e){super(e),this.labels=new Ga,this.tooltips=new ja,this.values=new Cs}};r([l({nonNullable:!0,type:Ga})],wi.prototype,"labels",void 0),r([l({nonNullable:!0,type:ja})],wi.prototype,"tooltips",void 0),r([l({nonNullable:!0,type:Cs})],wi.prototype,"values",void 0),wi=r([C("esri.views.interactive.sketch.SketchOptions")],wi);const Zt=wi;function Oh(t,e){switch(t){case"point":case"multipoint":return Ah();case"polyline":return Lh(e);case"polygon":return xh(e);default:return}}function Ah(t){return"point"}function Lh(t){return(t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function xh(t){const e=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function Vh(t){return t==null?null:JSON.stringify(t)}let gt=class extends O{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null}get attributesModified(){var e,i;return!Rh((e=this.initialFeature)==null?void 0:e.attributes,(i=this.feature)==null?void 0:i.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(e=this.feature){this.initialFeature=e==null?void 0:e.clone()}updateAttributes(e){const{feature:i}=this;i&&(i.attributes=e,this.notifyChange("attributesModified"))}updateGeometry(e){const{feature:i}=this;i&&(i.geometry=e,this.notifyChange("geometryModified"))}_stringifyGeometry(e){const i=e==null?void 0:e.geometry;return Vh((i==null?void 0:i.type)==="mesh"?{transform:i.transform,vertexSpace:i.vertexSpace}:i)}};function Rh(t,e){const i=t??{},n=e??{},s=new Set(Object.keys(i));Ld(s,Object.keys(n));for(const a of s)if(!Ph(i[a],n[a]))return!1;return!0}function Ph(t,e){return!(!Wo(t)||!Wo(e))||t===e}function Wo(t){return t==null||t===""}r([l()],gt.prototype,"_stagedForDelete",void 0),r([l()],gt.prototype,"attributesModified",null),r([l()],gt.prototype,"feature",void 0),r([l()],gt.prototype,"geometryModified",null),r([l()],gt.prototype,"initialFeature",void 0),r([l()],gt.prototype,"modified",null),gt=r([C("esri.widgets.Editor.Edits")],gt);let et=class extends O{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.parent=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null,this.upload=null,this._pendingEdits=new dr}get pendingFeatures(){return new Q([...this._pendingEdits.keys()])}addPendingFeature(e,i=e){const{_pendingEdits:n}=this;if(n.has(e))return n.get(e);const s=new gt({feature:e});return s.trackChanges(i),n.set(e,s),s}getEditsForPendingFeature(e){return this._pendingEdits.get(e)}removePendingFeature(e){const{_pendingEdits:i}=this,n=i.get(e);n&&(n.destroy(),i.delete(e))}};r([l()],et.prototype,"creationInfo",void 0),r([l()],et.prototype,"editorItem",void 0),r([l()],et.prototype,"parent",void 0),r([l()],et.prototype,"pendingFeatures",null),r([l({constructOnly:!0})],et.prototype,"sketchOptions",void 0),r([l()],et.prototype,"snappingManager",void 0),r([l()],et.prototype,"viewModel",void 0),r([l()],et.prototype,"upload",void 0),et=r([C("esri.widgets.Editor.CreateFeaturesWorkflowData")],et);let $t=class extends At.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}};r([l({constructOnly:!0})],$t.prototype,"graphic",void 0),r([l()],$t.prototype,"tracking",void 0),r([l()],$t.prototype,"displaying",void 0),r([l()],$t.prototype,"error",void 0),r([l()],$t.prototype,"isDraped",void 0),$t=r([C("esri.views.3d.layers.graphics.GraphicState")],$t);function Dh(t){return t.type==="update"}function Ba(t){const e=t.sourceLayer;if(!e||e.type!=="feature"||!Wh(e.renderer))return{rotation:null,size:null};let i=null,n=null;const s=e.renderer.getVisualVariablesForType("rotation").filter(o=>(!o.axis||o.axis==="heading")&&o.field&&!o.valueExpression&&nc(o,t)!=null);s.length===1&&(i=Gh(s[0],e));const a=e.renderer.getVisualVariablesForType("size").filter(o=>o.field&&!o.useSymbolValue&&!o.valueExpression&&tc(o)===ic.RealWorldSize&&sc(o,t)!=null);return a.length===1&&(n=Uh(a[0],e)),{rotation:i,size:n}}function Gh(t,e){const i=(t.axis||"heading")==="heading"&&t.rotationType==="arithmetic"?-1:1,n=t.field,s=e.fields&&e.fields.filter(d=>d.name===n),a=s&&s.length===1?s[0].type:"double",o={initial:0,current:0};return{field:n,fieldType:a,getDefault:()=>Promise.resolve(0),getValue:d=>(o.current=o.initial-i*d,ha((o.current+360)%360,a)),setInitialValue:d=>{o.initial=d,o.current=0},isUpdatingInteractively:!1,rotationType:t.rotationType??"geographic"}}function Nh(t,e){switch(e){case"width":return t[0];case"depth":return t[1];case"height":return t[2];default:return t[2]||t[1]||t[0]}}async function Hh(t,e,i){if(e==null)return 0;const{symbol:n}=ac(e);if(n==null||n.type==="web-style"||n.type==="cim")return 0;const s=n.symbolLayers.at(0);if(!s)return 0;switch(s.type){case"icon":{const{computeIconLayerResourceSize:a}=await E(()=>import("./symbolLayerUtils-BnaK6dY7.js"),__vite__mapDeps([187,1,2,38]));return s.size||Math.min(Lt.icon,(await a(s,Lt.icon))[0])||Lt.icon}case"text":return s.size||Lt.text;case"line":return s.size||Lt.line;case"object":{const{computeObjectLayerResourceSize:a}=await E(()=>import("./symbolLayerUtils-BnaK6dY7.js"),__vite__mapDeps([187,1,2,38]));return Nh(await a(s,t.scale/Lt.viewScaleSizeFactor),i)}case"path":return(s.width!=null?s.width:s.height)||t.scale/Lt.viewScaleSizeFactor;case"extrude":return s.size||t.scale/Lt.viewScaleSizeFactor;default:return 0}}function Uh(t,e){const i=t.field,n=t.axis,s=e.fields&&e.fields.filter(c=>c.name===i),a=s&&s.length===1?s[0].type:"double",o={initial:0,current:0},d=ec[t.valueUnit]??1;let p;return p=t.valueRepresentation==="area"?c=>(c*d/2)**2*Math.PI:t.valueRepresentation==="radius"||t.valueRepresentation==="distance"?c=>c*d/2:c=>c*d,{field:i,fieldType:a,getDefault:async(c,h)=>ha(p(await Hh(h,c,n)),a),getValue:(c,h)=>(o.initial||(o.initial=h.pixelSizeAt(h.center)),o.current=o.initial*c,ha(o.current,a)),setInitialValue:c=>{o.initial=c,o.current=0},isUpdatingInteractively:!1,displayUnit:sy(t.valueUnit),axis:t.axis}}function ha(t,e){switch(e){case"small-integer":case"integer":case"long":return Math.round(t);case"double":case"single":return t;default:return 0}}function Wh(t){switch(t==null?void 0:t.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}async function Ot(t,e,i){const n=await ea(t,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:e,scale:i});Jp(t.symbol,n)!=null&&(t.symbol=n)}function jh(t){if(!t)throw new Error("no geometry type");return t==="multipatch"?"mesh":t}async function Bh(t,e,i){const n=e.layer,s=gl(e);let a=null;const{view:o}=t,d=(o==null?void 0:o.type)==="2d";if(await jo(t,n,s,i,d?o.scale:null),d){const h=cn(u=>jo(t,n,s,i,u));a=k(()=>o.scale,u=>h(u))}const{data:p,editing:c}=n.capabilities;return t.layer.elevationInfo=n.elevationInfo,e.geometryToPlace==null?await t.create(jh(n.geometryType),{graphicProperties:{attributes:s,sourceLayer:n},hasZ:p.supportsZ,defaultZ:(d?c.zDefault:null)??t.defaultCreateOptions.defaultZ}):await t.place(e.geometryToPlace,{graphicProperties:{attributes:s,sourceLayer:n}}),a??j()}function gl(t){var e;return{...(e=t.template)==null?void 0:e.prototype.attributes,...t.attributeOverrides}}async function jo(t,e,i,n,s){const a=new Ai({sourceLayer:e,attributes:i}),{rotation:o,size:d}=Ba(a);let p=await ea(a,{useSourceLayer:!0,webStyleCache:n,scale:s}),c=!1;for(const h of[d,o])h!=null&&i[h.field]==null&&(i[h.field]=await h.getDefault(p,t.view),c=!0);switch(c&&(p=await ea(a,{useSourceLayer:!0,webStyleCache:n,scale:s})),p==null?void 0:p.type){case"simple-fill":case"polygon-3d":t.polygonSymbol=p;break;case"simple-line":case"line-3d":t.polylineSymbol=p;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":t.pointSymbol=p;break;case"mesh-3d":t.meshSymbol=p}fl(t.tooltipOptions,d,o)}function fl(t,e,i){t.visualVariables=e!=null||i!=null?{size:e!=null?{unit:e.displayUnit,axis:e.axis,valueType:e.fieldType}:null,rotation:i!=null?{valueType:i.fieldType,rotationType:i.rotationType??"geographic"}:null}:null}function zh(t,e){return t==null?void 0:t.find(i=>i.layer===e)}async function qh(t,e,i,n){switch(e.type){case"3d":return Zh(t,e,i,n);case"2d":return Kh(t,e,i,n)}}async function Zh(t,e,i,n){if(t.length===0)return[];const{updatable:s,graphicsByLayer:a}=await i.async(async()=>{const{results:o}=await rn(cc(e,i),n),d=new Map,p=h=>{const u=h.layer,y=d.get(u);if(!y){const g=new Array;return d.set(u,g),g}return y};Tr(o).forEach(({graphic:h})=>p(h).push(h));const c=t.filter(({capabilities:h,layer:u})=>h.update.enabled&&d.has(u));return c.length!==0&&i.stopPropagation(),{updatable:c,graphicsByLayer:d}});return rn(Promise.allSettled(s.map(async({layer:o})=>{const d=a.get(o),p=vl(o);if(d.every(u=>Vd(p,u)))return d;const c=[];for(const u of d){c.push(u.getObjectId());const y=Object.keys(u.attributes);Rd(p,y)}const h=o.createQuery();return h.returnGeometry=!1,h.objectIds=c,h.outFields=Ca(o.fieldsIndex,p),o.queryFeatures(h,{signal:n}).then(({features:u})=>u)})),n)}async function Kh(t,e,i,n){if(t.length===0)return[];const{mapPoint:s}=i;if(s==null)return[];let a=null;const o=await i.async(async()=>{const{results:d}=await rn(e.hitTest(i),n);if(d.length===0)return[];const p=new Set;a=Tr(d),a.forEach(({graphic:h})=>h&&p.add(h.layer));const c=t.filter(h=>p.has(h.layer)&&h.supportsUpdateWorkflow);return c.length>0&&i.stopPropagation(),c});return rn(Promise.allSettled(o.map(async({layer:d})=>{const p=d.createQuery();p.returnGeometry=!1,p.outFields=vl(d);const c="renderer"in d?Qp({renderer:d.renderer,pointerType:i.pointerType}):0;p.geometry=Xp(s,c,e),p.outSpatialReference=e.spatialReference;const{features:h}=await d.queryFeatures(p,{signal:n});return a==null||a.forEach(({graphic:u})=>{u.layer!==d||h.some(y=>y.getObjectId()===u.getObjectId())||h.push(u)}),h})),n)}function vl(t){return Ca(t.fieldsIndex,[t.objectIdField,yr({displayField:"displayField"in t?t.displayField:null,fields:t.fields})])}async function Yh(t,e,i){const{sourceLayer:n}=t,s=n.createQuery();s.objectIds=[t.getAttribute(n.objectIdField)],s.outFields=["*"],s.returnM=n.capabilities.data.supportsM,s.returnZ=n.capabilities.data.supportsZ,n.type==="scene"&&n.infoFor3D!=null||(s.outSpatialReference=e);const a=await n.queryFeatures(s,{signal:i});return at(i),a.features[0]}async function ya(t){var h;const{graphic:e,sketchViewModel:i,sourceLayer:n,visualVariables:s,webStyleCache:a}=t;let o=!1;const{rotation:d,size:p}=s;if([d,p].forEach(async u=>{if(u==null)return;const y=e.getAttribute(u.field);if(y!=null)u.setInitialValue(y);else{const g=await u.getDefault(e.symbol,i.view);u.setInitialValue(g),e.setAttribute(u.field,g),o=!0}}),o){const u=((h=i.view)==null?void 0:h.type)==="2d"?i.view.scale:null;await Ot(e,a,u)}const c={multipleSelectionEnabled:!1};return n.geometryType==="point"&&(c.enableRotation=d!=null,c.enableScaling=p!=null),fl(i.tooltipOptions,p,d),i.layer.elevationInfo=n.elevationInfo,i.update(e,c)}function Jh(t){return t==null||t.type!=="rotate-start"&&t.type!=="rotate"&&t.type!=="rotate-stop"?null:t}function Qh(t){return t==null||t.type!=="scale-start"&&t.type!=="scale"&&t.type!=="scale-stop"?null:t}async function _l(t,e,i,n,s){var c;if(e.geometry==null||((c=e.geometry)==null?void 0:c.type)!=="point")return;const a=n.rotation,o=Jh(i.toolEventInfo);if(a!=null&&o!=null){const{field:h,getValue:u}=a;o.type==="rotate-stop"?(a.isUpdatingInteractively=!1,a.setInitialValue(e.getAttribute(h))):(a.isUpdatingInteractively=!0,e.setAttribute(h,u(o.angle,t)))}const d=n.size,p=Qh(i.toolEventInfo);if(d!=null&&p!=null){const{field:h,getValue:u}=d;p.type==="scale-stop"?(d.isUpdatingInteractively=!1,d.setInitialValue(e.getAttribute(h))):(d.isUpdatingInteractively=!0,e.setAttribute(h,u(p.xScale,t)))}await Ot(e,s,t.type==="2d"?t.scale:null)}async function Xh({feature:t,featureClone:e,visualVariableAttributes:i,sketchViewModel:n,view:s,onUpdate:a,webStyleCache:o}){var _;await Ot(e,o,s.type==="2d"?s.scale:null);let d=null;if(((_=n==null?void 0:n.view)==null?void 0:_.type)==="2d"){const w=cn(b=>Ot(e,o,b));d=k(()=>{var b;return(b=n==null?void 0:n.view)==null?void 0:b.scale},b=>w(b))}const p=e.sourceLayer,c=Si(s,p);await ya({graphic:e,sketchViewModel:n,sourceLayer:p,visualVariables:i,webStyleCache:o});let h=null;c.then(w=>h=w).catch(()=>{});const u=i.size,y=i.rotation,g=k(()=>t.attributes,async w=>{let b=!1;for(const M in w){const I=w[M];I!==e.getAttribute(M)&&(e.setAttribute(M,I),u==null||u.isUpdatingInteractively||u.field!==M||u.setInitialValue(I),y==null||y.isUpdatingInteractively||y.field!==M||y.setInitialValue(I),(h==null||h.requiredFields.includes(M))&&(b=!0))}b&&await Ot(e,o,s.type==="2d"?s.scale:null)}),m=n.on("update",async w=>{const b=w.graphics[0];if(w.state==="complete")return ya({graphic:b,sketchViewModel:n,sourceLayer:p,visualVariables:i,webStyleCache:o});await _l(s,b,w,i,o),a(ma(b),w)}),v=n.on(["undo","redo"],async w=>{a(ma(w.graphics[0]),w)});return Ft([v,m,j(()=>n.cancel()),g,d])}async function ey(t,e,i){const n=t.view;t.layer.add(i);const s=e.sourceLayer,a=e.layer,o=e.getAttribute(a.objectIdField);let d=null;function p(c){d==null||d.abort(),d=pn(async h=>{var y;const u=await Si(n,s);at(h),(y=u.setVisibility)==null||y.call(u,o,c)})}return await iy(n,i),p(!1),Ft([ty(n,i,c=>p(!c)),j(async()=>{p(!0);try{const c=await Si(n,s);await ue(()=>!c.updating)}finally{t.layer.remove(i)}})])}function ty(t,e,i){if(t.type==="3d"){const n=new $t({graphic:e});return Ft([t.trackGraphicState(n),k(()=>n.displaying,i)])}return k(()=>e.visible,i)}async function iy(t,e){if(t.type==="3d"){const i=new $t({graphic:e}),n=t.trackGraphicState(i);await ue(()=>i.displaying||i.error),n.remove()}else await ue(()=>e.visible)}const Lt={icon:Ss(24),text:Ss(12),line:Ss(1),viewScaleSizeFactor:100};function wl(t,e,i){let n=!1;return t.filter(s=>!!n||(n=s===e,n)).map(s=>i[s]())}function ny(t,e){t.viewModel.syncFeatureTemplates();const i=t.creationInfo;if(e[0].id==="awaiting-feature-creation-info"&&i){const n=i.layer,s=ps(n);s.length===1&&n.type!=="scene"&&(i.template=s[0],e.shift())}return e}function sy(t){return t==="unknown"?null:t}function ay(t){t.filesEnabled=!0,t.mode="view",t.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}const bl=t=>/-stop/.test(t)||/vertex-/.test(t),Si=(t,e)=>{const i=e.type==="subtype-sublayer"?e.parent:e;return t.whenLayerView(i)};function oy(t){return"createInteractiveEditSession"in t}function ma(t){var i;const e=t.geometry;if((e==null?void 0:e.type)==="mesh"){const n=t.cloneShallow();return n.attributes=xd(t.attributes),n.geometry=e.cloneShallow(),n.geometry.transform=((i=e.transform)==null?void 0:i.clone())??null,n}return t.clone()}function ga(t){const e=t.cursor;return t.cursor="progress",j(()=>t.cursor=e)}async function ry({view:t,data:e,signal:i,next:n,cancel:s}){const{creationInfo:a}=e;if(!a)return j();if(!en(a))return j();const{layer:o}=a,d=a.geometryToPlace!=null;if(a.geometryToPlace=null,d)return s(),j();const{Upload:p}=await E(()=>import("./Upload-B3aMxJOg.js"),__vite__mapDeps([188,1,2,13,11,189,111]));at(i);const c=new p;e.upload=c;let h=null;const u=()=>h==null?void 0:h.remove(),y=Ft([k(()=>c.state,g=>{switch(g){case"default":case"error":u();break;case"pending":u(),h=ga(t);break;case"success":{a.maxFeatures=1;const{result:m}=c;(m==null?void 0:m.type)==="georeferenced"||(m==null?void 0:m.type)==="georeferenced-reprojected"?(a.geometryToPlace=m.mesh,a.initialFeature=new Ai({attributes:gl(a),geometry:m.mesh,sourceLayer:o}),t.goTo(a.initialFeature,{animate:!1}).catch(Pd)):a.geometryToPlace=m==null?void 0:m.mesh,u(),n();break}}}),j(()=>{c.cancel(),u()})]);return c.uploadTo(o),y}function en(t){const e=t==null?void 0:t.layer;return(e==null?void 0:e.type)==="scene"}let X=class extends At.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new xi,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter(i=>!i.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,i=e&&e[this._stepIndex];return i&&i.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(e=()=>Promise.resolve(!0)){this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(e={force:!0}){return e.force!==!1?this._cancel(e):new Promise((i,n)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...e,force:!0}).then(i)},deny:()=>n(new U("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:i}=this,n=i.findIndex(s=>s.id===e);this._indexHistory.push(this._stepIndex),await this._go(n)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(e={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=this._stepIndex===-1?0:this._stepIndex;await this._go(e)}async _cancel({emitCancelEvent:e=!0,error:i}={}){this.started&&(this._set("started",!1),await this._transaction(()=>{var n;return(n=this.steps[this._stepIndex])==null?void 0:n.tearDown({canceled:!0})})),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:i})}_go(e=-1,i=!1){return this._transaction(async()=>{const{steps:n}=this;if(!(e<=-1||e>=n.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await n[this._lastStepIndex].tearDown({canceled:i});try{await n[e].setUp()}catch(s){Dd(s)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}})}async _transaction(e){const i=this._pendingOperation,n=un(),s=(i??Promise.resolve()).then(()=>n.promise);this._pendingOperation=s,this._updatingHandles.addPromise(s);try{i&&await i,await e()}finally{n.resolve(),s===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(e=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};r([l()],X.prototype,"data",void 0),r([l()],X.prototype,"hasNextStep",null),r([l()],X.prototype,"hasPreviousStep",null),r([l()],X.prototype,"onCommit",void 0),r([l()],X.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],X.prototype,"hasInvalidFormTemplate",null),r([l()],X.prototype,"shouldShowAttachments",null),r([l()],X.prototype,"shouldAllowAttachmentEditing",null),r([l()],X.prototype,"started",void 0),r([l({readOnly:!0})],X.prototype,"stepId",null),r([l()],X.prototype,"steps",void 0),r([l({readOnly:!0})],X.prototype,"type",void 0),r([l()],X.prototype,"helpMessage",null),r([l()],X.prototype,"hasPendingEdits",null),r([l()],X.prototype,"keyboardCancellationEnabled",null),r([l()],X.prototype,"updating",null),X=r([C("esri.widgets.Editor.Workflow")],X);const za=X;function Bo(t){switch(t){case D.SUPPORTED:break;case D.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case D.GEOMETRY_MISSING:return"no geometry";case D.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case D.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case D.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var D;(function(t){t[t.SUPPORTED=0]="SUPPORTED",t[t.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",t[t.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",t[t.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",t[t.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",t[t.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(D||(D={}));function ly(t){var n,s;if(t.graphic&&((n=t.graphic.layer)==null?void 0:n.type)!=="graphics")return D.GRAPHICS_LAYER_MISSING;const e=(s=t.operations)==null?void 0:s.data.type;if(!e)return D.GEOMETRY_TYPE_UNSUPPORTED;switch(e){case"polygon":case"point":case"polyline":case"mesh":break;default:return D.GEOMETRY_TYPE_UNSUPPORTED}const i=t.elevationInfo;return Ta(i)?D.ELEVATION_MODE_UNSUPPORTED:D.SUPPORTED}function dy(t){return py(t).result}function py(t){var n;if(t.graphic&&((n=t.graphic.layer)==null?void 0:n.type)!=="graphics")return{result:D.GRAPHICS_LAYER_MISSING};if(!t.operations)return{result:D.GEOMETRY_MISSING};if(Ta(t.elevationInfo))return{result:D.ELEVATION_MODE_UNSUPPORTED};const e=t.operations.data.type,i=t.operations.data.geometry;return e==="point"||e==="mesh"||e==="polyline"||e==="polygon"?{result:D.SUPPORTED,geometry:i}:{result:D.GEOMETRY_TYPE_UNSUPPORTED}}function cy(t){var i;if(((i=t.layer)==null?void 0:i.type)!=="graphics")return D.GRAPHICS_LAYER_MISSING;if(t.geometry==null)return D.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return D.SUPPORTED;default:return D.GEOMETRY_TYPE_UNSUPPORTED}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return!e||!e.some(n=>n.type==="object")?D.SYMBOL_TYPE_UNSUPPORTED:xp(t)!=="on-the-ground"&&Vp(t)?D.ELEVATION_MODE_UNSUPPORTED:D.SUPPORTED}function zo(t,e,i){if(!e||!(t!=null&&t.map))return;const{map:n}=t,s=n.layers.find(a=>a===e);s||n.add(e,i),s&&i!=null&&n.layers.reorder(s,i)}function uy(t,e){const i=(e==null?void 0:e.type)==="subtype-sublayer"?e.parent:e;return t.allLayerViews.find(n=>{const s=n.layer;return s===i||"sublayers"in s&&s.sublayers!=null&&s.sublayers.includes(i)})}let re=class extends At.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:pr(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;(e=this.activeComponent)==null||e.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};r([l()],re.prototype,"activeComponent",void 0),r([l()],re.prototype,"cancelled",void 0),r([l()],re.prototype,"history",void 0),r([l()],re.prototype,"tool",null),r([l()],re.prototype,"type",void 0),r([l()],re.prototype,"canUndo",null),r([l()],re.prototype,"canRedo",null),r([l()],re.prototype,"onEnd",void 0),r([l()],re.prototype,"undo",null),r([l()],re.prototype,"redo",null),r([l()],re.prototype,"toggleTool",void 0),r([l()],re.prototype,"addToSelection",void 0),r([l()],re.prototype,"removeFromSelection",void 0),re=r([C("esri.widgets.Sketch.support.OperationHandle")],re);let Un=class extends re{};r([l()],Un.prototype,"activeComponent",void 0),Un=r([C("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],Un);let St=class extends re{};r([l()],St.prototype,"activeComponent",void 0),St=r([C("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],St);const qo={defaultZ:0},Ni={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let A=class extends At.EventedAccessor{constructor(e){var i;super(e),this._numUpdating=0,this._defaultSnappingManager=null,this._internalGraphicsLayer=new ms({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new lo({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Gd({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Nd({color:[130,130,130,1],width:2}),this.meshSymbol=new Hd({symbolLayers:new Q([new Ud])}),this.updateGraphics=new Q,this.updateOnGraphicClick=!0,this.vertexSymbol=new lo({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Zt,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalPopupEnabled=null,this.defaultCreateOptions=qo,this.defaultUpdateOptions=Ni,this.snappingOptions=((i=e==null?void 0:e.snappingManager)==null?void 0:i.options)??(e==null?void 0:e.snappingOptions)??new ui}initialize(){this.addHandles([Ne(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.layers},"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),Ne(()=>{var e;return(e=this.layer)==null?void 0:e.graphics},"change",e=>{if(this._operationHandle!=null)for(const i of e.removed)this.updateGraphics.includes(i)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(i):this._operationHandle.cancel())}),k(()=>{var e;return((e=this.layer)==null?void 0:e.elevationInfo)??null},e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},it),k(()=>this.view,e=>{this._defaultSnappingManager=Se(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new Ge({view:e,options:this.snappingOptions})),e.type==="2d"?E(()=>import("./editingTools-CU2cZK96.js"),__vite__mapDeps([190,1,2,191,6,8,47,192,193,9,44,45,112,104,105,106,107,194,10,11,12,13,195,7,196,197,198,199,200,133,201,202,203,204,108,109,205,206,14,15,16,30,17,3,4,5,207,208,102,209,99,100,58,25,26,65,66,67,68,84,97,210,211,212,96,46,38,213,35,36,110,101,59,43,214,18,19,20,21,22,23,24,27,28,29,31,32,33,34,37,39,40,41,42,48,49,50,51,52,53,54,55,56,57,60,61,62,63,64,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,98,103,111,113,114,115])):e.type==="3d"&&(E(()=>import("./ImageMaterial.glsl-BgV2IVLt.js").then(i=>i.e),__vite__mapDeps([215,216,217,218,109,1,2,105,106,9,108,44,45,104,107,8,112,219,197,195,220,11,221,222,223,224,225,226,227,6,5,212,205,228,204,229,93,230,231,232,233,234,203,235,236,237,238,13,199,200,10,12,207,239,240,4,241,242,243,244,245,246,247,102,198,248,249,208,209,43,3,194,7,196,133,201,202,250,192,193,206,14,15,16,30,17,99,100,58,25,26,65,66,67,68,84,97,210,211,251,252,96,46,47,38,253,254,77,255,256,257,213,35,36,110])),E(()=>import("./LineCallout.glsl-BwvEWs7Q.js").then(i=>i.G),__vite__mapDeps([258,1,2,259,20,21,12,13,11,10,3,4,5,236,106,220,237,9,44,45,108,109,105,104,107,8,112,238,212,205,218,219,197,195,217,221,216,222,223,224,225,226,227,6,228,204,229,93,230,199,200,207,239,240,241,232,233,242,30,17,58,25,26,33,32,23,24,28,29,31,34,35,36,37,27,38,39,40,41,42,43,46,47,48,49,260,208,102,209,131,261,68,262,263,264,265,266,267,268,269,270,271,272,273,274,275,101,59,276,277,54,55,278,279,280,281,119,120,282,248]))))},it),k(()=>{var e;return(e=this.view)==null?void 0:e.spatialReference},(e,i)=>{e&&i&&!e.equals(i)&&this.cancel()})]),hu(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Se(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this.emit("destroy")}get updating(){return this._numUpdating>0||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){var e;return((e=this._operationHandle)==null?void 0:e.tool)??null}get activeTooltip(){const{activeComponent:e,destroyed:i}=this,n=!i&&e&&"tooltip"in e?e.tooltip:null;return n!=null&&n.visible?n:null}get activeComponent(){var e;return((e=this._operationHandle)==null?void 0:e.activeComponent)??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...qo,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Ni,...e,reshapeOptions:{...Ni.reshapeOptions,...e==null?void 0:e.reshapeOptions},highlightOptions:{...Ni.highlightOptions,...e==null?void 0:e.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){var e;return((e=this.snappingManager)==null?void 0:e.options)??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Se(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:i}=this;!this._defaultSnappingManager&&i&&(this._defaultSnappingManager=new Ge({options:this.snappingOptions,view:i})),this._clearOverride("snappingManager")}}get state(){var n;const e=!(!((n=this.view)!=null&&n.ready)||!this.layer),i=this._operationHandle;return e&&i?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const i=this._get("view");if(i){const{container:s,map:a}=i;s&&(i.cursor=null),a==null||a.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const n="view-ready";this.removeHandles(n),e&&this.addHandles(si(()=>e.ready,s=>{this.removeHandles(this._viewHandlesKey),s&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},it),n),this._set("view",e)}cancel(){this._moduleLoaderAbortController=ni(this._moduleLoaderAbortController),this._viewReadyAbortController=ni(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:i}=this;if(e==="active"&&i.length){const{activeTool:n,layer:s}=this,a=i.toArray();s.removeMany(a),this.cancel(),this._emitDeleteEvent({graphics:a,tool:n})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(i=>i.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,i){this.cancel(),await this._waitViewReady();const{view:n,layer:s}=this;if(!n||this.state==="disabled")throw s||this._logMissingLayer(),Ys();if(n.activeTool!=null&&(n.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");zo(n,this._internalGraphicsLayer);const a=await this._setupCreateOperation(e,i);if(a==null||this.destroyed)return void n.map.remove(this._internalGraphicsLayer);const o=()=>{var d;if(a===this._operationHandle){const p=this.createGraphic,c=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),(d=this.view)!=null&&d.map&&this.view.map.remove(this._internalGraphicsLayer),a.cancelled||p==null||s.add(p),this.emit("create",{graphic:p,state:c?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}};a.on("complete",o),this._operationHandle=a,n.ready&&n.focus()}async place(e,i){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...i})}async update(e,i){this.cancel(),await this._waitViewReady();const{layer:n,view:s,state:a}=this;if(!s||a==="disabled")throw n||this._logMissingLayer(),Ys();s.activeTool!=null&&(s.activeTool=null);const o=Array.isArray(e)?e:[e];if(e==null||!(o!=null&&o.length))return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(o.some(p=>p.layer!==n?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):p.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const d=await this._setupUpdateOperation(o,i);this.destroyed||d==null||J(d)||(zo(s,this._internalGraphicsLayer),this._setUpdateOperationHandle(d,i),this.emit("update",{graphics:o,state:"start",aborted:!1,tool:d.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const i=this.view;if(i){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const n of e)n.geometry==null||n.geometry.type==="mesh"||Yi(n.geometry.spatialReference,i.spatialReference)||(Sp(n.geometry.spatialReference,i.spatialReference)||Fp()||await Op(),n.geometry=ta(n.geometry,i.spatialReference));this._endAsyncOperation()}else this._logMissingView()}undo(){var e;this.canUndo()&&((e=this._operationHandle)==null||e.undo())}redo(){var e;this.canRedo()&&((e=this._operationHandle)==null||e.redo())}canUndo(){var e;return!!((e=this._operationHandle)!=null&&e.canUndo())}canRedo(){var e;return!!((e=this._operationHandle)!=null&&e.canRedo())}toggleUpdateTool(){var e;(e=this._operationHandle)==null||e.toggleTool()}async _getFirstHit(e){const i=this.view;if(!i)return this._logMissingView(),null;if(i.type==="2d"){const a=[];i.map.allLayers.forEach(d=>{d.type!=="vector-tile"&&d.type!=="imagery"||a.push(d)});const o=await i.hitTest(e,{exclude:a});return hc(o.results)}const n=[i.map.ground];i.map.allLayers.forEach(a=>{Wd(a.type)&&n.push(a)});const s=await i.hitTest(e,{exclude:n});if(s.results.length>0){const a=s.results[0];if(a!=null&&a.type==="graphic"&&a.graphic&&(!s.ground.mapPoint||i.map.ground.opacity<1||s.ground.distance-(a.distance??0)>-Math.min(3*s.ground.distance,i.viewingMode==="global"?jd(i.renderCoordsHelper.spatialReference).radius/i.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return a}return null}_generateViewHandles(e){return[e.on("immediate-click",async i=>{var o;const n=this.state==="active"&&((o=this._operationHandle)==null?void 0:o.type)==="create";if(this.state==="disabled"||n||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const s=await i.async(()=>this._getFirstHit(fo(i)));let a=null;if(s!=null){const d=s.graphic;this.updateGraphics.includes(d)||d.layer===this.layer?(i.stopPropagation(),a=d):e.type!=="2d"||this._isComponentGraphic(d)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();a==null||this.updateGraphics.includes(a)||await this.update([a],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()},q.WIDGET)]}async _setupCreateOperation(e,i){const n=this.view;if(!n)return this._logMissingView(),null;const s={hasZ:n.type==="3d",...this.defaultCreateOptions,...i},a=await this._setupDrawGraphicTool(e,n,s);return a==null?null:(n.tools.add(a),n.activeTool=a,this._setupCreateOperationHandle(a))}async _setupDrawGraphicTool(e,i,n){if(e==="multipoint"&&i.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!i)return this._logMissingView(),null;const{cursor:s,defaultZ:a,hasZ:o,geometryToPlace:d,graphicProperties:p,mode:c,preserveAspectRatio:h}=n,u=e==="rectangle"||e==="circle"?"hybrid":"click",y=h??e!=="rectangle",g={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:s,defaultZ:a,forceUniformSize:y,graphicProperties:p,geometryToPlace:d,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:o,mode:c??u,snappingManager:this.snappingManager,snapToScene:!1,view:i};return i.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(e){const i=await this._requireModule(E(()=>import("./editingTools-CU2cZK96.js"),__vite__mapDeps([190,1,2,191,6,8,47,192,193,9,44,45,112,104,105,106,107,194,10,11,12,13,195,7,196,197,198,199,200,133,201,202,203,204,108,109,205,206,14,15,16,30,17,3,4,5,207,208,102,209,99,100,58,25,26,65,66,67,68,84,97,210,211,212,96,46,38,213,35,36,110,101,59,43,214,18,19,20,21,22,23,24,27,28,29,31,32,33,34,37,39,40,41,42,48,49,50,51,52,53,54,55,56,57,60,61,62,63,64,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,98,103,111,113,114,115])));return J(i)||this.destroyed?null:new i.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:yy(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const i=await this._requireModule(E(()=>import("./ImageMaterial.glsl-BgV2IVLt.js").then(s=>s.e),__vite__mapDeps([215,216,217,218,109,1,2,105,106,9,108,44,45,104,107,8,112,219,197,195,220,11,221,222,223,224,225,226,227,6,5,212,205,228,204,229,93,230,231,232,233,234,203,235,236,237,238,13,199,200,10,12,207,239,240,4,241,242,243,244,245,246,247,102,198,248,249,208,209,43,3,194,7,196,133,201,202,250,192,193,206,14,15,16,30,17,99,100,58,25,26,65,66,67,68,84,97,210,211,251,252,96,46,47,38,253,254,77,255,256,257,213,35,36,110])));if(J(i)||this.destroyed)return null;const{elevationInfo:n}=this.layer;return new i.module.DrawGraphicTool3D({...e,elevationInfo:n,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const i=this.view;if(!i)return this._logMissingView(),null;let n=null;const s=e.forceUniformSize,a=e.centered,o=[i.on("key-down",p=>{if(p.key===Z.pan)p.stopPropagation(),p.repeat||(e.enabled=!1);else if(p.key===Z.complete)p.stopPropagation(),e.completeCreateOperation();else if(p.key!==Z.vertexAdd||p.repeat)p.key===Z.undo?(p.stopPropagation(),d.undo()):p.key===Z.redo?(p.stopPropagation(),d.redo()):p.key!==Z.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||p.repeat?p.key===Z.center&&(p.repeat||(e.centered=!a,p.stopPropagation())):(e.forceUniformSize=!s,p.stopPropagation());else{const c=e.drawOperation.geometryType;c!=="polyline"&&c!=="polygon"&&c!=="multipoint"||(p.stopPropagation(),e.drawOperation.commitStagedVertex())}},q.WIDGET),i.on("key-up",p=>{p.key===Z.pan?e.enabled=!0:p.key!==Z.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?p.key===Z.center&&(e.centered=a,p.stopPropagation()):(e.forceUniformSize=s,p.stopPropagation())},q.WIDGET),e.on("vertex-add",p=>{switch(n=n==null?"start":"active",p.operation){case"apply":this.emit("create",{graphic:e.graphic,state:n,tool:this.activeTool,toolEventInfo:p,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",p=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:p.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",p=>{switch(p.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:p,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",p=>{this._set("createGraphic",p.graphic),n="complete",p.aborted?d&&d.cancel():d&&d.complete()}),k(()=>this._getGraphicSymbolFromTool(e.geometryType),p=>{e.graphicSymbol=p})],d=new Un({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{var p;rt(o),(p=i.tools)==null||p.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return d}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,i){var d;const{layer:n,view:s}=this;if(!s)return this._logMissingView(),null;const a={...this.defaultUpdateOptions,...i,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...i==null?void 0:i.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...i==null?void 0:i.highlightOptions}};let o=a.tool??Ni.tool;for(const p of e)n.remove(p),n.add(p);if(s.type==="3d"){if(e.length===0)return null;switch(o){case"move":return this._setupMove3DOperation(e,a,s,o);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],a,s);case"transform":return this._setupGraphicTransform3DOperation(e,a,s)}}switch(o){case"move":return this._setupMove2DOperation(e,a,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,o,a,s);case"transform":if(e.length===1){const p=(d=e[0].geometry)==null?void 0:d.type;p!=="point"&&p!=="multipoint"||(o="reshape")}return this._setupTransformOrReshape2DOperation(e,o,a,s)}}async _setupMove3DOperation(e,i,n,s,a=!1){const o=await this._requireModule(E(()=>import("./ImageMaterial.glsl-BgV2IVLt.js").then(m=>m.e),__vite__mapDeps([215,216,217,218,109,1,2,105,106,9,108,44,45,104,107,8,112,219,197,195,220,11,221,222,223,224,225,226,227,6,5,212,205,228,204,229,93,230,231,232,233,234,203,235,236,237,238,13,199,200,10,12,207,239,240,4,241,242,243,244,245,246,247,102,198,248,249,208,209,43,3,194,7,196,133,201,202,250,192,193,206,14,15,16,30,17,99,100,58,25,26,65,66,67,68,84,97,210,211,251,252,96,46,47,38,253,254,77,255,256,257,213,35,36,110])));if(J(o))return o;const{ManipulatedObject3DGraphic:d,MoveTool3D:p}=o.module,c=new Map,h=()=>{c.forEach(m=>m.destroy()),c.clear()};for(const m of e){const v=new d({view:n,graphic:m}),_=ly(v);if(_!==D.SUPPORTED)return h(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Bo(_)}).`),null;c.set(m,v)}const u=new p({view:n,enableZ:i.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(u),u.objects.addMany(Array.from(c.values())),a||this.updateGraphics.addMany(e);const y=[],g=new St({activeComponent:u,tool:s,type:"update",onEnd:()=>{rt(y),Fn(n,u),h()},undo:()=>{Ko(this.view,u),$n(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},redo:()=>{Sn(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:m=>{this.updateGraphics.push(m);const v=new d({view:n,graphic:m});c.set(m,v),u.objects.push(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[m],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:m=>{const v=this.updateGraphics.indexOf(m);if(g.history.undo.forEach(w=>w.updates.splice(v,1)),g.history.redo.forEach(w=>w.updates.splice(v,1)),this.updateGraphics.remove(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[m],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void g.complete();const _=c.get(m);_&&(u.objects.remove(_),_.destroy(),c.delete(m))},toggleTool:async()=>{if(this.updateGraphics.length!==1||i.toggleToolOnClick===!1||s!=="transform")return;const m=this.updateGraphics.at(0),v=await this._setupReshape3DOperation(m,i,n,!0);v&&!J(v)&&(g.onEnd(),g.destroy(),this._setUpdateOperationHandle(v,i))}});return y.push(...this._getHandlesForComponent(g,i),n.on("immediate-click",m=>this._getCommonUpdateOperationClickHandlers(g,m,i),q.WIDGET),n.on("key-down",m=>{this._getCommonUpdateOperationKeyDownHandlers(g,m)},q.WIDGET)),g}_setupGraphicTransform3DOperation(e,i,n,s=!1){if(e.length===1&&cy(e[0])===D.SUPPORTED){const a=e[0],o=a.geometry;if(o!=null&&(o.type==="point"||o.type==="mesh"))return this._setupPointTransform3DOperation(a,i,n);if(o!=null&&(o.type==="polygon"||o.type==="polyline"))return this._setupPolyTransform3DOperation(a,i,n,s)}return this._setupMove3DOperation(e,i,n,"transform",s)}async _setupPointTransform3DOperation(e,i,n){const s="transform",{enableRotation:a,enableScaling:o,enableZ:d}=i,p=await this._requireModule(E(()=>import("./ImageMaterial.glsl-BgV2IVLt.js").then(v=>v.e),__vite__mapDeps([215,216,217,218,109,1,2,105,106,9,108,44,45,104,107,8,112,219,197,195,220,11,221,222,223,224,225,226,227,6,5,212,205,228,204,229,93,230,231,232,233,234,203,235,236,237,238,13,199,200,10,12,207,239,240,4,241,242,243,244,245,246,247,102,198,248,249,208,209,43,3,194,7,196,133,201,202,250,192,193,206,14,15,16,30,17,99,100,58,25,26,65,66,67,68,84,97,210,211,251,252,96,46,47,38,253,254,77,255,256,257,213,35,36,110])));if(J(p))return p;const{TransformTool3D:c,ManipulatedObject3DGraphic:h}=p.module,u=new h({graphic:e,view:n}),y=new c({object:u,view:n,enableRotation:a,enableScaling:o,enableZ:d,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(y),this.updateGraphics.add(e);const g=[],m=new St({activeComponent:y,tool:s,type:"update",onEnd:()=>{rt(g),Fn(n,y),u.destroy()},undo:()=>{Ko(this.view,y),$n(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},redo:()=>{Sn(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async v=>{this.updateGraphics.add(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),i,n,"transform",!0);J(_)||this._setUpdateOperationHandle(_,i)},removeFromSelection:v=>{this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),m.complete()},toggleTool:()=>{}});return g.push(...this._getHandlesForComponent(m,i),n.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(m,v,i),q.WIDGET),n.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(m,v)},q.WIDGET)),m}async _setupPolyTransform3DOperation(e,i,n,s=!1){var b,M;const a="transform",{enableRotation:o,enableScaling:d,enableZ:p,preserveAspectRatio:c}=i,h=await this._requireModule(E(()=>import("./ImageMaterial.glsl-BgV2IVLt.js").then(I=>I.e),__vite__mapDeps([215,216,217,218,109,1,2,105,106,9,108,44,45,104,107,8,112,219,197,195,220,11,221,222,223,224,225,226,227,6,5,212,205,228,204,229,93,230,231,232,233,234,203,235,236,237,238,13,199,200,10,12,207,239,240,4,241,242,243,244,245,246,247,102,198,248,249,208,209,43,3,194,7,196,133,201,202,250,192,193,206,14,15,16,30,17,99,100,58,25,26,65,66,67,68,84,97,210,211,251,252,96,46,47,38,253,254,77,255,256,257,213,35,36,110])));if(J(h))return h;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:y}=h.module,g=(M=(b=this.view)==null?void 0:b.inputManager)==null?void 0:M.isModifierKeyDown(Z.constraint),m=new u({view:n,graphic:e}),v=new y({object:m,view:n,enableRotation:o,enableScaling:d,enableZ:p,preserveAspectRatio:!!c!=!!g,sketchOptions:this.sketchOptions});n.tools.add(v),s||this.updateGraphics.add(e);const _=[],w=new St({activeComponent:v,tool:a,type:"update",onEnd:()=>{rt(_),Fn(n,v),m.destroy()},canUndo:()=>!v.destroyed&&v.canUndo,undo:()=>{v.destroyed||(v.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},canRedo:()=>!v.destroyed&&v.canRedo,redo:()=>{v.destroyed||(v.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},addToSelection:async I=>{this.updateGraphics.add(I),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[I],removed:[],type:"selection-change"},type:"update"}),w.onEnd(),w.destroy();const F=await this._setupMove3DOperation(this.updateGraphics.toArray(),i,n,"transform",!0);J(F)||this._setUpdateOperationHandle(F,i)},removeFromSelection:I=>{this.updateGraphics.remove(I),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[I],type:"selection-change"},type:"update"}),w.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||i.toggleToolOnClick===!1)return;const I=await this._setupReshape3DOperation(e,i,n,!0);I&&!J(I)&&(w.onEnd(),w.destroy(),this._setUpdateOperationHandle(I,i))}});return _.push(...this._getHandlesForComponent(w,i),n.on("immediate-click",I=>this._getCommonUpdateOperationClickHandlers(w,I,i),q.WIDGET),n.on("key-down",I=>this._getCommonUpdateOperationKeyDownHandlers(w,I),q.WIDGET),n.on("key-down",I=>{I.key!==Z.constraint||I.repeat||(v.preserveAspectRatio=!v.preserveAspectRatio,I.stopPropagation())},q.WIDGET),n.on("key-up",I=>{I.key===Z.constraint&&(v.preserveAspectRatio=!v.preserveAspectRatio,I.stopPropagation())},q.WIDGET)),w}async _setupMove2DOperation(e,i,n){const s="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const a=await this._getGraphicMover(e,i,n);if(J(a))return a;const o=new St({activeComponent:a,tool:s,type:"update",onEnd:()=>{var h;this._displayDefaultCursor(),rt(c),rt(p),a.destroy(),(h=this._internalGraphicsLayer)==null||h.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const h=this.updateGraphics.toArray();$n(o,h),o.refreshComponent(),this._emitUndoEvent({graphics:h,tool:s})},redo:()=>{const h=this.updateGraphics.toArray();Sn(o,h),o.refreshComponent(),this._emitRedoEvent({graphics:h,tool:s})},addToSelection:async h=>{await this._updateSpatialReference(h),this.updateGraphics.push(h),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:h=>{const u=this.updateGraphics.indexOf(h);o.history.undo.forEach(g=>g.updates.splice(u,1)),o.history.redo.forEach(g=>g.updates.splice(u,1)),this.updateGraphics.remove(h);const y=this.updateGraphics.toArray();this.emit("update",{graphics:y,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?a.graphics=y:o.complete()}});let d=!1;const p=[n.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(o,h,i),q.WIDGET),n.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(o,h),h.key!==Z.constraint||h.repeat||(d=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},q.WIDGET),n.on("key-up",h=>{h.key===Z.constraint&&d&&(d=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},q.WIDGET)],c=this._getHandlesForComponent(o,i);return o}async _setupReshape3DOperation(e,i,n,s=!1){const a="reshape",o=await this._requireModule(E(()=>import("./ImageMaterial.glsl-BgV2IVLt.js").then(v=>v.e),__vite__mapDeps([215,216,217,218,109,1,2,105,106,9,108,44,45,104,107,8,112,219,197,195,220,11,221,222,223,224,225,226,227,6,5,212,205,228,204,229,93,230,231,232,233,234,203,235,236,237,238,13,199,200,10,12,207,239,240,4,241,242,243,244,245,246,247,102,198,248,249,208,209,43,3,194,7,196,133,201,202,250,192,193,206,14,15,16,30,17,99,100,58,25,26,65,66,67,68,84,97,210,211,251,252,96,46,47,38,253,254,77,255,256,257,213,35,36,110])));if(J(o))return o;const{ManipulatedObject3DGraphic:d,ReshapeTool3D:p}=o.module,c=new d({view:n,graphic:e}),h=dy(c);if(h!==D.SUPPORTED)return c.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Bo(h)}).`),null;const u=i.reshapeOptions,y=new p({view:n,object:c,enableZVertex:i.enableZ&&(u==null?void 0:u.vertexOperation)==="move",enableZShape:i.enableZ&&(u==null?void 0:u.shapeOperation)==="move",enableMoveObject:(u==null?void 0:u.shapeOperation)==="move"||(u==null?void 0:u.shapeOperation)==="move-xy",enableMidpoints:(u==null?void 0:u.edgeOperation)==="split",enableEdgeOffset:(u==null?void 0:u.edgeOperation)==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(y),s||this.updateGraphics.add(c.graphic);const g=[],m=new St({activeComponent:y,tool:a,type:"update",onEnd:()=>{rt(g),Fn(n,y),c.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},addToSelection:async v=>{this.updateGraphics.add(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),i,n,"transform",!0);J(_)||this._setUpdateOperationHandle(_,i)},removeFromSelection:v=>{this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),m.complete()},toggleTool:async()=>{if(i.toggleToolOnClick===!1)return;m.onEnd(),m.destroy();const v=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),i,n,!0);J(v)||this._setUpdateOperationHandle(v,i)}});return g.push(...this._getHandlesForComponent(m,i),n.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(m,v,i),q.WIDGET),n.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(m,v)},q.WIDGET)),m}async _setupTransformOrReshape2DOperation(e,i,n,s){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const a=i==="transform"?await this._getBox(e,n,s):await this._getReshape(e,n,s);if(J(a))return a;const o=new St({activeComponent:a,type:"update",onEnd:()=>{rt(p),rt(d),o.activeComponent&&!o.activeComponent.destroyed&&o.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{$n(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},redo:()=>{Sn(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},addToSelection:async c=>{let h=o.activeComponent;if((h==null?void 0:h.type)==="reshape"){const u=[...this.updateGraphics,c];this.updateGraphics.removeAll(),o.onEnd(),o.destroy();const y=await this._setupTransformOrReshape2DOperation(u,"transform",n,s);if(J(y))return;this._setUpdateOperationHandle(y,n)}else this.updateGraphics.add(c),h.graphics=this.updateGraphics.toArray(),h.refresh(),o.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async c=>{const h=this.updateGraphics.indexOf(c);o.history.undo.forEach(y=>y.updates.splice(h,1)),o.history.redo.forEach(y=>y.updates.splice(h,1)),this.updateGraphics.remove(c);const u=this.updateGraphics.toArray();if(u.length===0)o.complete();else{const y=u[0].geometry;u.length!==1||y==null||y.type!=="point"&&y.type!=="multipoint"?o.activeComponent.graphics=u:o.toggleTool()}this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"})},toggleTool:async()=>{var y;if(this.updateGraphics.length>1)return;const c=this.updateGraphics.at(0),h=c.geometry;if(h!=null&&(o.tool==="reshape"&&(h.type==="point"||h.type==="multipoint")||o.tool==="transform"&&h.type==="extent"))return;let u=null;o.tool==="transform"?u=await this._getReshape([c],n,s):o.tool==="reshape"&&(u=await this._getBox([c],n,s)),J(u)||((y=o.activeComponent)==null||y.destroy(),o.activeComponent=u,o.activeComponent&&(rt(p),p=this._getHandlesForComponent(o,n)))}}),d=[s.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(o,c,n),q.WIDGET),s.on("key-down",c=>{if(this._getCommonUpdateOperationKeyDownHandlers(o,c),c.key===Z.constraint&&!c.repeat&&o){const h=o.activeComponent;h&&h.type==="box"&&(h.preserveAspectRatio=!h.preserveAspectRatio)}},q.WIDGET),s.on("key-up",c=>{if(c.key===Z.constraint&&o){const h=o.activeComponent;h&&h.type==="box"&&(h.preserveAspectRatio=!h.preserveAspectRatio)}},q.WIDGET)];let p=this._getHandlesForComponent(o,n);return o}async _getGraphicMover(e,i,n){const{enableMoveAllGraphics:s,highlightOptions:a}=i,o=await this._requireModule(E(()=>import("./GraphicMover-BXAg2mBy.js"),__vite__mapDeps([283,1,2,99,100,58,25,26,65,66,67,68,84,4,5,214,101,59,102,213,6,9,13,11,12,3,35,36,110,8,10,14,15,16,17,18,19,20,21,22,23,24,27,28,29,30,31,32,33,34,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,60,61,62,63,64,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,103,104,105,106,107,108,109,111,112,113,114,115])));return J(o)?o:new o.module.default({enableMoveAllGraphics:s,highlightsEnabled:!!(a!=null&&a.enabled),indicatorsEnabled:!1,graphics:e,view:n,callbacks:{onGraphicMoveStart:({dx:d,dy:p,graphic:c})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:p,mover:c,type:"move-start"},type:"update"})},onGraphicMove:({dx:d,dy:p,graphic:c})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:p,mover:c,type:"move"},type:"update"}),onGraphicMoveStop:({dx:d,dy:p,graphic:c})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:p,mover:c,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,i,n){var h,u;const{enableRotation:s,enableScaling:a,highlightOptions:o,preserveAspectRatio:d}=i,p=await this._requireModule(E(()=>import("./Box-DjZBm2t7.js"),__vite__mapDeps([284,1,2,214,283,99,100,58,25,26,65,66,67,68,84,4,5,101,59,102,213,6,9,13,11,12,3,35,36,110,8,10,14,15,16,17,18,19,20,21,22,23,24,27,28,29,30,31,32,33,34,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,60,61,62,63,64,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,103,104,105,106,107,108,109,111,112,113,114,115,285,194,195,7,196,197,198,199,200,133,201,202,257,252])));if(J(p))return p;const c=(u=(h=this.view)==null?void 0:h.inputManager)==null?void 0:u.isModifierKeyDown(Z.constraint);return new p.module.default({graphics:e,enableRotation:s,enableScaling:a,highlightsEnabled:!!(o!=null&&o.enabled),preserveAspectRatio:!!d!=!!c,layer:this._internalGraphicsLayer,view:n,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onMove:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onMoveStop:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onScaleStart:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onScale:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onScaleStop:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onRotateStart:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onRotate:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"}),onRotateStop:y=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...y},type:"update"})}})}async _getReshape(e,i,n){var p,c,h;const s=((p=i.reshapeOptions)==null?void 0:p.edgeOperation)==="split",a=((c=i.reshapeOptions)==null?void 0:c.shapeOperation)==="move",o=!!((h=i.highlightOptions)!=null&&h.enabled),d=await this._requireModule(E(()=>import("./Reshape-DJof3RzQ.js"),__vite__mapDeps([286,1,2,99,100,58,25,26,65,66,67,68,84,4,5,112,191,6,8,47,192,193,9,44,45,104,105,106,107,194,10,11,12,13,195,7,196,197,198,199,200,133,201,202,203,204,108,109,205,214,283,101,59,102,213,3,35,36,110,14,15,16,17,18,19,20,21,22,23,24,27,28,29,30,31,32,33,34,37,38,39,40,41,42,43,46,48,49,50,51,52,53,54,55,56,57,60,61,62,63,64,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,103,111,113,114,115,251,252,285])));return J(d)?d:new d.module.default({enableMidpoints:s,enableMovement:a,graphic:e[0],highlightsEnabled:o,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:n,callbacks:{onReshapeStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshape:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshapeStop:({mover:u,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:u,type:y},type:"update"}),onMoveStart:({dx:u,dy:y,mover:g,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:y,mover:g,type:m},type:"update"}),onMove:({dx:u,dy:y,mover:g,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:y,mover:g,type:m},type:"update"}),onMoveStop:({dx:u,dy:y,mover:g,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:y,mover:g,type:m},type:"update"}),onVertexAdd:({added:u,type:y,vertices:g})=>{const m=u.map(v=>po(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:m,vertices:g,type:y},type:"update"})},onVertexRemove:({removed:u,type:y,vertices:g})=>{const m=u.map(v=>po(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:m,vertices:g,type:y},type:"update"})}}})}_getHandlesForComponent(e,i){const n=e.activeComponent;if(!n)return[];switch(n.type){case"graphic-mover":return[n.on("graphic-click",({graphic:s,viewEvent:a})=>{var o;(o=a.native)!=null&&o.shiftKey&&(a.stopPropagation(),e.removeFromSelection(s))}),n.on("graphic-move-start",s=>e.addToHistory(xt(s.allGraphics)))];case"box":return[n.on("graphic-click",s=>this._onTransformOrReshape2DGraphicClick(e,i,s)),n.on("move-start",s=>e.addToHistory(xt(s.graphics))),n.on("rotate-start",s=>e.addToHistory(xt(s.graphics))),n.on("scale-start",s=>e.addToHistory(xt(s.graphics)))];case"reshape":return[n.on("graphic-click",s=>this._onTransformOrReshape2DGraphicClick(e,i,s)),n.on("move-start",s=>e.addToHistory(xt([s.mover]))),n.on("reshape-start",s=>e.addToHistory(xt([s.graphic]))),n.on("vertex-add",s=>e.addToHistory(xt([s.oldGraphic]))),n.on("vertex-remove",s=>e.addToHistory(xt([s.oldGraphic])))];case"move-3d":return[n.events.on("record-undo",({updates:s})=>{e.addToHistory({updates:s})}),n.events.on("move-start",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:s.objects.length>0?s.objects[0].graphic:null,type:"move-start"},type:"update"})}),n.events.on("move",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s.dx,dy:s.dy,mover:s.objects.length>0?s.objects[0].graphic:null,type:"move"},type:"update"})}),n.events.on("move-stop",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:s.objects.length>0?s.objects[0].graphic:null,type:"move-stop"},type:"update"})}),n.events.on("immediate-click",s=>{s.shiftKey?this._toggleSelection([s.object.graphic],e,i):e.toggleTool()})];case"transform-3d":return[n.events.on("record-undo",({updates:s})=>{e.addToHistory({updates:s})}),n.events.on("translate-start",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,dx:s.dxScreen,dy:s.dyScreen,type:"move-start"},type:"update"})}),n.events.on("translate-stop",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,dx:s.dxScreen,dy:s.dyScreen,type:"move-stop"},type:"update"})}),n.events.on("rotate-start",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,angle:s.angle,type:"rotate-start"},type:"update"})}),n.events.on("rotate-stop",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,angle:s.angle,type:"rotate-stop"},type:"update"})}),n.events.on("scale-start",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,xScale:s.xScale,yScale:s.yScale,type:"scale-start"},type:"update"})}),n.events.on("scale-stop",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,xScale:s.xScale,yScale:s.yScale,type:"scale-stop"},type:"update"})}),n.events.on("translate",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,dx:s.dxScreen,dy:s.dyScreen,type:"move"},type:"update"})}),n.events.on("rotate",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,angle:s.angle,type:"rotate"},type:"update"})}),n.events.on("scale",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s.object.graphic,xScale:s.xScale,yScale:s.yScale,type:"scale"},type:"update"})}),n.events.on("immediate-click",s=>{s.shiftKey?this._toggleSelection([s.object.graphic],e,i):e.toggleTool()})];case"reshape-3d":return[n.events.on("reshape",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s,mover:s.object.graphic},type:"update"})}),n.events.on("move",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s,mover:s.object.graphic},type:"update"})}),n.events.on("vertex-add",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:s,type:"update"})}),n.events.on("vertex-remove",s=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:s,type:"update"})}),n.events.on("immediate-click",s=>{s.shiftKey?this._toggleSelection([s.object.graphic],e,i):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,i,n){var o;const{graphic:s,viewEvent:a}=n;return(o=a.native)!=null&&o.shiftKey&&s.layer===this.layer?(a.stopPropagation(),e.removeFromSelection(s)):i.toggleToolOnClick?(a.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,i){var a;this._operationHandle=e;const n=(a=this.view)==null?void 0:a.map;this._disablePopup(i);const s=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),d=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),n&&n.remove(this._internalGraphicsLayer),this._restorePopup(i),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:d,toolEventInfo:null,type:"update"})}};e.on("complete",s)}async _getCommonUpdateOperationClickHandlers(e,i,n){const s=fo(i),a=await i.async(()=>this._getFirstHit(s));if(a==null)return void e.complete();if(i.native.shiftKey&&this._toggleSelection([a.graphic],e,n))return void i.stopPropagation();this.updateGraphics.includes(a.graphic)?i.stopPropagation():e.complete()}_toggleSelection(e,i,n){const s=!!n.multipleSelectionEnabled;return e.some(a=>a!=null&&!(!s||a.layer!==this.layer)&&(this.updateGraphics.includes(a)?i.removeFromSelection(a):i.addToSelection(a),!0))}_getCommonUpdateOperationKeyDownHandlers(e,i){if(!e)return;const n=i.key;n===Z.undo&&e.canUndo()?(i.stopPropagation(),e.undo()):n===Z.redo&&e.canRedo()?(i.stopPropagation(),e.redo()):n===Z.cancel?(i.stopPropagation(),e.cancel()):this.allowDeleteKey&&Z.delete.includes(n)&&this._onDeleteKey(i)}_onDeleteKey(e){var s;if(!this._operationHandle||this._operationHandle.type!=="update")return;const i=this.activeComponent,n=this.updateGraphics.toArray();i!=null&&(i.type!=="reshape"||n.length===1&&((s=n[0].geometry)==null?void 0:s.type)==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){var e,i;this._internalGraphicsLayer&&((i=(e=this.view)==null?void 0:e.map)==null||i.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Se(this._internalGraphicsLayer))}_isComponentGraphic(e){var n;const{activeComponent:i}=this;return!(!e||i==null)&&(((n=e.attributes)==null?void 0:n.esriSketchTool)||i.type==="draw-2d"&&i.graphic===e||(i.type==="box"||i.type==="reshape")&&i.isUIGraphic(e))}_displayPointerCursor(){var e;(e=this.view)!=null&&e.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){var e;(e=this.view)!=null&&e.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){var e;(e=this.view)!=null&&e.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,i,n){le.getLogger(this).error(new U(e,i,n))}async _requireModule(e){const i=new AbortController;this._moduleLoaderAbortController=i;const n=await e;return this._moduleLoaderAbortController!==i||i.signal.aborted?{requireError:"aborted"}:{module:n}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return ue(()=>!this.updating)}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var i;return((i=this.view)==null?void 0:i.type)!=="3d"||this.updateOnGraphicClick||((e==null?void 0:e.toggleToolOnClick)??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(ni(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await rn(ue(()=>e==null?void 0:e.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Zo("view"))}_logMissingLayer(){this._logError(hy,Zo("layer"))}};r([l()],A.prototype,"_defaultSnappingManager",void 0),r([l()],A.prototype,"updating",null),r([l()],A.prototype,"_operationHandle",void 0),r([l({readOnly:!0})],A.prototype,"activeTool",null),r([l()],A.prototype,"activeTooltip",null),r([l()],A.prototype,"activeFillSymbol",void 0),r([l()],A.prototype,"activeLineSymbol",void 0),r([l()],A.prototype,"activeVertexSymbol",void 0),r([l()],A.prototype,"allowDeleteKey",void 0),r([l({readOnly:!0})],A.prototype,"createGraphic",null),r([l()],A.prototype,"defaultCreateOptions",null),r([l()],A.prototype,"defaultUpdateOptions",null),r([l({type:Ga,nonNullable:!0})],A.prototype,"labelOptions",null),r([l()],A.prototype,"layer",void 0),r([l({types:kn})],A.prototype,"pointSymbol",void 0),r([l({types:kn})],A.prototype,"polygonSymbol",void 0),r([l({types:kn})],A.prototype,"polylineSymbol",void 0),r([l()],A.prototype,"meshSymbol",void 0),r([l({type:ui,nonNullable:!0})],A.prototype,"snappingOptions",null),r([l()],A.prototype,"snappingManager",null),r([l({readOnly:!0})],A.prototype,"state",null),r([l({type:ja,nonNullable:!0})],A.prototype,"tooltipOptions",null),r([l({readOnly:!0})],A.prototype,"updateGraphics",void 0),r([l()],A.prototype,"updateOnGraphicClick",void 0),r([l({type:Cs,nonNullable:!0})],A.prototype,"valueOptions",null),r([l({types:kn})],A.prototype,"vertexSymbol",void 0),r([l({value:null})],A.prototype,"view",null),r([l({constructOnly:!0,type:Zt})],A.prototype,"sketchOptions",void 0),A=r([C("esri.widgets.Sketch.SketchViewModel")],A);const hy="sketch:missing-property",Zo=t=>`Property '${t}' is missing on SketchViewModel.`;function yy(t){return t==="polygon"||t==="rectangle"||t==="circle"}function $n(t,e){El("undo",t.history.undo,t.history.redo,e)}function Sn(t,e){El("redo",t.history.redo,t.history.undo,e)}function El(t,e,i,n){const s=e.pop();if(!s)return;const a=s.updates,o=[];n.forEach((d,p)=>{const c=a[p];c!=null&&("geometry"in c&&c.geometry!=null&&(o.push({geometry:d.geometry}),d.geometry=c.geometry),"symbol"in c&&c.symbol!=null&&(o.push({symbol:d.symbol}),d.symbol=c.symbol),"undo"in c&&(o.push(c),c[t](d)))}),i.push({updates:o})}function Ko(t,e){t!=null&&e.hasGrabbedManipulators&&(t.activeTool=null)}function xt(t){return{updates:t.map(({geometry:e})=>(e==null?void 0:e.type)==="mesh"?{geometry:e.cloneShallow()}:{geometry:e})}}function Fn(t,e){var i;(i=t.tools)==null||i.remove(e),e.destroyed||e.destroy()}function J(t){return"requireError"in t&&t.requireError==="aborted"}const qa=A;var Wn;const Bs=Symbol(),fi=Symbol(),On=Symbol();let se=Wn=class extends za{constructor(t){super(t),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new Ua,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=cn((e,i,n)=>Ot(e,i,n))}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var a,o;if(this.pendingFeatures.some(d=>{var p;return!!((p=this.data.getEditsForPendingFeature(d))!=null&&p.modified)}))return!0;const{creationInfo:t,upload:e}=this.data,i=this._sketchViewModel,{activeComponent:n}=i,s=(o=(a=i.createGraphic)==null?void 0:a.geometry)==null?void 0:o.type;return!(s!=="polyline"&&s!=="polygon"&&s!=="multipoint"||(n==null?void 0:n.type)!=="draw-2d"&&(n==null?void 0:n.type)!=="draw-3d")&&n.drawOperation.committedVertices.length>0||!(!e||e.state!=="pending"&&e.state!=="success")||!!(t!=null&&t.geometryToPlace)}get helpMessage(){var s;const{creationInfo:t,viewModel:e}=this.data;if(this.stepId!=="creating-features"||!t)return;const i=t.layer.geometryType,n=this._sketchViewModel.createGraphic;if(i==="mesh"){this._getDrawMeshHelpMessage||E(()=>import("./helpMessageUtils3d-BZzQ2OvH.js"),__vite__mapDeps([211,1,2,9,3,4,5])).then(o=>{this._getDrawMeshHelpMessage=o.getDrawMeshHelpMessage});const{view:a}=e;return(a==null?void 0:a.type)==="3d"?(s=this._getDrawMeshHelpMessage)==null?void 0:s.call(this,n,a):void 0}return Oh(i,n==null?void 0:n.geometry)}get layer(){var t;return(t=this.data.creationInfo)==null?void 0:t.layer}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get parentLayer(){var t;return(t=this.parent)==null?void 0:t.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return this.numPendingFeatures===0}get reliesOnOwnerAdminPrivileges(){var t;return((t=this.data.editorItem)==null?void 0:t.capabilities.create.reliesOnOwnerAdminPrivileges)??!1}get shouldShowAttachments(){var t;return((t=this.data.editorItem)==null?void 0:t.capabilities.create.attachments.enabled)??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}async enter(){this._isActive=!0,this.stepId!=="awaiting-feature-creation-info"&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([On])}async updatePendingFeature(t,e){return this._preventDefaultActionOnCancel=!0,this._sketchViewModel.cancel(),zs(this._lastActiveGraphics,t),this._startUpdating({feature:t,webStyleCache:e})}async start(){var t;return await super.start(),ai((t=this.data.creationInfo)==null?void 0:t.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}static create(t){const{addAttachmentsCallback:e,applyEditsCallback:i,isNested:n,creationInfo:s,parent:a,snappingManager:o,startAt:d,viewModel:p}=t,c=t.sketchOptions??new Zt,h=s==null?void 0:s.layer,u=h?p.findEditorItemForLayer(h):void 0,y=new Wn({data:new et({creationInfo:s,editorItem:u,parent:a,sketchOptions:c,snappingManager:o,viewModel:p}),isNested:n,onCommit:async g=>{var I;const{creationInfo:m}=g;if(!m)return;const v=g.pendingFeatures.toArray(),{layer:_}=m,w=((I=_.capabilities)==null?void 0:I.editing.supportsGlobalId)&&"globalIdField"in _,b=y._attachmentFileInfos;if(w){const F=fy(v,_,b);return void await i(_,F,{globalIdUsed:!0})}const M=await i(_,{addFeatures:v});if(b.size>0){const F=(M==null?void 0:M.addFeatureResults)??[];await e(_,gy(v,F,_,b))}}});return y._set("steps",this._createWorkflowSteps(y,d)),y}_fadeExistingFeatures(t){if("effect"in t){const i=t.effect;return t.effect="saturate(0.6) opacity(0.8)",j(()=>t.effect=i)}const e=t.opacity;return t.opacity=.7,j(()=>t.opacity=e)}_highlight(t){const e=this.data.viewModel.view;(e==null?void 0:e.type)==="3d"&&this._highlightHandles.set(t,e.highlight(t))}_removeHighlight(t){Vn(this._highlightHandles.get(t)),this._highlightHandles.delete(t)}async _startCreating(t){this.removeHandles(fi);const{creationInfo:e}=this.data;if(!e)return;this.createFeatureState="create-new";const i=await Bh(this._sketchViewModel,e,t);this.addHandles(i,fi)}async _startUpdating({feature:t,webStyleCache:e,initialFeature:i=t}){var w;const{data:n,pendingFeatures:s}=this;s.includes(t)||n.addPendingFeature(t,i);const{_featureFormViewModel:a,_sketchViewModel:o}=this,{creationInfo:d,viewModel:p}=n,{attachmentsViewModel:c,layerInfos:h,view:u}=p;if(!u||!d)return;const y=d.layer,g=zh(h,y),m=g==null?void 0:g.formTemplate,v=u.spatialReference;if(a.set({arcadeEditType:"INSERT",feature:t,formTemplate:m,spatialReference:v,map:u.map}),c.mode!=="add"&&c.mode!=="edit"||((w=p.activeWorkflow)==null||w.previous()),c.graphic=t,c.fileInfos.removeAll(),c.mode="view",(this._attachmentFileInfos.get(t)||[]).forEach(({file:b,form:M})=>c.addFile(b,M)),this._removeHighlight(t),await Ot(t,e,u.type==="2d"?u.scale:null),this.removeHandles(fi),Vn(this._featureFormHandle),u.type==="2d"){const b=k(()=>u.scale,M=>this._updateGraphicDebounced(t,e,M));this.addHandles(b,fi)}const _=n.getEditsForPendingFeature(t);return this._featureFormHandle=Ft([a.on("value-change",async()=>{_==null||_.updateAttributes(a.getValues()),await Ot(t,e,u.type==="2d"?u.scale:null)}),o.on(["update","undo","redo"],b=>{(b.type==="undo"||b.type==="redo"||b.type==="update"&&b.toolEventInfo!=null&&bl(b.toolEventInfo.type))&&a.notifyFeatureGeometryChanged()}),k(()=>{var b;return(b=a.feature)==null?void 0:b.sourceLayer},b=>t.sourceLayer=b)]),this.createFeatureState="update-pending",this._visualVariableAttributes=Ba(t),ai(y)?void 0:ya({graphic:t,sketchViewModel:o,sourceLayer:y,visualVariables:this._visualVariableAttributes,webStyleCache:e})}static _createWorkflowSteps(t,e="awaiting-feature-creation-info"){const{data:i}=t,n=wl(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],e,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:s,viewModel:a}=i,{view:o}=a;o&&(en(s)?t.addHandles(await ry({view:o,data:i,next:()=>t.next(),cancel:()=>a.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(i.parent&&s&&(t.addHandles(a.lockFeatureTemplatesViewModel(),this.id),a.featureTemplatesViewModel.layers=[s.layer]),t.addHandles(a.featureTemplatesViewModel.on("select",({item:d})=>{d&&(i.creationInfo={...i.creationInfo,layer:d.layer,template:d.template},t.next())}),this.id)))},async tearDown(){t.removeHandles([this.id,fi])}}),"creating-features":()=>({id:"creating-features",async setUp(){t._isActive&&await t._setUpCreatingFeaturesStep()},async tearDown(s){const{viewModel:a}=i;s.canceled&&(t.removeHandles([On,Bs,fi]),a.attachmentsViewModel.fileInfos.removeAll(),t._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=i.viewModel,{graphic:a,fileInfos:o}=s;t._attachmentFileInfos.set(a,o.toArray()),s.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=i.viewModel,{graphic:a,fileInfos:o}=s;t._attachmentFileInfos.set(a,o.toArray()),s.mode="view"}})});return ny(i,n)}static _configureSketchViewModel(t,e){const{data:i}=t,{creationInfo:n,viewModel:s}=i,{view:a}=s,o=t._sketchViewModel;let d=null;const p=[];if(!a)return j();a.type==="2d"&&n&&p.push(t._fadeExistingFeatures(n.layer));const c=async m=>{if(m.state==="cancel"){if(t._preventDefaultActionOnCancel)return void(t._preventDefaultActionOnCancel=!1);if(t._lastActiveGraphics.length<1)return t._startCreating(e);const v=t._lastActiveGraphics.pop();return t._startUpdating({feature:v,webStyleCache:e})}if(m.state==="complete"&&m.graphic){const v=m.graphic.clone();return v.geometry=null,t._startUpdating({feature:m.graphic,webStyleCache:e,initialFeature:v})}},h=async m=>{var R;const{attachmentsViewModel:v}=s,{_featureFormViewModel:_}=t,w=m.graphics[0];if(m.state==="complete"){w!==d&&(t._lastActiveGraphics.push(w),t._highlight(w)),d=null;const{hasPendingSubtypeChoice:Y,submittable:me}=_;if(t.numPendingFeatures===(n==null?void 0:n.maxFeatures)||Y||!me){!me&&_.submit();const te=t._lastActiveGraphics.pop();return t._startUpdating({feature:te,webStyleCache:e})}if(v.mode!=="add"&&v.mode!=="edit"||((R=s.activeWorkflow)==null||R.previous()),m.aborted&&t._preventDefaultActionOnCancel)return void(t._preventDefaultActionOnCancel=!1);t.addHandles([ga(a),a.on("click",te=>te.preventDefault())],Bs),await ue(()=>!_.updating),t.removeHandles(Bs),t._startCreating(e)}m.state==="start"&&t._removeHighlight(w);const b=t._visualVariableAttributes;await _l(a,w,m,b,e);const M=w.attributes,{rotation:I,size:F}=b;if(I!=null){const{field:Y}=I;_.setValue(Y,M[Y])}if(F!=null){const{field:Y}=F;_.setValue(Y,M[Y])}},u=m=>{const v=m.graphics[0];i.removePendingFeature(v),zs(t._lastActiveGraphics,v),d=v},y=async m=>{if(en(n))return;const{results:v}=await a.hitTest(m,{include:o.layer}),_=v.find(b=>b.type==="graphic"&&b.graphic.sourceLayer===(n==null?void 0:n.layer));if(!_)return;const w=_.graphic;if(o.activeTool==="transform"||o.activeTool==="reshape"){if(o.updateGraphics.at(0)===w)return;const{submittable:b,hasPendingSubtypeChoice:M}=t._featureFormViewModel;if(!b||M)return;await t.updatePendingFeature(w,e)}};p.push(o.on("create",m=>t._updatingHandles.addPromise(c(m))),o.on("update",m=>t._updatingHandles.addPromise(h(m))),o.on("delete",m=>u(m)),a.on("immediate-click",m=>t._updatingHandles.addPromise(y(m)),q.TOOL),j(()=>{t._preventDefaultActionOnCancel=!0,o.cancel()}),my(o,i));const g=Ft(p);return o.addHandles(g),g}_initializeSketchViewModel(){var s;const{data:t}=this,{view:e}=t.viewModel,i=new ms({elevationInfo:(s=t.creationInfo)==null?void 0:s.layer.elevationInfo,internal:!0,listMode:"hide"}),n=new qa({layer:i,sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,view:e});this._sketchViewModel=n,e==null||e.map.add(i),this.addHandles(j(()=>{e!=null&&e.destroyed||(e==null||e.map.remove(i)),i.destroy()}))}async _setUpCreatingFeaturesStep(){var v;if(this.hasHandles(On))return;const{data:t}=this,{creationInfo:e,viewModel:i}=t,{attachmentsViewModel:n,view:s}=i;if(!s||!(e!=null&&e.layer))throw new U("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:a,layer:o}=e,d=this._sketchViewModel,p=new Map,c=[];this._lastActiveGraphics=[],this._featureFormHandle=Vn(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},this.data.editorItem=i.findEditorItemForLayer(e.layer),ay(n),c.push(k(()=>n.mode,_=>{switch(_){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}));const h=ga(s);c.push(h);const u=ai(e.layer);try{if(u){const _=a??new Ai({attributes:{...(v=e.template)==null?void 0:v.prototype.attributes,...e.attributeOverrides},sourceLayer:o});await this._startUpdating({feature:_,webStyleCache:p})}else c.push(Wn._configureSketchViewModel(this,p)),a?(d.layer.add(a),await this._startUpdating({feature:a,webStyleCache:p})):await this._startCreating(p)}finally{h.remove()}const y=j(()=>{for(const _ of t.pendingFeatures)d.layer.remove(_),t.removePendingFeature(_)}),g=k(()=>s==null?void 0:s.timeZone,_=>this._featureFormViewModel.timeZone=_,K),m=j(()=>{en(e)&&i.cancelWorkflow({warnIfNoWorkflow:!1})});this._featureFormHandle&&c.push(this._featureFormHandle),this.addHandles(c,this._handleKeys.beforeCommit),this.addHandles([j(()=>n.fileInfos.removeAll()),Ft(c),m,y,g],On)}};function my(t,e){let i=null;const n=()=>t.snappingOptions.featureSources,s=()=>(i=new ks({layer:t.layer}),n().add(i),i),a=()=>{i!=null&&(n().remove(i),i=Se(i))};return Ft([k(()=>{var p;const o=(p=e.creationInfo)==null?void 0:p.layer,d=n().find(c=>c.layer===o);return{hasFeatureLayerSource:!!d,enabled:(d==null?void 0:d.enabled)??!1}},({hasFeatureLayerSource:o,enabled:d})=>{if(!o)return a();i??(i=s()),i.enabled=d},it),j(a)])}function gy(t,e,i,n){const s=[];return e.forEach((a,o)=>{if(!a.error){const d=t[o],p=n.get(d)||[];d.attributes[i.objectIdField]=a.objectId,p.forEach(({form:c})=>s.push({feature:d,attachment:c}))}}),s}function fy(t,e,i){const n=[],s=e.globalIdField;return t.forEach((a,o)=>{var d;(d=t[o].attributes)[s]??(d[s]=co()),((i==null?void 0:i.get(a))||[]).forEach(({file:p})=>n.push({feature:a,attachment:{globalId:co(),data:p}}))}),n.length?{addFeatures:t,addAttachments:n}:{addFeatures:t}}r([l()],se.prototype,"createFeatureState",void 0),r([l()],se.prototype,"data",void 0),r([l({constructOnly:!0})],se.prototype,"isNested",void 0),r([l()],se.prototype,"featureFormViewModel",null),r([l()],se.prototype,"hasPendingEdits",null),r([l()],se.prototype,"_getDrawMeshHelpMessage",void 0),r([l()],se.prototype,"helpMessage",null),r([l()],se.prototype,"layer",null),r([l()],se.prototype,"parent",null),r([l()],se.prototype,"parentLayer",null),r([l()],se.prototype,"keyboardCancellationEnabled",null),r([l()],se.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],se.prototype,"shouldShowAttachments",null),r([l()],se.prototype,"shouldAllowAttachmentEditing",null),r([l()],se.prototype,"sketchViewModel",null),se=Wn=r([C("esri.widgets.Editor.CreateFeaturesWorkflow")],se);const kl=se;let jn=class extends O{constructor(e){super(e),this.view=null}add(e){const i=!e||Array.isArray(e)?e:[e];i!=null&&i.length&&i.forEach(n=>this._highlight(n))}remove(e){const i=!e||Array.isArray(e)?e:[e];i!=null&&i.length&&i.forEach(n=>this._removeHighlight(n))}removeAll(){this.removeAllHandles()}_highlight(e){const i=uy(this.view,e.layer);mr(i)&&this.addHandles(i.highlight(e),uo(e))}_removeHighlight(e){e&&this.removeHandles(uo(e))}};r([l()],jn.prototype,"view",void 0),jn=r([C("esri.views.draw.support.HighlightHelper")],jn);const Cl=jn;var Bn;let dt=Bn=class extends O{constructor(t){super(t),this.editorItem=null,this.edits=null,this.parent=null,this.relatedRecordCallbacks=null,this.viewModel=null}get attachmentsCapabilities(){const t=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:t,update:t,delete:t}}}get formTemplate(){return this.editorItem.formTemplate}static async create(t){const e=Bn._makeConstructorProps(t);return new Bn(e)}static _makeConstructorProps(t){const{feature:e,parent:i,relatedRecordCallbacks:n,viewModel:s}=t,a=s.editorItems.find(o=>o.layer===e.layer);if(!a)throw new U("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{editorItem:a,edits:new gt({feature:e}),parent:i,relatedRecordCallbacks:n,viewModel:s}}};r([l()],dt.prototype,"attachmentsCapabilities",null),r([l({constructOnly:!0})],dt.prototype,"editorItem",void 0),r([l()],dt.prototype,"edits",void 0),r([l()],dt.prototype,"formTemplate",null),r([l()],dt.prototype,"parent",void 0),r([l()],dt.prototype,"relatedRecordCallbacks",void 0),r([l()],dt.prototype,"viewModel",void 0),dt=Bn=r([C("esri.widgets.Editor.UpdateRecordWorkflowData")],dt);const Il=dt;var zn;let bi=zn=class extends Il{constructor(t){super(t),this.sketchOptions=null,this.snappingManager=null}static async create(t){const{feature:e,snappingManager:i,viewModel:n}=t,s=t.sketchOptions??new Zt,{view:a}=n;if(!a)throw new U("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const o=await Si(a,e.layer);return new zn({...zn._makeConstructorProps(t),layerView:o,sketchOptions:s,snappingManager:i})}};r([l()],bi.prototype,"layerView",void 0),r([l({constructOnly:!0})],bi.prototype,"sketchOptions",void 0),r([l()],bi.prototype,"snappingManager",void 0),bi=zn=r([C("esri.widgets.Editor.UpdateFeatureWorkflowData")],bi);const vy=bi;var fa;const va={exit:Symbol()};let _e=fa=class extends za{constructor(t){super(t),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:t}=this,{edits:e}=t,{view:i}=t.viewModel,n=e.feature,s=new AbortController;this.addHandles(Bd(s)),this._updatingHandles.addPromise(Yh(n,t.viewModel.view.spatialReference,s.signal).then(a=>{ar(s)||(this._onFullFeatureLoaded(a),this._initializeFeatureFormViewModel())},a=>this.cancel({force:!0,error:new U("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:a}})}))),i&&(this._highlightHelper=new Cl({view:i}),this.addHandles(j(()=>{var a;return(a=this._highlightHelper)==null?void 0:a.removeAll()})))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var t;return(t=this.parent)==null?void 0:t.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const t=this.editorItem.capabilities;return t.update.reliesOnOwnerAdminPrivileges||t.delete.reliesOnOwnerAdminPrivileges}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel()}exit(t){this.removeHandles(va.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:t,fullFeature:e}=this,{attachmentsCapabilities:i,viewModel:n}=t,{attachmentsViewModel:s}=n;s.set({capabilities:i,graphic:e,filesEnabled:!1,mode:"view"}),this.addHandles([j(()=>s.fileInfos.removeAll()),k(()=>s.mode,a=>{switch(a){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],va.exit)}_initializeFeatureFormViewModel(){const{edits:t,formTemplate:e,viewModel:{view:i}}=this.data,n=this._featureFormViewModel=new Ua({arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:e,highlightHelper:this._highlightHelper,map:i==null?void 0:i.map,spatialReference:i.spatialReference,timeZone:i==null?void 0:i.timeZone});n.relatedRecordCallbacks={...this.data.relatedRecordCallbacks,showAllRelatedRecords:a=>n.relationshipId=a.relationshipId};const{initialFeature:s}=t;s&&n.overrideInitialFeature(s),this.addHandles([n.on("value-change",()=>{t.updateAttributes(n.getValues()),this.fullFeature.attributes=t.feature.attributes}),k(()=>i==null?void 0:i.timeZone,a=>n.timeZone=a)])}_onFullFeatureLoaded(t){this.fullFeature=t;const{edits:e}=this.data;e.updateAttributes(t.attributes),e.trackChanges()}static async create(t){const e=new fa({data:await Il.create(t),onCommit:this._onCommitFactory(t.applyEdits)});return e._set("steps",this._createWorkflowSteps(e)),e}static _createWorkflowSteps(t){const{attachmentsViewModel:e}=t.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){e.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){e.mode="view"}}]}};_e._onCommitFactory=t=>async e=>{var d;const{edits:i}=e,{feature:n}=i;if(!n)return;const s=n.sourceLayer,a=n.clone();if(!i.attributesModified||i.stagedForDelete){const p=s.objectIdField;if(a.attributes={[p]:n.getAttribute(p)},s.type==="scene"&&s.infoFor3D!=null){const c=(d=s.associatedLayer)==null?void 0:d.globalIdField;c!=null&&a.setAttribute(c,n.getAttribute(c))}}i.geometryModified&&!i.stagedForDelete||(a.geometry=null);const o=i.stagedForDelete?"deleteFeatures":"updateFeatures";await t(s,{[o]:[a]})},r([l()],_e.prototype,"editorItem",null),r([l()],_e.prototype,"featureFormViewModel",null),r([l()],_e.prototype,"fullFeature",void 0),r([l()],_e.prototype,"hasPendingEdits",null),r([l()],_e.prototype,"layer",null),r([l()],_e.prototype,"parent",null),r([l()],_e.prototype,"parentLayer",null),r([l()],_e.prototype,"shouldShowAttachments",null),r([l()],_e.prototype,"shouldAllowAttachmentEditing",null),r([l()],_e.prototype,"reliesOnOwnerAdminPrivileges",null),_e=fa=r([C("esri.widgets.Editor.UpdateRecordWorkflow")],_e);var _a;const Ye={...va,highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol()};let Ei=_a=class extends _e{constructor(t){super(t),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){var t;(t=this._layerViewEditSession)==null||t.rollback()}async commit(){this.removeHandles(Ye.sketchGraphics);try{const t=this.data.edits.stagedForDelete;await super.commit();const e=this._layerViewEditSession;t?e==null||e.rollback():e==null||e.commit()}catch(t){throw await this._configureSketchViewModel(),new U("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:t})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles([this._featureFormViewModel.on("value-change",t=>{var e;(e=this._layerViewEditSession)==null||e.setAttribute(t.fieldName,t.value)}),k(()=>{var t;return(t=this._featureFormViewModel.feature)==null?void 0:t.sourceLayer},t=>this._sketchGraphicClone.sourceLayer=t)])}_configureHighlight(){const{edits:t,layerView:e}=this.data;mr(e)&&this.addHandles(e.highlight(t.feature),Ye.highlights)}async _configureSketchViewModel(){const t=this._sketchViewModel;if(!t)return;const{data:e,_featureFormViewModel:i,_sketchGraphicClone:n}=this,{edits:s,viewModel:a}=e,o=s.feature,{view:d}=a,p=Ba(o),c=await Xh({feature:o,featureClone:n,visualVariableAttributes:p,sketchViewModel:t,view:d,onUpdate:({geometry:h,attributes:u},y)=>{if(s.updateAttributes(u),s.updateGeometry(h),i.feature&&(i.feature.geometry=h),p.rotation!=null){const{field:g}=p.rotation;i.setValue(g,u[g])}if(p.size!=null){const{field:g}=p.size;i.setValue(g,u[g])}(y.type==="undo"||y.type==="redo"||y.type==="update"&&y.toolEventInfo!=null&&bl(y.toolEventInfo.type))&&i.notifyFeatureGeometryChanged()},webStyleCache:this._webStyleCache});this.addHandles(c,Ye.sketchGraphics),t.addHandles(c)}async _initializeSketchViewModel(){const{data:t,_sketchGraphicClone:e}=this,i=t.edits.feature,{capabilities:n,layer:s}=t.editorItem,{view:a}=t.viewModel;if(this.removeHandles([Ye.highlights,Ye.sketchGraphics,Ye.sketchViewModel]),!n.update.geometry||(a==null?void 0:a.type)==="3d"&&Ta(s.elevationInfo))return{enter:async()=>{this.hasHandles(Ye.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([Ye.highlights])};const o=new ms({elevationInfo:s.elevationInfo,internal:!0,listMode:"hide"}),d=new qa({allowDeleteKey:!1,layer:o,sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,view:a});return this._sketchViewModel=d,a==null||a.map.add(o),this.addHandles(j(()=>{a!=null&&a.destroyed||(a==null||a.map.remove(o)),o.destroy(),this._sketchViewModel=Se(d)}),Ye.sketchViewModel),await Ot(e,this._webStyleCache,(a==null?void 0:a.type)==="2d"?a.scale:null),this.addHandles([await ey(d,i,e)]),{enter:async()=>{this.hasHandles(Ye.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([Ye.sketchGraphics]),viewModel:d}}_onFullFeatureLoaded(t){super._onFullFeatureLoaded(t);const e=this._sketchGraphicClone=ma(t),{edits:i,layerView:n}=this.data;i.updateGeometry(t.geometry),i.trackChanges(),oy(n)&&(this._layerViewEditSession=n.createInteractiveEditSession(e))}static async create(t){const e=new _a({data:await vy.create(t),onCommit:this._onCommitFactory(t.applyEdits)});return e._set("steps",this._createWorkflowSteps(e)),e}get test(){}};r([l()],Ei.prototype,"_layerViewEditSession",void 0),r([l()],Ei.prototype,"_sketchGraphicClone",void 0),r([l()],Ei.prototype,"_sketchViewModel",void 0),Ei=_a=r([C("esri.widgets.Editor.UpdateFeatureWorkflow")],Ei);let pt=class extends O{constructor(e){super(e),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.candidates=null,this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};r([l()],pt.prototype,"addAttachmentsCallback",void 0),r([l()],pt.prototype,"applyEditsCallback",void 0),r([l()],pt.prototype,"candidates",void 0),r([l()],pt.prototype,"rootFeature",void 0),r([l({constructOnly:!0})],pt.prototype,"sketchOptions",void 0),r([l()],pt.prototype,"snappingManager",void 0),r([l()],pt.prototype,"viewModel",void 0),pt=r([C("esri.widgets.Editor.UpdateWorkflowData")],pt);const _y=pt;var wa;const Ml="esri.widgets.Editor.UpdateWorkflow",wy=()=>le.getLogger(Ml);let pe=wa=class extends za{constructor(t){super(t),this._workflowStack=new vo(ho),this._sketchStack=new vo(ho),this.data=void 0,this.type="update"}get activeEditorItem(){var t;return((t=this.activeWorkflow)==null?void 0:t.data.editorItem)??void 0}get activeFeatureFormViewModel(){var t;return(t=this.activeWorkflow)==null?void 0:t.featureFormViewModel}get activeSketchViewModel(){var t;return(t=this._sketchStack.peek())==null?void 0:t.viewModel}get activeWorkflow(){return this._workflowStack.last()}get hasUpdatableCandidates(){const{candidates:t,viewModel:e}=this.data;return t.some(({layer:i})=>{var n;return(n=e.findEditorItemForLayer(i))==null?void 0:n.supportsUpdateWorkflow})}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var t;return!!((t=this.activeEditorItem)!=null&&t.capabilities.attachments.enabled)}get shouldAllowAttachmentEditing(){var t;return!!((t=this.activeEditorItem)!=null&&t.capabilities.update.attachments.enabled)}get hasPendingEdits(){return Array.from(this._workflowStack).some(t=>t.hasPendingEdits)}get helpMessage(){var t;return(t=this.activeWorkflow)!=null&&t.helpMessage?this.activeWorkflow.helpMessage:this.stepId==="awaiting-feature-to-update"?"select":void 0}get reliesOnOwnerAdminPrivileges(){var t;return((t=this.activeWorkflow)==null?void 0:t.reliesOnOwnerAdminPrivileges)??!1}get hasInvalidFormTemplate(){var t;return!!((t=this.activeEditorItem)!=null&&t.hasInvalidFormTemplate)}async back(t=()=>Promise.resolve(!0)){const{activeWorkflow:e}=this;if((e==null?void 0:e.featureFormViewModel.relationshipId)==null)if(e){if(e.hasPendingEdits&&!await t())return;e.hasPreviousStep?await e.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else e.featureFormViewModel.relationshipId=null}async cancelActiveWorkflow(t){var e;await((e=this.activeWorkflow)==null?void 0:e.cancel(t)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(t=>t.commit()),await super.commit()}static create(t){const{viewModel:e,snappingManager:i,startAt:n,addAttachmentsCallback:s,applyEditsCallback:a}=t,o=t.sketchOptions??new Zt,d=new wa({data:new _y({addAttachmentsCallback:s,applyEditsCallback:a,sketchOptions:o,snappingManager:i,viewModel:e}),onCommit:async()=>{}});return d._set("steps",this._createWorkflowSteps(d,n)),d}async save(){var t;this.nestedWorkflowCount>1?(await((t=this.activeWorkflow)==null?void 0:t.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(t){try{const e=await this._createNestedCreateFeaturesWorkflow(t);await this._pushWorkflow(e)}catch(e){throw new U("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:e})}}async startUpdating(t){try{const e=await this._createNestedUpdateWorkflow(t);await this._pushWorkflow(e)}catch(e){throw new U("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:e})}}async deleteActiveFeature(){const{activeWorkflow:t}=this;if(!t)throw new U("editor:nothing-to-delete","There is no feature to delete");by(t)?await t.deleteAndCommit():await t.cancel(),this.nestedWorkflowCount===1?await this.reset():await this._popWorkflow()}async cancelAll(){await this._drainWorkflowStack(t=>t.cancel({force:!0}))}async _createNestedCreateFeaturesWorkflow(t){var h;const{relatedLayer:e}=t,{addAttachmentsCallback:i,applyEditsCallback:n,sketchOptions:s,snappingManager:a,viewModel:o}=this.data;if(!Qn(e))throw new U("editor:unsupported-layer","Editing is not supported on the provided layer");const d=this._getCreationInfoForNestedCreateFeaturesWorkflow(t),p=d.template||d.initialFeature?"creating-features":"awaiting-feature-creation-info",c=((h=this.activeWorkflow)==null?void 0:h.type)!=="create-features"?this.activeWorkflow:void 0;return kl.create({addAttachmentsCallback:i,applyEditsCallback:n,creationInfo:d,isNested:!0,parent:c,sketchOptions:s,snappingManager:a,startAt:p,viewModel:o})}_getCreationInfoForNestedCreateFeaturesWorkflow(t){const{relatedLayer:e}=t;if(!Qn(e)||zd(e))throw new U("editor:unsupported-layer","Editing is not supported on the provided layer");const i={layer:e,maxFeatures:1},n=this._makeRelatedRecordAttributes(t),s=ps(e);return(s==null?void 0:s.length)>0?(i.attributeOverrides=n,s.length===1&&(i.template=s[0])):i.initialFeature=new Ai({sourceLayer:e,attributes:n}),i}async _createNestedUpdateWorkflow(t){var p;const e=ai(t.sourceLayer)?_e:Ei,{applyEditsCallback:i,sketchOptions:n,snappingManager:s,viewModel:a}=this.data,o=((p=this.activeWorkflow)==null?void 0:p.type)!=="create-features"?this.activeWorkflow:void 0,d=await e.create({feature:t,parent:o,sketchOptions:n,snappingManager:s,viewModel:a,applyEdits:i,relatedRecordCallbacks:{addRelatedRecord:async c=>await this.startCreatingRelatedRecord(c),editRelatedRecord:async({relatedFeature:c})=>await this.startUpdating(c)}});return await ue(()=>!d.updating),d}async _drainWorkflowStack(t){const e=this._workflowStack,i=[];for(;e.length>0;){const n=e.pop();this._sketchStack.pop();const s=t(n).then(()=>n.destroy());this._updatingHandles.addPromise(s),i.push(s)}await Promise.all(i)}_makeRelatedRecordAttributes(t){var h,u;const{parentFeature:e,relatedLayer:i,relationshipId:n}=t;if(!qd(e))return;const s=(h=i.relationships)==null?void 0:h.find(y=>y.id===n);if(!s)return void Hi("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if(s.role==="origin")return void Hi("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const a=e.sourceLayer;s.relatedTableId!==a.layerId&&Hi("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const o=(u=a.relationships)==null?void 0:u.find(y=>y.id===n);if(!o)return void Hi("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const d=Yo(a,o),p=e.getAttribute(d);return p||Hi("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[Yo(i,s)]:p}}async _popWorkflow(){var e;(e=this._workflowStack.pop())==null||e.destroy(),this._sketchStack.pop();const t=await this._reconcileWorkflowStack();if(t.failureCount>0)throw new U("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",t)}async _pushWorkflow(t){var o;const e=this._workflowRequiresSketchViewModel(t);(o=this.activeWorkflow)==null||o.exit({removeSketchHandles:e});const i=this._sketchStack,n=await(t==null?void 0:t.start()),s=i.peek();n?(s==null||s.exit(),i.push(n)):i.push(this._cloneSketchController(s)),this._workflowStack.push(t);const a=await this._reconcileWorkflowStack();if(a.failureCount>0)throw new U("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",a)}async _reconcileWorkflowStack(){var i;const t=this._workflowStack,e=this._sketchStack;try{const n=t.peek();return await(n==null?void 0:n.enter()),await((i=e.peek())==null?void 0:i.enter()),{activeWorkflow:n,failureCount:0}}catch{t.pop().destroy(),e.pop();const{activeWorkflow:s,failureCount:a}=await this._reconcileWorkflowStack();return{activeWorkflow:s,failureCount:a+1}}}_cloneSketchController(t){return{enter:(t==null?void 0:t.enter)??(async()=>{}),exit:(t==null?void 0:t.exit)??(async()=>{}),viewModel:t==null?void 0:t.viewModel}}_workflowRequiresSketchViewModel(t){var i;const{type:e}=t;return e==="update-feature"||e==="create-features"&&!ai((i=t.data.creationInfo)==null?void 0:i.layer)}static _createWorkflowSteps(t,e="awaiting-feature-to-update"){const{data:i}=t;return wl(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],e,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:n}=i.viewModel,s=i.viewModel.view;let a=null;t.addHandles(j(()=>{a=ni(a)}),this.id),i.rootFeature=null,i.candidates=[];const o=s.on("immediate-click",async d=>{n.location=d.mapPoint,n.visible=!0,a==null||a.abort();const{editorItems:p}=i.viewModel;a=new AbortController;const c=await d.async(()=>new Promise((h,u)=>{Zd(a==null?void 0:a.signal,()=>u(Ys())),h(qh(p,s,d,a==null?void 0:a.signal))}));at(a),i.candidates=c.filter(h=>h.status==="fulfilled").flatMap(h=>h.value).filter(h=>!h.isAggregate),n.visible=i.candidates.length===1,i.candidates.length!==0&&(d.stopPropagation(),i.candidates.length===1?(i.rootFeature=i.candidates[0],t.go("editing-existing-feature").catch(()=>{}).then(()=>n.visible=!1)):t.next())},q.TOOL);s.focus(),t.addHandles(o,this.id)},async tearDown(){i.candidates.length===0&&(i.viewModel.spinnerViewModel.visible=!1),t.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){i.rootFeature=null;const{view:n}=i.viewModel;if(!n)return;const s=new Cl({view:n});t.addHandles([k(()=>i.rootFeature,(a,o)=>{s.remove(o),s.add(a)},sn),j(()=>s.removeAll())],this.id)},async tearDown(){t.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:n,viewModel:s}=t.data;if(!n)throw new U("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await t.startUpdating(n),s.spinnerViewModel.visible=!1;const a=cn(async()=>{await ue(()=>!t.updating),t.previous()});t.addHandles([k(()=>t.nestedWorkflowCount,(o,d)=>{o===0&&d!==0&&a()},sn)],this.id)},async tearDown(){await t.cancelAll(),t.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}})})}};function Yo(t,{keyField:e}){var i;return((i=t.getField(e))==null?void 0:i.name)??e}r([l()],pe.prototype,"activeEditorItem",null),r([l()],pe.prototype,"activeFeatureFormViewModel",null),r([l()],pe.prototype,"activeSketchViewModel",null),r([l()],pe.prototype,"activeWorkflow",null),r([l()],pe.prototype,"data",void 0),r([l()],pe.prototype,"hasUpdatableCandidates",null),r([l()],pe.prototype,"nestedWorkflowCount",null),r([l()],pe.prototype,"shouldShowAttachments",null),r([l()],pe.prototype,"shouldAllowAttachmentEditing",null),r([l()],pe.prototype,"hasPendingEdits",null),r([l()],pe.prototype,"helpMessage",null),r([l()],pe.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],pe.prototype,"hasInvalidFormTemplate",null),pe=wa=r([C(Ml)],pe);const Hi=(t,e)=>wy().warn(`editor:${t}`,e,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),by=t=>!!t&&/update-/.test(t.type),Ey=pe;let ke=class extends O{constructor(e){super(e),this.layer=null}get attachments(){var e;return{enabled:this._effectiveEnabled&&!!((e=this._effectiveCapabilities)!=null&&e.data.supportsAttachment)}}get create(){var d;const{_effectiveCapabilities:e,layer:i}=this,n=this._createEnabled,s=n,a=(d=i.capabilities)==null?void 0:d.operations.supportsAdd,o=!!(e!=null&&e.operations.supportsAdd);return{attachments:{enabled:n&&this.attachments.enabled},attributes:n,enabled:n,geometry:s,reliesOnOwnerAdminPrivileges:!a&&o}}get delete(){var a;const{_effectiveCapabilities:e,layer:i}=this,n=(a=i.capabilities)==null?void 0:a.operations.supportsDelete,s=!!(e!=null&&e.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!!(e!=null&&e.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!n&&s}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var c;const{_effectiveCapabilities:e,layer:i}=this,n=this._updateEnabled,s=!(!n||!(e!=null&&e.editing.supportsGeometryUpdate)),a=(c=i.capabilities)==null?void 0:c.operations.supportsUpdate,o=!!(e!=null&&e.operations.supportsUpdate),d=this.attachments.enabled,p=d&&this._canCreateOrUpdate;return{attachments:{enabled:d,create:p,update:p},attributes:n,enabled:n,geometry:s,reliesOnOwnerAdminPrivileges:!a&&o}}get _createEnabled(){var e;return this._effectiveEnabled&&!!((e=this._effectiveCapabilities)!=null&&e.operations.supportsAdd)}get _updateEnabled(){var e;return this._effectiveEnabled&&!!((e=this._effectiveCapabilities)!=null&&e.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return Kd(this.layer)}get _effectiveCapabilities(){return Jn(this.layer)}};r([l()],ke.prototype,"attachments",null),r([l()],ke.prototype,"create",null),r([l()],ke.prototype,"delete",null),r([l()],ke.prototype,"layer",void 0),r([l()],ke.prototype,"reliesOnOwnerAdminPrivileges",null),r([l()],ke.prototype,"update",null),r([l()],ke.prototype,"_createEnabled",null),r([l()],ke.prototype,"_updateEnabled",null),r([l()],ke.prototype,"_canCreateOrUpdate",null),r([l()],ke.prototype,"_effectiveEnabled",null),r([l()],ke.prototype,"_effectiveCapabilities",null),ke=r([C("esri.layers.support.EditingCapabilities")],ke);const Jo=ke,vi="esri.views.layers.support.editableLayerViews";function ky(t,e){const{associatedLayer:i}=t,n=i==null?void 0:i.infoFor3D;if(!n)return!1;const s=oc(n);if(!(s!=null&&n.queryFormats.includes(s)))return le.getLogger(vi).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because it does not support GLB queries.`),!1;const a=t.spatialReference,o=i.spatialReference;if(!Yi(a,o))return le.getLogger(vi).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because its spatial reference (wkid:${a.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${o.wkid}).`),!1;const d=i.sourceJSON.sourceSpatialReference;if(!(d==null||Yi(d,o)))return le.getLogger(vi).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${o.wkid}) is different from its source spatial reference (wkid:${d.wkid}).`),!1;const{view:p}=e;if(e.destroyed||p==null)return!1;const c=p.spatialReference,{viewingMode:h}=p.state,u=nr(a),y=h===rc.Global;return u&&!y?(le.getLogger(vi).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${a.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!u&&y?(le.getLogger(vi).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${a.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(Yi(a,c)||y&&tr(c)&&Yd(a))||(le.getLogger(vi).warnOnce(`SceneLayer (${t.title??"Untitled layer"}, ${t.id}) does not support geometry edits because its spatial reference (wkid:${a.wkid}) does not match the view spatial reference (wkid:${c.wkid}).`),!1)}let Ve=class extends Jo{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,i=this.layerInfo;return{enabled:e&&(i==null?void 0:i.enabled)!==!1}}get create(){const{attachments:e,defaults:i,layerInfo:n,layer:s,layerView:a}=this,o=i.create,d=(n==null?void 0:n.enabled)!==!1&&(n==null?void 0:n.addEnabled)!==!1,p=o.enabled&&d;return{attributes:p&&o.attributes,enabled:p,geometry:p&&o.geometry&&Qo(s,a),attachments:{enabled:e.enabled&&p&&(n==null?void 0:n.attachmentsOnCreateEnabled)!==!1},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}get defaults(){return new Jo({layer:this.layer})}get delete(){const{defaults:e,layerInfo:i}=this,n=e.delete,s=(i==null?void 0:i.enabled)!==!1&&(i==null?void 0:i.deleteEnabled)!==!1;return{enabled:n.enabled&&s,reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:i}=this;return i!=null&&i.formTemplate?i.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){var s,a,o;const{layer:e}=this,i=!(!lr(e)||!((s=e.relationships)!=null&&s.length)),n=!!((o=(a=this.formTemplate)==null?void 0:a.elements)!=null&&o.some(d=>d.type==="relationship"));return{enabled:i&&n}}get update(){const{attachments:e,defaults:i,layerInfo:n,layer:s,layerView:a}=this,o=i.update,d=(n==null?void 0:n.enabled)!==!1&&(n==null?void 0:n.updateEnabled)!==!1,p=o.enabled&&d,c=p&&o.attributes&&(n==null?void 0:n.attributeUpdatesEnabled)!==!1,h=p&&o.geometry&&(n==null?void 0:n.geometryUpdatesEnabled)!==!1&&Qo(s,a),u=e.enabled&&(n==null?void 0:n.attachmentsOnUpdateEnabled)!==!1;return{attributes:c,enabled:p,geometry:h,attachments:{enabled:u,create:u&&o.attachments.create,update:u&&o.attachments.update},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}};function Qo(t,e){return t.type!=="scene"||e!=null&&"type"in e&&e.type==="scene-layer-3d"&&ky(t,e)}r([l()],Ve.prototype,"attachments",null),r([l()],Ve.prototype,"create",null),r([l()],Ve.prototype,"defaults",null),r([l()],Ve.prototype,"delete",null),r([l()],Ve.prototype,"formTemplate",null),r([l()],Ve.prototype,"layerInfo",void 0),r([l()],Ve.prototype,"layerView",void 0),r([l()],Ve.prototype,"relationship",null),r([l()],Ve.prototype,"update",null),Ve=r([C("esri.widgets.Editor.support.EditorEditingCapabilities")],Ve);const Cy=Ve;let ce=class extends O{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var e;return!!((e=this.layerView)!=null&&e.suspended)}get capabilities(){return new Cy({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:i,update:n,delete:{enabled:s}}=this.capabilities,a=e.attachments.enabled||n.attachments.enabled;return!this.disabled&&(e.enabled||n.enabled||a||s||i.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return Jd(this.layer,this.formTemplate)}get isTable(){return ai(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;const{enabled:e,geometry:i}=this.capabilities.create;return this.isTable?e:e&&i}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,i=e.parent;return!this._suspended&&e.visible&&(!i||!("visible"in i)||i.visible)}};r([l()],ce.prototype,"_suspended",null),r([l()],ce.prototype,"capabilities",null),r([l()],ce.prototype,"disabled",void 0),r([l()],ce.prototype,"editable",null),r([l()],ce.prototype,"formTemplate",null),r([l()],ce.prototype,"hasInvalidFormTemplate",null),r([l()],ce.prototype,"isTable",null),r([l()],ce.prototype,"layer",void 0),r([l()],ce.prototype,"layerInfo",void 0),r([l()],ce.prototype,"layerView",void 0),r([l()],ce.prototype,"supportsCreateFeaturesWorkflow",null),r([l()],ce.prototype,"supportsUpdateWorkflow",null),r([l()],ce.prototype,"visible",null),ce=r([C("esri.widgets.Editor.support.EditorItem")],ce);const Iy=ce,Tl="esri.widgets.Editor.EditorViewModel",My=()=>le.getLogger(Tl),$l=["create-features","update"];function Jt(t,e,i){My().error(new U(t,e,i))}function Ty(t,e){return t==null?void 0:t.find(i=>i.layer===e)}let $=class extends At.EventedAccessor{constructor(t){super(t),this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new ms({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updatingHandles=new xi,this._featureTemplatesViewModelLocked=!1,this.activeWorkflow=null,this._activityQueue=new Q,this.editorItems=new Q,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new wp({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new ua({disabledItemFunction:({layer:e})=>this._itemIsSuspended(e)}),this.layerInfos=null,this.ownSketchViewModel=new qa({layer:this._sketchGraphicsLayer}),this.sketchOptions=new Zt,this.snappingOptions=new ui({attributeRulesEnabled:!0}),this.spinnerViewModel=new bp,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var e;this.canGoBack&&((e=this.activeWorkflow)!=null&&e.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var i;const{featureFormViewModel:e}=this;if(e){if(e.submit(),!e.submittable||e.hasPendingSubtypeChoice)return;const n=e.getValues();if(e.validateContingencyConstraints(n,{includeIncompleteViolations:!0}).length>0)return}await((i=this.activeWorkflow)==null?void 0:i.save())},this.selectFeature=(e,i=!1)=>{const n=this.activeWorkflow;this._candidateCommitted||(n==null?void 0:n.type)!=="update"||(n.data.rootFeature=e,i&&(n.next(),this._candidateCommitted=!0))}}initialize(){this.addHandles([k(()=>{var s;const t=this.view,e=(s=t==null?void 0:t.map)==null?void 0:s.editableLayers,i=t==null?void 0:t.allLayerViews,n=i==null?void 0:i.filter(a=>!!(e!=null&&e.includes(a.layer)));return[e,n,this.layerInfos,this.allowedWorkflows]},()=>this._updateEditorItems(),it),k(()=>this.hideTemplatesForInactiveLayers,()=>this.syncFeatureTemplates()),Ne(()=>this.activeWorkflow,"cancel",()=>this.emit("workflow-cancel")),Ne(()=>this.activeWorkflow,"commit",()=>this.emit("workflow-commit")),Ne(()=>this.activeWorkflow,"complete",()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)}),si(()=>{var t;return(t=this.view)==null?void 0:t.map},t=>t.add(this._sketchGraphicsLayer),K),Ne(()=>this.editorItems,"change",()=>this._afterEditorItemsChange()),k(()=>[this.canCreate,this.canUpdateVisible],()=>this._afterEditorItemsChange()),k(()=>this.page,(t,e)=>{const i=[...this.pageStack];if(i.indexOf(t)===-1)i.push(t);else for(;i.length&&i.at(-1)!==t;)i.pop();this.pageStack=i},it),si(()=>this.state==="awaiting-update-feature-candidate",()=>this._candidateCommitted=!1),Ne(()=>this.featureTemplatesViewModel,"select",async({item:t,oldItem:e})=>{var s;const{activeWorkflow:i}=this;if(i){if(i.type==="update"&&((s=i.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-creation-info")return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(e,{emit:!1})}}if(!t)return;const n={layer:t.layer,template:t.template};if(t.supportsUpload)return this.featureTemplatesViewModel.select(e,{emit:!1}),this.startCreateFeaturesWorkflow(n);this.startCreateFeaturesWorkflowAtFeatureCreation(n)}),Ne(()=>this.view,"key-down",t=>{var e;t.key==="Escape"&&((e=this.activeWorkflow)!=null&&e.keyboardCancellationEnabled)&&(t.stopPropagation(),this.back())}),Ne(()=>this.sketchViewModel,["create","delete","update"],t=>{var o,d;const{activeWorkflow:e}=this,i=(e==null?void 0:e.type)==="update",n=i?(o=e.activeWorkflow)==null?void 0:o.layer:e==null?void 0:e.layer,s=i?(d=e==null?void 0:e.activeWorkflow)==null?void 0:d.parentLayer:void 0,a=`sketch-${t.type}`;this.emit(a,{type:a,detail:t,layer:n,parentLayer:s})},sn),k(()=>this.view,t=>{if(this._snappingManager=Se(this._snappingManager),!t)return;const e=this.snappingOptions;this._snappingManager=new Ge({view:t,options:e}),this.ownSketchViewModel.snappingManager=this._snappingManager},it),k(()=>this.snappingOptions,t=>{this._snappingManager&&(this._snappingManager.options=t)},it)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then(()=>{var t,e;(e=(t=this.view)==null?void 0:t.map)==null||e.remove(this._sketchGraphicsLayer),this.view=null}),this._updateItemsTask=ni(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=Vn(this._sketchEventListenerHandle)}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(t){Js(le.getLogger(this),"allowedWorkflows",{replacement:"Editor.visibleElements",version:"4.29",warnOnce:!0}),t&&t.length!==0||(t=[...$l]),this._set("allowedWorkflows",t)}get canCreate(){return this.editorItems.some(t=>t.supportsCreateFeaturesWorkflow)}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some(t=>t.supportsUpdateWorkflow)}get canUpdateVisible(){return this.editorItems.some(t=>t.supportsUpdateWorkflow&&t.visible)}get featureTemplatesLayers(){const t=new Q;for(const e of this.editorItems){const i=e.supportsCreateFeaturesWorkflow&&!e.isTable,n=this.hideTemplatesForInactiveLayers&&!e.visible;i&&!n&&t.push(e.layer)}return t}get editableItems(){return Js(le.getLogger(this),"editableItems",{replacement:"editorItems",version:"4.29",warnOnce:!0}),this.editorItems.map(t=>{const{capabilities:e,disabled:i,hasInvalidFormTemplate:n,layer:s}=t,a=[],o=e.create,d=e.update,p=e.delete;return o.enabled&&a.push("create"),d.enabled&&a.push("update"),p.enabled&&a.push("delete"),{layer:s,supports:a,suspended:i,attributeUpdatesEnabled:d.attributes,geometryUpdatesEnabled:d.geometry,attachmentsOnCreateEnabled:o.attachments.enabled,attachmentsOnUpdateEnabled:d.attachments.enabled,hasInvalidFormTemplate:n,hasAttachments:e.attachments.enabled}})}get featureFormViewModel(){const{activeWorkflow:t}=this;return(t==null?void 0:t.type)==="update"?t.activeFeatureFormViewModel:(t==null?void 0:t.type)==="create-features"?t.featureFormViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get sketchViewModel(){const{activeWorkflow:t}=this;return(t==null?void 0:t.type)==="update"?t.activeSketchViewModel:(t==null?void 0:t.type)==="create-features"?t.sketchViewModel:this.ownSketchViewModel}get state(){var i,n;if(!((i=this.view)!=null&&i.ready))return"disabled";const t=this.attachmentsViewModel.mode;if(t==="add")return"adding-attachment";if(t==="edit")return"editing-attachment";const{activeWorkflow:e}=this;return e!=null&&e.stepId?e.type==="update"&&((n=e.activeWorkflow)!=null&&n.stepId)?e.activeWorkflow.stepId:e.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var t;return this._updatingHandles.updating||((t=this.activeWorkflow)==null?void 0:t.updating)===!0}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}set view(t){this.ownSketchViewModel.view=t,this.spinnerViewModel.view=t,this._set("view",t)}get page(){const{activeWorkflow:t,state:e}=this;if((t==null?void 0:t.type)==="update"&&t.stepId==="awaiting-feature-to-update")return"ready";if((t==null?void 0:t.type)==="create-features"&&t.numPendingFeatures===0){const i=t.data.upload;if(i)return i.state==="default"?"ready":"creating-features-upload-details"}return e??"disabled"}get featureFormDisabled(){var e;const{activeWorkflow:t}=this;return(t==null?void 0:t.type)==="update"&&((e=t.activeEditorItem)==null?void 0:e.capabilities.update.attributes)===!1}get canGoBack(){return this.activeWorkflow!=null&&!this.syncing}get shouldShowDeleteButton(){var e;const{activeWorkflow:t}=this;return!!t&&t.type==="update"&&!!((e=t.activeEditorItem)!=null&&e.capabilities.delete.enabled)}get hasPendingEdits(){var t;return((t=this.activeWorkflow)==null?void 0:t.hasPendingEdits)??!1}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(t){return this.startCreateFeaturesWorkflow(t,"creating-features")}async startCreateFeaturesWorkflow(t,e="awaiting-feature-creation-info"){if(await ue(()=>!this.updating),!this.canCreate)throw new U("editing:unsupported-workflow","Creating features is unsupported or disabled.");const i=this._createUpdatingResolver();try{await this._cancelWorkflow();const n=this._createCreateFeaturesWorkflow(t,e);this._set("activeWorkflow",n),await n.start()}catch(n){this._logErrorAndCancelWorkflow(n)}finally{i.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(t){await ue(()=>!this.updating);const e=this._createUpdatingResolver();try{const{initialFeature:i}=t,n=i.sourceLayer=i.layer,s=n?this.findEditorItemForLayer(n):void 0;if(!(s!=null&&s.supportsCreateFeaturesWorkflow))throw new U("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const a=this._createCreateFeaturesWorkflow({initialFeature:i,layer:s.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",a),await a.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{e.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await ue(()=>!this.updating),!this.canUpdate)return void Jt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const e=this._createUpdateWorkflow();this._set("activeWorkflow",e),await e.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{t.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(t){if(await ue(()=>!this.updating),!this.canUpdate)return void Jt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("awaiting-update-feature-candidate");i.data.candidates=t,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{e.resolve()}}async startUpdateWorkflowAtFeatureEdit(t){if(await ue(()=>!this.updating),!this.canUpdate)return void Jt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createUpdateWorkflow("editing-existing-feature");i.data.rootFeature=t,this._set("activeWorkflow",i),await i.start()}catch(i){this._logErrorAndCancelWorkflow(i)}finally{e.resolve()}}async deleteFeatureFromWorkflow(){const{activeWorkflow:t}=this;t&&t.type==="update"?await t.deleteActiveFeature():Jt("editing:unsupported-workflow","Deleting requires an active update workflow.")}async cancelWorkflow(t){return this._cancelWorkflow({warnIfNoWorkflow:!0,...t})}findEditorItemForLayer(t){return this.editorItems.find(e=>e.layer===t)}itemHasInvalidFormTemplate(t){var e;return t!=null&&((e=this.findEditorItemForLayer(t.layer))==null?void 0:e.hasInvalidFormTemplate)===!0}syncFeatureTemplates(){this._featureTemplatesViewModelLocked||(this.featureTemplatesViewModel.layers=this.featureTemplatesLayers.toArray())}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&this.state==="awaiting-feature-to-update"?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}lockFeatureTemplatesViewModel(){return this._featureTemplatesViewModelLocked=!0,j(()=>{this._featureTemplatesViewModelLocked=!1,this.syncFeatureTemplates()})}async _getEditorItemCandidates(t){const{view:e}=this;if(!(e!=null&&e.map))return[];const{map:i}=e,n=i.editableLayers.toArray()??[],s=i.allTables.toArray().filter(Qd)??[];return await Promise.allSettled([...n.map(a=>a.type==="subtype-group"?a.loadAll():Promise.resolve()),...s.map(a=>a.load())]),at(t),[...n.reverse(),...s.reverse()].filter(a=>Qn(a)&&(a.geometryType!=="mesh"||e.type==="3d")).flatMap(a=>a.type==="subtype-group"?a.sublayers.toArray():a)}_drainEditorItems(){this.editorItems.drain(t=>t.destroy())}async _updateEditorItems(){ni(this._updateItemsTask);const{view:t}=this,e=pn(async i=>{if(!(t!=null&&t.map)||!(t!=null&&t.allLayerViews))return;const n=await this._getEditorItemCandidates(i);if(!n.length)return void this._drainEditorItems();const s=[],a=[],o=[],{layerInfos:d}=this;for(const c of n){const h=Ty(d,c),u=await Si(t,c).catch(()=>null);(h?s:u?a:o).push(new Iy({layer:c,layerInfo:h,layerView:u}))}d!=null&&d.length&&s.sort((c,h)=>d.findIndex(({layer:u})=>u===c.layer)-d.findIndex(({layer:u})=>u===h.layer));const p=[...s,...a,...o];i.aborted||(this._drainEditorItems(),this.editorItems.addMany(p))});this._updatingHandles.addPromise(e.promise),this._updateItemsTask=e}_afterEditorItemsChange(){const{activeWorkflow:t}=this;if(this.syncFeatureTemplates(),!t)return;const{stepId:e}=t;t.type!=="create-features"?t.type==="update"&&(e==="awaiting-feature-to-update"&&!this.canUpdateVisible||e==="awaiting-update-feature-candidate"&&!t.hasUpdatableCandidates)&&this._cancelWorkflow():e!=="awaiting-feature-creation-info"||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(t){const e=this.activeWorkflow;if(!e)return void((t==null?void 0:t.warnIfNoWorkflow)&&Jt("editing:no-active-workflow","There is no active workflow to cancel."));if(!t||t.force!==!1)return this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await e.cancel(t);await e.cancel(t),this._set("activeWorkflow",null)}_createCreateFeaturesWorkflow(t,e){return kl.create({viewModel:this,creationInfo:t,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(i,n,s)=>this._applyEdits(i,n,s),addAttachmentsCallback:(i,n)=>this._addAttachments(i,n)})}_createUpdateWorkflow(t){return Ey.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(e,i,n)=>this._applyEdits(e,i,n),addAttachmentsCallback:(e,i)=>this._addAttachments(e,i)})}_addAttachments(t,e){const i=e.map(n=>this._addAttachment(t,n.feature,n.attachment))??[];return Promise.all(i)}async _addAttachment(t,e,i){var s;let n=null;if(!("addAttachment"in t)||((s=t.capabilities)==null?void 0:s.attachment)==null)throw new U("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation(async()=>{var a;return n=await((a=t.addAttachment)==null?void 0:a.call(t,e,i).catch(o=>{throw(o==null?void 0:o.error)||o}))??null,n}),n}async _applyEdits(t,e,i){let n=null;const s=t.url?await Xd(t.url):null,a={returnServiceEditsOption:(!s||!ep(s))&&!RegExp("/hosted/","i").test(t.url)?"original-and-current-features":void 0,...i};return await this._queueOperation(async()=>{const{view:o}=this;if(!o)return null;const d=await Si(o,t).catch(()=>null);return n=await t.applyEdits(e,a),d&&await ue(()=>!d.updating),n}),n}_queueOperation(t){this._activityQueue.push(t);const e=(i,n)=>{const s=n.indexOf(i);s>-1&&n.splice(s,1)};return t().then(i=>{if(i!=null&&"error"in i&&i.error!=null)throw i.error;if(i!=null&&"addFeatureResults"in i){const{addFeatureResults:n,deleteFeatureResults:s,updateFeatureResults:a}=i,o=n.find(d=>!!d.error)||a.find(d=>!!d.error)||s.find(d=>!!d.error);if(o)throw o.error}return i}).catch(i=>{Jt("editing:operation-error","An error occurred.",{error:i});const n={error:i,retry:()=>(e(n,this.failures),this._queueOperation(t)),cancel:()=>{e(n,this.failures)}};this._set("failures",[...this.failures,n])}).then(()=>{e(t,this._activityQueue)})}_createUpdatingResolver(){const t=un();return this._updatingHandles.addPromise(t.promise),t}_logErrorAndCancelWorkflow(t){const{name:e,message:i,details:n}=t;Jt(e??"editing:workflow-start-failed",i??void 0,n??t),this._cancelWorkflow({force:!0})}_itemIsSuspended(t){const e=this.findEditorItemForLayer(t);return e!=null&&(!e.visible||e.disabled)}};r([l({readOnly:!0})],$.prototype,"activeWorkflow",void 0),r([l({readOnly:!0})],$.prototype,"_activityQueue",void 0),r([l({value:[...$l]})],$.prototype,"allowedWorkflows",null),r([l({readOnly:!0})],$.prototype,"canCreate",null),r([l()],$.prototype,"canCreateVisible",null),r([l({readOnly:!0})],$.prototype,"canUpdate",null),r([l()],$.prototype,"canUpdateVisible",null),r([l()],$.prototype,"featureTemplatesLayers",null),r([l()],$.prototype,"editableItems",null),r([l()],$.prototype,"editorItems",void 0),r([l({readOnly:!0})],$.prototype,"failures",void 0),r([l()],$.prototype,"hideTemplatesForInactiveLayers",void 0),r([l()],$.prototype,"attachmentsViewModel",void 0),r([l()],$.prototype,"featureFormViewModel",null),r([l()],$.prototype,"featureTemplatesViewModel",void 0),r([l()],$.prototype,"labelOptions",null),r([l()],$.prototype,"layerInfos",void 0),r([l()],$.prototype,"ownSketchViewModel",void 0),r([l()],$.prototype,"sketchOptions",void 0),r([l()],$.prototype,"sketchViewModel",null),r([l({type:ui,nonNullable:!0})],$.prototype,"snappingOptions",void 0),r([l()],$.prototype,"spinnerViewModel",void 0),r([l()],$.prototype,"state",null),r([l({readOnly:!0})],$.prototype,"syncing",null),r([l()],$.prototype,"updating",null),r([l()],$.prototype,"tooltipOptions",null),r([l()],$.prototype,"valueOptions",null),r([l()],$.prototype,"view",null),r([l()],$.prototype,"pageStack",void 0),r([l()],$.prototype,"showDiscardEditsPrompt",void 0),r([l()],$.prototype,"_candidateCommitted",void 0),r([l()],$.prototype,"page",null),r([l()],$.prototype,"featureFormDisabled",null),r([l()],$.prototype,"canGoBack",null),r([l()],$.prototype,"shouldShowDeleteButton",null),r([l()],$.prototype,"hasPendingEdits",null),$=r([C(Tl)],$);const $y=$;let Re=class extends O{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};r([l({type:Boolean,nonNullable:!0})],Re.prototype,"colorSelection",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"dynamicScaleToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"gridEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"numericInputs",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"gridSnapEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"lineIntervalInput",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"outOfScaleWarning",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"placementButtons",void 0),r([l({type:Boolean,nonNullable:!0})],Re.prototype,"rotateWithMapToggle",void 0),Re=r([C("esri.widgets.support.GridControls.VisibleElements")],Re);const Sl=Re;let Pe=class extends O{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new Sl({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"enabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"featureEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"gridEnabledToggle",void 0),r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"header",void 0),r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"layerList",void 0),r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"gridControls",void 0),r([l({type:Sl,nonNullable:!0})],Pe.prototype,"gridControlsElements",void 0),r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"layerListToggleLayersButton",void 0),r([l({type:Boolean,nonNullable:!0})],Pe.prototype,"selfEnabledToggle",void 0),Pe=r([C("esri.widgets.support.SnappingControls.VisibleElements")],Pe);const fn=Pe;let De=class extends O{constructor(e){super(e),this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.labelsToggle=!0,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new fn,this.tooltipsToggle=!0,this.undoRedoButtons=!1}};r([l({type:Boolean,nonNullable:!0})],De.prototype,"createFeaturesSection",void 0),r([l({type:Boolean,nonNullable:!0})],De.prototype,"directionModePicker",void 0),r([l({type:Boolean,nonNullable:!0})],De.prototype,"editFeaturesSection",void 0),r([l({type:Boolean,nonNullable:!0})],De.prototype,"labelsToggle",void 0),r([l({type:Boolean,nonNullable:!0})],De.prototype,"settingsMenu",void 0),r([l({type:Boolean,nonNullable:!0})],De.prototype,"snappingControls",void 0),r([l({type:fn,nonNullable:!0})],De.prototype,"snappingControlsElements",void 0),r([l({type:Boolean,nonNullable:!0})],De.prototype,"tooltipsToggle",void 0),r([l({type:Boolean,nonNullable:!0})],De.prototype,"undoRedoButtons",void 0),De=r([C("esri.widgets.Editor.VisibleElements")],De);const Fl=De,Ui="esri-editor__panel-content",ln={base:Ui,message:`${Ui}__message`,section:`${Ui}__section`,sectionGroup:`${Ui}__section__group`,scrimContainer:`${Ui}__scrim-container`},vn=()=>ze({scrim:()=>E(()=>import("./calcite-scrim-j94-IGph.js"),__vite__mapDeps([287,1,2]))});function jt(t,...e){return f("div",{class:on(ln.base,t!=null&&t.showScrimOverlay?ln.scrimContainer:void 0),key:(t==null?void 0:t.key)??"panel-content"},...e,t!=null&&t.showScrimOverlay?f("calcite-scrim",null):void 0)}function Za(t,...e){return f("div",{class:ln.message,"data-testid":"panel-content-message",key:(t==null?void 0:t.key)??"panel-content-message"},...e)}function Ii(t,...e){return f("div",{class:ln.section,key:(t==null?void 0:t.key)??"panel-content-section"},...e)}function Sy(t,...e){return f("div",{class:ln.sectionGroup,key:(t==null?void 0:t.key)??"panel-content-section-group"},...e)}const Fy=()=>vn();function Oy({helpMessage:t}){return f(jt,{key:"creating-features-panel-content"},f(Za,{key:"content-message"},t))}const Ay=()=>vn();function Ly({editorItems:t,filterText:e,id:i,messagesTemplates:n,onFilterTextChange:s,onSelectFeature:a,workflow:o}){const d=new Map,p=o.data.candidates;let c=0;p.map(y=>({label:xy(y),id:y.attributes[y.layer.objectIdField],data:y})).filter(({label:y,data:g})=>{const m=e.toLowerCase(),{title:v}=g.layer,_=t.find(w=>w.layer===g.sourceLayer);return _?_.supportsUpdateWorkflow&&(!m||(y==null?void 0:y.toLowerCase().includes(m))||(v==null?void 0:v.toLowerCase().includes(m))):null}).filter(Fe).forEach(y=>{var m;c++;const g=y.data.layer;d.has(g)?(m=d.get(g))==null||m.items.push(y):d.set(g,{id:`${g.id}`,label:g.title??"",items:[y]})});const h=t.toArray().map(({layer:y})=>d.get(y)).filter(Fe),u=c>10||e.length>0;return f(jt,{key:"feature-list"},f(Ii,null,hl({enableListScroll:!1,filterEnabled:u,filterText:e,id:i,items:h,messages:{filterPlaceholder:n.filterPlaceholder,noItems:n.noItems,noMatches:n.noMatches},onFilterChange:y=>s(y),onItemMouseEnter:y=>a(y.data),onItemMouseLeave:()=>a(null),onItemSelect:y=>a(y.data,!0)})))}function xy(t){const e=t.layer;if(!e)return null;const i=e.fieldsIndex.get(e.objectIdField),n=i.alias||i.name,{attributes:s}=t,a=yr(e);return a&&s[a]&&`${s[a]}`||`${n}: ${s[i.name]}`}const Vy={base:"esri-editor__actions"},Ka=()=>ze({button:()=>E(()=>import("./calcite-button-OwHWnVyW.js"),__vite__mapDeps([148,1,2]))});function cs({buttons:t,key:e}){return f("div",{class:Vy.base,key:e??"footer-actions",slot:"footer"},t.filter(Fe).map(({disabled:i,onClick:n,label:s,...a},o)=>f("calcite-button",{disabled:i??!1,key:`action-${o}`,onclick:()=>{i||n()},width:"full",...a},s)))}const Ry={notice:"esri-editor__notice"},Ol=()=>ze({notice:()=>E(()=>import("./calcite-notice-BhTM-Xuv.js"),__vite__mapDeps([180,1,2,136,181,138]))});function Py({workflow:t,messages:e}){var s,a;const i=[],n="content-start";if(t!=null&&t.reliesOnOwnerAdminPrivileges){const o=e.ownerAdminNotice;i.push(f(qn,{key:"owner-admin-notice",message:o,slot:n}))}if(t!=null&&t.hasInvalidFormTemplate){const o=e.formFieldUpdateError;i.push(f(qn,{key:"form-field-error",kind:"warning",message:o,slot:n}))}if((t==null?void 0:t.type)==="create-features"&&((a=(s=t.data.upload)==null?void 0:s.result)==null?void 0:a.type)==="georeferenced-reprojected"){const o=e.helpMessages3d.meshReprojected;i.push(f(qn,{key:"mesh-reprojected",kind:"warning",message:o,slot:n}))}return f(us,null,i)}function qn(t){const e=t.kind??"brand";return f("calcite-notice",{class:Ry.notice,icon:tp[e],key:t.key,kind:e,open:!0,scale:"s"},t.title?f("div",{slot:"title"},t.title):null,f("div",{slot:"message"},t.message))}const Dy={absolute:"absolute-direction",relative:"relative-direction"},Al=()=>ze({icon:()=>E(()=>import("./calcite-icon-B5wvyzgm.js"),__vite__mapDeps([161,1,2])),label:()=>E(()=>import("./calcite-label-CXLoAlD_.js"),__vite__mapDeps([174,1,2])),switch:()=>E(()=>import("./calcite-switch-DiS6Xp-u.js"),__vite__mapDeps([184,1,2])),tooltip:()=>E(()=>import("./calcite-tooltip-CQlqWX4W.js"),__vite__mapDeps([288,1,2,139,140,138,146]))}),Wi="esri-labeled-switch",ji={label:`${Wi}__label`,labelContent:`${Wi}__label-content`,iconInfo:`${Wi}__icon_info`,iconWarning:`${Wi}__icon_warning`,tooltip:`${Wi}__tooltip`};function Ci({checked:t,disabled:e,hint:i,key:n,label:s,onChange:a,hintIcon:o,hintKind:d}){return f("calcite-label",{class:ji.label,disabled:e,key:n,layout:"inline-space-between",scale:"s"},f("div",{class:ji.labelContent,key:"label-content"},i?f(us,null,f("div",null,s),f("calcite-icon",{class:d!=="warning"?ji.iconInfo:ji.iconWarning,icon:o??"information",id:n,scale:"s",tabIndex:0}),f("calcite-tooltip",{class:ji.tooltip,referenceElement:n},i)):s),f("calcite-switch",{checked:t,disabled:e,scale:"s",onCalciteSwitchChange:p=>a(p.target.checked)}))}let ti=class extends O{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};r([l({type:Boolean,nonNullable:!0})],ti.prototype,"directionModePicker",void 0),r([l({type:Boolean,nonNullable:!0})],ti.prototype,"header",void 0),r([l({type:Boolean,nonNullable:!0})],ti.prototype,"labelsToggle",void 0),r([l({type:Boolean,nonNullable:!0})],ti.prototype,"tooltipsToggle",void 0),ti=r([C("esri.widgets.support.SketchTooltipControls.VisibleElements")],ti);const Ll=ti,Bi="esri-sketch-tooltip-controls",An={base:Bi,block:`${Bi}__block`,blockContent:`${Bi}__block-content`,hintIcon:`${Bi}__hint-icon`,radioButtonLabelWrapper:`${Bi}__radio-button-label-wrapper`};let Ut=class extends Fi{constructor(t,e){super(t,e),this.viewModel=null,this.visibleElements=new Ll,this.sketchOptions=new Zt,this.viewType=void 0,this._onTooltipsEnabledChange=i=>{this.sketchOptions.tooltips.enabled=i},this._onLabelsEnabledChange=i=>{this.sketchOptions.labels.enabled=i},this._onDirectionModeChange=i=>{this.sketchOptions.values.directionMode=i.target.selectedItem.value}}loadDependencies(){return Promise.all([ze({block:()=>E(()=>import("./calcite-block-CV5TdCEP.js"),__vite__mapDeps([135,1,2,136,137,138,139,140,141,142,143,144,145,146,147])),label:()=>E(()=>import("./calcite-label-CXLoAlD_.js"),__vite__mapDeps([174,1,2])),icon:()=>E(()=>import("./calcite-icon-B5wvyzgm.js"),__vite__mapDeps([161,1,2])),"radio-button":()=>E(()=>import("./calcite-radio-button-SzL8DcRw.js"),__vite__mapDeps([182,1,2,143])),"radio-button-group":()=>E(()=>import("./calcite-radio-button-group-DokW4NJz.js"),__vite__mapDeps([183,1,2,153,157]))}),Al()])}render(){const{label:t,visibleElements:e}=this,i=this._renderContent();return f("div",{"aria-label":t,class:this.classes(An.base,di.widget)},i?f("calcite-block",{class:An.block,heading:e.header?this.label:"",key:"content-block",open:!0},f("div",{class:An.blockContent,key:"content"},i)):void 0)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}_renderContent(){const{visibleElements:t,viewType:e}=this,i=[t.tooltipsToggle?this._renderTooltipsToggle():null,t.labelsToggle&&e!=="2d"?this._renderLabelsToggle():null,t.directionModePicker?this._renderDirectionModePicker():null].filter(Fe);return i.length===0?null:i}_renderTooltipsToggle(){const{messages:t,sketchOptions:e}=this;return f(Ci,{checked:e.tooltips.effectiveEnabled,hint:t.tooltipsToggleHint,key:`${this.id}__tooltips`,label:t.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:t,sketchOptions:e}=this;return f(Ci,{checked:e.labels.enabled,hint:t.labelsToggleHint,key:`${this.id}__labels`,label:t.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:t,sketchOptions:e}=this,{directionMode:i}=e.values;return f("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},t.directionModePicker,f("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:i,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",i,t.directionModeRelative),this._renderDirectionModeOption("absolute",i,t.directionModeAbsolute)))}_renderDirectionModeOption(t,e,i){return f("calcite-label",{key:t,layout:"inline",scale:"s"},f("calcite-radio-button",{checked:t===e,scale:"s",value:t}),f("div",{class:An.radioButtonLabelWrapper,key:"label-wrapper"},f("calcite-icon",{icon:Dy[t],scale:"s"}),i))}};r([l()],Ut.prototype,"label",null),r([l({type:Ll,nonNullable:!0})],Ut.prototype,"visibleElements",void 0),r([l(),Ue("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],Ut.prototype,"messages",void 0),r([l({nonNullable:!0,type:Zt})],Ut.prototype,"sketchOptions",void 0),r([l({type:String})],Ut.prototype,"viewType",void 0),Ut=r([C("esri.widgets.support.SketchTooltipControls")],Ut);const Gy=Ut,Je={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},Ny="hide",xl=Q.ofType(Ha);let ct=class extends At.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new xl,this.view=null}initialize(){this.addHandles([k(()=>{var e;return((e=this.view)==null?void 0:e.ready)===!0},()=>this._viewHandles(),K),k(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),k(()=>_o(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],Je.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e!=null&&e.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,i){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:i})}moveListItem(e,i,n,s){var g,m;const a=e==null?void 0:e.layer;if(!a||a.type==="subtype-sublayer"||a.type==="sublayer")return;const o=(m=(g=this.view)==null?void 0:g.map)==null?void 0:m.layers,d=i?xo(i):o,p=n?xo(n):o;if(!d||!p)return;const{operationalItems:c}=this,h=(i==null?void 0:i.children)||c,u=(n==null?void 0:n.children)||c,y=p.length-s;e.parent=n||null,h.remove(e),d.remove(a),u.includes(e)||u.add(e,y),p.includes(a)||p.add(a,y),this._compileList()}_createLayerViewHandles(e){this.removeHandles(Je.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),Je.layerViews)}_createMapLayerHandles(e){this.removeHandles(Je.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),Je.mapLayers)}_createListItem(e){const{view:i,listItemCreatedFunction:n,checkPublishStatusEnabled:s,listModeDisabled:a}=this;return new Ha({checkPublishStatusEnabled:s,listModeDisabled:a,layer:e,listItemCreatedFunction:n,view:i})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(i=>ls(i)!==Ny):void 0}_watchLayersListMode(e){this.removeHandles(Je.layerListMode),e&&!this.listModeDisabled&&this.addHandles(k(()=>e.filter(i=>"listMode"in i).map(i=>i.listMode).toArray(),()=>this._compileList()),Je.layerListMode)}_compileList(){var s,a;const e=(a=(s=this.view)==null?void 0:s.map)==null?void 0:a.layers,i=_o(this.view)&&!this.view.inGeographicLayout?e==null?void 0:e.filter(({type:o})=>o==="link-chart"):e;this._watchLayersListMode(i);const n=this._getViewableLayers(i);n!=null&&n.length?(this._createNewItems(n),this._removeItems(n),this._sortItems(n)):this._removeAllItems()}_createNewItems(e){const{operationalItems:i}=this;e.forEach(n=>{i.some(s=>s.layer===n)||i.add(this._createListItem(n))})}_removeItems(e){const{operationalItems:i}=this,n=[];i.forEach(s=>{s&&e&&e.includes(s.layer)||n.push(s)}),i.destroyMany(n)}_sortItems(e){const{operationalItems:i}=this;i.sort((n,s)=>{const a=e.indexOf(n.layer),o=e.indexOf(s.layer);return a>o?-1:a<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([Je.mapLayers,Je.layerViews,Je.viewLayers]),e!=null&&e.ready?this.addHandles([k(()=>{var i,n;return(n=(i=this.view)==null?void 0:i.map)==null?void 0:n.allLayers},i=>this._createMapLayerHandles(i),K),k(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},i=>this._createLayerViewHandles(i),K)],Je.viewLayers):this._removeAllItems()}};r([l()],ct.prototype,"checkPublishStatusEnabled",void 0),r([l()],ct.prototype,"listItemCreatedFunction",void 0),r([l({nonNullable:!0})],ct.prototype,"listModeDisabled",void 0),r([l({type:xl})],ct.prototype,"operationalItems",void 0),r([l({readOnly:!0})],ct.prototype,"state",null),r([l()],ct.prototype,"totalItems",null),r([l()],ct.prototype,"view",void 0),ct=r([C("esri.widgets.LayerList.LayerListViewModel")],ct);const Hy=ct,Ya=t=>Uy(t)||Wy(t),Uy=t=>{if(!("type"in t))return!1;switch(t.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},Wy=t=>{const e=sl(t);if(e!=null&&t.hasOwnProperty(e)&&t[e]!=null){for(const i of t[e])if(Ya(i))return!0}return!1},Zn=(t,e)=>e!=null&&t!=null&&(e.test(t.title)?"self":!!t.children.some(i=>Zn(i,e)!==!1)&&"children");var ba;let Mt=ba=class extends Ha{constructor(t){super(t),this.children=new Q,this.parent=null}get enabled(){const{children:t}=this;if(t.length===0)return this.featureSource!=null&&this.featureSource.enabled?"enabled":"disabled";let e=!1,i=!1;for(const n of t){if(n.enabled==="indeterminate")return n.enabled;if(n.enabled==="enabled"?e=!0:n.enabled==="disabled"&&(i=!0),i&&e)return"indeterminate"}return i?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(t=>[t.layer.id,...t.childLayerIds])}get featureSource(){const{layer:t,getFeatureSnappingSources:e}=this;return e().find(i=>i.layer===t)}_initializeChildLayers(t){if(!t)return;const e=t.filter(Ya);super._initializeChildLayers(e)}_createChildItems(t){return t.map(e=>Na(e)?new ba({layer:e,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(Fe).reverse()}};r([l()],Mt.prototype,"enabled",null),r([l()],Mt.prototype,"children",void 0),r([l()],Mt.prototype,"childLayerIds",null),r([l()],Mt.prototype,"featureSource",null),r([l({constructOnly:!0})],Mt.prototype,"getFeatureSnappingSources",void 0),r([l()],Mt.prototype,"parent",void 0),Mt=ba=r([C("esri.widgets.support.SnappingControls.SnappingListItem")],Mt);let ii=class extends Hy{constructor(){super(...arguments),this.featureSnappingSources=new Q}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>{var i;return!((i=e.children)!=null&&i.length)})}_compileList(){var s,a;const e=(a=(s=this.view)==null?void 0:s.map)==null?void 0:a.layers;if(!e)return;const i=e.filter(Ya);this._watchLayersListMode(i);const n=this._getViewableLayers(i);n!=null&&n.length?(this._createNewItems(n),this._removeItems(n),this._sortItems(n)):this._removeAllItems()}_createListItem(e){return new Mt({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};r([l()],ii.prototype,"featureSnappingSources",void 0),r([l()],ii.prototype,"operationalItems",void 0),r([l()],ii.prototype,"operationalItemsFlat",null),r([l()],ii.prototype,"selectableItems",null),ii=r([C("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],ii);let ut=class extends O{constructor(t){super(t),this.layerListViewModel=new ii,this.snappingOptions=new ui,this.view=null}initialize(){this.addHandles([k(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:t,view:e})=>{t.view=e},K),k(()=>{var t;return{viewModel:this.layerListViewModel,sources:(t=this.snappingOptions)==null?void 0:t.featureSources}},({viewModel:t,sources:e})=>{t.featureSnappingSources=e},K)])}get allLayersEnabled(){var t;return(((t=this.layerListViewModel)==null?void 0:t.selectableItems)??[]).every(e=>e.enabled==="enabled")}get allLayersDisabled(){var t;return(((t=this.layerListViewModel)==null?void 0:t.selectableItems)??[]).every(e=>!e.enabled)}get layersEnabledCount(){var t,e;return((e=(t=this.layerListViewModel)==null?void 0:t.selectableItems)==null?void 0:e.filter(i=>i.enabled==="enabled").length)??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(t,e){t==null||t.forEach(i=>e?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i))}toggleSnappingForAllLayers(t){this.layerListViewModel.selectableItems.forEach(({layer:{id:e}})=>{t?this.enableSnappingForLayer(e):this.disableSnappingForLayer(e)})}enableSnappingForLayer(t){const e=this._findSnappingSourceForLayer(t)??this._makeSnappingSourceForLayer(t);e&&(e.enabled=!0)}disableSnappingForLayer(t){const e=this._findSnappingSourceForLayer(t);e&&(e.enabled=!1)}updateEnabledFeatureSources(t){for(const e of this.snappingOptions.featureSources)Na(e.layer)&&(e.enabled=t.includes(e.layer.id))}_findSnappingSourceForLayer(t){return this.snappingOptions.featureSources.find(e=>e.layer.id===t)}_makeSnappingSourceForLayer(t){var n;const e=(n=this.layerListViewModel.operationalItemsFlat.find(s=>s.layer.id===t))==null?void 0:n.layer;if(!e)throw new U("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${t} because no such layer was found in the view`);if(e.type==="group")return;const i=new ks({layer:e});return this.snappingOptions.featureSources.add(i),i}};r([l()],ut.prototype,"allLayersEnabled",null),r([l()],ut.prototype,"allLayersDisabled",null),r([l({constructOnly:!0})],ut.prototype,"layerListViewModel",void 0),r([l()],ut.prototype,"layersEnabledCount",null),r([l({type:ui,nonNullable:!0})],ut.prototype,"snappingOptions",void 0),r([l()],ut.prototype,"state",null),r([l()],ut.prototype,"view",void 0),ut=r([C("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],ut);const jy=ut,Qe="esri-snapping-controls",Xe={base:Qe,container:`${Qe}__container`,item:`${Qe}__item`,toggleBlock:`${Qe}__toggle-block`,layerListBlock:`${Qe}__layer-list-block`,layerList:`${Qe}__layer-list`,layerListFilter:`${Qe}__layer-list__filter`,layerListButton:`${Qe}__layer-list__button`,layerListItem:`${Qe}__layer-list__item`,layerListGroup:`${Qe}__layer-list__group`,nestedContainer:`${Qe}__nested-container`};let ee=class extends Fi{constructor(e,i){super(e,i),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new fn,this._enableSnappingSwitchChange=o=>{this.snappingOptions.enabled=o},this._featureEnabledSwitchChange=o=>{this.snappingOptions.featureEnabled=o},this._gridEnabledSwitchChange=o=>{this.snappingOptions.gridEnabled=o,o&&this._startLoadGrid()},this._selfEnabledSwitchChange=o=>{this.snappingOptions.selfEnabled=o},this._onToggleLayersButtonClick=o=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),hr(o.target)};const{snappingOptions:n,view:s,viewModel:a}=e;this.viewModel=a??(this._defaultViewModel=new jy({snappingOptions:n,view:s}))}normalizeCtorArgs(e){const{snappingOptions:i,view:n,viewModel:s,...a}=e;return a}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=Se(this._defaultViewModel))}loadDependencies(){return Promise.all([ze({block:()=>E(()=>import("./calcite-block-CV5TdCEP.js"),__vite__mapDeps([135,1,2,136,137,138,139,140,141,142,143,144,145,146,147])),button:()=>E(()=>import("./calcite-button-OwHWnVyW.js"),__vite__mapDeps([148,1,2])),input:()=>E(()=>import("./calcite-input-C30oMPBL.js"),__vite__mapDeps([162,163,1,2,153,164,157,165])),list:()=>E(()=>import("./calcite-list-DEz7lVXs.js"),__vite__mapDeps([175,1,2,176,177,152,140,163,153,164,157,165])),"list-item":()=>E(()=>import("./calcite-list-item-BLSA8Adn.js"),__vite__mapDeps([178,1,2,177,176,141,147])),checkbox:()=>E(()=>import("./calcite-checkbox-Cn1O7aj9.js"),__vite__mapDeps([289,1,2])),loader:()=>E(()=>import("./calcite-loader-Ce47wHPj.js"),__vite__mapDeps([179,1,2]))}),Al()])}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=Se(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return f("div",{"aria-label":e,class:this.classes(Xe.base,di.widget)},f("div",{class:Xe.container},this._renderContent()))}_renderContent(){var e;return[this._renderToggles(),this._renderLayerList(),((e=this.view)==null?void 0:e.type)==="2d"&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:i}=this,n=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&(i==null?void 0:i.type)==="2d"?this._renderGridEnabledToggle():null].filter(Fe),s=[e.enabledToggle?this._renderEnabledToggle():null,n.length>0?f("div",{class:Xe.nestedContainer},n):null].filter(Fe);return s.length===0?null:f("calcite-block",{class:Xe.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",open:!0},s)}_renderEnabledToggle(){return f(Ci,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return f(Ci,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return f(Ci,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return f(Ci,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:i}=this,n=({target:{value:d}})=>{this._layerListFilter=d===""?null:new RegExp(d,"i")},s=i.layerListViewModel.operationalItems.length>9?f("calcite-input",{class:Xe.layerListFilter,clearable:!0,placeholder:e==null?void 0:e.searchLayers,onCalciteInputInput:n}):null,a=this._secondaryElementsDisabled,o=this.layerListOpen&&!a;return f("calcite-block",{class:Xe.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:o,onCalciteBlockToggle:d=>this.layerListOpen=d.target.open},s,this._renderToggleLayersButton(),f("calcite-list",{class:Xe.layerList,selectionMode:"none"},this._renderLayerListItemCollection(i.layerListViewModel.operationalItems)))}_renderGridOptions(){var h;const{view:e,visibleElements:i,snappingManager:n,snappingOptions:s,_openAndReady:a}=this,{gridEnabled:o,enabled:d}=s;a&&this._startLoadGrid();const p=(h=this._gridLoadTask)==null?void 0:h.value,c=p&&(e==null?void 0:e.type)==="2d"&&f(p,{snappingManager:n,snappingOptions:s,view:e,visibleElements:i.gridControlsElements});return f("calcite-block",{class:Xe.layerListBlock,collapsible:!0,disabled:!o||!d,heading:this.messages.gridOptionsHeading,key:"grid-block",open:a,onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},c??f("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}async _startLoadGrid(){var e;!this._gridLoadTask&&this.visibleElements.gridControls&&((e=this.view)==null?void 0:e.type)==="2d"&&(this._gridLoadTask=pn(async()=>(await E(async()=>{const{default:i}=await import("./GridControls-_XlWP9J0.js");return{default:i}},__vite__mapDeps([290,1,2,121,10,11,12,13,194,9,195,7,196,106,197,105,107,44,198,199,200,133,201,202,122,190,191,6,8,47,192,193,45,112,104,203,204,108,109,205,206,14,15,16,30,17,3,4,5,207,208,102,209,99,100,58,25,26,65,66,67,68,84,97,210,211,212,96,46,38,213,35,36,110,101,59,43,214,18,19,20,21,22,23,24,27,28,29,31,32,33,34,37,39,40,41,42,48,49,50,51,52,53,54,55,56,57,60,61,62,63,64,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,98,103,111,113,114,115,250,279]))).default))}_renderLayerListItemCollection(e){const i=this._layerListFilter;return e.map(n=>{switch(i?Zn(n,i):null){case"children":{const s=n.children.filter(a=>Zn(a,i)!==!1);return this._renderLayerListItemGroup(n,s)}case"self":case null:return this._renderLayerListItemOrGroup(n);case!1:return Zn(n.parent,i)==="self"?this._renderLayerListItemOrGroup(n):null}}).toArray().filter(Fe)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:i}=this,n=e?i.disableAllLayers:i.enableAllLayers;return f("calcite-button",{appearance:"transparent",class:Xe.layerListButton,label:n,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},n)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:i}}=this,n=e.title||i,s=()=>{this.viewModel.toggleSnappingForLayers([e.layer.id],e.enabled!=="enabled")};return f("calcite-list-item",{class:Xe.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:n,onCalciteListItemSelect:a=>{a.stopPropagation(),s()}},f("calcite-checkbox",{checked:e.enabled==="enabled",slot:"actions-start",onCalciteCheckboxChange:s}))}_renderLayerListItemGroup(e,i){const{children:n,title:s}=e,a=s||this.messages.untitledLayer,o=s&&s!==""?s:Ia(),d=!!(i!=null&&i.length),p=i??n,c=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,e.enabled!=="enabled")};return f("calcite-list-item",{class:Xe.layerListGroup,key:o,label:a,open:d,onCalciteListItemSelect:h=>{h.stopPropagation(),c()}},f("calcite-checkbox",{checked:e.enabled==="enabled",indeterminate:e.enabled==="indeterminate",slot:"actions-start",onCalciteCheckboxChange:c}),f("calcite-list",null,this._renderLayerListItemCollection(p)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};r([l()],ee.prototype,"_defaultViewModel",void 0),r([l()],ee.prototype,"_layerListFilter",void 0),r([l()],ee.prototype,"_gridLoadTask",void 0),r([l()],ee.prototype,"_openAndReady",null),r([l()],ee.prototype,"label",null),r([l({type:Boolean,nonNullable:!0})],ee.prototype,"layerListOpen",void 0),r([l({type:Boolean,nonNullable:!0})],ee.prototype,"gridOptionsOpen",void 0),r([l(),Ue("esri/widgets/support/SnappingControls/t9n/SnappingControls")],ee.prototype,"messages",void 0),r([l(),Ue("esri/t9n/common")],ee.prototype,"messagesCommon",void 0),r([l()],ee.prototype,"snappingOptions",null),r([l()],ee.prototype,"snappingManager",void 0),r([l()],ee.prototype,"view",null),r([l()],ee.prototype,"viewModel",null),r([l({type:fn,nonNullable:!0})],ee.prototype,"visibleElements",void 0),r([l()],ee.prototype,"_enabledToggleDisabled",null),r([l()],ee.prototype,"_secondaryElementsDisabled",null),ee=r([C("esri.widgets.support.SnappingControls")],ee);const By=ee,zy={settingsContainer:"esri-editor__settings"},qy=()=>ze({accordion:()=>E(()=>import("./calcite-accordion-DrLEyXdV.js"),__vite__mapDeps([291,1,2])),"accordion-item":()=>E(()=>import("./calcite-accordion-item-BlbU6_We.js"),__vite__mapDeps([292,1,2,136]))});function Zy({editorViewModel:t,messagesCommon:e,visibleElements:i}){const{snappingOptions:n,sketchOptions:s,view:a,sketchViewModel:o}=t,d=[],p={directionModePicker:i.directionModePicker,labelsToggle:i.labelsToggle,tooltipsToggle:i.tooltipsToggle};return Object.values(p).includes(!0)&&d.push(f(Gy,{sketchOptions:s,viewType:a==null?void 0:a.type,visibleElements:p})),i.snappingControls&&d.push(f(By,{afterCreate:c=>c.layerListOpen=!1,snappingManager:o==null?void 0:o.snappingManager,snappingOptions:n,view:a,visibleElements:i.snappingControlsElements??new fn})),d.length===0?null:f("calcite-accordion",{appearance:"transparent",class:zy.settingsContainer,key:"settings"},f("calcite-accordion-item",{"data-testid":"settings",heading:e.settings,iconStart:"gear"},d))}const Ky={base:"esri-editor__panel-toolbar"},Yy=()=>Promise.all([ze({button:()=>E(()=>import("./calcite-button-OwHWnVyW.js"),__vite__mapDeps([148,1,2]))}),qy()]);function Jy({editorViewModel:t,messagesCommon:e,visibleElements:i}){const{sketchViewModel:n}=t;return f("div",{class:Ky.base,key:"panel-toolbar"},f(Zy,{editorViewModel:t,messagesCommon:e,visibleElements:i}),i.undoRedoButtons?[f("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(n!=null&&n.canUndo()),iconStart:"undo",key:"undo-button",kind:"neutral",label:e.undo,onclick:()=>n==null?void 0:n.undo(),scale:"l"},e.undo),f("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(n!=null&&n.canRedo()),iconStart:"redo",key:"redo-button",kind:"neutral",label:e.redo,onclick:()=>n==null?void 0:n.redo(),scale:"l"},e.redo)]:null)}const Qy=()=>Promise.all([Ka(),Ol(),vn()]);function Xo({editorViewModel:t,headingLevel:e,messages:i,messagesCommon:n,onDelete:s,onSave:a,renderAttachments:o,renderFeatureForm:d}){const{activeWorkflow:p,featureFormViewModel:c,syncing:h}=t;if(!p||!c)return null;const u=Dh(p)?p.activeWorkflow??p:p,y=u.type.includes("update"),g=y&&!u.hasPendingEdits||h||c.updating,m=y?n.update:n.create,v=(u==null?void 0:u.type)==="create-features"&&u.createFeatureState==="create-new",_=(u==null?void 0:u.type)==="create-features"?u.numPendingFeatures:0,w=_>1?Wt(i.createFeaturesTemplate,{numFeatures:_}):m,b=p.shouldShowAttachments&&!c.activeRelationshipInput,M=c.inputs.every(I=>!I.visible)&&!b?f(Za,{key:"panel-content-message"},Wt(i.clickToFinishTemplate,{button:m})):f(Ii,{key:"panel-content-section"},f(Py,{messages:i,workflow:p}),f(Sy,null,d(),b?f("div",{key:"attachments"},f(an,{level:Qi(e)},i.attachments),o()):null));return f(us,null,f(jt,{key:"attribute-panel-content",showScrimOverlay:v},M),f(cs,{buttons:[{onClick:a,disabled:g,label:w},t.shouldShowDeleteButton?{appearance:"outline",onClick:s,disabled:h,kind:"danger",label:n.delete}:void 0]}))}const Ee="esri-editor__upload-details",He={base:Ee,status:`${Ee}__status`,titleWrapper:`${Ee}__title-wrapper`,title:`${Ee}__title`,description:`${Ee}__description`,loader:`${Ee}__loader`,iconSuccess:`${Ee}__icon ${Ee}__icon--success`,iconError:`${Ee}__icon ${Ee}__icon--error`,fileList:`${Ee}__file-list`,file:`${Ee}__file`,fileIcon:`${Ee}__file-icon`,fileName:`${Ee}__file-name`},Xy=()=>Promise.all([ze({icon:()=>E(()=>import("./calcite-icon-B5wvyzgm.js"),__vite__mapDeps([161,1,2])),loader:()=>E(()=>import("./calcite-loader-Ce47wHPj.js"),__vite__mapDeps([179,1,2]))}),Ka(),vn()]);function em(t){const{messages:e,key:i,upload:n}=t;return f(us,null,f(jt,{key:i??"upload-details"},f(Ii,null,tm(t))),n.state==="error"?f(cs,{buttons:[{onClick:()=>n.retry(),label:e.modelUploads.error.uploadNew,iconStart:"upload-to"}],key:"upload-details-footer-actions"}):null)}function tm(t){const e=im(t);return e?f("div",{class:He.base,"data-testid":"upload-details",key:"upload-details-content"},f("div",{class:He.status,key:"status"},e.iconContent,f("div",{class:He.titleWrapper,key:"text"},f("div",{class:He.title,key:"title"},e.title),f("div",{class:He.description,key:"description"},e.description))),sm(t.upload)):null}function im({helpMessage:t,messages:e,upload:i}){switch(i.state){case"pending":{const{title:n,description:s}=e.modelUploads.pending;return{title:n,description:s,iconContent:f("calcite-loader",{"aria-hidden":"true",class:He.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*i.progress),i.progress===1?100:99)})}}case"success":{const{title:n}=e.modelUploads.success;return{title:n,description:t||e.helpMessages3d.mesh,iconContent:f("calcite-icon",{class:on(He.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:n}=e.modelUploads.error;return{title:n,description:nm(i.error,e),iconContent:f("calcite-icon",{class:on(He.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}function nm(t,e){if(!t)return null;const i=e.modelUploads.error.messages;switch(t.constructor){case pc:return i.noModel;case dc:return i.multipleModels;case lc:return i.conversionFailed;case U:switch(t.name){case"glt-loader-error":case"gltf-loader-invalid-glb":return i.loadFailed;case"gltf-loader-unsupported-feature":return i.unsupportedFeature;case"glt-loader-request-error":return i.resourceRequestFailed;default:return i.default}default:return i.default}}function sm(t){return f("div",{class:He.fileList,key:"file-list"},t.files.map(e=>f("div",{class:He.file,key:`file-${e.name}`},f("calcite-icon",{class:He.fileIcon,icon:om(e),scale:"s"}),f("span",{class:He.fileName},am(e.name)))))}function am(t){var e;return((e=t.split("/").pop())==null?void 0:e.split("\\").pop())??""}function om(t){var i;const e=(i=t.name.split(".").pop())==null?void 0:i.toLowerCase();return(e?lm[e]:null)??rm}const rm="file",er="file-shape",Ln="file-image",lm={glb:er,gltf:er,jpeg:Ln,jpg:Ln,png:Ln,svg:Ln,zip:"file-zip"};let L=class extends Fi{constructor(t,e){super(t,e),this._featureForm=new ch,this._attachments=new Ep({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new Fh({enableListScroll:!1,renderItemContentEnd:i=>i.supportsUpload?f("calcite-icon",{class:gi.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:i=>i.label,renderCustomGroupContent:i=>this._renderCustomTemplateGroupContent(i)}),this._filterText="",this._prompt=null,this._spinner=new kp,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new $y,this.visibleElements=new Fl,this._renderAttachments=()=>this._attachments.render(),this._renderFeatureForm=()=>this._featureForm.render(),this._renderFeatureTemplates=()=>this._featureTemplates.render(),this._renderSelectIcon=()=>f("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({heading:i,key:n},...s)=>{const{visibleElements:a}=this;return f("calcite-flow-item",{closable:!1,heading:i,headingLevel:this.headingLevel,key:n,loading:this._loading,onCalciteFlowItemBack:this._onBack},a.settingsMenu?f(Jy,{editorViewModel:this.viewModel,messagesCommon:this.messagesCommon,visibleElements:a}):null,...s)},this._showDiscardEditsPrompt=()=>{var s;const{messages:i,activeWorkflow:n}=this;return(n==null?void 0:n.type)==="create-features"&&en(n.data.creationInfo)?this._showPromptAndWait(((s=n.data.upload)==null?void 0:s.state)==="success"?i.modelUploads.cancelPlacementPrompt:i.modelUploads.cancelUploadPrompt):this._showPromptAndWait({title:i.cancelEditTitle,message:i.cancelEditWarningMessage,yesLabel:i.discardEdits,noLabel:i.continueEditing})},this._showGenericCancelPrompt=()=>{const{messages:i,messagesCommon:n}=this;return this._showPromptAndWait({title:i.cancelRequestTitle,message:i.cancelRequestWarningMessage,yesLabel:n.form.yes,noLabel:n.form.no})},this._showPrompt=i=>{var n,s;(s=(n=this._prompt)==null?void 0:n.cancel)==null||s.call(n),this._prompt=i},this._clearPrompt=()=>{this._prompt=null},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:i,messagesCommon:n}=this;this._showPrompt({title:i.deleteWarningTitle,message:i.deleteWarningMessage,context:"danger",actions:{primary:{label:n.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:i.keepFeature,action:this._clearPrompt}}})},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=i=>(i==null||i.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var n;const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"||i.type==="update"&&((n=i.activeWorkflow)==null?void 0:n.type)==="create-features"?(this._attachments.addFile(),i.back()):this._attachments.addAttachment().then(()=>i.back()))},this._onAttachmentUpdate=()=>{const{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"?(this._attachments.updateFile(),i.back()):this._attachments.updateAttachment().then(()=>i.back()))},this._onAttachmentDelete=()=>{const{messages:i,messagesCommon:n}=this;this._showPrompt({title:i.deleteAttachmentWarningTitle,message:i.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:n.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:i.keepAttachment,action:this._clearPrompt}}})},this._onAttachmentDeleteConfirm=async()=>{const i=this._attachments,{activeWorkflow:n}=this.viewModel;n&&(n.type==="create-features"?i.deleteFile():(await i.deleteAttachment(i.viewModel.activeAttachmentInfo),this._clearPrompt()),await n.back(),this._clearPrompt())},this._onAttachmentsError=i=>{this._showPrompt({title:this.messages.errorWarningTitle,message:i.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}})}}initialize(){this._featureForm.showPrompt=this._showPrompt,this._featureForm.clearPrompt=this._clearPrompt,this.addHandles([k(()=>Qi(this.headingLevel),t=>{this._featureForm.headingLevel=t,this._featureTemplates.headingLevel=t},K),Ne(()=>this.viewModel.activeWorkflow,"cancel-request",({controller:t})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then(e=>e?t.allow():t.deny())}),si(()=>this.viewModel.featureFormViewModel,t=>{this._featureForm.viewModel=t},K),k(()=>this.viewModel,t=>{this._attachments.viewModel=(t==null?void 0:t.attachmentsViewModel)??null,this._featureTemplates.viewModel=(t==null?void 0:t.featureTemplatesViewModel)??null,this._spinner.viewModel=(t==null?void 0:t.spinnerViewModel)??null,t.showDiscardEditsPrompt=this._showDiscardEditsPrompt},K),k(()=>this.view,(t,e)=>{const i=`editor-${this.id}-spinner`;e==null||e.ui.remove(this._spinner,i),t==null||t.ui.add(this._spinner,{key:i,position:"manual"})},K),k(()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel],([t])=>{var e;t&&(this._featureForm.set(t.featureForm),this._attachments.set(t.attachments),this._featureTemplates.set(t.featureTemplates),(e=this.viewModel.sketchViewModel)==null||e.set(t.sketch))},K),si(()=>{var t;return(t=this._attachments)==null?void 0:t.error},t=>this._onAttachmentsError(t)),si(()=>{var t;return(t=this.viewModel)==null?void 0:t.failures},t=>{const{messages:e}=this,[{error:i,retry:n,cancel:s}]=t;this._showPrompt({title:e.errorWarningTitle,message:Wt(e.errorWarningMessageTemplate,{errorMessage:i.message}),context:"warning",actions:{primary:{label:e.retry,action:()=>{n(),this._clearPrompt()}},secondary:{label:e.ignore,action:()=>{s(),this._clearPrompt()}}}})}),k(()=>{var t;return(t=this.viewModel)==null?void 0:t.state},t=>{switch(t){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}}),k(()=>this.viewModel.featureFormDisabled,t=>this._featureForm.disabled=t)])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return Promise.all([ze({"flow-item":()=>E(()=>import("./calcite-flow-item-DP0tjgKQ.js"),__vite__mapDeps([293,1,2,294,142,143,141,144,139,140,145,138,137,146])),flow:()=>E(()=>import("./calcite-flow-DPwGtHi7.js"),__vite__mapDeps([295,1,2])),icon:()=>E(()=>import("./calcite-icon-B5wvyzgm.js"),__vite__mapDeps([161,1,2])),list:()=>E(()=>import("./calcite-list-DEz7lVXs.js"),__vite__mapDeps([175,1,2,176,177,152,140,163,153,164,157,165]))}),Fy(),Ay(),Ka(),Ol(),vn(),Yy(),ip(),Qy(),Xy()])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get _loading(){const{viewModel:t}=this;return t.syncing||t.updating||this._attachments.submitting}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(t){Js(le.getLogger(this),"allowedWorkflows",{replacement:"visibleElements",version:"4.29",warnOnce:!0}),this.viewModel.allowedWorkflows=t}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(t){this.viewModel.hideTemplatesForInactiveLayers=t}get icon(){return"pencil"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(t){this.viewModel.labelOptions=t}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(t){this.viewModel.layerInfos=t}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(t){this.viewModel.tooltipOptions=t}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(t){this.viewModel.valueOptions=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(t){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(t)}startCreateFeaturesWorkflowAtFeatureEdit(t){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(t)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(t){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(t)}startUpdateWorkflowAtFeatureEdit(t){return this.viewModel.startUpdateWorkflowAtFeatureEdit(t)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(t){return this.viewModel.cancelWorkflow(t)}render(){const{viewModel:t}=this,e=this.classes(gi.base,di.widget,di.panel);return t?f("div",{class:e,key:"base"},f("calcite-flow",{key:"flow"},t.pageStack.map(i=>this._renderPage(i))),this._prompt?f(ur,{...this._prompt,headingLevel:this.headingLevel}):void 0):f("div",{class:e,key:"empty"})}_renderPage(t){switch(t){case"disabled":break;case"ready":return this._renderReady();case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo();case"creating-features-upload-details":return this._renderUploadDetails();case"creating-features":return this._renderCreatingFeatures();case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature();case"awaiting-update-feature-candidate":return this._renderFeatureList();case"adding-attachment":return this._renderAttachmentAdding();case"editing-attachment":return this._renderAttachmentEditing()}return f("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(){const{EditorPanel:t,messages:e}=this;return f(t,{heading:e.selectTemplate,key:"templates-panel"},f(jt,{key:"feature-templates"},f(Ii,null,this._renderFeatureTemplates())))}_renderUploadDetails(){const{EditorPanel:t,activeWorkflow:e,messages:i}=this;if((e==null?void 0:e.type)!=="create-features")return null;const n=e.data.upload;return n?f(t,{heading:i.createFeatures,key:"upload-details-panel"},f(em,{helpMessage:this._helpMessage,messages:i,upload:n})):null}_renderCreatingFeatures(){var d,p;const{EditorPanel:t,activeWorkflow:e,messages:i,messagesCommon:n,headingLevel:s,viewModel:a}=this;if(!e)return null;const o=e.type==="create-features"&&e.numPendingFeatures>0||e.type==="update"&&((d=e==null?void 0:e.activeWorkflow)==null?void 0:d.type)==="create-features"&&((p=e.activeWorkflow)==null?void 0:p.numPendingFeatures)>0;return f(t,{heading:i.createFeatures,key:"create-features-panel"},o?f(Xo,{editorViewModel:a,headingLevel:s,messages:i,messagesCommon:n,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,onDelete:this._onDelete,onSave:this._onSave}):f(Oy,{helpMessage:this._helpMessage}))}_renderUpdateFeature(){const{EditorPanel:t,messages:e,messagesCommon:i,headingLevel:n,viewModel:s}=this;return f(t,{heading:e.editFeature,key:"update-feature-panel"},f(Xo,{editorViewModel:s,headingLevel:n,messages:e,messagesCommon:i,renderAttachments:this._renderAttachments,renderFeatureForm:this._renderFeatureForm,onDelete:this._onDelete,onSave:this._onSave}))}_renderCustomTemplateGroupContent(t){const{messages:e,viewModel:i}=this,n=np(t.group.items,s=>i.itemHasInvalidFormTemplate(s)?e.formFieldCreateError:void 0);return n?f(qn,{kind:"warning",message:n}):null}_renderAttachmentAdding(){const{EditorPanel:t,_attachments:e,messages:i,messagesCommon:n}=this;return f(t,{heading:i.addAttachment,key:"attachment-adding-panel"},f(jt,{key:"attachments"},this._renderAttachments()),f(cs,{buttons:[{label:e.submitting?n.cancel:n.add,disabled:e.submitting||!e.selectedFile,onClick:this._onAttachmentAdd}]}))}_renderAttachmentEditing(){const{EditorPanel:t,_attachments:e,activeWorkflow:i,messages:n,messagesCommon:s}=this;return i?f(t,{heading:n.editAttachment,key:"attachment-editing-panel"},f(jt,{key:"attachments"},this._renderAttachments()),i.shouldAllowAttachmentEditing?f(cs,{buttons:[{label:s.update,disabled:e.submitting||!e.selectedFile,onClick:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:e.submitting,label:s.delete}]}):void 0):null}_renderReady(){const{EditorPanel:t,messages:e,viewModel:i,visibleElements:n}=this,s=this._helpMessage;return f(t,{heading:e.widgetLabel,key:"landing-panel"},f(jt,{key:"landing-content"},i.editorItems.length?[n.editFeaturesSection?f(Ii,{key:"edit-actions"},this._renderUpdateActions()):null,n.createFeaturesSection&&i.canCreateVisible?f(Ii,{key:"create-actions"},this._renderCreateActions()):null]:f(Za,{key:"no-content"},e.noEditableLayers)),s?f("div",{class:gi.helpMessage,key:"footer-actions",slot:"footer"},s):void 0)}get _helpMessage(){var s;const{activeWorkflow:t,messages:e,view:i}=this,n=t==null?void 0:t.helpMessage;return n?(s=e[(i==null?void 0:i.type)==="3d"?"helpMessages3d":"helpMessages2d"])==null?void 0:s[n]:void 0}_renderUpdateActions(){var s;const{messages:t,messagesCommon:e,viewModel:i}=this,n={id:"select",label:e.select};return f("div",{class:gi.updateActions,key:"update-actions"},f(an,{level:Qi(this.headingLevel)},t.editFeatures),f("calcite-list",{class:gi.updateActionsList,selectionAppearance:"border",selectionMode:"single"},Wa({disabled:!i.canUpdateVisible,grouped:!1,item:n,selectedItem:((s=i.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-to-update"?n:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return f("div",{key:"create-actions"},f(an,{level:Qi(this.headingLevel)},this.messages.createFeatures),f("div",{class:gi.featureTemplatesContainer,key:"templates"},this._renderFeatureTemplates()))}_renderFeatureList(){const{EditorPanel:t,viewModel:e}=this,{activeWorkflow:i}=e;if((i==null?void 0:i.type)!=="update")return null;const n=i.data.candidates,s=Wt(this.messages.multipleFeaturesTemplate,{total:n.length});return f(t,{heading:s,key:"feature-list"},f(Ly,{editorItems:e.editorItems,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:i,onFilterTextChange:a=>this._filterText=a,onSelectFeature:(a,o)=>e.selectFeature(a,o)}))}_showPromptAndWait({title:t,message:e,yesLabel:i,noLabel:n}){const s=un(),{view:a}=this,o=a==null?void 0:a.focused;return this._showPrompt({title:t,message:e,context:"danger",actions:{primary:{label:i,action:()=>s.resolve(!0)},secondary:{label:n,action:()=>s.resolve(!1)}}}),s.promise.finally(()=>{this._clearPrompt(),o&&(a==null||a.focus())})}};r([l()],L.prototype,"_featureForm",void 0),r([l()],L.prototype,"_attachments",void 0),r([l()],L.prototype,"_featureTemplates",void 0),r([l()],L.prototype,"_filterText",void 0),r([l()],L.prototype,"_prompt",void 0),r([l()],L.prototype,"_spinner",void 0),r([l()],L.prototype,"_deleteButtonCommonInfo",null),r([l()],L.prototype,"_loading",null),r([l({readOnly:!0})],L.prototype,"activeWorkflow",null),r([l()],L.prototype,"allowedWorkflows",null),r([l()],L.prototype,"headingLevel",void 0),r([l()],L.prototype,"hideTemplatesForInactiveLayers",null),r([l()],L.prototype,"icon",null),r([l()],L.prototype,"label",null),r([l()],L.prototype,"labelOptions",null),r([l()],L.prototype,"layerInfos",null),r([l(),Ue("esri/widgets/Editor/t9n/Editor")],L.prototype,"messages",void 0),r([l(),Ue("esri/t9n/common")],L.prototype,"messagesCommon",void 0),r([l(),Ue("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],L.prototype,"messagesTemplates",void 0),r([l()],L.prototype,"snappingOptions",null),r([l()],L.prototype,"tooltipOptions",null),r([l()],L.prototype,"supportingWidgetDefaults",void 0),r([l({type:Cs,nonNullable:!0})],L.prototype,"valueOptions",null),r([l()],L.prototype,"view",null),r([l(),Ma(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],L.prototype,"viewModel",void 0),r([l({type:Fl,nonNullable:!0})],L.prototype,"visibleElements",void 0),r([l()],L.prototype,"_helpMessage",null),L=r([C("esri.widgets.Editor")],L);const dm=L,bf=Object.freeze(Object.defineProperty({__proto__:null,default:dm},Symbol.toStringTag,{value:"Module"}));export{Yr as $,zo as A,Cl as B,uy as C,Zt as D,cu as E,Z as F,Zm as G,il as H,fg as I,ou as J,Ur as K,z as L,cg as M,bo as N,ig as O,_u as P,rs as Q,vg as R,ng as S,bu as T,Sl as U,Al as V,Ci as W,na as X,zi as Y,Eo as Z,Pc as _,Dn as a,as as a0,Ce as a1,Da as a2,Lc as a3,au as a4,Dc as a5,Ga as a6,tt as a7,hu as a8,oi as a9,Oh as aa,pg as ab,vc as ac,wt as ad,_c as ae,Lr as af,sg as ag,Bm as ah,ru as ai,So as aj,ag as ak,Dy as al,ug as am,hc as an,og as ao,rg as ap,Jm as aq,Ym as ar,Qm as as,Be as at,Eu as au,$t as av,ly as aw,D as ax,bf as ay,_s as b,Ae as c,Os as d,gu as e,Sr as f,fu as g,qt as h,Vi as i,gg as j,zm as k,yn as l,yg as m,nl as n,ye as o,ts as p,mn as q,vu as r,Km as s,wu as t,os as u,_g as v,dg as w,Cu as x,vs as y,mg as z};
