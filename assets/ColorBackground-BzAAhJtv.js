const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ElevationQuery-Bhbxi2uZ.js","assets/index-C1aGfQcb.js","assets/index-qkyhuh7d.css","assets/projection-BOBOhWzm.js","assets/projectBuffer-CZ7yaGuo.js","assets/TileKey-DZd6gJy7.js","assets/layersCreator-CNJ7O2pS.js","assets/portalLayers-Tq0Hm7T7.js","assets/associatedFeatureServiceUtils-BHFYEf6o.js","assets/arcgisLayerUrl-BkZy4Mr3.js","assets/fetchService-DODjWwEX.js","assets/portalItemUtils-Cy9KvMYK.js","assets/styleUtils-CFywnZa6.js"])))=>i.map(i=>d[i]);
import{F as o,G as a,K as h,hD as J,b0 as M,ay as f,cS as I,hC as y,Z as B,W,J as m,hB as k,bq as G,b7 as U,b9 as F,T as Z,f0 as Q,fx as H,br as K,aG as X,aA as N,aD as j,eq as Y,iW as ee,aO as te,f6 as re,aE as L,aF as _,ba as x,f8 as q,fw as oe,hF as se,bU as O,cl as ae,di as ie,L as ne,iX as le,ck as pe}from"./index-C1aGfQcb.js";import{n as z}from"./CollectionFlattener-COw367kg.js";import{y as ye,m as ue,b as de}from"./basemapUtils-SfV6Ch_Z.js";import{n as ce,l as he,t as me}from"./TablesMixin-CmFQDxpI.js";let c=class extends J{constructor(t){super(t),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(t){return t!=null&&this.row===t.row&&this.rows===t.rows&&this.column===t.column&&this.columns===t.columns}};o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"row",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"column",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"rows",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"columns",void 0),c=o([h("esri.CameraLayout")],c);const V=c;let l=class extends M(f){constructor(...e){super(...e),this.position=new I([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new V}normalizeCtorArgs(e,t,s,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const i={position:e};return t!=null&&(i.heading=t),s!=null&&(i.tilt=s),r!=null&&(i.fov=r),i}return e}writePosition(e,t,s,r){const i=e.clone();i.x=y(e.x||0),i.y=y(e.y||0),i.z=e.hasZ?y(e.z||0):e.z,t[s]=i.write({},r)}readPosition(e,t){const s=new I;return s.read(e,t),s.x=y(s.x||0),s.y=y(s.y||0),s.z=s.hasZ?y(s.z||0):s.z,s}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};o([a({type:I,json:{write:{isRequired:!0}}})],l.prototype,"position",void 0),o([B("position")],l.prototype,"writePosition",null),o([W("position")],l.prototype,"readPosition",null),o([a({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),m(e=>k.normalize(y(e)))],l.prototype,"heading",void 0),o([a({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),m(e=>G(y(e),-180,180))],l.prototype,"tilt",void 0),o([a({type:Number,nonNullable:!0,json:{default:55,write:!0}}),m(e=>G(y(e,55),1,170))],l.prototype,"fov",void 0),o([a({type:V,nonNullable:!0,json:{read:!1,write:!1}})],l.prototype,"layout",void 0),l=o([h("esri.Camera")],l);const ve=l;var T;let d=T=class extends f{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new T({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};o([a({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:C}}}}})],d.prototype,"rotation",void 0),o([m("rotation")],d.prototype,"castRotation",null),o([a({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:C}}}}})],d.prototype,"scale",void 0),o([a({types:U,json:{read:F,write:!0,origins:{"web-scene":{read:F,write:{overridePolicy:C}}}}})],d.prototype,"targetGeometry",void 0),o([a({type:ve,json:{write:!0}})],d.prototype,"camera",void 0),d=T=o([h("esri.Viewpoint")],d);const Ce=d;function C(){return{enabled:!this.camera}}var A;let w=A=class extends f{constructor(e){super(e),this.type="none"}clone(){return new A({type:this.type})}};o([Z({none:"none",stayAbove:"stay-above"})],w.prototype,"type",void 0),w=A=o([h("esri.ground.NavigationConstraint")],w);var E;let p=E=class extends Q(H){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new K;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&N.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},s=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>s(r.item))])}initialize(){this.when().catch(e=>{X(e)||N.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)j(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",Y(e,this._get("layers")))}writeLayers(e,t,s,r){const i=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(u=>{if("write"in u){const v={};ee(u)().write(v,r)&&i.push(v)}else r!=null&&r.messages&&r.messages.push(new te("layer:unsupported",`Layers (${u.title}, ${u.id}) of type '${u.declaredClass}' cannot be persisted in the ground`,{layer:u}))})),t.layers=i}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return re(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await L(()=>import("./ElevationQuery-Bhbxi2uZ.js"),__vite__mapDeps([0,1,2,3,4,5]));_(t);const r=new s,i=this.layers.filter(R).toArray();return r.queryAll(i,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await L(()=>import("./ElevationQuery-Bhbxi2uZ.js"),__vite__mapDeps([0,1,2,3,4,5]));_(t);const r=new s,i=this.layers.filter(R).toArray();return r.createSamplerAll(i,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:x(this.surfaceColor),navigationConstraint:x(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new E({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,s){const r=(t==null?void 0:t.origin)||"web-scene",i=(t==null?void 0:t.portal)||null,u=(t==null?void 0:t.url)||null,{populateOperationalLayers:v}=await L(async()=>{const{populateOperationalLayers:$}=await import("./layersCreator-CNJ7O2pS.js");return{populateOperationalLayers:$}},__vite__mapDeps([6,1,2,7,8,9,10,11,3,4,12]));_(s);const P=[];if(e.layers&&Array.isArray(e.layers)){const $={context:{origin:r,url:u,portal:i,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};P.push(v(this.layers,e.layers,$))}await Promise.allSettled(P)}};function we(e){return e&&"createElevationSampler"in e}function R(e){return e.type==="elevation"||we(e)}o([a({json:{read:!1}})],p.prototype,"layers",null),o([B("layers")],p.prototype,"writeLayers",null),o([a({readOnly:!0})],p.prototype,"resourceInfo",void 0),o([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:q,read:{reader:oe,source:"transparency"},write:{writer:(e,t)=>{t.transparency=se(e)},target:"transparency"}}})],p.prototype,"opacity",void 0),o([a({type:O,json:{type:[q],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],p.prototype,"surfaceColor",void 0),o([a({type:w,json:{write:!0}})],p.prototype,"navigationConstraint",void 0),p=E=o([h("esri.Ground")],p);const g=p,D={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function be(e){let t=null;if(typeof e=="string")if(e in D){const s=D[e];t=new g({resourceInfo:{data:{layers:[s]}}})}else N.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=ae(g,e);return t}let n=class extends ce(he(ie.EventedMixin(ne))){constructor(e){super(e),this.allLayers=new z({getCollections:()=>{var t,s,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(s=this.ground)==null?void 0:s.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=me(this),this.basemap=null,this.editableLayers=new z({getCollections:()=>[this.allLayers],itemFilterFunction:le}),this.ground=new g,this._basemapCache=ye()}destroy(){ue(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=j(this.basemap),j(this.ground),this._set("ground",null)}castBasemap(e){return de(e,this._basemapCache)}castGround(e){return be(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};o([a({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),o([a({readOnly:!0})],n.prototype,"allTables",void 0),o([a({type:pe,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],n.prototype,"basemap",void 0),o([m("basemap")],n.prototype,"castBasemap",null),o([a({readOnly:!0})],n.prototype,"editableLayers",void 0),o([a({type:g,nonNullable:!0})],n.prototype,"ground",void 0),o([m("ground")],n.prototype,"castGround",null),o([a()],n.prototype,"undoRedo",void 0),n=o([h("esri.Map")],n);const Ie=n;var S;let b=S=class extends f{constructor(e){super(e),this.color=new O([0,0,0,1])}clone(){return new S(x({color:this.color}))}};o([a({type:O,json:{write:!0}})],b.prototype,"color",void 0),b=S=o([h("esri.webmap.background.ColorBackground")],b);const Ne=b;export{Ie as L,Ne as a,Ce as m};
