import{F as e,G as o,K as h,aG as g,aA as l,M as d}from"./index-C1aGfQcb.js";import{c as u}from"./GraphicsCollection-BlUFPpxh.js";import{a as c}from"./BitmapContainer-rte_DrKS.js";import{j as y}from"./LayerView2D-_cD1rRgW.js";import{F as f}from"./GraphicsView2D-igLDaNxb.js";import{h as x}from"./HighlightGraphicContainer-D7fVQPOh.js";import{_ as w}from"./ExportStrategy-Jkk4mBXy.js";import{y as _}from"./LayerView-ClcY0vUI.js";import{y as H}from"./ExportImageParameters-BqqZG4Ti.js";import{i as v}from"./timeSupport-BVjefMvf.js";import{i as I}from"./RefreshableLayerView-B0PsMbXg.js";import{R as $}from"./MapServiceLayerViewHelper-C3SEG_rC.js";import{r as E}from"./drapedUtils-BnpEPkkO.js";import"./WGLContainer-Bti4JDk_.js";import"./definitions-C0Jy3zs7.js";import"./LabelMetric-BbDPE4Hv.js";import"./enums-CmIX1y88.js";import"./Texture-CLoEFKJJ.js";import"./enums-Dk3osxpS.js";import"./Program-B50gSpr4.js";import"./BufferObject-C4qiEJeh.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./BoundingBox-CnpCxTZE.js";import"./vec2f32-BbH2jxlN.js";import"./VertexArrayObject-CzGu5bI8.js";import"./ProgramTemplate-FAwkPdO7.js";import"./mat2df32-BR-p9z6z.js";import"./mat3-Dg2BrR6m.js";import"./MapView-DMINGQ-3.js";import"./ColorBackground-BzAAhJtv.js";import"./CollectionFlattener-COw367kg.js";import"./basemapUtils-SfV6Ch_Z.js";import"./utils-sqJe3zMg.js";import"./TablesMixin-CmFQDxpI.js";import"./Layer-CneDw8eF.js";import"./TimeExtent-DGiXUfis.js";import"./timeUtils-X0MXjtQ8.js";import"./workers-CeelWDzo.js";import"./projection-BOBOhWzm.js";import"./projectBuffer-CZ7yaGuo.js";import"./TileInfo-C4AYiz3R.js";import"./TileKey-DZd6gJy7.js";import"./UpdatingHandles-DOPUoIlu.js";import"./screenUtils-CLE_gLy7.js";import"./signal-CRiDvIIF.js";import"./HeightModelInfo-kVs8dE0B.js";import"./Query-LPs1Zyw4.js";import"./FullTextSearch-Cza0yp3f.js";import"./IViewEvents-Bci6PjlS.js";import"./mat2df64-B7VPBnkO.js";import"./a11yUtils-Tsw26pQ5.js";import"./heightModelInfoUtils-BhzRw8-2.js";import"./arcgisLayerUrl-BkZy4Mr3.js";import"./ViewingMode-HRfKv6NR.js";import"./vec2f64-CCfZVA9N.js";import"./vec2-D9okOEat.js";import"./normalizeUtils-Bg1OALXh.js";import"./normalizeUtilsCommon-UUlRRPVA.js";import"./utils-DGPHbhMN.js";import"./utils-ByvCMLXh.js";import"./unitBezier-BX6NeAEr.js";import"./Scheduler-DS_v5N7L.js";import"./debugFlags-CfZYxH5Q.js";import"./Tile-9ZT_yo0a.js";import"./TileKey-C3cOKqPf.js";import"./QueueProcessor-8zZK2k9z.js";import"./quickselect-QQC62dOK.js";import"./vec32-CmwgPQMd.js";import"./HighlightDefaults-D7TbvM-a.js";import"./imageUtils-DpI9AOR9.js";import"./capabilities-A2uoe7dc.js";import"./themeUtils-C3zvZbsE.js";import"./accessibleHandler-CubitGf2.js";import"./GoTo-H_qEVlhS.js";import"./ZoomViewModel-BtZMM985.js";import"./utils-CS8i_70G.js";import"./Version-DD-eRUXC.js";import"./vec3f32-nZdmKIgz.js";import"./Container-DukYN7bA.js";import"./EffectView-Di3KCO94.js";import"./parser-C4Qiz3JH.js";import"./StyleDefinition-BTt_i6C1.js";import"./config-MDUrh2eL.js";import"./earcut-Lltz9D9k.js";import"./featureConversionUtils-C-Uqf9Q4.js";import"./OptimizedFeature-swgcyHeh.js";import"./OptimizedGeometry-C9mSZhHi.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./utils-BQBvadb7.js";import"./FieldsIndex-BrdRr9E_.js";import"./UnknownTimeZone-DhxWDwo9.js";import"./CIMSymbolHelper-CkjLOfcU.js";import"./BidiEngine-DNnuvc1i.js";import"./fontUtils-BVEStqBT.js";import"./GeometryUtils-Bkk2TwKC.js";import"./utils-D7agaEG-.js";import"./Rect-CUzevAry.js";import"./defaults-Dbnhuv3C.js";import"./defaultsJSON-GKolV7NZ.js";import"./OverrideHelper-D-UVQ00R.js";import"./colorUtils-BWiljOUv.js";import"./vec42-BHDxGccW.js";import"./vec4f64-o2zAXfmz.js";import"./quantizationUtils-DbJV_fl5.js";import"./AttributeStore-DoHrhu85.js";import"./TimeOnly-vNYE6bX9.js";import"./centroid-DdLmOD72.js";import"./UpdateTracking2D-Do-Jp4xp.js";import"./BindType-BmZEZMMh.js";import"./Util-BK6CBhAA.js";import"./labelUtils-C_ZaLudT.js";import"./diffUtils-DMLidw0V.js";import"./queryUtils-DfwPGxwH.js";import"./json-Wa8cmqdu.js";import"./timeSupport-DZeNU3Q4.js";import"./FeatureCommandQueue-DFtBlGYR.js";import"./constants-F8oTIn7N.js";import"./lengthUtils-CFwdZ3dz.js";import"./normalizeUtilsSync-DxE8L4Ib.js";import"./AGraphicContainer-Be74AnP4.js";import"./TechniqueInstance-Ct6vq7te.js";import"./TileContainer-ChXztKMJ.js";import"./Bitmap-Dit7l_zy.js";import"./scaleUtils-D2VbidBA.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./sublayerUtils-C2scBnIk.js";import"./languageUtils-DfhLIq1n.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-Czb1Shm3.js";import"./number-ByPuf2wa.js";import"./highlightUtils-Ch3EC-YF.js";import"./popupUtils-3iX6uIxV.js";const V=t=>{let r=class extends t{initialize(){this.exportImageParameters=new H({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){var i;return((i=this.view)==null?void 0:i.floors)??null}get exportImageVersion(){var i;return(i=this.exportImageParameters)==null||i.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){var i;return v(this.layer,(i=this.view)==null?void 0:i.timeExtent,this._get("timeExtent"))}canResume(){var i;return!!super.canResume()&&!((i=this.timeExtent)!=null&&i.isEmpty)}};return e([o()],r.prototype,"exportImageParameters",void 0),e([o({readOnly:!0})],r.prototype,"floors",null),e([o({readOnly:!0})],r.prototype,"exportImageVersion",null),e([o()],r.prototype,"layer",void 0),e([o()],r.prototype,"suspended",void 0),e([o({readOnly:!0})],r.prototype,"timeExtent",null),r=e([h("esri.views.layers.MapImageLayerView")],r),r};let m=class extends V(I(y(_))){constructor(){super(...arguments),this._highlightGraphics=new u,this._updateHash=""}fetchPopupFeaturesAtLocation(t,r){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,r)}update(t){const r=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==r&&(this._updateHash=r,this.strategy.update(t).catch(i=>{g(i)||l.getLogger(this).error(i)}),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:r,version:i}=this.layer,p=i>=10.3,n=i>=10;this._bitmapContainer=new c,this.container.addChild(this._bitmapContainer),this._highlightView=new f({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new x(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new $({createFetchPopupFeaturesQueryGeometry:(a,s)=>E(a,s,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(a,s)=>{this._highlightView.graphicUpdateHandler({graphic:a,property:s})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new w({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:r,imageRotationSupported:p,imageNormalizationSupported:n,hidpi:!0}),this.addAttachHandles(d(()=>this.exportImageVersion,()=>this.requestUpdate())),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,r,i,p){return this.layer.fetchImage(t,r,i,{timeExtent:this.timeExtent,floors:this.floors,...p})}fetchImageBitmap(t,r,i,p){return this.layer.fetchImageBitmap(t,r,i,{timeExtent:this.timeExtent,floors:this.floors,...p})}highlight(t){return this._popupHighlightHelper.highlight(t)}};e([o()],m.prototype,"strategy",void 0),e([o()],m.prototype,"updating",void 0),m=e([h("esri.views.2d.layers.MapImageLayerView2D")],m);const Xi=m;export{Xi as default};
